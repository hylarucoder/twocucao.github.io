<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"twocucao.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="本文是《Python ORM 三部曲的第二部 - Django ORM 的用法 &#x2F; 原理 &#x2F; 优化》 上一部的地址为《Python ORM 三部曲的第一部 - Python ORM 的三种实现模式》 本文基于最新 Django 版本  模型定义 Create&#x2F;Update&#x2F;Delete 各种查询 &#x2F; 链式调用 &#x2F; F 表达式 &#x2F; Window 函数 &#x2F;Lazy Loading &#x2F; Eager Lo">
<meta property="og:type" content="article">
<meta property="og:title" content="DjangoORMCheatSheet">
<meta property="og:url" content="http://twocucao.xyz/2018/04/28/DjangoORMCheatSheet/index.html">
<meta property="og:site_name" content="MG的编程小屋">
<meta property="og:description" content="本文是《Python ORM 三部曲的第二部 - Django ORM 的用法 &#x2F; 原理 &#x2F; 优化》 上一部的地址为《Python ORM 三部曲的第一部 - Python ORM 的三种实现模式》 本文基于最新 Django 版本  模型定义 Create&#x2F;Update&#x2F;Delete 各种查询 &#x2F; 链式调用 &#x2F; F 表达式 &#x2F; Window 函数 &#x2F;Lazy Loading &#x2F; Eager Lo">
<meta property="og:locale">
<meta property="article:published_time" content="2018-04-28T10:29:58.000Z">
<meta property="article:modified_time" content="2019-05-02T02:13:03.000Z">
<meta property="article:author" content="Micheal Gardner">
<meta property="article:tag" content="Django">
<meta property="article:tag" content="VueJS">
<meta property="article:tag" content="全栈开发">
<meta property="article:tag" content="RestAPI">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://twocucao.xyz/2018/04/28/DjangoORMCheatSheet/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>DjangoORMCheatSheet | MG的编程小屋</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="MG的编程小屋" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">MG的编程小屋</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Get Busy Living, Or Get Busy Dying</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://twocucao.xyz/2018/04/28/DjangoORMCheatSheet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Micheal Gardner">
      <meta itemprop="description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MG的编程小屋">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          DjangoORMCheatSheet
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-04-28 18:29:58" itemprop="dateCreated datePublished" datetime="2018-04-28T18:29:58+08:00">2018-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-02 10:13:03" itemprop="dateModified" datetime="2019-05-02T10:13:03+08:00">2019-05-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">后端开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>本文是《Python ORM 三部曲的第二部 - Django ORM 的用法 / 原理 / 优化》</p>
<p>上一部的地址为《Python ORM 三部曲的第一部 - Python ORM 的三种实现模式》</p>
<p>本文基于最新 Django 版本</p>
<ol>
<li>模型定义</li>
<li>Create/Update/Delete</li>
<li>各种查询 / 链式调用 / F 表达式 / Window 函数 /Lazy Loading / Eager Loading</li>
<li>Join</li>
<li>DEBUG 和 Profile 技巧</li>
</ol>
<p>本文是《Python ORM 三部曲的第一部 - Python 的三种数据源架构模式》</p>
<p>本文适用于：</p>
<ol>
<li>好奇 or 喜欢折腾的程序员</li>
<li>想深入了解 ORM 的程序员</li>
</ol>
<p>本文将解决你以下的疑惑：</p>
<ol>
<li>能不能不用 ORM?</li>
<li>ORM 为什么在某些场景下会胜于写 SQL</li>
<li>不同的 ORM 实现机制会带来什么差异？</li>
</ol>
<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>新工作的技术栈是以 Flask 为主，SQLAlchemy 是 许多玩 Flask 的人的标配。好，文档读起来，笔记搞起来。</p>
<blockquote>
<p>所以，本文记录的是 Django ORM</p>
</blockquote>
<p>逃。</p>
<p>这篇文章也是我对比 SqlAlchemy 以及 DjangoORM 的产物</p>
<h2 id="0x01-如何快速上手"><a href="#0x01-如何快速上手" class="headerlink" title="0x01 如何快速上手"></a>0x01 如何快速上手</h2><p>Django 世界里面，Django 的文档每次刷都会有新的发现。</p>
<h2 id="0x02-DjangoORM-的基本功能"><a href="#0x02-DjangoORM-的基本功能" class="headerlink" title="0x02 DjangoORM 的基本功能"></a>0x02 DjangoORM 的基本功能</h2><h3 id="2-1-模型定义-Model"><a href="#2-1-模型定义-Model" class="headerlink" title="2.1 模型定义 Model"></a>2.1 模型定义 Model</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">class Musician(models.Model):</span><br><span class="line">    first_name &#x3D; models.CharField(max_length&#x3D;50) # Field</span><br><span class="line">    last_name &#x3D; models.CharField(max_length&#x3D;50)</span><br><span class="line">    instrument &#x3D; models.CharField(max_length&#x3D;100)</span><br><span class="line"></span><br><span class="line">class Album(models.Model):</span><br><span class="line">    artist &#x3D; models.ForeignKey(Musician, on_delete&#x3D;models.CASCADE)</span><br><span class="line">    name &#x3D; models.CharField(max_length&#x3D;100)</span><br><span class="line">    release_date &#x3D; models.DateField()</span><br><span class="line">    num_stars &#x3D; models.IntegerField()</span><br><span class="line"></span><br><span class="line">    class Meta: # Model Meta</span><br><span class="line">        order_with_respect_to &#x3D; &#39;question&#39;</span><br></pre></td></tr></table></figure>

<p>可以看出，包含如下的部分：</p>
<ol>
<li>Model 与 Model 内部的 Meta</li>
<li>Field 与 Field 内部的 Options</li>
<li>Model 与 Model 之间的关系</li>
<li>其他，比如索引</li>
</ol>
<h4 id="Models-与-Meta"><a href="#Models-与-Meta" class="headerlink" title="Models 与 Meta"></a>Models 与 Meta</h4><blockquote>
<p>DjangoORM 是 ActivityRecord 模式的一种实现，在该模式下，Model 与 session 耦合。</p>
</blockquote>
<h4 id="Field-与-Field-Options"><a href="#Field-与-Field-Options" class="headerlink" title="Field 与 Field Options"></a>Field 与 Field Options</h4><h5 id="Field"><a href="#Field" class="headerlink" title="Field"></a>Field</h5><ul>
<li>AutoField</li>
<li>BigAutoField</li>
<li>BigIntegerField</li>
<li>BinaryField</li>
<li>BooleanField</li>
<li>CharField</li>
<li>DateField</li>
<li>DateTimeField</li>
<li>DecimalField</li>
<li>DurationField</li>
<li>EmailField</li>
<li>FileField</li>
<li>FileField and FieldFile</li>
<li>FilePathField</li>
<li>FloatField</li>
<li>ImageField</li>
<li>IntegerField</li>
<li>GenericIPAddressField</li>
<li>NullBooleanField</li>
<li>PositiveIntegerField</li>
<li>PositiveSmallIntegerField</li>
<li>SlugField</li>
<li>SmallIntegerField</li>
<li>TextField</li>
<li>TimeField</li>
<li>URLField</li>
<li>UUIDField</li>
</ul>
<p>虽然有这么多东东，其实常用的如下</p>
<ul>
<li>BigIntegerField</li>
<li>BooleanField</li>
<li>CharField</li>
<li>DateField</li>
<li>DateTimeField</li>
<li>DecimalField</li>
<li>IntegerField</li>
<li>TextField</li>
<li>TimeField</li>
</ul>
<p>有的字段属于那种，有也可以，没有也可以的。</p>
<p>FileField 之类的 往往现在都被 CDN 取代</p>
<h5 id="Field-Options"><a href="#Field-Options" class="headerlink" title="Field Options"></a>Field Options</h5><ul>
<li>null</li>
<li>blank</li>
<li>choices<ul>
<li>p.shirt_size</li>
<li>p.get_shirt_size_display()</li>
</ul>
</li>
<li>db_column</li>
<li>db_index</li>
<li>db_tablespace</li>
<li>default</li>
<li>editable</li>
<li>error_messages</li>
<li>help_text</li>
<li>primary_key</li>
<li>unique</li>
<li>unique_for_date</li>
<li>unique_for_month</li>
<li>unique_for_year</li>
<li>verbose_name</li>
<li>validators</li>
</ul>
<p>如此可见，Django 的 ORM 比起 SQLAlchemy 做了不少应用层的校验，一些 help_text</p>
<h4 id="Relationship"><a href="#Relationship" class="headerlink" title="Relationship"></a>Relationship</h4><p>表和表之间的关系</p>
<ol>
<li>A 表和 B 表 一对多 / 多对一</li>
<li>A 表和 B 表 一对一 （特殊的一对多）</li>
<li>A 表和 B 表 简单多对多 （借助中间的 Mapping 表进行映射）</li>
<li>A 表和 B 表 复杂多对多</li>
<li>A 表和 B 表 一对多</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">class Manufacturer(models.Model):</span><br><span class="line">    # ...</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">class Car(models.Model):</span><br><span class="line">    manufacturer &#x3D; models.ForeignKey(Manufacturer, on_delete&#x3D;models.CASCADE)</span><br><span class="line">    # ...</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">class Topping(models.Model):</span><br><span class="line">    # ...</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">class Pizza(models.Model):</span><br><span class="line">    # ...</span><br><span class="line">    toppings &#x3D; models.ManyToManyField(Topping)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">class Person(models.Model):</span><br><span class="line">    name &#x3D; models.CharField(max_length&#x3D;128)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">class Group(models.Model):</span><br><span class="line">    name &#x3D; models.CharField(max_length&#x3D;128)</span><br><span class="line">    members &#x3D; models.ManyToManyField(Person, through&#x3D;&#39;Membership&#39;)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">class Membership(models.Model):</span><br><span class="line">    person &#x3D; models.ForeignKey(Person, on_delete&#x3D;models.CASCADE)</span><br><span class="line">    group &#x3D; models.ForeignKey(Group, on_delete&#x3D;models.CASCADE)</span><br><span class="line">    date_joined &#x3D; models.DateField()</span><br><span class="line">    invite_reason &#x3D; models.CharField(max_length&#x3D;64)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Models across files</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objects</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Models 重写方法</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Models 继承</span><br><span class="line">https:&#x2F;&#x2F;docs.djangoproject.com&#x2F;en&#x2F;2.0&#x2F;topics&#x2F;db&#x2F;models&#x2F;#model-inheritance</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">组织代码 - 以及应对循环引用</span><br></pre></td></tr></table></figure>

<h3 id="2-2-QuerySet"><a href="#2-2-QuerySet" class="headerlink" title="2.2 QuerySet"></a>2.2 QuerySet</h3><h4 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c &#x3D; Child(name&#x3D;&quot;苏轼&quot;)</span><br><span class="line">c.save()</span><br><span class="line">p &#x3D; Parent(name&#x3D;&quot;苏辙&quot;)</span><br><span class="line">p.best_child &#x3D; c</span><br><span class="line">p.children.add([c,c2,c3,c4])</span><br><span class="line">p.save()</span><br></pre></td></tr></table></figure>

<h4 id="Retrieve"><a href="#Retrieve" class="headerlink" title="Retrieve"></a>Retrieve</h4><p>过滤</p>
<p>filter(**kwargs)<br>exclude(**kwargs)<br>.all()</p>
<h5 id="跨关系（跨表）查询"><a href="#跨关系（跨表）查询" class="headerlink" title="跨关系（跨表）查询"></a>跨关系（跨表）查询</h5><p>Blog.objects.filter(entry__headline__contains=’Lennon’)</p>
<p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/2.0/topics/db/queries/#lookups-that-span-relationships">https://docs.djangoproject.com/en/2.0/topics/db/queries/#lookups-that-span-relationships</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/2.0/topics/db/queries/#spanning-multi-valued-relationships">https://docs.djangoproject.com/en/2.0/topics/db/queries/#spanning-multi-valued-relationships</a></p>
<h5 id="prefetch-related-amp-amp-select-related"><a href="#prefetch-related-amp-amp-select-related" class="headerlink" title="prefetch_related &amp;&amp; select_related"></a>prefetch_related &amp;&amp; select_related</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select_related</span><br><span class="line"></span><br><span class="line">生成 join 的 SQL, 可以用来减少 N+1 , 不过仅仅支持一对多，和一对一</span><br><span class="line"></span><br><span class="line">prefetch_related</span><br></pre></td></tr></table></figure>

<h5 id="Limit-Offset-分页"><a href="#Limit-Offset-分页" class="headerlink" title="Limit / Offset / 分页"></a>Limit / Offset / 分页</h5><p>Blog.objects.filter(entry__headline__contains=’Lennon’)[30:20]</p>
<h5 id="链式调用"><a href="#链式调用" class="headerlink" title="链式调用"></a>链式调用</h5><p>query = query.filter(**kwargs)<br>query = query.exclude(**kwargs)</p>
<h5 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h5><p>Django 里面最强大的就是其 Q 表达式了</p>
<p>Q(question__startswith=’Who’) | Q(question__startswith=’What’)</p>
<p>Poll.objects.get(<br>    Q(question__startswith=’Who’),<br>    Q(pub_date=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6))<br>)</p>
<p>这个表达式甚至可以嵌套超级深从而完成一个比较深的跨表查询。</p>
<blockquote>
<p>并且，这种 API 查询反而在写前端 API 的时候，可以传入 question__startswith 这类参数，从而直接完成一组搜索。</p>
</blockquote>
<p>Q / F</p>
<h5 id="执行查询"><a href="#执行查询" class="headerlink" title="执行查询"></a>执行查询</h5><p>需要注意的的是，SQLAlchemy 必须显式执行查询，而 Django 不一定。</p>
<p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/2.0/ref/models/querysets/#when-querysets-are-evaluated">https://docs.djangoproject.com/en/2.0/ref/models/querysets/#when-querysets-are-evaluated</a></p>
<p>在 Django 内部实现的时候，一个 queryset 创建 / 过滤 / 切片 / 传送，<strong>除非这个 queryset 被 evaluated 了</strong>, 否则不会做数据库的操作。</p>
<ul>
<li>iteration</li>
<li>Slicing</li>
<li>Pickling/Caching</li>
<li>repr</li>
<li>len</li>
<li>list</li>
<li>bool</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">all()</span><br><span class="line">first()</span><br><span class="line">last()</span><br><span class="line">exist()</span><br></pre></td></tr></table></figure>

<h5 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h5><ul>
<li>pk</li>
<li>model</li>
</ul>
<h5 id="复制-实例"><a href="#复制-实例" class="headerlink" title="复制 实例"></a>复制 实例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">blog &#x3D; Blog(name&#x3D;&#39;My blog&#39;, tagline&#x3D;&#39;Blogging is easy&#39;)</span><br><span class="line">blog.save() # blog.pk &#x3D;&#x3D; 1</span><br><span class="line"></span><br><span class="line">blog.pk &#x3D; None</span><br><span class="line">blog.save() # blog.pk &#x3D;&#x3D; 2</span><br><span class="line"></span><br><span class="line"># 但这个并不拷贝外键？???</span><br><span class="line">https:&#x2F;&#x2F;docs.djangoproject.com&#x2F;en&#x2F;2.0&#x2F;topics&#x2F;db&#x2F;queries&#x2F;#copying-model-instances</span><br></pre></td></tr></table></figure>

<h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 默认查询的是所有字段，但我希望查询部分字段</span><br><span class="line"># TODO: 阿萨德</span><br><span class="line"># Distinct</span><br><span class="line"># OrderBy</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="缓存机制"><a href="#缓存机制" class="headerlink" title="缓存机制"></a>缓存机制</h5><p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/2.0/topics/db/queries/#caching-and-querysets">https://docs.djangoproject.com/en/2.0/topics/db/queries/#caching-and-querysets</a></p>
<h4 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h4><p>单个 object 更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">blog.title &#x3D; &quot;大宝天天见&quot;</span><br><span class="line">blog.save()</span><br></pre></td></tr></table></figure>

<p>批量更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query.update(headline&#x3D;F(&#39;blog__name&#39;))</span><br></pre></td></tr></table></figure>

<p>一对多的更新（类似于 Set 操作）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">add(obj1, obj2, ...)</span><br><span class="line">create(**kwargs)</span><br><span class="line">remove(obj1, obj2, ...)</span><br><span class="line">clear()</span><br><span class="line">set(objs)</span><br></pre></td></tr></table></figure>

<h4 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h4><h5 id="ForeignKey"><a href="#ForeignKey" class="headerlink" title="ForeignKey"></a>ForeignKey</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Car(models.Model):</span><br><span class="line">    manufacturer &#x3D; models.ForeignKey(</span><br><span class="line">        &#39;production.Manufacturer&#39;, # 用来解决循环 circular import</span><br><span class="line">        on_delete&#x3D;models.CASCADE,</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>on_delete 的情况</p>
<ul>
<li>PROTECT 阻止</li>
<li>CASCADE 应用层的级联删除</li>
<li>SET_NULL 应用层的级联 SET_NULL</li>
<li>SET_DEFAULT</li>
<li>DO_NOTHING</li>
<li>SET() 一个 callback</li>
</ul>
<h4 id="聚集查询"><a href="#聚集查询" class="headerlink" title="聚集查询"></a>聚集查询</h4><p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/2.0/topics/db/aggregation/">https://docs.djangoproject.com/en/2.0/topics/db/aggregation/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Book.objects.all().aggregate(Max(&#39;price&#39;))</span><br><span class="line">Book.objects.aggregate(price_diff&#x3D;Max(&#39;price&#39;, output_field&#x3D;FloatField()) - Avg(&#39;price&#39;))</span><br><span class="line">Book.objects.annotate(num_authors&#x3D;Count(&#39;authors&#39;))</span><br><span class="line">Book.objects.annotate(num_authors&#x3D;Count(&#39;authors&#39;)).aggregate(Avg(&#39;num_authors&#39;)) # &#123;&#39;num_authors__avg&#39;: 1.66&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h4><p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/2.0/topics/db/search/">https://docs.djangoproject.com/en/2.0/topics/db/search/</a></p>
<h4 id="Window-Function"><a href="#Window-Function" class="headerlink" title="Window Function"></a>Window Function</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Option.objects.annotate(</span><br><span class="line">		rank_num&#x3D;Window(</span><br><span class="line">				expression&#x3D;Rank(),</span><br><span class="line">				partition_by&#x3D;F(&quot;vote_id&quot;),</span><br><span class="line">				order_by&#x3D;[F(&quot;current_vote_count&quot;).desc(), F(&quot;id&quot;).desc()],</span><br><span class="line">		),</span><br><span class="line">		lag_vote_num&#x3D;Window(</span><br><span class="line">				expression&#x3D;Lag(&quot;current_vote_count&quot;),</span><br><span class="line">				partition_by&#x3D;F(&quot;vote_id&quot;),</span><br><span class="line">				order_by&#x3D;[F(&quot;current_vote_count&quot;).desc(), F(&quot;id&quot;).desc()],</span><br><span class="line">		),</span><br><span class="line">)</span><br><span class="line">.filter(vote&#x3D;obj.vote)</span><br><span class="line">.order_by(&quot;-current_vote_count&quot;, &quot;id&quot;)</span><br><span class="line">.values(&quot;id&quot;, &quot;rank_num&quot;, &quot;current_vote_count&quot;, &quot;lag_vote_num&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Model-Instances"><a href="#2-2-Model-Instances" class="headerlink" title="2.2 Model Instances"></a>2.2 Model Instances</h3><p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/2.0/ref/models/instances/">https://docs.djangoproject.com/en/2.0/ref/models/instances/</a></p>
<h3 id="2-3-模型实例"><a href="#2-3-模型实例" class="headerlink" title="2.3 模型实例"></a>2.3 模型实例</h3><h3 id="2-4-迁移机制"><a href="#2-4-迁移机制" class="headerlink" title="2.4 迁移机制"></a>2.4 迁移机制</h3><ol>
<li>加 INSTALLED_APPS</li>
</ol>
<h2 id="0x03-Django-ORM-的高级功能"><a href="#0x03-Django-ORM-的高级功能" class="headerlink" title="0x03 Django ORM 的高级功能"></a>0x03 Django ORM 的高级功能</h2><h3 id="maneger"><a href="#maneger" class="headerlink" title="maneger"></a>maneger</h3><p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/2.0/topics/db/managers/">https://docs.djangoproject.com/en/2.0/topics/db/managers/</a></p>
<h3 id="raw-sql"><a href="#raw-sql" class="headerlink" title="raw sql"></a>raw sql</h3><p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/2.0/topics/db/sql/">https://docs.djangoproject.com/en/2.0/topics/db/sql/</a></p>
<h4 id="database-fuction"><a href="#database-fuction" class="headerlink" title="database-fuction"></a>database-fuction</h4><p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/2.0/ref/models/database-functions/">https://docs.djangoproject.com/en/2.0/ref/models/database-functions/</a></p>
<h2 id="0x04-Database-Access-Optimization"><a href="#0x04-Database-Access-Optimization" class="headerlink" title="0x04 Database Access Optimization"></a>0x04 Database Access Optimization</h2><h3 id="4-1-使用连接池"><a href="#4-1-使用连接池" class="headerlink" title="4.1 使用连接池"></a>4.1 使用连接池</h3><p>连接池是一种永远在线模型的实现</p>
<p>连接池：驱动程序类型</p>
<p>连接池：代理类型</p>
<h3 id="4-2-减少对-MySQL-的访问"><a href="#4-2-减少对-MySQL-的访问" class="headerlink" title="4.2 减少对 MySQL 的访问"></a>4.2 减少对 MySQL 的访问</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from pg_stat_activity where pid &lt;&gt; pg_backend_pid() and usename &#x3D; current_user;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Before"><a href="#Before" class="headerlink" title="Before"></a>Before</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from pg_stat_activity where pid &lt;&gt; pg_backend_pid() and usename &#x3D; current_user;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Profile-First"><a href="#Profile-First" class="headerlink" title="Profile First"></a>Profile First</h3><ol>
<li>django-extentions</li>
<li>django-debug-toolbar</li>
</ol>
<p>手动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">queryset.explain</span><br><span class="line"></span><br><span class="line">from django.db import connection</span><br><span class="line">connection.queries</span><br><span class="line"></span><br><span class="line">from django.db import reset_queries</span><br><span class="line">reset_queries()</span><br></pre></td></tr></table></figure>

<h2 id="0x05-Django-ORM-Under-The-Hood"><a href="#0x05-Django-ORM-Under-The-Hood" class="headerlink" title="0x05 Django ORM Under The Hood"></a>0x05 Django ORM Under The Hood</h2><h3 id="理解-QuerySet"><a href="#理解-QuerySet" class="headerlink" title="理解 QuerySet"></a>理解 QuerySet</h3><ul>
<li>querysets-are-lazy when-querysets-are-evaluated<ul>
<li>Iteration</li>
<li>Slicing</li>
<li>Pickling/Caching</li>
<li>len</li>
<li>repr</li>
<li>list</li>
<li>bool</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj &#x3D;&#x3D; nobj # obj.id &#x3D;&#x3D; nobj.id</span><br></pre></td></tr></table></figure>

<ul>
<li>caching-and-querysets</li>
</ul>
<h3 id="理解-cached-attributes"><a href="#理解-cached-attributes" class="headerlink" title="理解 cached attributes"></a>理解 cached attributes</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; entry &#x3D; Entry.objects.get(id&#x3D;1)</span><br><span class="line">&gt;&gt;&gt; entry.blog   # Blog object is retrieved at this point</span><br><span class="line">&gt;&gt;&gt; entry.blog   # cached version, no DB access</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; entry &#x3D; Entry.objects.get(id&#x3D;1)</span><br><span class="line">&gt;&gt;&gt; entry.authors.all()   # query performed</span><br><span class="line">&gt;&gt;&gt; entry.authors.all()   # query performed again</span><br></pre></td></tr></table></figure>

<h2 id="0xEE-参考链接"><a href="#0xEE-参考链接" class="headerlink" title="0xEE 参考链接"></a>0xEE 参考链接</h2><hr>
<p>ChangeLog:</p>
<ul>
<li><strong>2018-03-09</strong> 重修文字</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Django/" rel="tag"># Django</a>
              <a href="/tags/VueJS/" rel="tag"># VueJS</a>
              <a href="/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/" rel="tag"># 全栈开发</a>
              <a href="/tags/RestAPI/" rel="tag"># RestAPI</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/03/31/SQLAlchemyCheatSheet/" rel="prev" title="SQLAlchemyCheatSheet">
      <i class="fa fa-chevron-left"></i> SQLAlchemyCheatSheet
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/05/16/PyConDjango/" rel="next" title="PyCon 2018 之 Django 专题与 未来的包管理工具 pipenv">
      PyCon 2018 之 Django 专题与 未来的包管理工具 pipenv <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x00-%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">0x00 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="nav-number">2.</span> <span class="nav-text">0x01 如何快速上手</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-DjangoORM-%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD"><span class="nav-number">3.</span> <span class="nav-text">0x02 DjangoORM 的基本功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E6%A8%A1%E5%9E%8B%E5%AE%9A%E4%B9%89-Model"><span class="nav-number">3.1.</span> <span class="nav-text">2.1 模型定义 Model</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Models-%E4%B8%8E-Meta"><span class="nav-number">3.1.1.</span> <span class="nav-text">Models 与 Meta</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Field-%E4%B8%8E-Field-Options"><span class="nav-number">3.1.2.</span> <span class="nav-text">Field 与 Field Options</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Field"><span class="nav-number">3.1.2.1.</span> <span class="nav-text">Field</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Field-Options"><span class="nav-number">3.1.2.2.</span> <span class="nav-text">Field Options</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Relationship"><span class="nav-number">3.1.3.</span> <span class="nav-text">Relationship</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-QuerySet"><span class="nav-number">3.2.</span> <span class="nav-text">2.2 QuerySet</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Create"><span class="nav-number">3.2.1.</span> <span class="nav-text">Create</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Retrieve"><span class="nav-number">3.2.2.</span> <span class="nav-text">Retrieve</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%A8%E5%85%B3%E7%B3%BB%EF%BC%88%E8%B7%A8%E8%A1%A8%EF%BC%89%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.2.2.1.</span> <span class="nav-text">跨关系（跨表）查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#prefetch-related-amp-amp-select-related"><span class="nav-number">3.2.2.2.</span> <span class="nav-text">prefetch_related &amp;&amp; select_related</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Limit-Offset-%E5%88%86%E9%A1%B5"><span class="nav-number">3.2.2.3.</span> <span class="nav-text">Limit &#x2F; Offset &#x2F; 分页</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8"><span class="nav-number">3.2.2.4.</span> <span class="nav-text">链式调用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">3.2.2.5.</span> <span class="nav-text">表达式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.2.2.6.</span> <span class="nav-text">执行查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AF%94%E8%BE%83"><span class="nav-number">3.2.2.7.</span> <span class="nav-text">比较</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6-%E5%AE%9E%E4%BE%8B"><span class="nav-number">3.2.2.8.</span> <span class="nav-text">复制 实例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B6%E4%BB%96"><span class="nav-number">3.2.2.9.</span> <span class="nav-text">其他</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="nav-number">3.2.2.10.</span> <span class="nav-text">缓存机制</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Update"><span class="nav-number">3.2.3.</span> <span class="nav-text">Update</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Delete"><span class="nav-number">3.2.4.</span> <span class="nav-text">Delete</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ForeignKey"><span class="nav-number">3.2.4.1.</span> <span class="nav-text">ForeignKey</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%81%9A%E9%9B%86%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.2.5.</span> <span class="nav-text">聚集查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Search"><span class="nav-number">3.2.6.</span> <span class="nav-text">Search</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Window-Function"><span class="nav-number">3.2.7.</span> <span class="nav-text">Window Function</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-Model-Instances"><span class="nav-number">3.3.</span> <span class="nav-text">2.2 Model Instances</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E6%A8%A1%E5%9E%8B%E5%AE%9E%E4%BE%8B"><span class="nav-number">3.4.</span> <span class="nav-text">2.3 模型实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E8%BF%81%E7%A7%BB%E6%9C%BA%E5%88%B6"><span class="nav-number">3.5.</span> <span class="nav-text">2.4 迁移机制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-Django-ORM-%E7%9A%84%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD"><span class="nav-number">4.</span> <span class="nav-text">0x03 Django ORM 的高级功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#maneger"><span class="nav-number">4.1.</span> <span class="nav-text">maneger</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#raw-sql"><span class="nav-number">4.2.</span> <span class="nav-text">raw sql</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#database-fuction"><span class="nav-number">4.2.1.</span> <span class="nav-text">database-fuction</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-Database-Access-Optimization"><span class="nav-number">5.</span> <span class="nav-text">0x04 Database Access Optimization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E4%BD%BF%E7%94%A8%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-number">5.1.</span> <span class="nav-text">4.1 使用连接池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%87%8F%E5%B0%91%E5%AF%B9-MySQL-%E7%9A%84%E8%AE%BF%E9%97%AE"><span class="nav-number">5.2.</span> <span class="nav-text">4.2 减少对 MySQL 的访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Before"><span class="nav-number">5.3.</span> <span class="nav-text">Before</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Profile-First"><span class="nav-number">5.4.</span> <span class="nav-text">Profile First</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x05-Django-ORM-Under-The-Hood"><span class="nav-number">6.</span> <span class="nav-text">0x05 Django ORM Under The Hood</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%90%86%E8%A7%A3-QuerySet"><span class="nav-number">6.1.</span> <span class="nav-text">理解 QuerySet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%90%86%E8%A7%A3-cached-attributes"><span class="nav-number">6.2.</span> <span class="nav-text">理解 cached attributes</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0xEE-%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="nav-number">7.</span> <span class="nav-text">0xEE 参考链接</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Micheal Gardner</p>
  <div class="site-description" itemprop="description">Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">93</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">96</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Micheal Gardner</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




  















  

  

</body>
</html>
