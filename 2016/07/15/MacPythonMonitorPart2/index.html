<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"twocucao.xyz","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="前言如果有不清楚本文介绍的是什么的？请移步（使用 Python 监控 Mac 一天的运行 - 上）[http:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;9ebb527e93a0] 任务回顾一下：  隔一段时间使用 Python 脚本，统计当前电脑的运行情况，CPU, 内存，硬盘，网络使用状况，然后在每天的下午六点通过 Email 把统计情况汇总，并且必须要有监控图，并通过 Email 发送给我的邮箱">
<meta property="og:type" content="article">
<meta property="og:title" content="使用 Python 监控 Mac 一天的运行（下）">
<meta property="og:url" content="http://twocucao.xyz/2016/07/15/MacPythonMonitorPart2/index.html">
<meta property="og:site_name" content="MG的编程小屋">
<meta property="og:description" content="前言如果有不清楚本文介绍的是什么的？请移步（使用 Python 监控 Mac 一天的运行 - 上）[http:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;9ebb527e93a0] 任务回顾一下：  隔一段时间使用 Python 脚本，统计当前电脑的运行情况，CPU, 内存，硬盘，网络使用状况，然后在每天的下午六点通过 Email 把统计情况汇总，并且必须要有监控图，并通过 Email 发送给我的邮箱">
<meta property="og:locale">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/52890-b79e26953467d4a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/52890-e7979c928d1bf4ec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/52890-92c75ac53eedd2bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/52890-061e0e0c91521d9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/52890-59100ed39a3b8588.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="article:published_time" content="2016-07-15T10:50:23.000Z">
<meta property="article:modified_time" content="2017-12-19T05:33:11.000Z">
<meta property="article:author" content="Micheal Gardner">
<meta property="article:tag" content="效率">
<meta property="article:tag" content="小玩具">
<meta property="article:tag" content="编程工具">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/52890-b79e26953467d4a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">

<link rel="canonical" href="http://twocucao.xyz/2016/07/15/MacPythonMonitorPart2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>使用 Python 监控 Mac 一天的运行（下） | MG的编程小屋</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="MG的编程小屋" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">MG的编程小屋</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Get Busy Living, Or Get Busy Dying</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://twocucao.xyz/2016/07/15/MacPythonMonitorPart2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Micheal Gardner">
      <meta itemprop="description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MG的编程小屋">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          使用 Python 监控 Mac 一天的运行（下）
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-15 18:50:23" itemprop="dateCreated datePublished" datetime="2016-07-15T18:50:23+08:00">2016-07-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-12-19 13:33:11" itemprop="dateModified" datetime="2017-12-19T13:33:11+08:00">2017-12-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E9%BB%91%E9%AD%94%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">Python 黑魔法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>如果有不清楚本文介绍的是什么的？请移步<br>（使用 Python 监控 Mac 一天的运行 - 上）[<a target="_blank" rel="noopener" href="http://www.jianshu.com/p/9ebb527e93a0]">http://www.jianshu.com/p/9ebb527e93a0]</a></p>
<p>任务回顾一下：</p>
<blockquote>
<p>隔一段时间使用 Python 脚本，统计当前电脑的运行情况，CPU, 内存，硬盘，网络使用状况，然后在每天的下午六点通过 Email 把统计情况汇总，并且必须要有监控图，并通过 Email 发送给我的邮箱。</p>
</blockquote>
<p>好了，这篇文章，我们讲解的是具体的 Python 脚本完成这些任务。因为代码可能稍微复杂一点点，老规矩，讲解思路和必要注意点，其他的请参阅代码。</p>
<h2 id="目标确定与任务分解"><a href="#目标确定与任务分解" class="headerlink" title="目标确定与任务分解"></a>目标确定与任务分解</h2><p>目标就如同上面两段所写。</p>
<p>那么把任务分解一下：</p>
<ul>
<li>首先，你得知道如何获取计算机的运行信息。</li>
<li>其次，你得知道如何把这些数据保存下来（不保存怎么分析）.</li>
<li>接着，你得知道如何分析并制图。</li>
<li>最后，你得知道如何发送邮件。</li>
</ul>
<p>好了，本文的目录也就应运而生了。</p>
<ul>
<li>前言</li>
<li>目标确定和任务分解</li>
<li>Python 获取计算机运行信息</li>
<li>RRDTool 保存计算机运行信息<ul>
<li>为什么是 RRDTool 而不是 sqlite</li>
<li>RRD 怎么保存信息</li>
<li>RRD 怎么保存计算机运行信息</li>
</ul>
</li>
<li>RRDTool 制图功能</li>
<li>汇总并发送 Email</li>
<li>思考与不足</li>
<li>代码</li>
</ul>
<h2 id="Python-获取计算机运行信息"><a href="#Python-获取计算机运行信息" class="headerlink" title="Python 获取计算机运行信息"></a>Python 获取计算机运行信息</h2><p>我们知道有很多 shell 命令可以获取当前时间点，或者当前时间段的计算机各种情况，但是呢，我们只需要某个时间点的计算机的运行情况，Python 中有一个比较好的神器叫做 psutil, 果断安装之。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install psutil</span><br></pre></td></tr></table></figure>

<p>运行如下脚本，你就可以看出来你的电脑运行的当前状况了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> rrdtool</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen,URLError</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> getpass</span><br><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">now = <span class="built_in">str</span>(time.strftime(<span class="string">&quot;%Y%m%d%H%M%S&quot;</span>))</span><br><span class="line">today = <span class="built_in">str</span>(time.strftime(<span class="string">&quot;%Y%m%d&quot;</span>))</span><br><span class="line"></span><br><span class="line">logging.basicConfig(</span><br><span class="line">    <span class="built_in">format</span>=<span class="string">&quot;%(asctime)s - \</span></span><br><span class="line"><span class="string">[%(process)d]%(filename)s:%(lineno)d - %(levelname)s: %(message)s&quot;</span>,</span><br><span class="line">    datefmt=<span class="string">&#x27;%Y-%m-%d %H:%I:%S&#x27;</span>,</span><br><span class="line">    filename=os.path.expanduser(<span class="string">&#x27;~/OhMyCode/PyTools/logs/&#x27;</span>+today+<span class="string">&#x27;.log&#x27;</span>),</span><br><span class="line">    level=logging.INFO</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;monitor_my_mac&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sys.version_info &lt; (<span class="number">3</span>,):</span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;at least Python3.0 is required!!&quot;</span>)</span><br><span class="line">APP_DESC = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                ---- A Terminal Tools For Monitoring Mac Daily</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author Micheal Gardner (twocucao@gmail.com)</span></span><br><span class="line"><span class="string">                                last_update 2016-02-28</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">linux_distribution</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> platform.linux_distribution()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;N/A&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_connectivity</span>(<span class="params">reference</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查是否连接到网络&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        urlopen(reference, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> URLError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">secs2str</span>(<span class="params">secs</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 将秒转化为字符串 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">int</span>(secs) &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>,time.localtime(secs)))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fetch_all_info</span>():</span></span><br><span class="line">    network_connectivity = check_connectivity(<span class="string">&quot;http://119.75.218.70&quot;</span>)</span><br><span class="line"></span><br><span class="line">    public_ip_addr = urlopen(<span class="string">&#x27;http://ip.42.pl/raw&#x27;</span>).read().decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#=============&gt;操作系统信息&lt;==============#</span></span><br><span class="line">    print(<span class="string">&quot;========&gt;MACHINE&lt;==========&quot;</span>)</span><br><span class="line">    print(getpass.getuser())</span><br><span class="line">    print(platform.uname())</span><br><span class="line">    <span class="comment"># print(os.uname())</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;&quot;&quot;Python version: %s</span></span><br><span class="line"><span class="string">    dist: %s</span></span><br><span class="line"><span class="string">    linux_distribution: %s</span></span><br><span class="line"><span class="string">    system: %s</span></span><br><span class="line"><span class="string">    machine: %s</span></span><br><span class="line"><span class="string">    platform: %s</span></span><br><span class="line"><span class="string">    uname: %s</span></span><br><span class="line"><span class="string">    version: %s</span></span><br><span class="line"><span class="string">    mac_ver: %s</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span> % (</span><br><span class="line">    sys.version.split(<span class="string">&#x27;\n&#x27;</span>),</span><br><span class="line">    <span class="built_in">str</span>(platform.dist()),</span><br><span class="line">    linux_distribution(),</span><br><span class="line">    platform.system(),</span><br><span class="line">    platform.machine(),</span><br><span class="line">    platform.platform(),</span><br><span class="line">    platform.uname(),</span><br><span class="line">    platform.version(),</span><br><span class="line">    platform.mac_ver(),</span><br><span class="line">    ))</span><br><span class="line"></span><br><span class="line">    os_boot_time = psutil.boot_time()</span><br><span class="line">    print(<span class="string">&quot;Boottime: &quot;</span> + <span class="built_in">str</span>(os_boot_time) +<span class="string">&quot;-&gt;&quot;</span>+secs2str(os_boot_time)  )</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;========&gt;CPU&lt;==========&quot;</span>)</span><br><span class="line">    print(psutil.cpu_times())</span><br><span class="line">    print(psutil.cpu_count())</span><br><span class="line">    print(psutil.cpu_count(logical=<span class="literal">False</span>))</span><br><span class="line">    print(psutil.cpu_times_percent())</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;========&gt;MEM&lt;==========&quot;</span>)</span><br><span class="line">    print(psutil.virtual_memory())</span><br><span class="line">    print(psutil.swap_memory())</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;========&gt;DISK&lt;==========&quot;</span>)</span><br><span class="line">    print(psutil.disk_partitions())</span><br><span class="line">    print(psutil.disk_usage(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">    print(psutil.disk_io_counters())</span><br><span class="line">    print(psutil.disk_io_counters(perdisk=<span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;========&gt;NET&lt;==========&quot;</span>)</span><br><span class="line">    print(psutil.net_io_counters())</span><br><span class="line">    print(psutil.net_io_counters(pernic=<span class="literal">True</span>))</span><br><span class="line">    print(psutil.users())</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;hostname:&quot;</span> + socket.gethostname())</span><br><span class="line">    print(<span class="string">&quot;internal ip address: &quot;</span> + socket.gethostbyname(socket.gethostname()))</span><br><span class="line">    print(<span class="string">&quot;connected to internet?: &quot;</span> + <span class="built_in">str</span>(network_connectivity))</span><br><span class="line">    print(<span class="string">&quot;public ip: &quot;</span> + public_ip_addr )</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    print(APP_DESC)</span><br><span class="line">    fetch_all_info()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>好的，下面我就想把这些数据保存下来。</p>
<h2 id="RRDTool-保存计算机运行信息"><a href="#RRDTool-保存计算机运行信息" class="headerlink" title="RRDTool 保存计算机运行信息"></a>RRDTool 保存计算机运行信息</h2><p>对于 RRDTool, 引自 RRDTool 的官网</p>
<blockquote>
<p>RRDtool is the OpenSource industry standard, high performance data logging and graphing system for time series data. RRDtool can be easily integrated in shell scripts, perl, python, ruby, lua or tcl applications.</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/52890-b79e26953467d4a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="stream-pop.png"></p>
<blockquote>
<p><strong>注意：</strong>    如果你看不懂下面关于 RRDTool 的相关内容，请立即反复参考下面的链接，大致留下 rrd 的印象。注意，<strong>是反复，是反复，是反复</strong>, 重要的事情听说要说三遍的。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://oss.oetiker.ch/rrdtool/tut/rrdtutorial.en.html">http://oss.oetiker.ch/rrdtool/tut/rrdtutorial.en.html</a></p>
<p>wait,wait,don’t tell me, 你怎么使用这个什么 RRDTool, 这又是什么东西？既然你一天只存储一点点的东西，为什么不使用 sqlite?</p>
<h3 id="为什么是-RRDTool-而不是-sqlite"><a href="#为什么是-RRDTool-而不是-sqlite" class="headerlink" title="为什么是 RRDTool 而不是 sqlite"></a>为什么是 RRDTool 而不是 sqlite</h3><p>答案很简单，因为我们采用的是监控，采用 sqlite 不是说不可以，只是 sqlite 在监控领域不是很专业。那为什么不够专业呢？</p>
<blockquote>
<p>因为在这个场景下，仅仅有存储数据的功能是不够的。</p>
</blockquote>
<blockquote>
<p>还需要根据监控的场景，进行各种绘图功能。</p>
</blockquote>
<ul>
<li>如果使用 sqlite, 还要安装各种 python 绘图，运算库 (seaborn,numpy,pandas 等）进行统计绘图，那样就不够轻量级了。</li>
<li>而 rrdtool 作为运维监控的常用工具，则成为首选数据库。</li>
</ul>
<h3 id="RRD-怎么保存信息"><a href="#RRD-怎么保存信息" class="headerlink" title="RRD 怎么保存信息"></a>RRD 怎么保存信息</h3><p>既然，这是一种叫做数据库的东西，那么，最好的学习方式就是和在实战中练习并且和之前学过的同类型数据进行对比。</p>
<p>那好，我们要回想一下，在学习过的关系型数据库里面，我们是怎么进行数据的怎删改查的。</p>
<p>首先，对于关系型数据库，DBA 创建数据库并指派给某些权限用户，接着由 DB 用户创建表，表中需要各种数据的定义数据类型，最后插入数据，并且进行大量的 curd.</p>
<p>在 sqlite 这种依靠单个文件作为存储介质的关系型数据库，则是由 DB 用户创建表，表中需要各种数据的定义数据类型，最后依赖 SQL 语句插入数据，并且进行大量的 curd.（注：没有谈到事务不代表事务不重要）</p>
<p>rrdtool 也是这个道理。它也是依靠单文件作为存储介质的一种 rrd 数据库的实现。先看下面的实例：</p>
<p>这个实例来自于官网的 tutorial : <a target="_blank" rel="noopener" href="http://oss.oetiker.ch/rrdtool/tut/rrdtutorial.en.html">http://oss.oetiker.ch/rrdtool/tut/rrdtutorial.en.html</a></p>
<p>仔细阅读官方教程，我们大致可以得出以下结论。</p>
<p>对于创建数据库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rrdtool create test.rrd             \</span><br><span class="line">        --start 920804400          \</span><br><span class="line">        DS:speed:COUNTER:600:0:U   \</span><br><span class="line">        RRA:AVERAGE:0.5:1:24       \</span><br><span class="line">        RRA:AVERAGE:0.5:6:10</span><br></pre></td></tr></table></figure>

<ul>
<li>创建一个数据库文件，文件名为 test,</li>
<li>开始时间为 unix 时间戳 920804400 ,</li>
<li>存储的行车速度（额，其实这里我觉得用行车路程表示比较好）</li>
<li>用两个 rra 用来保存”当保存行车路程的时候，经过计算的值”.</li>
<li>一个 databese 是一个 rrd 文件，一个 rrd 文件中存储多个 rra（类似于关系型数据库中，一个数据库里面有多张表）, 但是这里的”表”是用来存储不同的时间间隔的数据，所有的数据来源由创建数据库的时候指定的，(rr 代表 round robin,a 代表 achive)</li>
<li>第一个 RRA 存储的是平均值（也可以存储 MAX 和 MIN),CDP 中的 PDP 超过一半的时候，则 CDP 标记为 UNKNOWNA（这里咱默认 0.5 就好）, 每隔 1 X 300 秒的时候，存一次平均值，存 24 次。</li>
</ul>
<p>对于更新数据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rrdtool update test.rrd 920804700:12345 920805000:12357 920805300:12363</span><br><span class="line">rrdtool update test.rrd 920805600:12363 920805900:12363 920806200:12373</span><br><span class="line">rrdtool update test.rrd 920806500:12383 920806800:12393 920807100:12399</span><br><span class="line">rrdtool update test.rrd 920807400:12405 920807700:12411 920808000:12415</span><br><span class="line">rrdtool update test.rrd 920808300:12420 920808600:12422 920808900:12423</span><br></pre></td></tr></table></figure>
<p>你可能有疑惑：官网里面的 speed 指的不是速度么，怎么会用来代表路程.（回顾一下：路程 = 时间 X 速度）, 官网的教程插入数据的时候，使用的是某个时间点已经行驶的路程。说实话，我也觉得很疑惑。<br>请注意：它更新的数据都是累加的 (COUNTOR), 也就是说，</p>
<p>对于绘图：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rrdtool graph speed.png                                 \</span><br><span class="line">    --start 920804400 --end 920808000               \</span><br><span class="line">    DEF:myspeed=test.rrd:speed:AVERAGE              \</span><br><span class="line">    LINE2:myspeed<span class="comment">#FF0000</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rrdtool graph speed2.png                           \</span><br><span class="line">    --start 920804400 --end 920808000               \</span><br><span class="line">    --vertical-label m/s                            \</span><br><span class="line">    DEF:myspeed=test.rrd:speed:AVERAGE              \</span><br><span class="line">    CDEF:realspeed=myspeed,1000,\*                  \</span><br><span class="line">    LINE2:realspeed<span class="comment">#FF0000</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rrdtool graph speed3.png                             \</span><br><span class="line">    --start 920804400 --end 920808000               \</span><br><span class="line">    --vertical-label km/h                           \</span><br><span class="line">    DEF:myspeed=test.rrd:speed:AVERAGE              \</span><br><span class="line">    <span class="string">&quot;CDEF:kmh=myspeed,3600,*&quot;</span>                       \</span><br><span class="line">    CDEF:fast=kmh,100,GT,kmh,0,IF                   \</span><br><span class="line">    CDEF:good=kmh,100,GT,0,kmh,IF                   \</span><br><span class="line">    HRULE:100<span class="comment">#0000FF:&quot;Maximum allowed&quot;              \</span></span><br><span class="line">    AREA:good<span class="comment">#00FF00:&quot;Good speed&quot;                   \</span></span><br><span class="line">    AREA:fast<span class="comment">#FF0000:&quot;Too fast&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rrdtool graph speed4.png                           \</span><br><span class="line">      --start 920804400 --end 920808000               \</span><br><span class="line">      --vertical-label km/h                           \</span><br><span class="line">      DEF:myspeed=test.rrd:speed:AVERAGE              \</span><br><span class="line">      CDEF:nonans=myspeed,UN,0,myspeed,IF             \</span><br><span class="line">      CDEF:kmh=nonans,3600,*                          \</span><br><span class="line">      CDEF:fast=kmh,100,GT,100,0,IF                   \</span><br><span class="line">      CDEF:over=kmh,100,GT,kmh,100,-,0,IF             \</span><br><span class="line">      CDEF:good=kmh,100,GT,0,kmh,IF                   \</span><br><span class="line">      HRULE:100<span class="comment">#0000FF:&quot;Maximum allowed&quot;              \</span></span><br><span class="line">      AREA:good<span class="comment">#00FF00:&quot;Good speed&quot;                   \</span></span><br><span class="line">      AREA:fast<span class="comment">#550000:&quot;Too fast&quot;                     \</span></span><br><span class="line">      STACK:over<span class="comment">#FF0000:&quot;Over speed&quot;</span></span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/52890-e7979c928d1bf4ec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="speed.png"><br><img src="http://upload-images.jianshu.io/upload_images/52890-92c75ac53eedd2bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="speed2.png"><br><img src="http://upload-images.jianshu.io/upload_images/52890-061e0e0c91521d9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="speed3.png"><br><img src="http://upload-images.jianshu.io/upload_images/52890-59100ed39a3b8588.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="speed4.png"></p>
<h3 id="RRD-怎么保存计算机运行信息"><a href="#RRD-怎么保存计算机运行信息" class="headerlink" title="RRD 怎么保存计算机运行信息"></a>RRD 怎么保存计算机运行信息</h3><p>在这里，仅仅使用带宽的统计作为演示案例（案例来自使用 Python 自动化运维这本书）.</p>
<h4 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h4><h4 id="更新数据库"><a href="#更新数据库" class="headerlink" title="更新数据库"></a>更新数据库</h4><h4 id="RRDTool-制图"><a href="#RRDTool-制图" class="headerlink" title="RRDTool 制图"></a>RRDTool 制图</h4><h2 id="汇总并发送-Email"><a href="#汇总并发送-Email" class="headerlink" title="汇总并发送 Email"></a>汇总并发送 Email</h2><h2 id="思考与不足"><a href="#思考与不足" class="headerlink" title="思考与不足"></a>思考与不足</h2><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>代码地址为：</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://github.com/yorkoliu/pyauto/blob/master/%E7%AC%AC%E4%B8%89%E7%AB%A0/rrdtool/graph.py">https://github.com/yorkoliu/pyauto/blob/master/%E7%AC%AC%E4%B8%89%E7%AB%A0/rrdtool/graph.py</a></p>
<p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/21784641/installation-issue-with-matplotlib-python">http://stackoverflow.com/questions/21784641/installation-issue-with-matplotlib-python</a></p>
<hr>
<p>ChangeLog:</p>
<ul>
<li><strong>2017-03-14</strong> 本文已经彻底烂尾了，哈哈哈</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%95%88%E7%8E%87/" rel="tag"># 效率</a>
              <a href="/tags/%E5%B0%8F%E7%8E%A9%E5%85%B7/" rel="tag"># 小玩具</a>
              <a href="/tags/%E7%BC%96%E7%A8%8B%E5%B7%A5%E5%85%B7/" rel="tag"># 编程工具</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2016/07/01/MacCheatSheet/" rel="prev" title="Mac Cheatsheet">
      <i class="fa fa-chevron-left"></i> Mac Cheatsheet
    </a></div>
      <div class="post-nav-item">
    <a href="/2016/09/12/MySQLCheatSheet/" rel="next" title="MySQL Cheatsheet">
      MySQL Cheatsheet <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87%E7%A1%AE%E5%AE%9A%E4%B8%8E%E4%BB%BB%E5%8A%A1%E5%88%86%E8%A7%A3"><span class="nav-number">2.</span> <span class="nav-text">目标确定与任务分解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python-%E8%8E%B7%E5%8F%96%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%BF%90%E8%A1%8C%E4%BF%A1%E6%81%AF"><span class="nav-number">3.</span> <span class="nav-text">Python 获取计算机运行信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RRDTool-%E4%BF%9D%E5%AD%98%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%BF%90%E8%A1%8C%E4%BF%A1%E6%81%AF"><span class="nav-number">4.</span> <span class="nav-text">RRDTool 保存计算机运行信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF-RRDTool-%E8%80%8C%E4%B8%8D%E6%98%AF-sqlite"><span class="nav-number">4.1.</span> <span class="nav-text">为什么是 RRDTool 而不是 sqlite</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RRD-%E6%80%8E%E4%B9%88%E4%BF%9D%E5%AD%98%E4%BF%A1%E6%81%AF"><span class="nav-number">4.2.</span> <span class="nav-text">RRD 怎么保存信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RRD-%E6%80%8E%E4%B9%88%E4%BF%9D%E5%AD%98%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%BF%90%E8%A1%8C%E4%BF%A1%E6%81%AF"><span class="nav-number">4.3.</span> <span class="nav-text">RRD 怎么保存计算机运行信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">4.3.1.</span> <span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">4.3.2.</span> <span class="nav-text">更新数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RRDTool-%E5%88%B6%E5%9B%BE"><span class="nav-number">4.3.3.</span> <span class="nav-text">RRDTool 制图</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B1%87%E6%80%BB%E5%B9%B6%E5%8F%91%E9%80%81-Email"><span class="nav-number">5.</span> <span class="nav-text">汇总并发送 Email</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%9D%E8%80%83%E4%B8%8E%E4%B8%8D%E8%B6%B3"><span class="nav-number">6.</span> <span class="nav-text">思考与不足</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">7.</span> <span class="nav-text">代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">8.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Micheal Gardner</p>
  <div class="site-description" itemprop="description">Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">93</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">96</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Micheal Gardner</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




  















  

  

</body>
</html>
