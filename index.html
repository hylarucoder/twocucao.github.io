<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"twocucao.xyz","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
<meta property="og:type" content="website">
<meta property="og:title" content="MG的编程小屋">
<meta property="og:url" content="http://twocucao.xyz/index.html">
<meta property="og:site_name" content="MG的编程小屋">
<meta property="og:description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
<meta property="og:locale">
<meta property="article:author" content="Micheal Gardner">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://twocucao.xyz/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>MG的编程小屋</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="MG的编程小屋" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">MG的编程小屋</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Get Busy Living, Or Get Busy Dying</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://twocucao.xyz/2020/11/29/_ory/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Micheal Gardner">
      <meta itemprop="description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MG的编程小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/29/_ory/" class="post-title-link" itemprop="url">开源认证基础服务</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-11-29 23:57:32 / Modified: 23:57:47" itemprop="dateCreated datePublished" datetime="2020-11-29T23:57:32+08:00">2020-11-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Go/" itemprop="url" rel="index"><span itemprop="name">Go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>随着业务的增长，往往需要统一体系内的服务的账户。<br>经过一番调研，决定尝试一下 ory 的开源认证基础服务</p>
<h2 id="0x01-ORY-尝试解决问题？"><a href="#0x01-ORY-尝试解决问题？" class="headerlink" title="0x01 ORY 尝试解决问题？"></a>0x01 ORY 尝试解决问题？</h2><p>ORY 提供了四个主要项目，每个项目着力于解决一个边界清晰的认证 / 鉴权问题</p>
<ul>
<li>ORY Kratos 提供了用户认证服务</li>
<li>ORY Hydra 提供了 OAuth 2.0 &amp; OpenID Connect provider.</li>
<li>ORY Keto 提供了 访问控制</li>
<li>ORY Oathkeeper 提供了认证访问代理</li>
</ul>
<h2 id="0x02-用户认证服务-Kratos"><a href="#0x02-用户认证服务-Kratos" class="headerlink" title="0x02 用户认证服务 Kratos"></a>0x02 用户认证服务 Kratos</h2><h3 id="常见方案"><a href="#常见方案" class="headerlink" title="常见方案"></a>常见方案</h3><ol>
<li>方案 1, 选择全栈式解决方案 - 比如 Java 社区的 JGroups</li>
<li>方案 2, 选择 IDaas - 比如 Login With Apple, Google</li>
<li>方案 3, 选择自己来 - 比如 Java 社区的 JGroups</li>
</ol>
<p>三种方案各有利弊</p>
<ol>
<li><p>全栈式解决方案上手极快，但</p>
<ul>
<li>扩展性不强</li>
<li>绑定 Java 技术栈</li>
<li>数据模型固定</li>
<li>登陆流程固定<br>  - 更新迭代慢</li>
</ul>
</li>
<li><p>Login With Google 虽然方便，但是并没有解决如下的问题<br>  - 更新 Profile</p>
<ul>
<li>添加第二个恢复邮箱</li>
<li>2FA</li>
<li>存储管理 Sessions<br>  - 全局登出</li>
</ul>
</li>
<li><p>自己来，需要处理事情也挺多</p>
</li>
</ol>
<p>  - 方案二遇到的问题，一个不会少<br>  - 加密算法<br>    - 流程可能较为复杂，比如先用邮箱注册，然后用 Sign Up Using Google, 或者先用 Sign Up Google, 然后使用邮箱登陆。(PS: 我国的登陆姿势就更多了）</p>
<p>是不是某种方案是最好的呢？其实未必<br>就我个人经验来说，</p>
<ul>
<li>第一种方案比较适合稳定的，技术栈相同的团队使用。如果对原先应用进行少量裁剪就可以使用，其实未尝不可。</li>
<li>第二种方案如果登陆入口仅是 Login With Google, 并且内网服务数量就几个，也不需要做全局登出，那么其实做起来比较省事。我工作过的一个公司就喜欢这么干。</li>
<li>第三种方案虽然处理的问题看起来比较多，但是社区现有的 Building Block 已经比较多了。如果流程没有特别复杂，一手打造的非常容易往自己的项目发展情况发展。</li>
</ul>
<h3 id="Kratos-的方案"><a href="#Kratos-的方案" class="headerlink" title="Kratos 的方案"></a>Kratos 的方案</h3><p>Kratos 提供了如下的解决方案</p>
<ul>
<li>登陆与注册</li>
<li>track sesison/devices</li>
<li>MFA/2FA</li>
<li>账户验证</li>
<li>账户恢复</li>
<li>Profile &amp; Account Management</li>
<li>管理后台接口 API</li>
<li>消费 OAuth2 and OpenID Connect</li>
</ul>
<h2 id="0x03-Ory-Hydra"><a href="#0x03-Ory-Hydra" class="headerlink" title="0x03 Ory Hydra"></a>0x03 Ory Hydra</h2><blockquote>
<p>You May Not Need It</p>
</blockquote>
<ul>
<li>Provider OAuth2 and OpenID Connect via <a target="_blank" rel="noopener" href="https://github.com/ory/hydra">https://github.com/ory/hydra</a></li>
</ul>
<h2 id="0x03-Ory-Keto"><a href="#0x03-Ory-Keto" class="headerlink" title="0x03 Ory Keto"></a>0x03 Ory Keto</h2><p>权限系统一般放在按照产品需求，最好跟着产品走。而不是随随便便提取出来做一个权限系统。</p>
<blockquote>
<p>You May Not Need It</p>
</blockquote>
<h2 id="0x04-Ory-Oathkeeper"><a href="#0x04-Ory-Oathkeeper" class="headerlink" title="0x04 Ory Oathkeeper"></a>0x04 Ory Oathkeeper</h2><p>同样，如果你不是有做 zero trust</p>
<blockquote>
<p>You May Not Need It</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://twocucao.xyz/2019/05/15/GoLang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Micheal Gardner">
      <meta itemprop="description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MG的编程小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/15/GoLang/" class="post-title-link" itemprop="url">写给 Pythonista 的 Golang 入门指北</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2019-05-15 21:02:20 / Modified: 22:07:48" itemprop="dateCreated datePublished" datetime="2019-05-15T21:02:20+08:00">2019-05-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Go/" itemprop="url" rel="index"><span itemprop="name">Go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原计划是去年 8 月份入 Golang 大法的，然后开一篇帖子进行写个入门指北来着。这一拖就拖到了今年。</p>
<p>同样是快速上手教程，这篇文章和其他的文章的不同点在于，完全假设你是 Pythonista 的入门。</p>
<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><h2 id="0x01-安装"><a href="#0x01-安装" class="headerlink" title="0x01 安装"></a>0x01 安装</h2><p>Golang 安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 如果你是在 mac 上，建议先安装下面的 SDK 以防不测</span><br><span class="line">open &#x2F;Library&#x2F;Developer&#x2F;CommandLineTools&#x2F;Packages&#x2F;macOS_SDK_headers_for_macOS_10.14.pkg</span><br><span class="line"># 安装 golang</span><br><span class="line">brew install golang</span><br><span class="line"># 配置环境变量</span><br><span class="line">echo $GOPATH # &#x2F;Users&#x2F;twocucao&#x2F;Codes&#x2F;ReposGo</span><br><span class="line"></span><br><span class="line">cd &#x2F;Users&#x2F;twocucao&#x2F;Codes&#x2F;ReposPublic&#x2F;</span><br><span class="line"></span><br><span class="line">mkcd thanos # mkdir &amp;&amp; cd</span><br><span class="line">go mod init github.com&#x2F;twocucao&#x2F;thanos</span><br><span class="line">git remote add origin git@github.com:twocucao&#x2F;thanos.git</span><br></pre></td></tr></table></figure>

<p>接下来，需要解决卡 golang.org 的网络问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export GOPROXY&#x3D;https:&#x2F;&#x2F;goproxy.io</span><br><span class="line">go get -v -u github.com&#x2F;hqpko&#x2F;go-mod-tidy</span><br><span class="line">go mod tidy</span><br></pre></td></tr></table></figure>

<p>接下来就是随便找一些带有依赖库的代码。放到该文件夹下面。</p>
<p>你也可以直接从这里 <a target="_blank" rel="noopener" href="https://github.com/twocucao/thanos.git">https://github.com/twocucao/thanos.git</a> 拉取代码</p>
<h2 id="0x01-基本概念"><a href="#0x01-基本概念" class="headerlink" title="0x01 基本概念"></a>0x01 基本概念</h2><h3 id="工具链"><a href="#工具链" class="headerlink" title="工具链"></a>工具链</h3><h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><h3 id="社区"><a href="#社区" class="headerlink" title="社区"></a>社区</h3><h3 id="书籍"><a href="#书籍" class="headerlink" title="书籍"></a>书籍</h3><h3 id="内置简单类型"><a href="#内置简单类型" class="headerlink" title="内置简单类型"></a>内置简单类型</h3><p>对于一些基本的数据类型，操作为 加减乘除取余数位运算等等</p>
<ul>
<li>数字类型</li>
<li>布尔类型</li>
<li>字符串类型</li>
<li>数组 / 列表</li>
<li>字典</li>
</ul>
<h3 id="内置复杂类型"><a href="#内置复杂类型" class="headerlink" title="内置复杂类型"></a>内置复杂类型</h3><ul>
<li>集合结构 : 串</li>
<li>线性结构 : 线性表 （单链表，静态链表，循环链表，双向链表，<strong>栈，队列</strong>)</li>
<li>树形结构 : 树（二叉树，B+ 树，红黑树）</li>
<li>图形结构 : 图</li>
</ul>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><h2 id="0x02-中级概念"><a href="#0x02-中级概念" class="headerlink" title="0x02 中级概念"></a>0x02 中级概念</h2><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h4 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h4><h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><p>模块，这个概念，可大可小，大的时候，把一个程序说成是模块，小的时候，可以把一个文件，甚至你说这一个函数是一个模块，也行。</p>
<p>这里的模块指的是一个包下的函数。</p>
<h3 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h3><p>面向对象有三大概念：</p>
<ul>
<li>封装</li>
<li>继承</li>
<li>多态</li>
</ul>
<h3 id="错误-调试测试"><a href="#错误-调试测试" class="headerlink" title="错误 / 调试测试"></a>错误 / 调试测试</h3><p>异常处理实际上可以考验一个程序员编写代码的健壮性。</p>
<p>事实上来说，代码写的健壮是一个程序员必备的素养。但其实在开发过程中，出于对项目进行赶工上线，需要对程序的健壮性做出一定的取舍。并且，在编写客户端，服务端，网页前端的时候基本上都会遇到这个问题。什么时候选择健壮的程序，什么时候选择是还可以的程序。需要自己的经验。</p>
<h3 id="IO-编程"><a href="#IO-编程" class="headerlink" title="IO 编程"></a>IO 编程</h3><h3 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h3><h4 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h4><blockquote>
<p>Go 多线程约等于并发。</p>
</blockquote>
<h4 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h4><h5 id="协同式多任务处理"><a href="#协同式多任务处理" class="headerlink" title="协同式多任务处理"></a>协同式多任务处理</h5><p>如果有两个线程，同时进行 IO 请求，当其中一个线程连接之后，立即会<strong>主动让出 GIL</strong>, 其他线程就可以运行。</p>
<blockquote>
<p>当 N 个线程在网络 I/O 堵塞，或等待重新获取 GIL，而一个线程运行 Python。</p>
</blockquote>
<p>让出之后还要执行代码呀，所以要有个收回 GIL 的动作。</p>
<h5 id="抢占式多任务处理"><a href="#抢占式多任务处理" class="headerlink" title="抢占式多任务处理"></a>抢占式多任务处理</h5><h5 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全"></a>线程安全</h5><p>原子操作：sort 之类不需要<br>非原子操作：n=n+2 的字节码分为 加载 n , 加载 2 , 相加，存储 n, 四个步骤，由于不是原子性，很可能被由于 15 ms 而被打断。</p>
<p>当然，懒人一向是 : <strong>优先级不决加括号，线程不决加 lock</strong></p>
<p>对于 Java, 程序员努力在尽可能短的时间内加锁存取共享数据，减轻线程的争夺，实现最大并行。但 Python 中，线程无法并行运行，细粒度的锁就没有了优势。</p>
<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><h2 id="0x03-高级技巧"><a href="#0x03-高级技巧" class="headerlink" title="0x03 高级技巧"></a>0x03 高级技巧</h2><h2 id="0x04-标准库"><a href="#0x04-标准库" class="headerlink" title="0x04 标准库"></a>0x04 标准库</h2><h3 id="常用内建模块"><a href="#常用内建模块" class="headerlink" title="常用内建模块"></a>常用内建模块</h3><h3 id="系统化模块"><a href="#系统化模块" class="headerlink" title="系统化模块"></a>系统化模块</h3><h2 id="0x05-第三方库"><a href="#0x05-第三方库" class="headerlink" title="0x05 第三方库"></a>0x05 第三方库</h2><ul>
<li>Requests : API 人性化</li>
</ul>
<h2 id="0x06-代码质量"><a href="#0x06-代码质量" class="headerlink" title="0x06 代码质量"></a>0x06 代码质量</h2><h3 id="正确性"><a href="#正确性" class="headerlink" title="正确性"></a>正确性</h3><h3 id="可维护性"><a href="#可维护性" class="headerlink" title="可维护性"></a>可维护性</h3><h3 id="可读性"><a href="#可读性" class="headerlink" title="可读性"></a>可读性</h3><h3 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h3><h3 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h3><h2 id="0x07-常用命令"><a href="#0x07-常用命令" class="headerlink" title="0x07 常用命令"></a>0x07 常用命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">go build</span><br><span class="line">go install -v</span><br><span class="line">go clean</span><br><span class="line">go fmt</span><br><span class="line">go get</span><br><span class="line">go test</span><br><span class="line">go tool fix . # 修复老代码到新版本</span><br><span class="line">go tool vet directory|files</span><br><span class="line">go tool yacc -o gopher.go -p parser gopher.y</span><br><span class="line">godoc -http&#x3D;:8080</span><br><span class="line">go version 查看 go 当前的版本</span><br><span class="line">go env 查看当前 go 的环境变量</span><br><span class="line">go list 列出当前全部安装的 package</span><br><span class="line">go run 编译并运行 Go 程序</span><br></pre></td></tr></table></figure>

<h2 id="0xEE-文章更新"><a href="#0xEE-文章更新" class="headerlink" title="0xEE 文章更新"></a>0xEE 文章更新</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 如果你是在 mac 上，建议先安装下面的 SDK 以防不测</span><br><span class="line">open &#x2F;Library&#x2F;Developer&#x2F;CommandLineTools&#x2F;Packages&#x2F;macOS_SDK_headers_for_macOS_10.14.pkg</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<p>ChangeLog:</p>
<ul>
<li><strong>2018-08-22</strong> 初始化接口</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://twocucao.xyz/2019/04/13/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E4%BD%BF%E7%94%A8Windows10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Micheal Gardner">
      <meta itemprop="description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MG的编程小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/13/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E4%BD%BF%E7%94%A8Windows10/" class="post-title-link" itemprop="url">如何优雅的使用 Windows 10</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2019-04-13 13:21:44 / Modified: 14:33:05" itemprop="dateCreated datePublished" datetime="2019-04-13T13:21:44+08:00">2019-04-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%96%84%E7%94%A8%E4%BD%B3%E8%BD%AF/" itemprop="url" rel="index"><span itemprop="name">善用佳软</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>最近入手了 SP6, 于是把 2015 年写的这篇文章修订为 2019 版</p>
<blockquote>
<p>笔者已过了爱折腾的年纪，仅从提升工作效率方面来说。</p>
</blockquote>
<p>背景：</p>
<ol start="0">
<li>Pythonista &amp;&amp; Nodejs</li>
<li>工作机 MBP 2017 款机器</li>
<li>生活机 Surface Pro 6, 轻办公，有时也用来调试 Windows 上的程序。</li>
</ol>
<p>本文目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">▼ 0x00 前言 : section</span><br><span class="line">	0x01 文件整理 : section</span><br><span class="line">▼ 0x02 自带功能 : section</span><br><span class="line">		2.1 快捷键 : section</span><br><span class="line">		2.2 触摸板 : section</span><br><span class="line">		2.3 Win+R -- 运行 : section</span><br><span class="line">▼ 0x03 必备软件 : section</span><br><span class="line">		3.1 文件管理 : section</span><br><span class="line">		3.2 资讯浏览 : section</span><br><span class="line">		3.3 学习软件 : section</span><br><span class="line">		3.4 播放器 : section</span><br><span class="line">	0x04 Autohotkey : section</span><br><span class="line">▼ 0x05 编程配置 : section</span><br><span class="line">		5.1 Windows Subsystem Linux : section</span><br><span class="line">		5.2 终端 : section</span><br><span class="line">		5.3 Python : section</span><br><span class="line">		5.4 Node : section</span><br><span class="line">		5.5 其他 : section</span><br><span class="line">	0x06 实用主义的工具论 : section</span><br><span class="line">	0xEE 后续 : section</span><br></pre></td></tr></table></figure>

<h2 id="0x01-文件整理"><a href="#0x01-文件整理" class="headerlink" title="0x01 文件整理"></a>0x01 文件整理</h2><p>文件整理一般从类型上进行划分子文件夹。</p>
<p>贴上我的几张图来看一下我的文件夹命名：</p>
<p>一级文件夹如下：<br><img src="http://upload-images.jianshu.io/upload_images/52890-b6a5322beca48d2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>二级文件夹如下：<br><img src="http://upload-images.jianshu.io/upload_images/52890-656d90e16abaff66.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>三级或者三级以上文件夹</p>
<p><img src="http://upload-images.jianshu.io/upload_images/52890-bdf7349fccedda52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>文件命名规范（因为涉及到后面使用 Everything，所以我们的命名尽量追求便于搜索）</p>
<p>举个例子，对于读书笔记 ：读书笔记、_设计模式、_20150303_v2.1.xmind</p>
<p>对于照片这种文件比较多的，优先命名文件夹，其次按照地址人物日期命名，比如：大明湖胖、_夏雨荷、_20150101</p>
<blockquote>
<p>无需刻意追求命名，方便搜索，方便管理就好。</p>
</blockquote>
<p>不妨参考下面文章：</p>
<p><a target="_blank" rel="noopener" href="http://www.zhihu.com/question/21537488">电脑上的文件夹该如何命名（整理）才能做到很久都不用重新整理的那种？ - 文件整理</a></p>
<p>由于 Windows 的文件没有标签系统。则可以从命名上强行打上标签，比如加上年份。</p>
<p>嗯这样你在搜索笔记的时候在 Everything 里面只需要键入 2015 笔记就可以查看 2015 笔记文件。</p>
<p>是不是很方便？</p>
<p><img src="http://upload-images.jianshu.io/upload_images/52890-f4a815755900d627.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/52890-1fb3ac3766e59044.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>当然桌面上尽量少放或者不放文件夹，我的桌面上仅仅有一个链接到 OneDrive 里面的 TEMP 文件夹的快捷方式，用于存放临时没有整理的文件。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/52890-be22e9252b149d1f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h2 id="0x02-自带功能"><a href="#0x02-自带功能" class="headerlink" title="0x02 自带功能"></a>0x02 自带功能</h2><h3 id="2-1-快捷键"><a href="#2-1-快捷键" class="headerlink" title="2.1 快捷键"></a>2.1 快捷键</h3><p>能看到本文的读者应该都可以搜索到这些东西。就不赘述了。</p>
<p>仅仅说一些重点快捷键。Win+ 数字键 把常用的软件附在任务栏上。</p>
<p>建议四个以内，方便单手操作。Win+X Alt+tab 切换窗口 Win+R 运行</p>
<h3 id="2-2-触摸板"><a href="#2-2-触摸板" class="headerlink" title="2.2 触摸板"></a>2.2 触摸板</h3><p>嗯，没有苹果的触摸板好用。但 Windows 的快捷键好用多了。</p>
<h3 id="2-3-Win-R-–-运行"><a href="#2-3-Win-R-–-运行" class="headerlink" title="2.3 Win+R – 运行"></a>2.3 Win+R – 运行</h3><p>主要用于启动一些程序或者一些 DOS 小命令。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/52890-d39ea3f078f1d800.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>我将所有的便携与非便携软件的快捷方式放在这里并且配置环境变量。</p>
<p>比如，我需要启动为知笔记，我就仅仅需要闭上眼睛输入 Win+R + wz +<Enter></p>
<p>PS: 景观</p>
<p>其他软件同理。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sublime text 打开需要输入 </span></span><br><span class="line">Win+R + st +&lt;Enter&gt;</span><br><span class="line"><span class="comment"># 欧路词典 打开需要输入 </span></span><br><span class="line">Win+R + ol +&lt;Enter&gt;</span><br><span class="line"><span class="comment"># 这里省去若干软件打开方式。</span></span><br></pre></td></tr></table></figure>

<p>关于 Win+R 你可以参考善用佳软 <a target="_blank" rel="noopener" href="http://xbeta.info/win-run.htm">最绿色最高效，用 win+r 启动常用程序和文档</a> 的介绍。</p>
<h2 id="0x03-必备软件"><a href="#0x03-必备软件" class="headerlink" title="0x03 必备软件"></a>0x03 必备软件</h2><h3 id="3-1-文件管理"><a href="#3-1-文件管理" class="headerlink" title="3.1 文件管理"></a>3.1 文件管理</h3><ul>
<li><p>图片方面，如果不是 RAW 格式，可以考虑使用 Eagle 这个神器</p>
</li>
<li><p>文字方面，如果是简单的图文素材，可以直接丢到印象笔记 / 有道云笔记里。</p>
</li>
<li><p>文档管理，如果是比较 Geek 一些的话，可以考虑用 TotalCMD 管理文档，Everything 快速搜索</p>
</li>
<li><p>PS: 没有足够的需求，不要搞 TC.</p>
</li>
<li><p>PS2: 无坚不摧，为快不破。 everything 是搜索效率最快的软件。没有之一。</p>
</li>
</ul>
<h3 id="3-2-资讯浏览"><a href="#3-2-资讯浏览" class="headerlink" title="3.2 资讯浏览"></a>3.2 资讯浏览</h3><ul>
<li>浏览器 Chrome / 新版 Edge 浏览器</li>
<li>欧陆词典：可以外挂其他的开源词库，查词速度超级快。</li>
</ul>
<h3 id="3-3-学习软件"><a href="#3-3-学习软件" class="headerlink" title="3.3 学习软件"></a>3.3 学习软件</h3><ul>
<li>Xmind</li>
<li>OneNote</li>
<li>Office</li>
</ul>
<h3 id="3-4-播放器"><a href="#3-4-播放器" class="headerlink" title="3.4 播放器"></a>3.4 播放器</h3><ul>
<li>PotPlayer</li>
<li>foobar2000 – 逼格提升必备</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/52890-1d8bc57d69948d60.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<ul>
<li>网易云音乐 – 这货真的不错。</li>
</ul>
<h2 id="0x04-Autohotkey"><a href="#0x04-Autohotkey" class="headerlink" title="0x04 Autohotkey"></a>0x04 Autohotkey</h2><p>早年刚接触这个软件的时候，是为了在魔兽争霸里面快速输入文本….</p>
<p>但这个软件可以帮你少装很多软件，</p>
<p>比如：</p>
<ol>
<li>可以针对快捷键进行编程，</li>
<li>节省大量的时间，比如一大段文字中有一个网址，你需要访问它，我的解决方法就是选中那些文字，然后一个 Win+b，直接打开 chrome 进行搜索，如果文字中没有网址，那么对选中文字进行百度。同理可以推淘宝，京东 github 等等。</li>
<li>你需要大量的文本编辑，但是上下左右离自己的工作区比较远，你可以小拇指按住大写锁定按键，然后使用 HJKL 进行移动。</li>
</ol>
<p>而且，作为曾经的 Geek , 不写点代码定制一下使用流程，你都不好意思说优雅。</p>
<p>教程参考 <a target="_blank" rel="noopener" href="http://zhuanlan.zhihu.com/autohotkey">AutoHotkey 之美 - 知乎专栏</a></p>
<p>新手可以先拿我搜刮整理的 AHK 代码看看。<a target="_blank" rel="noopener" href="https://github.com/twocucao/ChortHotKey">twocucao/ChortHotKey · GitHub</a></p>
<p>PS：AHK/TotalCMD 神级软件，都是入门容易精通难的深坑，想调教好也不是想象中呢么简单的，但，书到用时方恨少，你可以先挑一些使用。如果你以后有不少的文件需要管理，在未来，你一定会用到。</p>
<blockquote>
<p>PS: 站在 2019 年回头看，其实 AHK 的语法还是蛮糟糕的。相比于顺手打出很多快捷键。倒不如先优化自己的工作流程。甚至，很多 AHK 的场景完全可以用 Python 之类的语言来写。当我在 Windows 上的时候一味追求 APM, 即高效的操作，但其实最高效的还是自己的思路清晰，想好了再动手。</p>
</blockquote>
<p>毕竟，AHK 作为脚本语言，确实语法不美，数据结构也少，没有主流编程语言的社区支持。</p>
<p>嗯，其实还是推荐学 Python</p>
<h2 id="0x05-编程配置"><a href="#0x05-编程配置" class="headerlink" title="0x05 编程配置"></a>0x05 编程配置</h2><h3 id="5-1-Windows-Subsystem-Linux"><a href="#5-1-Windows-Subsystem-Linux" class="headerlink" title="5.1 Windows Subsystem Linux"></a>5.1 Windows Subsystem Linux</h3><p>如何配置 WSL （我死了？哈哈哈哈好逗的缩写）</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/49227132">https://zhuanlan.zhihu.com/p/49227132</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/47733615">https://zhuanlan.zhihu.com/p/47733615</a></p>
<h3 id="5-2-终端"><a href="#5-2-终端" class="headerlink" title="5.2 终端"></a>5.2 终端</h3><p>cmder 相当于 windows 上的 iterm</p>
<p><a target="_blank" rel="noopener" href="https://github.com/cmderdev/cmder">https://github.com/cmderdev/cmder</a></p>
<h3 id="5-3-Python"><a href="#5-3-Python" class="headerlink" title="5.3 Python"></a>5.3 Python</h3><p><a target="_blank" rel="noopener" href="https://www.anaconda.com/distribution/#download-section">https://www.anaconda.com/distribution/#download-section</a></p>
<p>由于笔者要调试 Win32 程序，而大部分这些 dll 文件都是在 32 位的情况下编译出来的。</p>
<h3 id="5-4-Node"><a href="#5-4-Node" class="headerlink" title="5.4 Node"></a>5.4 Node</h3><p><a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a></p>
<h3 id="5-5-其他"><a href="#5-5-其他" class="headerlink" title="5.5 其他"></a>5.5 其他</h3><ul>
<li>beyond compare 代码比对</li>
<li>jetbrain</li>
<li>vscode</li>
</ul>
<h2 id="0x06-实用主义的工具论"><a href="#0x06-实用主义的工具论" class="headerlink" title="0x06 实用主义的工具论"></a>0x06 实用主义的工具论</h2><p>当你选择用一个工具的时候，务必把精力放在解决问题上。</p>
<p>能满足你的要求，就是好工具，须知『梅须逊雪三分白，雪却输梅一段香』</p>
<p>孰高孰下取决于使用者。</p>
<blockquote>
<p>你是张三丰，你就能徒手夺来灭绝师太的倚天剑。</p>
</blockquote>
<p>并不是说用了一个操作系统，用了某个软件，就会显得自己多么高明，如果不能给日常工作生活提高效率，让自己节省时间，再好的工具，那又有什么意义呢？</p>
<blockquote>
<p>抓到老鼠的猫才是好猫呀！</p>
</blockquote>
<h2 id="0xEE-后续"><a href="#0xEE-后续" class="headerlink" title="0xEE 后续"></a>0xEE 后续</h2><blockquote>
<p>2016-01-04 已换 Macbook Pro, 依然挂念 Windows.<br>2017-05-01 已换 2016 年 Macbook Pro With Multi-Touchbar.<br>2019-04-13 新增 SP6 作为生活机。</p>
</blockquote>
<p>ChangeLog:</p>
<ul>
<li>2017-03-08 09:32:15 整理知乎回答，搬运到博客上。</li>
<li>2017-05-01 09:32:15 补充现在使用的电脑信息</li>
<li>2017-06-10 09:32:15 重新排版，增加后续章节。</li>
<li>2019-04-13 13:57:02 重新排版</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://twocucao.xyz/2019/04/12/Mapping/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Micheal Gardner">
      <meta itemprop="description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MG的编程小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/12/Mapping/" class="post-title-link" itemprop="url">一文解决你的 Python ORM 选择困难症</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2019-04-12 21:05:00 / Modified: 17:19:48" itemprop="dateCreated datePublished" datetime="2019-04-12T21:05:00+08:00">2019-04-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">后端开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>Python 圈内三大 ORM SQLAlchemy VS Django ORM VS Peewee</p>
<ol>
<li>SQLAlchemy 复杂程度最高，同时，这也意味着 SQLAlchemy 可以做更多的事情。使用 DataMapper 方式实现</li>
<li>Django ORM 个人最喜欢，使用 ActiveRecord 实现 如果不是因为现在 Flask 项目已经是用了 SQLAlchemy , 否则的话我甚至会考虑将 Django ORM 配置到 Flask 项目中。当然，也有蛋疼的 SqlAlchemy 使用者已经移植给 django 配置了 SQLAlchemy 的库。</li>
<li>Peewee 没用过，不好评论。以后有机会试试。</li>
</ol>
<h2 id="0x01-如何访问数据库"><a href="#0x01-如何访问数据库" class="headerlink" title="0x01 如何访问数据库"></a>0x01 如何访问数据库</h2><p>那，既然已经可以访问数据库，本着『如无必要，勿增实体』的原则，为什么要不辞劳苦的用个库呢？</p>
<h2 id="0x02-数据库抽象的两种理论"><a href="#0x02-数据库抽象的两种理论" class="headerlink" title="0x02 数据库抽象的两种理论"></a>0x02 数据库抽象的两种理论</h2><h3 id="理论一：Active-Record"><a href="#理论一：Active-Record" class="headerlink" title="理论一：Active Record"></a>理论一：Active Record</h3><h3 id="理论二：Data-Mapper"><a href="#理论二：Data-Mapper" class="headerlink" title="理论二：Data Mapper"></a>理论二：Data Mapper</h3><h2 id="0x03-数据库抽象的两种实现"><a href="#0x03-数据库抽象的两种实现" class="headerlink" title="0x03 数据库抽象的两种实现"></a>0x03 数据库抽象的两种实现</h2><h3 id="实现一：Django-ORM"><a href="#实现一：Django-ORM" class="headerlink" title="实现一：Django ORM"></a>实现一：Django ORM</h3><h3 id="实现二：Sqlalchemy"><a href="#实现二：Sqlalchemy" class="headerlink" title="实现二：Sqlalchemy"></a>实现二：Sqlalchemy</h3><h2 id="0x04-工具的强弱"><a href="#0x04-工具的强弱" class="headerlink" title="0x04 工具的强弱"></a>0x04 工具的强弱</h2><p><a target="_blank" rel="noopener" href="https://www.thoughtfulcode.com/orm-active-record-vs-data-mapper/">https://www.thoughtfulcode.com/orm-active-record-vs-data-mapper/</a></p>
<h3 id="2-0-SQLAlchemy-VS-DjangoORM"><a href="#2-0-SQLAlchemy-VS-DjangoORM" class="headerlink" title="2.0 SQLAlchemy VS DjangoORM"></a>2.0 SQLAlchemy VS DjangoORM</h3><p>ORM 通常有 DataMapper 实现和 ActiveRecord 实现两种。</p>
<p>依照我的经验，ActiveRecord 使用起来的更接近对象 (Object) 的操作，DataMapper 使用起来更接近 (Table) 的操作。</p>
<blockquote>
<p>SQLAlchemy 是 DataMapper 模式的实现，在该模式下，session 会暴露出来，即 Model 与 session 并不耦合。</p>
</blockquote>
<blockquote>
<p>DjangoORM 是 ActivityRecord 模式的一种实现，在该模式下，session 并不暴露出来，即 Model 与 session 耦合。</p>
</blockquote>
<p>使用 Django ORM 的时候，往往是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b &#x3D; Blog(**data)</span><br><span class="line">b.save()</span><br></pre></td></tr></table></figure>

<p>使用 SQLAlchemy 的时候，往往是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b &#x3D; Blog(**data)</span><br><span class="line">session.add(b)</span><br><span class="line">session.session(b)</span><br></pre></td></tr></table></figure>

<p>由于 Django 帮你屏蔽了 session 的操作。</p>
<p>在通常情况下，</p>
<ol>
<li>DjangoORM 使用起来更加接近 Object 的操作。</li>
<li>SQLAlchemy 使用起来更加接近 Table 的操作。</li>
</ol>
<p>举个例子，</p>
<p>一对多，Father 添加两个小孩（其中一个小孩是已经存在的）</p>
<p>在 DjangoORM 里面， 这里更像是一个 Set 的 add 操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">father.children.add(new_child,exsit_child)</span><br></pre></td></tr></table></figure>

<p>在 SQLAlchemy 里面，这里更像是一个 table 的 insert 操作。（麻蛋，你要说是一个 list 的 append 操作也行）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for child in (new_child,exsit_child):</span><br><span class="line">    if child in father.children:</span><br><span class="line">        father.children.append(child)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>写 SQLAlchemy 更接近操作放在数据库里面的数据记录，而 DjangoORM 更接近操作一批放在数据库里面的对象。</p>
</blockquote>
<p>由于 session 的使用姿势不同，所以往往会有很多使用上面的区别。</p>
<p>至于孰优孰劣，难以评判。</p>
<ul>
<li><p>技术老大 (Flask 和 React 大神）倾向于使用 SQLAlchemy, 他认为</p>
<ul>
<li>对于一个技术『知其然，知其所以然』</li>
<li>对于 ORM<ul>
<li>操作数据库，操作最好要落实在成 SQL</li>
<li>如果有可能的话，每一个 SQL 语句都要经过推敲，而且写这个 SQL 和 ORM 过程要反复练习</li>
</ul>
</li>
<li>对于 Migration 机制<ul>
<li>Alembic 这个迁移工具是为了省事用的，甚至在某些情况下没必要用。完全可以写 SQL 代替</li>
</ul>
</li>
</ul>
</li>
<li><p>我 (Django 和 Vue 弱鸡）倾向于使用 DjangoORM, 我认为</p>
<ul>
<li>对于一个技术『先知其大致然，需要深入的时候知其所以然』</li>
<li>对于 ORM<ul>
<li>操作数据，最好抽象为对对象的操作。</li>
<li>测试到位的情况下，快糙狠先出东西。到需要优化的时候该怎么 Profile 怎么 Profile</li>
</ul>
</li>
<li>对于 Migration 机制<ul>
<li>用起来啊，能操作对象为什么还要强行到数据库操作？</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Active Record, properly defined, is a design pattern where an object is represented as a record on a table in a relational database.</span><br></pre></td></tr></table></figure>

<h3 id="2-1-模型定义"><a href="#2-1-模型定义" class="headerlink" title="2.1 模型定义"></a>2.1 模型定义</h3><p>先看一组模型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line">Base = declarative_base() <span class="comment"># 模型基类</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, Integer, String</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">Base</span>):</span></span><br><span class="line">    __tablename__ = <span class="string">&#x27;users&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">id</span> = Column(Integer, primary_key=<span class="literal">True</span>) <span class="comment"># 主键</span></span><br><span class="line">    name = Column(String)</span><br><span class="line">    fullname = Column(String)</span><br><span class="line">    password = Column(String)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;&lt;User(name=&#x27;%s&#x27;, fullname=&#x27;%s&#x27;, password=&#x27;%s&#x27;)&gt;&quot;</span> % (</span><br><span class="line">                            self.name, self.fullname, self.password)</span><br><span class="line">Base.metadata.create_all(engine)</span><br></pre></td></tr></table></figure>

<p>可以看出，包含如下的部分：</p>
<ol>
<li>Model 与 Model 内部的 Meta</li>
<li>Field 与 Field 内部的 Options</li>
<li>Model 与 Model 之间的关系</li>
<li>其他，比如索引</li>
</ol>
<h4 id="Models-与-Meta"><a href="#Models-与-Meta" class="headerlink" title="Models 与 Meta"></a>Models 与 Meta</h4><p><a target="_blank" rel="noopener" href="https://github.com/zzzeek/sqlalchemy/blob/master/lib/sqlalchemy/sql/schema.py#L3685">https://github.com/zzzeek/sqlalchemy/blob/master/lib/sqlalchemy/sql/schema.py#L3685</a></p>
<h4 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h4><h5 id="One-To-Many"><a href="#One-To-Many" class="headerlink" title="One To Many"></a>One To Many</h5><p>母亲有若干个孩子，外键在孩子上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class Parent(Base):</span><br><span class="line">    #...</span><br><span class="line">    children &#x3D; relationship(&quot;Child&quot;, backref&#x3D;&quot;parent&quot;)</span><br><span class="line"></span><br><span class="line">class Child(Base):</span><br><span class="line">    #...</span><br><span class="line">    parent_id &#x3D; Column(Integer, ForeignKey(&#39;parent.id&#39;))</span><br></pre></td></tr></table></figure>

<h5 id="Many-To-One"><a href="#Many-To-One" class="headerlink" title="Many To One"></a>Many To One</h5><p>多个母亲共享一个孩子，外键在母亲上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class Parent(Base):</span><br><span class="line">    child_id &#x3D; Column(Integer, ForeignKey(&#39;child.id&#39;))</span><br><span class="line">    child &#x3D; relationship(&quot;Child&quot;)</span><br><span class="line"></span><br><span class="line">class Child(Base):</span><br><span class="line">    # ...</span><br></pre></td></tr></table></figure>

<h5 id="One-To-One"><a href="#One-To-One" class="headerlink" title="One To One"></a>One To One</h5><p>One to One 是 One to Many 或者是 Many to One 的简化版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># Many To One</span><br><span class="line">class Parent(Base):</span><br><span class="line">    # ...</span><br><span class="line">    child_id &#x3D; Column(Integer, ForeignKey(&#39;child.id&#39;))</span><br><span class="line">    child &#x3D; relationship(&quot;Child&quot;, backref&#x3D;backref(&quot;parent&quot;, uselist&#x3D;False))</span><br><span class="line"></span><br><span class="line">class Child(Base):</span><br><span class="line">    # ...</span><br><span class="line"></span><br><span class="line"># One To Many 改 One To One</span><br><span class="line">class Parent(Base):</span><br><span class="line">    # ...</span><br><span class="line"></span><br><span class="line">class Child(Base):</span><br><span class="line">    # ...</span><br><span class="line">    parent_id &#x3D; Column(Integer, ForeignKey(&#39;parent.id&#39;))</span><br><span class="line">    parent &#x3D; relationship(&quot;Parent&quot;, backref&#x3D;backref(&quot;child&quot;, uselist&#x3D;False))</span><br></pre></td></tr></table></figure>

<h5 id="Many-To-Many"><a href="#Many-To-Many" class="headerlink" title="Many To Many"></a>Many To Many</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">association_table &#x3D; Table(&#39;association&#39;, Base.metadata,</span><br><span class="line">    Column(&#39;left_id&#39;, Integer, ForeignKey(&#39;left.id&#39;)),</span><br><span class="line">    Column(&#39;right_id&#39;, Integer, ForeignKey(&#39;right.id&#39;))</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">class Parent(Base):</span><br><span class="line">    # ...</span><br><span class="line">    children &#x3D; relationship(&quot;Child&quot;,</span><br><span class="line">                    secondary&#x3D;association_table,</span><br><span class="line">                    backref&#x3D;&quot;parents&quot;)</span><br><span class="line"></span><br><span class="line">class Child(Base):</span><br><span class="line">    # ...</span><br></pre></td></tr></table></figure>

<p>注意事项</p>
<p>执行删除 mapping 表的时候尽量这样。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myparent.children.remove(somechild)</span><br></pre></td></tr></table></figure>

<p>当你想干掉 somechild 的时候，会执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.delete(somechild)</span><br></pre></td></tr></table></figure>

<ol>
<li>假如 Child 没有 ref Parent 的话，Secondary Table 无删除，则无法删除。</li>
<li>假如 ref 了的话，则删除 secondary 里面的记录。</li>
<li>TODO</li>
</ol>
<h5 id="邻接列表关系"><a href="#邻接列表关系" class="headerlink" title="邻接列表关系"></a>邻接列表关系</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class Node(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;node&#39;</span><br><span class="line">    id &#x3D; Column(Integer, primary_key&#x3D;True)</span><br><span class="line">    parent_id &#x3D; Column(Integer, ForeignKey(&#39;node.id&#39;))</span><br><span class="line">    data &#x3D; Column(String(50))</span><br><span class="line">    children &#x3D; relationship(&quot;Node&quot;,</span><br><span class="line">                backref&#x3D;backref(&#39;parent&#39;, remote_side&#x3D;[id])</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>

<h5 id="relationship-详解"><a href="#relationship-详解" class="headerlink" title="relationship 详解"></a>relationship 详解</h5><h3 id="2-1-Query"><a href="#2-1-Query" class="headerlink" title="2.1 Query"></a>2.1 Query</h3><h4 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">c1 &#x3D; Child(name&#x3D;&quot;苏轼&quot;)</span><br><span class="line">session.add(c1)</span><br><span class="line">session.flush()</span><br><span class="line">p &#x3D; Parent(name&#x3D;&quot;苏辙&quot;)</span><br><span class="line">p.best_child &#x3D; c1</span><br><span class="line">for c in [c1,c2,c3,c4]:</span><br><span class="line">    p.children.append(c)</span><br><span class="line">session.add(c1)</span><br><span class="line">session.commit()</span><br></pre></td></tr></table></figure>

<h4 id="Retrieve"><a href="#Retrieve" class="headerlink" title="Retrieve"></a>Retrieve</h4><p>过滤</p>
<p>filter(**kwargs)<br>filter(Singer.name == “周杰伦”)<br>filter(Singer.name =! “周杰棍”)</p>
<h5 id="跨关系（跨表）查询"><a href="#跨关系（跨表）查询" class="headerlink" title="跨关系（跨表）查询"></a>跨关系（跨表）查询</h5><p>session.query(Entry).join(Blog,Blog.entry_id == Entry.id).filter(Blog.name = “SqlAlchemy CheatSheet”)</p>
<h5 id="Limit-Offset-分页"><a href="#Limit-Offset-分页" class="headerlink" title="Limit / Offset / 分页"></a>Limit / Offset / 分页</h5><ul>
<li>limit()</li>
<li>offset()</li>
</ul>
<h5 id="链式调用"><a href="#链式调用" class="headerlink" title="链式调用"></a>链式调用</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">query &#x3D; session.query(Order) # query &#x3D; session.query(Order)</span><br><span class="line">query &#x3D; query.filter(Order.name.like(f&quot;%name%&quot;))</span><br></pre></td></tr></table></figure>

<h5 id="二进制表达式"><a href="#二进制表达式" class="headerlink" title="二进制表达式"></a>二进制表达式</h5><p>我们先 type 一下表达式，找到 eq 的类型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>(model.column_name == <span class="string">&#x27;asdf&#x27;</span>) → sqlalchemy.sql.elements.BinaryExpression</span><br></pre></td></tr></table></figure>

<p>是一个二进制表达式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 等于</span></span><br><span class="line">query.<span class="built_in">filter</span>(User.name == <span class="string">&#x27;ed&#x27;</span>)</span><br><span class="line"><span class="comment"># 不等于</span></span><br><span class="line">query.<span class="built_in">filter</span>(User.name != <span class="string">&#x27;ed&#x27;</span>)</span><br><span class="line"><span class="comment"># Like（有的数据库不区分大小写）</span></span><br><span class="line">query.<span class="built_in">filter</span>(User.name.like(<span class="string">&#x27;%ed%&#x27;</span>))</span><br><span class="line"><span class="comment"># ILIKE (case-insensitive LIKE)</span></span><br><span class="line">query.<span class="built_in">filter</span>(User.name.ilike(<span class="string">&#x27;%ed%&#x27;</span>))</span><br><span class="line"><span class="comment"># IN</span></span><br><span class="line">query.<span class="built_in">filter</span>(User.name.in_([<span class="string">&#x27;ed&#x27;</span>, <span class="string">&#x27;wendy&#x27;</span>, <span class="string">&#x27;jack&#x27;</span>]))</span><br><span class="line"><span class="comment"># Not in</span></span><br><span class="line">query.<span class="built_in">filter</span>(~User.name.in_([<span class="string">&#x27;ed&#x27;</span>, <span class="string">&#x27;wendy&#x27;</span>, <span class="string">&#x27;jack&#x27;</span>]))</span><br><span class="line"><span class="comment"># IS NULL</span></span><br><span class="line">query.<span class="built_in">filter</span>(User.name == <span class="literal">None</span>)</span><br><span class="line"><span class="comment">## 如果你用了 pep8/linter 的话</span></span><br><span class="line">query.<span class="built_in">filter</span>(User.name.is_(<span class="literal">None</span>))</span><br><span class="line"><span class="comment"># IS NOT NULL:</span></span><br><span class="line">query.<span class="built_in">filter</span>(User.name != <span class="literal">None</span>)</span><br><span class="line"><span class="comment">## 如果你用了 pep8/linter 的话</span></span><br><span class="line">query.<span class="built_in">filter</span>(User.name.isnot(<span class="literal">None</span>))</span><br><span class="line"><span class="comment"># AND</span></span><br><span class="line"><span class="comment">## use and_()</span></span><br><span class="line">query.<span class="built_in">filter</span>(and_(User.name == <span class="string">&#x27;ed&#x27;</span>, User.fullname == <span class="string">&#x27;Ed Jones&#x27;</span>))</span><br><span class="line"><span class="comment">## or send multiple expressions to .filter()</span></span><br><span class="line">query.<span class="built_in">filter</span>(User.name == <span class="string">&#x27;ed&#x27;</span>, User.fullname == <span class="string">&#x27;Ed Jones&#x27;</span>)</span><br><span class="line"><span class="comment">## or chain multiple filter()/filter_by() calls</span></span><br><span class="line">query.<span class="built_in">filter</span>(User.name == <span class="string">&#x27;ed&#x27;</span>).<span class="built_in">filter</span>(User.fullname == <span class="string">&#x27;Ed Jones&#x27;</span>)</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">query.<span class="built_in">filter</span>(or_(User.name == <span class="string">&#x27;ed&#x27;</span>, User.name == <span class="string">&#x27;wendy&#x27;</span>))</span><br><span class="line"><span class="comment"># MATCH</span></span><br><span class="line">query.<span class="built_in">filter</span>(User.name.match(<span class="string">&#x27;wendy&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h5 id="执行查询"><a href="#执行查询" class="headerlink" title="执行查询"></a>执行查询</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">all()</span><br><span class="line">first()</span><br><span class="line">one()</span><br><span class="line">one_or_none()</span><br><span class="line">scalar()</span><br></pre></td></tr></table></figure>

<p>YourModel.query.get((pk1, pk2))</p>
<h5 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h5><blockquote>
<p>同一个 Session 下面，取到的某一条数据对应的 objects 应该是一样的？</p>
</blockquote>
<h5 id="复制-实例"><a href="#复制-实例" class="headerlink" title="复制 实例"></a>复制 实例</h5><h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询的是 SomeModel 里面所有的字段 即 select *</span><br><span class="line">query &#x3D; session.query(SomeModel)</span><br><span class="line"># 查询的是 SomeModel 里面部分的字段 即 select acol, bcol</span><br><span class="line">query &#x3D; session.query(SomeModel.acol,SomeModel.bcol)</span><br><span class="line"># 即 select acol , bcol</span><br><span class="line"># alias</span><br><span class="line">user_alias &#x3D; aliased(User, name&#x3D;&#39;user_alias&#39;)</span><br><span class="line">for row in session.query(user_alias, user_alias.name).all():</span><br><span class="line">    # 即相当于 select name as name_label</span><br><span class="line">    print(row.user_alias)</span><br><span class="line"></span><br><span class="line"># limit 和 offset</span><br><span class="line">for u in session.query(User).order_by(User.id)[1:3]:</span><br><span class="line">    print(u)</span><br><span class="line"></span><br><span class="line"># distinct</span><br><span class="line">session.query(model.Name).distinct(model.Name.value).order_by(model.Name.value)</span><br><span class="line"># order_by</span><br><span class="line">User.query.order_by(User.popularity.desc(),User.date_created.desc()).limit(10).all()</span><br></pre></td></tr></table></figure>

<h4 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h4><p>单个 object 更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">blog.title &#x3D; &quot;大宝天天见&quot;</span><br><span class="line">session.add(blog)</span><br><span class="line">session.commit()</span><br></pre></td></tr></table></figure>

<p>批量更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">session.query.filter(Blog.content.like(&quot;% 敏感词 %&quot;)).update(&#123;</span><br><span class="line">    Blog.content: &quot;依照相关 XX 无法查看&quot;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>一对多的更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">append</span><br></pre></td></tr></table></figure>

<h4 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h4><p>query.delete()</p>
<h4 id="JOIN"><a href="#JOIN" class="headerlink" title="JOIN"></a>JOIN</h4><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6044309/sqlalchemy-how-to-join-several-tables-by-one-query">https://stackoverflow.com/questions/6044309/sqlalchemy-how-to-join-several-tables-by-one-query</a></p>
<h5 id="两表-InnerJoin"><a href="#两表-InnerJoin" class="headerlink" title="两表 InnerJoin"></a>两表 InnerJoin</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> u, a <span class="keyword">in</span> session.query(User, Address).\</span><br><span class="line">                    <span class="built_in">filter</span>(User.<span class="built_in">id</span>==Address.user_id).\</span><br><span class="line">                    <span class="built_in">filter</span>(Address.email_address==<span class="string">&#x27;jack@google.com&#x27;</span>).\</span><br><span class="line">                    <span class="built_in">all</span>():</span><br><span class="line">    print(u)</span><br><span class="line">    print(a)</span><br><span class="line"><span class="comment"># &lt;User(name=&#x27;jack&#x27;, fullname=&#x27;Jack Bean&#x27;, password=&#x27;gjffdd&#x27;)&gt;</span></span><br><span class="line"><span class="comment"># &lt;Address(email_address=&#x27;jack@google.com&#x27;)&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="多表-InnerJoin-LeftJoin"><a href="#多表-InnerJoin-LeftJoin" class="headerlink" title="多表 InnerJoin + LeftJoin"></a>多表 InnerJoin + LeftJoin</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query.outerjoin(User.addresses)   # LEFT OUTER JOIN</span><br></pre></td></tr></table></figure>

<h4 id="聚集查询"><a href="#聚集查询" class="headerlink" title="聚集查询"></a>聚集查询</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.query(User).filter(User.name.like(&#39;%ed&#39;)).count()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from sqlalchemy import func</span><br><span class="line">session.query(Table.column, func.count(Table.column)).group_by(Table.column).all()</span><br><span class="line"></span><br><span class="line">self.session.query(func.count(Table.column1),Table.column1, Table.column2).group_by(Table.column1, Table.column2).all()</span><br><span class="line"></span><br><span class="line">from sqlalchemy.sql import func</span><br><span class="line">session.query(func.avg(Rating.field2).label(&#39;average&#39;)).filter(Rating.url&#x3D;&#x3D;url_string.netloc)</span><br></pre></td></tr></table></figure>

<h4 id="缓存机制"><a href="#缓存机制" class="headerlink" title="缓存机制"></a>缓存机制</h4><p>Query 对象，下文中，我会聊到这个 Query 对象。这里先跳过。</p>
<h3 id="2-2-原生查询"><a href="#2-2-原生查询" class="headerlink" title="2.2 原生查询"></a>2.2 原生查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">from sqlalchemy import text</span><br><span class="line"></span><br><span class="line">sql &#x3D; text(&#39;select name from penguins&#39;)</span><br><span class="line">result &#x3D; db.engine.execute(sql)</span><br><span class="line">names &#x3D; []</span><br><span class="line">for row in result:</span><br><span class="line">    names.append(row[0])</span><br><span class="line"></span><br><span class="line">print names</span><br><span class="line"></span><br><span class="line">from collections import namedtuple</span><br><span class="line"></span><br><span class="line">Record &#x3D; namedtuple(&#39;Record&#39;, result.keys())</span><br><span class="line">records &#x3D; [Record(*r) for r in result.fetchall()]</span><br><span class="line">for r in records:</span><br><span class="line">    print(r)</span><br><span class="line"></span><br><span class="line">from sqlalchemy.sql import text</span><br><span class="line"></span><br><span class="line">connection &#x3D; engine.connect()</span><br><span class="line"></span><br><span class="line"># recommended</span><br><span class="line">cmd &#x3D; &#39;select * from Employees where EmployeeGroup &#x3D;&#x3D; :group&#39;</span><br><span class="line">employeeGroup &#x3D; &#39;Staff&#39;</span><br><span class="line">employees &#x3D; connection.execute(text(cmd), group &#x3D; employeeGroup)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>get_or_create</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def get_or_create(session, model, defaults&#x3D;None, **kwargs):</span><br><span class="line">    instance &#x3D; session.query(model).filter_by(**kwargs).first()</span><br><span class="line">    if instance:</span><br><span class="line">        return instance, False</span><br><span class="line">    else:</span><br><span class="line">        params &#x3D; dict((k, v) for k, v in kwargs.iteritems() if not isinstance(v, ClauseElement))</span><br><span class="line">        params.update(defaults or &#123;&#125;)</span><br><span class="line">        instance &#x3D; model(**params)</span><br><span class="line">        session.add(instance)</span><br><span class="line">        return instance, True</span><br></pre></td></tr></table></figure>

<h3 id="2-3-更新查询"><a href="#2-3-更新查询" class="headerlink" title="2.3 更新查询"></a>2.3 更新查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.query(Stuff).update(&#123;Stuff.foo: Stuff.foo + 1&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1) for c in session.query(Stuff).all():</span><br><span class="line">       c.foo +&#x3D; 1</span><br><span class="line">   session.commit()</span><br><span class="line"></span><br><span class="line">2) session.query().\</span><br><span class="line">       update(&#123;&quot;foo&quot;: (Stuff.foo + 1)&#125;)</span><br><span class="line">   session.commit()</span><br><span class="line"></span><br><span class="line">3) conn &#x3D; engine.connect()</span><br><span class="line">   stmt &#x3D; Stuff.update().\</span><br><span class="line">       values(Stuff.foo &#x3D; (Stuff.foo + 1))</span><br><span class="line">   conn.execute(stmt)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1) user.no_of_logins +&#x3D; 1</span><br><span class="line">   session.commit()</span><br><span class="line"></span><br><span class="line">2) session.query().\</span><br><span class="line">       filter(User.username &#x3D;&#x3D; form.username.data).\</span><br><span class="line">       update(&#123;&quot;no_of_logins&quot;: (User.no_of_logins +1)&#125;)</span><br><span class="line">   session.commit()</span><br><span class="line"></span><br><span class="line">3) conn &#x3D; engine.connect()</span><br><span class="line">   stmt &#x3D; User.update().\</span><br><span class="line">       values(no_of_logins&#x3D;(User.no_of_logins + 1)).\</span><br><span class="line">       where(User.username &#x3D;&#x3D; form.username.data)</span><br><span class="line">   conn.execute(stmt)</span><br><span class="line"></span><br><span class="line">4) setattr(user, &#39;no_of_logins&#39;, user.no_of_logins+1)</span><br><span class="line">   session.commit()</span><br></pre></td></tr></table></figure>

<h3 id="2-4-删除"><a href="#2-4-删除" class="headerlink" title="2.4 删除"></a>2.4 删除</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5033547/sqlalchemy-cascade-delete">https://stackoverflow.com/questions/5033547/sqlalchemy-cascade-delete</a></p>
<h4 id="OnDelete"><a href="#OnDelete" class="headerlink" title="OnDelete"></a>OnDelete</h4><p>ondelete=’CASCADE’))</p>
<h4 id="批量操作"><a href="#批量操作" class="headerlink" title="批量操作"></a>批量操作</h4><p>models.User.query.delete()</p>
<h3 id="如何从-Object-到一个-ORM"><a href="#如何从-Object-到一个-ORM" class="headerlink" title="如何从 Object 到一个 ORM"></a>如何从 Object 到一个 ORM</h3><p>如何追踪 Object 的变化？</p>
<h2 id="0x03-SQLAlchemy-的高级特性"><a href="#0x03-SQLAlchemy-的高级特性" class="headerlink" title="0x03 SQLAlchemy 的高级特性"></a>0x03 SQLAlchemy 的高级特性</h2><h3 id="表继承"><a href="#表继承" class="headerlink" title="表继承"></a>表继承</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1337095/sqlalchemy-inheritance">https://stackoverflow.com/questions/1337095/sqlalchemy-inheritance</a></p>
<h3 id="啥玩意"><a href="#啥玩意" class="headerlink" title="啥玩意"></a>啥玩意</h3><p>Flush 和 commit</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/4201455/sqlalchemy-whats-the-difference-between-flush-and-commit">https://stackoverflow.com/questions/4201455/sqlalchemy-whats-the-difference-between-flush-and-commit</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">x &#x3D; Foo(bar&#x3D;1)</span><br><span class="line">print x.id</span><br><span class="line"># None</span><br><span class="line">session.add(x)</span><br><span class="line">session.flush()</span><br><span class="line"># BEGIN</span><br><span class="line"># INSERT INTO foo (bar) VALUES(1)</span><br><span class="line"># COMMIT</span><br><span class="line">print x.id</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qry &#x3D; DBSession.query(User).filter(</span><br><span class="line">        and_(User.birthday &lt;&#x3D; &#39;1988-01-17&#39;, User.birthday &gt;&#x3D; &#39;1985-01-17&#39;))</span><br></pre></td></tr></table></figure>

<h2 id="0x04-SQLAlchemy-的基础特性-Under-The-Hood"><a href="#0x04-SQLAlchemy-的基础特性-Under-The-Hood" class="headerlink" title="0x04 SQLAlchemy 的基础特性 Under The Hood"></a>0x04 SQLAlchemy 的基础特性 Under The Hood</h2><h3 id="Loading-策略"><a href="#Loading-策略" class="headerlink" title="Loading 策略"></a>Loading 策略</h3><h4 id="Lazy-Loading"><a href="#Lazy-Loading" class="headerlink" title="Lazy Loading"></a>Lazy Loading</h4><h4 id="Eager-Loading"><a href="#Eager-Loading" class="headerlink" title="Eager Loading"></a>Eager Loading</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from sqlalchemy.dialects import postgresql</span><br><span class="line">&gt;&gt;&gt; print str(q.statement.compile(dialect&#x3D;postgresql.dialect()))</span><br><span class="line">Where q is defined as:</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="0x05-SQLAlchemy-的高级特性-Under-The-Hood"><a href="#0x05-SQLAlchemy-的高级特性-Under-The-Hood" class="headerlink" title="0x05 SQLAlchemy 的高级特性 Under The Hood"></a>0x05 SQLAlchemy 的高级特性 Under The Hood</h2><h3 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6297404/multi-threaded-use-of-sqlalchemy">https://stackoverflow.com/questions/6297404/multi-threaded-use-of-sqlalchemy</a><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/9619789/sqlalchemy-proper-session-handling-in-multi-thread-applications">https://stackoverflow.com/questions/9619789/sqlalchemy-proper-session-handling-in-multi-thread-applications</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;34322471&#x2F;sqlalchemy-engine-connection-and-session-difference</span><br><span class="line">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;11769366&#x2F;why-is-sqlalchemy-insert-with-sqlite-25-times-slower-than-using-sqlite3-directly</span><br><span class="line">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;12223335&#x2F;sqlalchemy-creating-vs-reusing-a-session</span><br><span class="line">session 是个容器</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;18199053&#x2F;example-of-what-sqlalchemy-can-do-and-django-orm-cannot</span><br><span class="line">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;7389759&#x2F;memory-efficient-built-in-sqlalchemy-iterator-generator</span><br><span class="line"></span><br><span class="line"># 日志</span><br><span class="line">import logging</span><br><span class="line">logging.basicConfig()</span><br><span class="line">logging.getLogger(&#39;sqlalchemy.engine&#39;).setLevel(logging.INFO)</span><br></pre></td></tr></table></figure>

<h2 id="0x06-DEBUG-和-Profile-技巧"><a href="#0x06-DEBUG-和-Profile-技巧" class="headerlink" title="0x06 DEBUG 和 Profile 技巧"></a>0x06 DEBUG 和 Profile 技巧</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQLALCHEMY_TRACK_MODIFICATIONS &#x3D; False</span><br></pre></td></tr></table></figure>

<h3 id="6-1-查看技巧"><a href="#6-1-查看技巧" class="headerlink" title="6.1 查看技巧"></a>6.1 查看技巧</h3><p>dict(u)<br>u.<strong>dict</strong></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1171166/how-can-i-profile-a-sqlalchemy-powered-application">https://stackoverflow.com/questions/1171166/how-can-i-profile-a-sqlalchemy-powered-application</a></p>
<p>如果用上 Flask+SQLAlchemy 一般也要带上，Flask-Migration 与 Flask-SQLAlchemy, 这两个库也是对 Alembic 和 SQLAlchemy 的浅封装。</p>
<p>那么，对于这个 ORM 库还有那些通用性的知识需要了解？</p>
<p>嗯，是时候了解本质了。</p>
<p><a target="_blank" rel="noopener" href="http://derrickgilland.com/posts/demystifying-flask-sqlalchemy/">http://derrickgilland.com/posts/demystifying-flask-sqlalchemy/</a></p>
<h2 id="0x07-ORM-的本质"><a href="#0x07-ORM-的本质" class="headerlink" title="0x07 ORM 的本质"></a>0x07 ORM 的本质</h2><p>ORM 的本质是 Data Access Layer 上的一层封装。如果你写原生 SQL, 即手写 DAL 的话，开发效率可能会大打折扣。</p>
<h3 id="ORM-的两种类型-Active-Record-与-Data-Mappers"><a href="#ORM-的两种类型-Active-Record-与-Data-Mappers" class="headerlink" title="ORM 的两种类型 Active Record 与 Data Mappers"></a>ORM 的两种类型 Active Record 与 Data Mappers</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"># ActiveRecord 风格写起来类似于 Django ORM, 大致是这样的</span><br><span class="line"></span><br><span class="line">## AR 的模型定义</span><br><span class="line"></span><br><span class="line">class User(db.models):</span><br><span class="line">    name &#x3D; db.StringField(verbose&#x3D;&quot;xyz&quot;)</span><br><span class="line"></span><br><span class="line">## AR 的新增</span><br><span class="line">user &#x3D; User()</span><br><span class="line">user.name &#x3D; &quot;123456&quot;</span><br><span class="line">user.save() ## 正好对应数据库中的一行</span><br><span class="line"></span><br><span class="line">## AR 的查询</span><br><span class="line"></span><br><span class="line">users &#x3D; User.objects.filter(Q(name&#x3D;&quot;黄老板的小姨子&quot;)).all()</span><br><span class="line"></span><br><span class="line"># Data Mappers 风格写起来类似于 SQLAlchemy ORM, 大致是这样的</span><br><span class="line"></span><br><span class="line">## SA 的定义</span><br><span class="line"></span><br><span class="line">from sqlalchemy.ext.declarative import declarative_base</span><br><span class="line"></span><br><span class="line">Base &#x3D; declarative_base()</span><br><span class="line"></span><br><span class="line">from sqlalchemy import Column, Integer, String</span><br><span class="line">class User(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;users&#39;</span><br><span class="line"></span><br><span class="line">    id &#x3D; Column(Integer, primary_key&#x3D;True)</span><br><span class="line">    name &#x3D; Column(String)</span><br><span class="line"></span><br><span class="line">Base.metadata.create_all(engine)</span><br><span class="line"></span><br><span class="line">## SA 的新增</span><br><span class="line"></span><br><span class="line">user &#x3D; User()</span><br><span class="line">user.name &#x3D; &quot;123456&quot;</span><br><span class="line">session.add(user)</span><br><span class="line">sessoon.commit() ## 嗯？其实也是对应数据库中的一行。</span><br><span class="line"></span><br><span class="line">## SA 的查询</span><br><span class="line"></span><br><span class="line">session.query(User).filter(User.name)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>问题来了，这两者到底是什么，看起来似乎相差不大。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class Person:</span><br><span class="line"></span><br><span class="line">    lastname</span><br><span class="line">    firstname</span><br><span class="line">    children</span><br><span class="line"></span><br><span class="line">    # 数据操作</span><br><span class="line">    def findone(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">    def insert(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">    def update(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">    def delete(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">    # 业务逻辑</span><br><span class="line">    def getChildrenTax(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>lastName firstName numberOfDependents</p>
<p>insert update delete</p>
<p>getExemption isFlaggedForAudit getTaxableEarnings</p>
<p>An object that wraps a row in a database table or view, encapsulates the database access, and adds domain logic on that data.</p>
<p>The essence of an Active Record is a Domain Model (116) in which the classes match very closely the record structure of an underlying database. Each Active Record is responsible for saving and loading to the database and also for any domain logic that acts on the data. This may be all the domain logic in the application, or you may ﬁnd that some domain logic is held in Transaction Scripts (110) with common and data-oriented code in the Active Record.</p>
<p>The data structure of the Active Record should exactly match that of the database: one ﬁeld in the class for each column in the table. Type the ﬁelds the way the SQL interface gives you the data—don’t do any conversion at this stage. You may consider Foreign Key Mapping (236), but you may also leave the foreign keys as they are. You can use views or tables with Active Record, although updates through views are obviously harder. Views are particularly useful for reporting purposes.</p>
<p>objects correspond directly to the database tables: an isomorphic schema. If your business logic is complex, you’ll soon want to use your object’s direct relationships, collections, inheritance, and so forth. These don’t map easily onto Active Record, and adding them piecemeal gets very messy. That’s what will lead you to use Data Mapper (165) instead.</p>
<p>Another argument against Active Record is the fact that it couples the object design to the database design. This makes it more difﬁcult to refactor either design as a project goes forward.</p>
<p>Active Record is a good pattern to consider if you’re using Transaction Script (110) and are beginning to feel the pain of code duplication and the difﬁculty in updating scripts and tables that Transaction Script (110) often brings. In this case you can gradually start creating Active Records and then slowly refactor behavior into them. It often helps to wrap the tables as a Gateway (466) ﬁrst, and then start moving behavior so that the tables evolve to a Active Record.</p>
<p>其实为什么不选择设计成 ActiveRecord , 而是选择设计成 Data Mapper, 其实就可以回答这个问题：</p>
<blockquote>
<p>虽然要设计成 ORM, 考虑到数量和性能因素，SQL 数据库（多个表）并不应该是表现像 Object 集合那样（换言之，也就是 AR 表现的像 Object 的集合一样）。<br>同时，出于更好的抽象，object 集合也应该表现的像表以及行</p>
</blockquote>
<p>于是我们可以得出结论，可以在 SQLAlchemy 上面进行一定的封装，使得最后用起来非常的 Django ORM like，其实 SQLAlchemy 稍加定制还是可以很 Django ORM-like 的。</p>
<p>:TODO: 有机会看看那本书再修改一下本小节</p>
<p>这不，果然有人就这么搞了 <a target="_blank" rel="noopener" href="https://github.com/absent1706/sqlalchemy-mixins">https://github.com/absent1706/sqlalchemy-mixins</a></p>
<h2 id="0x09-踩坑集"><a href="#0x09-踩坑集" class="headerlink" title="0x09 踩坑集"></a>0x09 踩坑集</h2><h3 id="关系持久化坑"><a href="#关系持久化坑" class="headerlink" title="关系持久化坑"></a>关系持久化坑</h3><ol>
<li>Rows that point to themselves : 比如一个 insert 一个推荐自己的用户，则需要保存 id / ref_id , 但是在这个 user 插入之前，并不存在 id. 所以，一般情况下是先 insert, 然后保存 ref_id</li>
<li>Mutually Dependent Rows</li>
</ol>
<h3 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h3><p>session.query(MyClass).filter(“foo={}”.format(getArgs[‘val’]))</p>
<h2 id="0xEE-参考链接"><a href="#0xEE-参考链接" class="headerlink" title="0xEE 参考链接"></a>0xEE 参考链接</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://www.eversql.com/django-vs-sqlalchemy-which-python-orm-is-better/">https://www.eversql.com/django-vs-sqlalchemy-which-python-orm-is-better/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2546207/does-sqlalchemy-have-an-equivalent-of-djangos-get-or-create">https://stackoverflow.com/questions/2546207/does-sqlalchemy-have-an-equivalent-of-djangos-get-or-create</a></p>
</li>
<li><p>除了文档本身，作者在 Stack Overflow 上的回答都是非常值得阅读的。<a target="_blank" rel="noopener" href="https://stackoverflow.com/users/34549/zzzeek">https://stackoverflow.com/users/34549/zzzeek</a></p>
</li>
<li><p>Patterns of Enterprise Application Architecture - Martin Fowler</p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://aosabook.org/en/sqlalchemy.html">http://aosabook.org/en/sqlalchemy.html</a></p>
<p>  <a target="_blank" rel="noopener" href="http://techspot.zzzeek.org/">http://techspot.zzzeek.org/</a></p>
</li>
</ul>
<hr>
<p>ChangeLog:</p>
<ul>
<li><strong>2018-03-09</strong> 重修文字</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://twocucao.xyz/2019/02/10/%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B3%A8%E6%84%8F%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Micheal Gardner">
      <meta itemprop="description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MG的编程小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/02/10/%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B3%A8%E6%84%8F%E7%82%B9/" class="post-title-link" itemprop="url">秒杀系统的一些注意点</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2019-02-10 12:17:17 / Modified: 12:57:45" itemprop="dateCreated datePublished" datetime="2019-02-10T12:17:17+08:00">2019-02-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">系统设计</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><h2 id="秒杀常见问题"><a href="#秒杀常见问题" class="headerlink" title="秒杀常见问题"></a>秒杀常见问题</h2><h3 id="01-卖超问题"><a href="#01-卖超问题" class="headerlink" title="01 卖超问题"></a>01 卖超问题</h3><p>假设有 20 个商品要卖，1W 个请求打过来。</p>
<ol>
<li>SQL 加上数量判断，防止数量超掉</li>
</ol>
<p>应用层的检查，并发量上来，肯定要加行级锁，开销比较大。</p>
<ol start="2">
<li>redis 集合预先缓存好相关的数量，然后从 redis 上进行应用层的数量检查。</li>
</ol>
<p>然后走异步队列。</p>
<p>因为对于数据库来说，我只要 20 个请求即可，redis 起到了一个阻挡多余的请求穿透到 DB 中的作用。</p>
<p>即便如此，redis 依然可能会出现一些意外的情况，比如为负数，这个时候多打进去几个请求，变成 24 个，这个时候 MQ 的作用就出来了。排好队伍。</p>
<ol start="3">
<li>唯一索引</li>
</ol>
<p>数据库层的检查，可以从根本上防止问题</p>
<h3 id="02-缓存问题"><a href="#02-缓存问题" class="headerlink" title="02 缓存问题"></a>02 缓存问题</h3><ol>
<li>page 级别的缓存，由于 wsgi 协议本身在 flask 中返回的就是文本，所以，当作文本处理即可</li>
<li>obj 级别的缓存</li>
</ol>
<p>能走内存的走内存，能走 redis 就走 redis, 能通过 mq 削减峰值的就走 mq, 能走 mongodb 的走 mongodb, 最后是数据库。</p>
<h3 id="03-安全"><a href="#03-安全" class="headerlink" title="03 安全"></a>03 安全</h3><ol>
<li>验证码</li>
<li>接口防刷限流</li>
<li>秒杀接口隐藏</li>
</ol>
<h3 id="04-分布式锁"><a href="#04-分布式锁" class="headerlink" title="04 分布式锁"></a>04 分布式锁</h3><ol>
<li>不加锁，并发起来资源浪费</li>
<li>加锁，然而，线路抖动会导致不能及时释放锁</li>
<li>加过期锁，或者加带有时间的锁，然后重新获取锁。</li>
<li>redisson 封装好的方法</li>
</ol>
<h3 id="06-减少数据库访问时间"><a href="#06-减少数据库访问时间" class="headerlink" title="06 减少数据库访问时间"></a>06 减少数据库访问时间</h3><ol>
<li>首先考虑在 where 和 order by 设计的列上建立索引</li>
<li>索引越多，插入越慢，这个要做好平衡</li>
<li>避免过长的事务级操作，提高并发能力</li>
</ol>
<p>其他的可以参考 MySQL 的一些优化原则，油管上很多。</p>
<h3 id="07-分布式事务"><a href="#07-分布式事务" class="headerlink" title="07 分布式事务"></a>07 分布式事务</h3><p>分布式事务，准确来说，是分布式</p>
<h2 id="0xEE-参考"><a href="#0xEE-参考" class="headerlink" title="0xEE 参考"></a>0xEE 参考</h2><h3 id="PEP"><a href="#PEP" class="headerlink" title="PEP"></a>PEP</h3><ul>
<li><p>PEP 3107</p>
</li>
<li><p>PEP 483</p>
</li>
<li><p>PEP 3107</p>
</li>
<li><p>PEP 3107</p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://wphomes.soic.indiana.edu/jsiek/what-is-gradual-typing/">关于 gradual typing</a></p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://mypy.readthedocs.io/en/latest/cheat_sheet_py3.html">https://mypy.readthedocs.io/en/latest/cheat_sheet_py3.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.zulip.org/2016/10/13/static-types-in-python-oh-mypy/">https://blog.zulip.org/2016/10/13/static-types-in-python-oh-mypy/</a></p>
<hr>
<p>ChangeLog:</p>
<ul>
<li><strong>2018-11-25</strong> 初始化本文</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://twocucao.xyz/2018/12/23/VlogCheatSheet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Micheal Gardner">
      <meta itemprop="description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MG的编程小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/23/VlogCheatSheet/" class="post-title-link" itemprop="url">旅拍 Vlog CheatSheet</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2018-12-23 20:44:09 / Modified: 21:16:13" itemprop="dateCreated datePublished" datetime="2018-12-23T20:44:09+08:00">2018-12-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%86%99%E5%9C%A8%E4%BA%BA%E7%94%9F%E7%9A%84%E8%BE%B9%E4%B8%8A/" itemprop="url" rel="index"><span itemprop="name">写在人生的边上</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>最近剪辑了几个 Vlog, 借着这个机会复盘一下几次从拍摄到出片的流程。</p>
<h2 id="0x01-拍摄准备"><a href="#0x01-拍摄准备" class="headerlink" title="0x01 拍摄准备"></a>0x01 拍摄准备</h2><p>目前笔者的拍摄装备如下：</p>
<p>主力拍摄器材：</p>
<ol>
<li>Sony A6500</li>
</ol>
<p>辅助拍摄器材：</p>
<ol>
<li>GoPro Hero 7 Black</li>
</ol>
<p>相机的设备还氛围 + 三块电池 + 充电宝</p>
<ol>
<li>辅助 IPhone 8P</li>
<li>充电宝</li>
</ol>
<h2 id="0x02-工作流"><a href="#0x02-工作流" class="headerlink" title="0x02 工作流"></a>0x02 工作流</h2><p>可以找司机询问最佳的视角</p>
<h2 id="0xEE-参考"><a href="#0xEE-参考" class="headerlink" title="0xEE 参考"></a>0xEE 参考</h2><hr>
<p>ChangeLog:</p>
<ul>
<li><strong>2018-11-25</strong> 初始化本文</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://twocucao.xyz/2018/12/10/PythonTypeAnotation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Micheal Gardner">
      <meta itemprop="description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MG的编程小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/10/PythonTypeAnotation/" class="post-title-link" itemprop="url">用 Type Anotation 提升你的 Python 代码健壮性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-12-10 10:32:31" itemprop="dateCreated datePublished" datetime="2018-12-10T10:32:31+08:00">2018-12-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-02-16 11:52:35" itemprop="dateModified" datetime="2019-02-16T11:52:35+08:00">2019-02-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E9%BB%91%E9%AD%94%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">Python 黑魔法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>本文是《提升你的 Python 项目代码健壮性和性能》系列的第一篇文章。</p>
<p>本系列仅仅从笔者的项目经历来讲解一些提升代码健壮性的姿势和小技巧。</p>
<p>本文目录如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">▼ 0x00 前言 : section</span><br><span class="line">▼ 0x01 Gradual Typing : section</span><br><span class="line">		静态类型 VS 动态类型 : section</span><br><span class="line">		Gradual Typing &#x3D; 静态类型 + 动态类型 : section</span><br><span class="line">▼ 0x02 Python Typing 实战 - MyPY : section</span><br><span class="line">		MyPy : section</span><br><span class="line">		快速入门 : section</span><br><span class="line">▼ 0x03 常见问题 : section</span><br><span class="line">		如何忽略 mypy 警告 : section</span><br><span class="line">		循环导入 : section</span><br><span class="line">	0x04 Typing Anotation 项目最佳实践 : section</span><br><span class="line">▼ 0xEE 参考 : section</span><br><span class="line">		PEP : section</span><br><span class="line">		扩展文章 : section</span><br></pre></td></tr></table></figure>

<p>当我刚知道 Python 要添加类型的时候，我的内心是拒绝的。</p>
<p>但是，尝试了俩个疗程之后，腰也不疼了，腿也不疼了，走起路来都有劲了，嗯，真香。</p>
<p>为啥需要 Type Anotation?</p>
<p>因为软件开发需要协作，动态类型给人极大的灵活性，写的时候很爽，但如果解放了双手，撸起袖子一通写，自己写起来爽了，自己重构的时候或者其他人来看代码的时候，头发就会加速掉落。</p>
<p>加了 Typing 能解决这个问题嘛？不能，但适当的使用可以极大的提升代码的健壮性。</p>
<p>在如下的场景中，Typing 可以发挥作用</p>
<ol>
<li>在程序运行前进行类型检查</li>
<li>提供 typing 信息，当然，这带来的另一个巨大的优点就是让 IDE 可以分析出函数的参数类型以及返回值</li>
</ol>
<p>这样大大提升了代码量上来之后的类型检查不足带来的返工问题。</p>
<h2 id="0x01-Gradual-Typing"><a href="#0x01-Gradual-Typing" class="headerlink" title="0x01 Gradual Typing"></a>0x01 Gradual Typing</h2><p>在你刚入门一门编程语言的时候，我们常常说，Java 是强类型（静态类型）语言，Python 是弱类型（动态类型）语言</p>
<p>从这两位诞生开始，静态类型和动态类型就一直进行旷日持久的圣战。</p>
<p>然而，而现在的发展趋势是：</p>
<ul>
<li>静态类型的语言觉得自己太过静态，以至于写起来很啰嗦。于是引入了很多类型推断。 Java / Go</li>
<li>动态类型的语言觉得自己太过动态，以至于协作的过程中总是出现低级错误。于是引入了 Gradual Typing , Typescript / Flow / Python Type Annotation</li>
</ul>
<p>什么是 Gradual Typing?</p>
<p>Gradual typing 允许开发者仅在程序的部分地区使用 Annotate/Type. 即，既不是黑猫（静态）, 也不是白猫（动态），从而诞生了熊猫（动静结合）。</p>
<p>话说回来，要知道为什么这么搞，首先要知道动态类型和静态类型会给程序带来什么。</p>
<h3 id="静态类型-VS-动态类型"><a href="#静态类型-VS-动态类型" class="headerlink" title="静态类型 VS 动态类型"></a>静态类型 VS 动态类型</h3><p>静态类型的语言，比如在写 Java 的时候，如果你把一个 int 赋值给了 string 的变量，IDE 会通过<strong>类型检查器</strong>立即报错并告诉你，你这个值赋值错啦。这个就是 Java 程序的检查阶段。<br>动态类型的语言，比如在写 Python 的时候，如果不用一些额外的手段，这种低级的错误，并不会在检查时爆出来，只会在运行时爆出来。如果线上还是出这个问题，就蛋疼了。</p>
<p>为了进行友好的讨论，本人将精分成 Javaer 和 Pythonist, 通过两人对话的方式，来讨论类型。</p>
<ul>
<li><p>Javaer: 我先喝杯咖啡</p>
</li>
<li><p>Pythonist: 生命苦短，我用 Python。</p>
</li>
<li><p>Javaer: P 哥，请（为什么叫 P 哥？Python 1989 年出生，Java 1995 年）</p>
</li>
<li><p>Pythonist: J 弟，请</p>
</li>
<li><p>Javaer: 静态类型可以较低成本的提早捕获 BUG, 比如：</p>
<ol>
<li>你在写 Python 的时候，如果不用一些额外的手段，这种低级的错误，并不会在检查时爆出来，只会在运行时爆出来。</li>
<li>如果线上还是出这个问题，就蛋疼了。我这个类型检查可以在<strong>使用 IDE 的时候给我分析出方法参数的类型和返回值</strong>。所谓『上医治未病，中医治已病，下医治大病』, 防范于未然，善之善者也。</li>
</ol>
</li>
<li><p>Python: 等等，你小子还广征博引了还，首先，提早捕获 Bug, 我这里也有呀，比如我这里可以通过 flake8 来检查出有些没有定义的变量，<strong>仅仅是类型没有检查而已</strong>。其次，IDE 给我的补全又不是完全无法补全。弱一点罢了。你说的类型检查的问题：</p>
<ol>
<li>可以通过<strong>提升程序员的素质</strong>来解决这个问题，或者让他们长点脑子，别特么在这种低级错误上犯错误。</li>
<li>写测试来<strong>提升测试代码的代码覆盖率</strong>（这个我会在本系列的第二篇文章里深入讲解）来解决这个问题</li>
<li>看看写的代码检查时出现问题，我完全可以<strong>把代码拖到 IPython 里面跑一遍</strong>。这可不仅仅能解决类型不正确带来的问题，还能快速解决代码的逻辑问题</li>
</ol>
</li>
<li><p>Java: 关于你说的第三点，我完全可以提升测试代码的覆盖率。哎？似乎我这个开发测试成本也上来了。看来<strong>类型检查也不能解决这个问题</strong></p>
</li>
<li><p>Javaer: 来 P 哥</p>
<ol>
<li>静态类型确实以<strong>较低的成本</strong>解决了这种类型的问题，不是么？</li>
<li>并且，如果我其中一小块功能进行了修改，我总不能每次都跑 IPython 吧？我也不能因为想检查一下类型这种小操作就写测试代码覆盖一下？</li>
</ol>
</li>
<li><p>Python: 你每次修改，都要加类型，加类型，改类型，直到类型检查器完全接受。不麻烦嘛？面向类型检查器编程？</p>
</li>
<li><p>Javaer: 来，</p>
<ol>
<li>每次改代码的时候，又不是改一大推，你是小部分改的，能有多少项目是海量海量改？高内聚，低耦合，模块化开发。</li>
<li>好的代码是重构出来的，修改你的类型来让类型检查器通过。你的代码会被更好的组织起来。</li>
<li>我大 Java 就是面向重构的语言！我有 Jetbrain 的 IDE, 重构代码我怕谁</li>
</ol>
</li>
<li><p>Python: 来，你说的没错，</p>
<ol>
<li><strong>每次改代码的时候，又不是改一大推，你是小部分改的</strong>。这话你说的没错，我也能用啊，因为代码总是一小部分一小部分改的，所以，改完了跑一下 IPython 就结了。</li>
<li>好的代码是重构出来的，修改你的类型来让类型检查器通过。你的代码会被更好的组织起来。这话你说的也没错，可<strong>我重构的时候没有写测试就重构</strong>，是不是有点莽撞？写了测试了，我还要花时间在类型检查器上，不啰嗦么？</li>
<li>我也有 Jetbrain 的 IDE, 重构代码我又不是不能重构。</li>
</ol>
</li>
<li><p>Python: 再来，</p>
<ol>
<li>需求变更上来了，结果往往会出现，你本来是想专注于业务逻辑的更改的，但最后变成了大型<strong>为了让类型检查器通过类型检查而艰苦奋斗的现场</strong>, 我这个场景直接传 int/str/ 字典 / 传对象就很方便，你非要让我写四个函数来 override 方法。</li>
<li>虽然说，好代码确实可以通过重构出来，但动态语言表达能力强呀，你 Java HashMap 啰啰嗦嗦 put 写了半天，我 Python 一个 Dict 一把梭，看起来，清晰，改起来方便。</li>
</ol>
</li>
</ul>
<p>再比如说，</p>
<p>LeetCode 上面有一道题目，叫做最长连续 1</p>
<p>Input 是 [1,1,0,1,1,1] Output 是 3</p>
<p>我们尝试用 Python 来看下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_max_consecutive_ones</span>(<span class="params">num</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">max</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: <span class="built_in">len</span>(x), <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(num) <span class="keyword">for</span> num <span class="keyword">in</span> nums]).split(<span class="string">&#x27;0&#x27;</span>)))</span><br></pre></td></tr></table></figure>

<p>我们尝试用 Java 来看下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findMaxConsecutiveOnes</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (nums[i] == <span class="number">0</span>)</span><br><span class="line">				tmp = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				tmp += <span class="number">1</span>;</span><br><span class="line">				result = Math.max(tmp, result);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Javaer: 啊咧？P 哥你确实有点短啊！</li>
<li>Pythonist: 你敢说我短？你看看 java 的创始人的头发！</li>
</ul>
<p>『贴图』</p>
<ul>
<li><p>Javaer: 我不是那个意思，浓缩就是精华嘛，表达能力弱又怎么样，我 Javaer 可以直接封装好这个功能当成工具类用，从外部使用上用起来差不多好吧，从项目角度表达力并不是决定性因素，静态类型检查可以提早在编译阶段做字节码优化。你的 GIL…</p>
</li>
<li><p>Pythonist: 好了，咱就不要提 GIL 了</p>
</li>
<li><p>Pythonist: 动态类型不需要花时间写 type annotation, 写起来速度杠杠的。</p>
</li>
<li><p>Javaer: 静态语言一时爽，动态类型火葬场好伐？举个例子，太动态的东西，就是不好做类型推断，比如贵圈的著名的 sqlalchemy 做的那么动态，query.get() 结合 flask 来用，YouModel.query.get() 出来的 YouModel 你还要点进去查看一下具体属性，你要用 title 还是 name, 拼错了，怎么办？都不报错的。</p>
</li>
<li><p>Javaer: 静态类型迫使你思考程序的时候更加严谨认真，这将会提升你的代码质量。</p>
</li>
<li><p>Pythonist: 这点我是不服的，你只是花费了大量的时间在类型检查上，写的认不认真不完全取决于你编程的水平和态度好伐？假如你的观点成立，语言只是武器，峨眉师太拿一把倚天剑，不还是被张三丰空手取来？</p>
</li>
<li><p>Javaer: 但你不能否认，峨眉师太拿着倚天剑确实可以秒杀很多人。</p>
</li>
</ul>
<blockquote>
<p>旁白君：有道是，梅须逊雪三分白，雪却输梅一段香。</p>
</blockquote>
<ul>
<li>Guido van Rossum: 好了，我觉得类型不错，我在 dropbox 带领团队实现了 python 的 typing，python 3.7 内置哦。</li>
<li>Pythonist: 我自己打脸一下，动态类型花点时间写 type annotation 代码健壮性杠杠的。</li>
<li>Javaer: 你走开… 你怎么不去解决 GIL 的问题。</li>
</ul>
<h3 id="Gradual-Typing-静态类型-动态类型"><a href="#Gradual-Typing-静态类型-动态类型" class="headerlink" title="Gradual Typing = 静态类型 + 动态类型"></a>Gradual Typing = 静态类型 + 动态类型</h3><p>Gradual Typing 就是在动态语言的基础上，增加了可选的类型声明 (Type Annotation)</p>
<p>这对于我这种人是福音，</p>
<p>对于我个人而言，我是希望 Python 是有类型的</p>
<ol>
<li>作为某段程序的开发者和维护者，我可以提升我重构的速度。</li>
<li>作为某段程序的调用方，可以快速的知道我调用后得到的东西究竟是什么。</li>
</ol>
<p>但我又不希望这个声明不是强制性的</p>
<ol>
<li>我在构思程序的时候，想专注于接口的设计。在落实编码并且把代码写的足够的 dry 之后，在被调用的一些地方加上类型声明，这样可以提升我写代码的速度。</li>
</ol>
<h2 id="0x02-Python-Typing-实战-MyPY"><a href="#0x02-Python-Typing-实战-MyPY" class="headerlink" title="0x02 Python Typing 实战 - MyPY"></a>0x02 Python Typing 实战 - MyPY</h2><h3 id="MyPy"><a href="#MyPy" class="headerlink" title="MyPy"></a>MyPy</h3><p>mypy 是一个可选的静态分析器，官网介绍上说，mypy 将使你的程序更加易懂，调试和维护。</p>
<p>这个程序</p>
<ul>
<li>对于 PHP 有 Hack , 对 JavaScript 有 Flow 和 TypeScript, 对于 Python 有 MyPy</li>
<li>对于 Python, 则有 MyPy , MyPy 彼时还不是很成熟 (2016 年 10 之前）。</li>
</ul>
<p>Dropbox 的团队开发，Guido van Rossum 领导开发</p>
<h3 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h3><p>本小节部分摘录 Type hints cheat sheet</p>
<p>建议读者收藏原网址 <a target="_blank" rel="noopener" href="https://mypy.readthedocs.io/en/latest/cheat_sheet_py3.html">https://mypy.readthedocs.io/en/latest/cheat_sheet_py3.html</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内置类型</span></span><br><span class="line">x: <span class="built_in">int</span> = <span class="number">1</span></span><br><span class="line">x: <span class="built_in">float</span> = <span class="number">1.0</span></span><br><span class="line">x: <span class="built_in">bool</span> = <span class="literal">True</span></span><br><span class="line">x: <span class="built_in">str</span> = <span class="string">&quot;test&quot;</span></span><br><span class="line">x: <span class="built_in">bytes</span> = <span class="string">b&quot;test&quot;</span></span><br><span class="line"></span><br><span class="line">child: <span class="built_in">bool</span></span><br><span class="line"><span class="keyword">if</span> age &lt; <span class="number">18</span>:</span><br><span class="line">    child = <span class="literal">True</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    child = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 普通函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stringify</span>(<span class="params">num: <span class="built_in">int</span></span>) -&gt; str:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(num)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">n: <span class="built_in">int</span></span>) -&gt; Iterable[int]:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; n:</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>直接看起来似乎，加不加 typing 对现在的代码改善并不是很明显嘛。</p>
<p>我们可以给复杂类型起别名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">比如：</span><br><span class="line">def f() -&gt; Union[List[Dict[Tuple[int, str], Set[int]]], Tuple[str, List[str]]]:</span><br><span class="line">def b() -&gt; Union[List[Dict[Tuple[int, str], Set[int]]], Tuple[str, List[str]]]:</span><br><span class="line"></span><br><span class="line">AliasType &#x3D; Union[List[Dict[Tuple[int, str], Set[int]]], Tuple[str, List[str]]]</span><br><span class="line">def f() -&gt; AliasType:</span><br><span class="line">    ...</span><br><span class="line">def b() -&gt; AliasType:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>看起来还行，但还是没有感觉到很明显的代码质量改善。</p>
<p>好，再看一例，使用 ClassVar 禁止属性无法在实例上设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from typing import ClassVar</span><br><span class="line"></span><br><span class="line">class A:</span><br><span class="line">    x: ClassVar[int] &#x3D; 0  # Class variable only</span><br><span class="line"></span><br><span class="line">A.x +&#x3D; 1  # OK</span><br><span class="line"></span><br><span class="line">a &#x3D; A()</span><br><span class="line">a.x &#x3D; 1  # Error: Cannot assign to class variable &quot;x&quot; via instance</span><br><span class="line">print(a.x)  # OK -- can be read through an instance</span><br></pre></td></tr></table></figure>

<p>举个例子，flask-sqlalchemy, 可以通过 YouModel.query.get(id) 来拿到 YouModel 的实例，但 IDE 不能推断出这个实例是什么。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 方法一，Cast</span><br><span class="line">you_model_ins: YouModel &#x3D; YouModel.query.get(id)</span><br><span class="line"># 方法二，包装一下 get 方法</span><br><span class="line"></span><br><span class="line">class YouModel(base):</span><br><span class="line">	def get(id) -&gt; &quot;YouModel&quot;: # 注意这里的字符串</span><br><span class="line">		pass</span><br><span class="line">you_model_ins &#x3D; YouModel.get(id)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>细心的读者可能看到这里的 YouModel 的返回值类型居然使用了 YouModel 的字符串，如果是 Java 的话，是可以直接写 YouModel 的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 加上类型延迟求值</span><br><span class="line">from __future__ import annotations</span><br><span class="line"></span><br><span class="line">class YouModel(base):</span><br><span class="line">	def get(id) -&gt; YouModel:</span><br><span class="line">		pass</span><br><span class="line">you_model_ins &#x3D; YouModel.get(id)</span><br></pre></td></tr></table></figure>

<p>还有其他的用法，请参考 MyPY 的官方文档</p>
<h2 id="0x03-常见问题"><a href="#0x03-常见问题" class="headerlink" title="0x03 常见问题"></a>0x03 常见问题</h2><h3 id="如何忽略-mypy-警告"><a href="#如何忽略-mypy-警告" class="headerlink" title="如何忽略 mypy 警告"></a>如何忽略 mypy 警告</h3><p>有的地方的代码不进行检查的话会方便很多。</p>
<p>与 flake8 类似，在注释后面写上标志就可以忽略了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">youcode  # type: igonre</span><br></pre></td></tr></table></figure>

<h3 id="循环导入"><a href="#循环导入" class="headerlink" title="循环导入"></a>循环导入</h3><p>我现在有两个文件，一个是 user.py 另一个是 order.py</p>
<p>在 user 里面有个方法需要返回 order 里面的 Order 列表，order 里面有个 order.owner 需要返回 User 实例。</p>
<p>如果不用类型声明的话，在 user 需要 order 的时候 import 进来即可规避循环导入。</p>
<p>在使用类型声明之后，建议在 user 里面这么写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if TYPE_CHECKING:</span><br><span class="line">    from project.models.order import Order # noqa</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="0x04-Typing-Anotation-项目最佳实践"><a href="#0x04-Typing-Anotation-项目最佳实践" class="headerlink" title="0x04 Typing Anotation 项目最佳实践"></a>0x04 Typing Anotation 项目最佳实践</h2><p>通过本文了解了基本的 Typing Anotation 的用法，其实效果还不够，本着对爱学习的读者老爷的负责的态度。</p>
<p>所谓『纸上得来终觉浅，绝知此事要宫刑』, 哦不『躬行』</p>
<p>推荐一个超级牛的大项目来让大家了解一下 typing annotation 的最佳实践。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/zulip/zulip/">https://github.com/zulip/zulip/</a></p>
<p>当然，从这个项目里面不仅仅能学到 typing annotation, 还能学到大项目下，牛 X 的公司的做法</p>
<ol>
<li>如何组织和划分模块</li>
<li>如何帮助开发者快速启用开发环境。</li>
<li>如何做测试，如何做 CI</li>
<li>如何优化自己的 Workflow</li>
</ol>
<p>有机会的话，我会挑其中的一小部分讲解一下。</p>
<h2 id="0xEE-参考"><a href="#0xEE-参考" class="headerlink" title="0xEE 参考"></a>0xEE 参考</h2><h3 id="PEP"><a href="#PEP" class="headerlink" title="PEP"></a>PEP</h3><ul>
<li>PEP 3107</li>
<li>PEP 483</li>
</ul>
<h3 id="扩展文章"><a href="#扩展文章" class="headerlink" title="扩展文章"></a>扩展文章</h3><ul>
<li><a target="_blank" rel="noopener" href="http://wphomes.soic.indiana.edu/jsiek/what-is-gradual-typing/">关于 gradual typing</a></li>
<li><a target="_blank" rel="noopener" href="https://mypy.readthedocs.io/en/latest/cheat_sheet_py3.html">https://mypy.readthedocs.io/en/latest/cheat_sheet_py3.html</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.zulip.org/2016/10/13/static-types-in-python-oh-mypy/">https://blog.zulip.org/2016/10/13/static-types-in-python-oh-mypy/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/21017354/answer/589574939">https://www.zhihu.com/question/21017354/answer/589574939</a></li>
</ul>
<hr>
<p>ChangeLog:</p>
<ul>
<li><strong>2018-11-25</strong> 初始化本文</li>
<li><strong>2019-02-16</strong> 重新整理文章</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://twocucao.xyz/2018/11/25/FinalCutProX/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Micheal Gardner">
      <meta itemprop="description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MG的编程小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/25/FinalCutProX/" class="post-title-link" itemprop="url">Final Cut Pro X CheatSheet</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-25 10:01:06" itemprop="dateCreated datePublished" datetime="2018-11-25T10:01:06+08:00">2018-11-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-12-23 20:43:10" itemprop="dateModified" datetime="2018-12-23T20:43:10+08:00">2018-12-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%86%99%E5%9C%A8%E4%BA%BA%E7%94%9F%E7%9A%84%E8%BE%B9%E4%B8%8A/" itemprop="url" rel="index"><span itemprop="name">写在人生的边上</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>本文诞生于用 Final Cut Pro X 剪了几次视频之后的复盘总结</p>
<p>部分内容来自于</p>
<ul>
<li>Final Cut Pro X 10.1 非线性编辑高级教程</li>
<li>Final Cut Pro X 影视包装剪辑完全自学教程</li>
</ul>
<h2 id="0x01-剪辑流程"><a href="#0x01-剪辑流程" class="headerlink" title="0x01 剪辑流程"></a>0x01 剪辑流程</h2><p>所有的剪辑流程都是想法的具体实现，这意味着在剪辑之前，需要做好前期准备</p>
<pre><code>1. 确定大致思路
2. 调好参数摄影</code></pre>
<p>然后</p>
<ol>
<li>素材导入</li>
<li>片段整理</li>
<li>前期剪辑</li>
<li>精剪</li>
<li>分享</li>
</ol>
<h2 id="0x01-前期准备"><a href="#0x01-前期准备" class="headerlink" title="0x01 前期准备"></a>0x01 前期准备</h2><p>本文复盘的是古墓丽影暗影假预告片剪辑。</p>
<p>热血的预告片通常具有如下的特征：</p>
<ol>
<li>有一条主线，但不剧透，通常这个主线往往是有人在说话，引出了整个故事</li>
<li>霸气磅礴的背景音乐</li>
<li>频繁而不冗余的镜头切换</li>
<li>踩节奏踩的非常精准</li>
</ol>
<h2 id="0x02-素材导入"><a href="#0x02-素材导入" class="headerlink" title="0x02 素材导入"></a>0x02 素材导入</h2><ol>
<li>建立 Library 游戏</li>
<li>建立 Event 古墓丽影暗影，导入游戏视频</li>
<li>建立 Project 古墓丽影暗影盗梦空间预告片</li>
</ol>
<p>素材导入没什么好说的，因为 PS4 里录制成什么样子，就是什么样子。</p>
<p>开启转码和分析的话，可以分析出更多的片段类型。</p>
<h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><ul>
<li>建议开启『创建优化的媒体』</li>
<li>看存储情况如果存储不是很足的话，开启『创建优化的代理文件』</li>
</ul>
<p>尽量将素材管理的任务交给 FCPX 来做，所以，如果可能的话，直接拷贝进资料库最好。</p>
<p>对于个人剪辑的话，比较适合两个 Library, 即一个常用 Library, 另一个是本项目的 Library 当然，其实也可以</p>
<h2 id="0x03-片段整理"><a href="#0x03-片段整理" class="headerlink" title="0x03 片段整理"></a>0x03 片段整理</h2><p>对于不同类型的影片，需要不同类型的整理方式</p>
<ol>
<li>对于预告片来说，两三秒的镜头可以带出大量的信息，引人遐想。</li>
<li>而对于普通综艺 / 电视剧 / 电影来说，如果遵循着预告片的节奏的话，则会交代不清楚事情。</li>
</ol>
<p>对于预告片来说，就仅仅剩下挑选中上片段这一个选项了。</p>
<ol>
<li>快速浏览片段内容</li>
<li>挑选片段里面的片段打上关键字</li>
<li>进入了某个关键字的视频列表，对它进行评价 (f/u/del)</li>
</ol>
<p>快速浏览</p>
<ol>
<li>FCPX 提供了缩略图模式，可以按 1s/5s/10s 的间隔显示视频内容，合理使用的话，可<br>以达到事半功倍的效果。</li>
<li>善用 jkl 快速浏览视频</li>
</ol>
<p>打关键字</p>
<ol>
<li>调出关键词管理器，然后设置关键词的快捷键，FCPX 可以快速选中一个片段中的片段（也可以通过 i/o 快捷键进行选择），选择 ctrl + num 打一个关键字。</li>
<li>这里也不需要把关键词的片段弄的特别的精准。因为其实放到视频里面还是可以前后拖拽的。（这只是个浅拷贝）</li>
</ol>
<p>评价系统</p>
<p>嗯？上了关键字的都是不错的镜头，似乎评价体系就没那么重要了</p>
<p>经过这些操作，之后，可以快捷的进行搜索。筛选出自己需要的片段。</p>
<p>嗯，由于项目本身并不算复杂。就关键字一波流搞定好了。</p>
<p>当然，题外话，如果我后期会基于这些素材做很多其他的事情的话，我就会认真的重新给片段<br>划分精细的关键字。</p>
<h2 id="0x04-前期剪辑"><a href="#0x04-前期剪辑" class="headerlink" title="0x04 前期剪辑"></a>0x04 前期剪辑</h2><p>笔者遇到的剪辑基本分为两种：</p>
<ol>
<li><p>踩情节类型</p>
</li>
<li><p>踩节奏类型</p>
</li>
<li><p>踩情节类型的剪辑只需要往上怼素材，然后依据磁力线调整即可。比如采访类，比如综艺。</p>
</li>
<li><p>踩节奏类型的剪辑这比较繁琐，因为要不断的增加，修改，删除片段。</p>
</li>
</ol>
<p>本次的剪辑就遇到了这个偏移问题，对于音乐的几个转节奏的地方，把视频 / 字幕放在磁力线上，删掉调整节奏前的片段，则导致后面的片段发生偏移。</p>
<p>为了解决偏移带来的踩节奏问题：</p>
<ol>
<li>设定一个标尺，奈何 FCPX 没有这个概念。于是，我采用了通过字幕来进行项目骨架的构建和注释。在音频的关键的地方，Marker 来注释.（经过仔细思考后，我认为可以弃用字幕的方式了，直接加一个调整层，在调整层上做 marker 来注释就好了）</li>
<li>当我要先空着预告片的前面，直接到后面编辑需要踩节奏的点位，则先 Q 放一个片段到这个踩节奏的点，然后创建故事线。在故事线里调整完毕之后，合并到主线上。</li>
<li>当我现在转到前面进行编辑的时候，Q 放一个片段到这个踩节奏的点，然后创建故事线，同上。</li>
<li>当我需要修改的时候把多个视频片段提出来，在视频上方调整好片段，合并到主线上。</li>
</ol>
<p>于是，骨架搭好，进入精细剪辑阶段吧。</p>
<h2 id="0x05-精细剪辑"><a href="#0x05-精细剪辑" class="headerlink" title="0x05 精细剪辑"></a>0x05 精细剪辑</h2><p>在精细剪辑的时候，记得先复制当前项目的一个快照。给快照名称升级个版本。</p>
<h3 id="5-1-调整片段"><a href="#5-1-调整片段" class="headerlink" title="5.1 调整片段"></a>5.1 调整片段</h3><ol>
<li>视频长度太长可以剪掉 (B)</li>
<li>速度过快过慢可以调整速度 (cmd+r)</li>
<li>滑动编辑 (Trim)</li>
<li>1 时间范围对了，似乎需要该片段的更前或者更后的部分.(T trim 一下） PS: 可以搭配 Marker 在细节上踩节奏。</li>
<li>2 片段和片段之间需要前面少点，后面多点 (T trim 一下）</li>
<li>移动故事线的片段而不发生位移 (postion 拖动 / lift + select 拖动）</li>
</ol>
<p>PS: 调整速度上 blade speed 是个利器</p>
<h3 id="5-2-调整效果"><a href="#5-2-调整效果" class="headerlink" title="5.2 调整效果"></a>5.2 调整效果</h3><h4 id="色彩改变-调色"><a href="#色彩改变-调色" class="headerlink" title="色彩改变 - 调色"></a>色彩改变 - 调色</h4><ol>
<li>苹果自带了平衡颜色。</li>
<li>手动调整</li>
</ol>
<h4 id="画面聚焦-晕影"><a href="#画面聚焦-晕影" class="headerlink" title="画面聚焦 - 晕影"></a>画面聚焦 - 晕影</h4><h4 id="关键帧动画"><a href="#关键帧动画" class="headerlink" title="关键帧动画"></a>关键帧动画</h4><h3 id="5-3-调整转场"><a href="#5-3-调整转场" class="headerlink" title="5.3 调整转场"></a>5.3 调整转场</h3><p>少用转场，尽量保持转场的一致性。</p>
<h3 id="5-5-调音"><a href="#5-5-调音" class="headerlink" title="5.5 调音"></a>5.5 调音</h3><h2 id="0x06-分享文件"><a href="#0x06-分享文件" class="headerlink" title="0x06 分享文件"></a>0x06 分享文件</h2><ol>
<li>直接输出 cmd + e</li>
<li>调用 Compressor 制定更多的输出规则</li>
</ol>
<h3 id="分享技巧"><a href="#分享技巧" class="headerlink" title="分享技巧"></a>分享技巧</h3><ol>
<li>素材很重要 – 『保留 Library』</li>
<li>作品已定型 – 『输出模板文件』</li>
<li>Compressor – 输出多格式的文件</li>
</ol>
<h2 id="0x07-其他"><a href="#0x07-其他" class="headerlink" title="0x07 其他"></a>0x07 其他</h2><h3 id="7-1-插入的四种方式"><a href="#7-1-插入的四种方式" class="headerlink" title="7.1 插入的四种方式"></a>7.1 插入的四种方式</h3><ol>
<li>连接：放置在磁力线上方，磁力线上方可以使用 N 进行片段之间的吸附</li>
<li>插入</li>
<li>追加</li>
<li>覆盖</li>
</ol>
<p>当 range 选中在主故事线选中时间范围内的话，可以插入某个时间段的视频</p>
<h3 id="7-2-提升格调"><a href="#7-2-提升格调" class="headerlink" title="7.2 提升格调"></a>7.2 提升格调</h3><p>提升格调的两种方法：</p>
<ol>
<li>镜头感</li>
<li>电影感</li>
</ol>
<h2 id="0xEE-参考"><a href="#0xEE-参考" class="headerlink" title="0xEE 参考"></a>0xEE 参考</h2><hr>
<p>ChangeLog:</p>
<ul>
<li><strong>2018-11-25</strong> 初始化本文</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://twocucao.xyz/2018/09/17/ThinkingInProgrammingLanguage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Micheal Gardner">
      <meta itemprop="description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MG的编程小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/17/ThinkingInProgrammingLanguage/" class="post-title-link" itemprop="url">Thinking In Programming Language</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-17 10:42:25" itemprop="dateCreated datePublished" datetime="2018-09-17T10:42:25+08:00">2018-09-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-13 10:22:52" itemprop="dateModified" datetime="2018-11-13T10:22:52+08:00">2018-11-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E6%80%9D%E7%B4%A2/" itemprop="url" rel="index"><span itemprop="name">编程思索</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>笔者对于涉猎的语言都是草草了解，深入不敢谈。能用罢了。</p>
<p>即便是用过几种语言，得出的经验依然是片面的。</p>
<p>很多人得出一些结论，往往是样本就一个。比如说一个只用过 PHP 的人叫嚣 PHP 是最好的语言。</p>
<p>所以，我得出的结论，不过是一家之言罢了。</p>
<p>本文文章就是总结一下，我使用的一些语言的经验，我整理出一个大致的框架，方便我以后切换到其他编程语言可以更顺滑一些。</p>
<h2 id="0x01-语言胡论"><a href="#0x01-语言胡论" class="headerlink" title="0x01 语言胡论"></a>0x01 语言胡论</h2><p>在我看来，一个人说他会且只精通一门编程语言是很让我不能理解的事情，在我看来，什么编程语言框架上手两三天就能去写，但是这严格意义上应该叫做能用，和精通相差甚远。那是不是说写的时间长的人经验就老道了呢？也不见得。下棋下了一辈子是烂棋篓子的人比比皆是。</p>
<p>那我认为什么样子的人才是懂写代码的人。</p>
<pre><code>拥有良好的组织代码的能力的人。</code></pre>
<p>恩，组织代码的能力，一个文件排布混乱的人，不太可能写出整齐严谨的代码，当然，人也可能是复杂的，比如，这个人写的代码挺好，但是生活住处一团糟。</p>
<p>当然这是题外话了，依个人经验而言，学习任何一个复杂的系统，也需要像组织一个东西一样，系统性的学习。</p>
<p>系统化的东西往往像《如何阅读一本书》里面描述一本书的复杂架构那样。</p>
<pre><code>没有一种物质或产品是绝对简单的。所有的东西都是复杂的组合体。当你看一个整体组成复杂的东西的时候，如果只看它如何呈现一体的面貌，那是还没有掌握精髓，你还必须要明白它怎样呈现多个的面貌，但不是各自为政、互不相干的多个面貌，而是互相融合成有机体的多个面貌。如果组成的各个部分没有有机的关联，仅仅是一个集合体罢了。

这就像是一堆砖头跟一栋又砖头建造起来的房子是有区别的。而单一的房子与建造的房子也不相同。一本书就像是一栋单一的房子。一栋大厦，拥有许多房间，每层楼都有房间，有不同的尺寸和形状，不同的外观，不同的用途，这些房间是独立的，分离的，每个房间都有自己的架构和装潢设计，但却不是完全独立与分离的，这些房间使用普通门 / 拱门 / 走廊 / 楼梯串联起来的，即建筑师错位的动线架构，因为这些架构师彼此联结的，因此每一个部分在整体的使用功能上要贡献出自己的力量。否则这栋房子便是不适合居住的。</code></pre>
<h3 id="独一无二"><a href="#独一无二" class="headerlink" title="独一无二"></a>独一无二</h3><p>有的人认为所有的编程语言都是一样的。</p>
<p>依我看，所有的编程语言都是有特点的，也是有优缺点的。</p>
<p>举一个我朋友的爱说的很粗俗的例子：</p>
<pre><code>虽然说关了灯全都一个样，但是每一个女孩子都有是独一无二的存在。</code></pre>
<p>编程语言也是一样。</p>
<ul>
<li>有的偏向于运行效率，有的偏向于开发效率。</li>
<li>有的据说是让人编程时候感到快乐 (ruby)，有的说你生命苦短，为什么不用 Python。</li>
<li>有的偏向于 Web 开发 (PHP)，有的偏向于并发操作</li>
<li>有的是 Windows 上面自动化的小白工具 (Autohotkey)</li>
<li>有的是据说是一次编译，到处运行 (Java)</li>
<li>有的是亲妈平台万金油 (C#), 当然，最近也在亲妈的带领下往其他方向前进了。</li>
</ul>
<p>编程语言往往是上面这些因素的取舍。</p>
<ul>
<li>你要运行效率，往往开发效率就会打折。</li>
<li>你要开发效率，往往就需要堆更多的机器来提升性能。</li>
<li>你要充分利用某个平台，往往就没有极高兼容性。</li>
<li>你要编程语言帮你处理掉不需要考虑的问题，有的程序员就站出来了，你是不相信我控制<br>  内存的能力么？</li>
</ul>
<p>有的语言生态好，比如 对于我定位于全栈工程师（其实是全干工程师）的程序员来说：</p>
<p>  文能写虫爬数据<br>  武能后端写网站<br>  进能数据搞 AI<br>  退能机器跑运维</p>
<p>十八般武艺武艺样样稀疏的 API 搬运工，那，那就 Python 好了。你还要啥自行车？</p>
<h2 id="0x02-语言的工具链"><a href="#0x02-语言的工具链" class="headerlink" title="0x02 语言的工具链"></a>0x02 语言的工具链</h2><p>工欲善其事必先利其器</p>
<h3 id="编辑器-amp-amp-IDE"><a href="#编辑器-amp-amp-IDE" class="headerlink" title="编辑器 &amp;&amp; IDE"></a>编辑器 &amp;&amp; IDE</h3><p>大学里有个老师喜欢用 Notepad 手撸 Pascal 代码，然后拖到 IDE 里面运行。</p>
<p>集成开发环境 (IDE) = 编辑器 + 编译器 + 构建系统 + 调试 + 其他编辑提升（补全，重构，格式化）</p>
<p>到底是 IDE 好，还是 Editor 好。其实你看到这里就差不多明白了。一般情况下，选择<br>JetBrain 的 IDE 总是没问题的。</p>
<p>那么什么情况下，会选择编辑器呢？</p>
<p>多个</p>
<p>对于，这个经典的问题，可以这么回答：抓到好猫的猫，你管他是黑猫还是白猫。</p>
<p>那么，这个问题就变成了另一个问题。编辑器或者 IDE 可以满足我当前的开发工作流么？</p>
<h3 id="Workflow"><a href="#Workflow" class="headerlink" title="Workflow"></a>Workflow</h3><p>那么，我们从编辑器 + 集成环境</p>
<ul>
<li>Mac Homebrew</li>
<li>开发环境里面的 shell</li>
<li>cmake</li>
</ul>
<h2 id="0x03-语言的学习资源"><a href="#0x03-语言的学习资源" class="headerlink" title="0x03 语言的学习资源"></a>0x03 语言的学习资源</h2><p>官网的文档是最应该反复查看的东西，这是我现在依然喜欢强调的。</p>
<p>而官网的文档也分为四种</p>
<ul>
<li>一种是 tutorial      – 用于<strong>上手</strong>对应的软件 / 编程语言</li>
<li>一种是 guide         – 用于** Topic Reading **</li>
<li>一种是 api document  – 用于<strong>查看细节</strong></li>
<li>一种是 RTFSC ( Read The Fucking Source Code ) 阅读源码</li>
</ul>
<blockquote>
<p>注：把 StackOverFlow 中某个标签的 Most Votes 的答案，是除了大略看看 tutorial 之外的另一种快速熟悉入门时候的痛点的手段。</p>
</blockquote>
<p>当然，其实代码写的足够好的话本身就是一种注释。</p>
<h3 id="社区"><a href="#社区" class="headerlink" title="社区"></a>社区</h3><p>社区一般情况下都会有的，但有几个网站特别值得提出来</p>
<ul>
<li>官网上一般都会放一些比较出色的社区</li>
<li>Github</li>
<li>reddit</li>
<li>某个技术对应的 Weekly 订阅</li>
</ul>
<h3 id="书籍"><a href="#书籍" class="headerlink" title="书籍"></a>书籍</h3><p>特别值得一提的是有一个持续不断阅读到有趣的文章的方法：</p>
<ol>
<li>Google 出对应的 书 / Weekly 周报 / 博客，比如 Python Weekly 然后订阅</li>
<li>接着不断的查看列入优质文章的作者的文章，Github 地址啦，他关注的 Repo 啦等等等等。</li>
<li>然后去阅读他的代码 / 博客。</li>
</ol>
<h2 id="0x04-基础概念"><a href="#0x04-基础概念" class="headerlink" title="0x04 基础概念"></a>0x04 基础概念</h2><blockquote>
<p> 程序 = 算法 + 数据结构</p>
</blockquote>
<p>这句话当然是不全面的，这句话经典就经典在高度概括了程序中算法和数据结构的重要性，但并不影响这句话在计算机世界里面的地位。</p>
<p>依我看来，对我的启发是：</p>
<blockquote>
<p>我会把 API 的调用和数据结构以及算法想清楚，然后才动手把代码分解成伪代码。最后写成代码。</p>
</blockquote>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>按照复杂性可划分为：</p>
<ul>
<li>简单类型</li>
<li>复杂类型</li>
</ul>
<p>按照复杂性可划分为：</p>
<ul>
<li>基本类型</li>
<li>引用类型</li>
</ul>
<p>按照数据结构可划分为：</p>
<ul>
<li>集合结构 : 串</li>
<li>线性结构 : 线性表 （单链表，静态链表，循环链表，双向链表，<strong>栈，队列</strong>)</li>
<li>树形结构 : 树（二叉树，B+ 树，红黑树）</li>
<li>图形结构 : 图</li>
</ul>
<p>对于一些基本的数据类型，操作为 加减乘除取余数位运算等等</p>
<p>对于复杂的一些数据类型，则需要对数据结构多一些了解。</p>
<p>比如，对队列而言，增删改查在算法复杂度上意味着什么？对机器的性能会不会有很多影响呢？<br>比如，对 hash 而言，增删改查在算法复杂度上意味着什么？对机器的性能会不会有很多影响呢？<br>比如，对字典而言，增删改查在算法复杂度上意味着什么？对机器的性能会不会有很多影响呢？<br>比如，对字符串而言，增删改查在算法复杂度上意味着什么？对机器的性能会不会有很多影响呢？</p>
<p>那字符串来说，Java 推荐使用 StringBuilder 来合并多个字符串，Python 推荐 join 多个字符串等等。</p>
<h3 id="语句"><a href="#语句" class="headerlink" title="语句"></a>语句</h3><ul>
<li><p>声明语句</p>
</li>
<li><p>赋值语句</p>
</li>
<li><p>条件语句</p>
<ol>
<li>判断的时候不确定操作符优先级的时候，加括号</li>
<li>尽量显式判断，不要用隐式判断。</li>
</ol>
</li>
<li><p>循环语句</p>
<ol>
<li>Break 和 Continue</li>
</ol>
</li>
</ul>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ol>
<li>传值还是传引用</li>
<li>参数</li>
</ol>
<p>函数或者叫做方法，叫法不同。</p>
<p>函数，我有个很私人的称呼，称它为最小操作模块。</p>
<p>实际上，在编程的过程中，程序员用面向对象的思想进行编码的人可能真的不是很多。把一段长程序按照自己的需求进行切分成若干个函数的倒是比比皆是。</p>
<p>不过按照什么样子的标准来切分一段程序为多个函数，仁者见仁智者见智。</p>
<p>这里面需要注意的事情是：</p>
<ul>
<li><ol>
<li>注意传值（基本类型）和传引用（引用类型）</li>
</ol>
</li>
<li><ol start="2">
<li>函数重载</li>
</ol>
</li>
</ul>
<p>对于不同的编程语言，传值（基本类型）和传引用（引用类型）基本上达成了共识。<br>但在实现函数重载的时候则是有所不同，</p>
<p>比如，Java 里面选择了多写几个函数，Python 则没有这个机制，不过，通过默认参数却可以曲线救国，实现这个机制。</p>
<p>递归<br>函数式编程<br>高阶函数 mapreduce/ filter / sorted / 返回函数 / 匿名函数 / 装饰器 / 偏函数</p>
<h4 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span>():</span></span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span></span><br><span class="line">        a = <span class="number">2</span></span><br><span class="line">    print(a)</span><br><span class="line"></span><br><span class="line">outer()</span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span>():</span></span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span></span><br><span class="line">        a = <span class="number">2</span></span><br><span class="line">    print(a)</span><br><span class="line">    inner()</span><br><span class="line">    print(a)</span><br><span class="line"></span><br><span class="line">outer()</span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span>():</span></span><br><span class="line">    a = [<span class="number">1</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span></span><br><span class="line">        a.append(<span class="number">2</span>)</span><br><span class="line">    print(a)</span><br><span class="line">    inner()</span><br><span class="line">    print(a)</span><br><span class="line"></span><br><span class="line">outer()</span><br><span class="line"><span class="comment"># [1]</span></span><br><span class="line"><span class="comment"># [1, 2]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> outer = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> inner = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        a = <span class="number">2</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">    inner();</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;</span><br><span class="line">outer()</span><br><span class="line"># 1</span><br><span class="line"># 2</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> outer = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> inner = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="number">2</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">    inner();</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;</span><br><span class="line">outer()</span><br><span class="line"># 1</span><br><span class="line"># 1</span><br></pre></td></tr></table></figure>

<h4 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h4><ul>
<li>map</li>
<li>reduce</li>
<li>filter</li>
</ul>
<h4 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h4><h2 id="0x05-中级概念"><a href="#0x05-中级概念" class="headerlink" title="0x05 中级概念"></a>0x05 中级概念</h2><h3 id="类和对象"><a href="#类和对象" class="headerlink" title="类和对象"></a>类和对象</h3><p>面向对象有三大概念：</p>
<ul>
<li>封装</li>
<li>继承</li>
<li>多态</li>
</ul>
<h3 id="模块与包"><a href="#模块与包" class="headerlink" title="模块与包"></a>模块与包</h3><p>模块，这个概念，可大可小，大的时候，把一个程序说成是模块，小的时候，可以把一个文件，甚至你说这一个函数是一个模块，也行。</p>
<p>这里的模块指的是一个包下的函数。</p>
<h3 id="错误-调试测试"><a href="#错误-调试测试" class="headerlink" title="错误 / 调试测试"></a>错误 / 调试测试</h3><p>异常处理实际上可以考验一个程序员编写代码的健壮性。</p>
<p>事实上来说，代码写的健壮是一个程序员必备的素养。但其实在开发过程中，出于对项目进行赶工上线，需要对程序的健壮性做出一定的取舍。并且，在编写客户端，服务端，网页前端的时候基本上都会遇到这个问题。什么时候选择健壮的程序，什么时候选择是还可以的程序。需要自己的经验。</p>
<h3 id="IO-编程"><a href="#IO-编程" class="headerlink" title="IO 编程"></a>IO 编程</h3><h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><h2 id="0x06-高级概念"><a href="#0x06-高级概念" class="headerlink" title="0x06 高级概念"></a>0x06 高级概念</h2><h3 id="元编程"><a href="#元编程" class="headerlink" title="元编程"></a>元编程</h3><h3 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h3><p>Spawn - 产卵，为什么叫做产卵呢，因为生出大量的 child process<br>Spawn = fork + exec</p>
<h3 id="并发-并行"><a href="#并发-并行" class="headerlink" title="并发 / 并行"></a>并发 / 并行</h3><h4 id="并行架构"><a href="#并行架构" class="headerlink" title="并行架构"></a>并行架构</h4><p>并行并不完全等同与多核并行</p>
<ol>
<li>bit-level 并行 : 即 8bit 与 32bit 的区别</li>
<li>instrction-level 并行：CPU 的并行度：流水线，乱序执行，猜测执行</li>
<li>data-level 并行：比如 GPU 在调整图像亮度的时候。</li>
<li>task-level 并行：即多处理器，按照内存模型氛围共享内存模型与分布式内存模型</li>
</ol>
<h4 id="七个并发-并行模型"><a href="#七个并发-并行模型" class="headerlink" title="七个并发 / 并行模型"></a>七个并发 / 并行模型</h4><ol>
<li>线程与锁</li>
<li>函数式编程</li>
<li>分离标志与状态</li>
<li>Actor</li>
<li>通信顺序进程 (CSP)</li>
<li>数据级并行</li>
<li>Lambda 架构</li>
</ol>
<h4 id="模型-1-线程与锁"><a href="#模型-1-线程与锁" class="headerlink" title="模型 1. 线程与锁"></a>模型 1. 线程与锁</h4><p>互斥<br>竞态条件<br>死锁</p>
<h5 id="内置锁"><a href="#内置锁" class="headerlink" title="内置锁"></a>内置锁</h5><p>当若干个线程进行对某个变量进行一个非原子性的操作的时候，比如<br>(read-modify-write), 就吹出现竞态条件。解决方式就是进行对某个变量使用同步访问 (java 中的 synchronized)。</p>
<p>内存可见性</p>
<p>当一个线程使用了多把锁的时候，就可能出现死锁。简单避开死锁的方式就是总是按照一个<br>全局的固定思路获取多把锁</p>
<p>哲学家进餐：五个哲学家围绕着桌子，两边五双筷子，如果饿了，就拿起两边的筷子吃饭。则迟早会出现一个情<br>况，所有的哲学家在同一时刻决定吃饭。于是两边都拿不到筷子。</p>
<p>最终的解决方案就是按照全局的顺序来获取多把锁。</p>
<h5 id="可重入锁-Reentrant-Lock"><a href="#可重入锁-Reentrant-Lock" class="headerlink" title="可重入锁 Reentrant Lock"></a>可重入锁 Reentrant Lock</h5><p>可以用 try lock 来和超时时间来避免无尽死锁。</p>
<p>交替锁，避免锁整个链表，而是锁上下结点。</p>
<h4 id="模型-2-函数式编程"><a href="#模型-2-函数式编程" class="headerlink" title="模型 2. 函数式编程"></a>模型 2. 函数式编程</h4><h4 id="模型-3-分离标志与状态"><a href="#模型-3-分离标志与状态" class="headerlink" title="模型 3. 分离标志与状态"></a>模型 3. 分离标志与状态</h4><h4 id="模型-4-Actor"><a href="#模型-4-Actor" class="headerlink" title="模型 4. Actor"></a>模型 4. Actor</h4><h4 id="模型-5-通信顺序进程-CSP"><a href="#模型-5-通信顺序进程-CSP" class="headerlink" title="模型 5. 通信顺序进程 (CSP)"></a>模型 5. 通信顺序进程 (CSP)</h4><h4 id="模型-6-数据级并行"><a href="#模型-6-数据级并行" class="headerlink" title="模型 6. 数据级并行"></a>模型 6. 数据级并行</h4><h4 id="模型-7-Lambda-架构"><a href="#模型-7-Lambda-架构" class="headerlink" title="模型 7. Lambda 架构"></a>模型 7. Lambda 架构</h4><h2 id="0x05-标准库"><a href="#0x05-标准库" class="headerlink" title="0x05 标准库"></a>0x05 标准库</h2><h3 id="数据结构与算法"><a href="#数据结构与算法" class="headerlink" title="数据结构与算法"></a>数据结构与算法</h3><h3 id="字符串与文本"><a href="#字符串与文本" class="headerlink" title="字符串与文本"></a>字符串与文本</h3><h3 id="数字日期与时间"><a href="#数字日期与时间" class="headerlink" title="数字日期与时间"></a>数字日期与时间</h3><h3 id="迭代器与生成器"><a href="#迭代器与生成器" class="headerlink" title="迭代器与生成器"></a>迭代器与生成器</h3><h3 id="文本处理"><a href="#文本处理" class="headerlink" title="文本处理"></a>文本处理</h3><h2 id="0x07-番外篇"><a href="#0x07-番外篇" class="headerlink" title="0x07 番外篇"></a>0x07 番外篇</h2><h2 id="0x08-调试和-Profile"><a href="#0x08-调试和-Profile" class="headerlink" title="0x08 调试和 Profile"></a>0x08 调试和 Profile</h2><h3 id="8-1-测试"><a href="#8-1-测试" class="headerlink" title="8.1 测试"></a>8.1 测试</h3><p>hash 算法</p>
<p>rehash | redis 渐进式 rehash</p>
<h2 id="0xEE-参考"><a href="#0xEE-参考" class="headerlink" title="0xEE 参考"></a>0xEE 参考</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.yinwang.org/blog-cn/2017/07/06/master-pl">http://www.yinwang.org/blog-cn/2017/07/06/master-pl</a></li>
</ul>
<hr>
<p>ChangeLog:</p>
<ul>
<li><strong>2017-03-21</strong> 初始化本文</li>
<li><strong>2017-05-11</strong> 增加代码质量模块</li>
<li><strong>2018-08-29</strong> 重修文字</li>
<li><strong>2018-09-08</strong> 阅读七周七并发之后，针对并发章节做了补充</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://twocucao.xyz/2018/09/04/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Micheal Gardner">
      <meta itemprop="description" content="Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MG的编程小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/04/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">Thinking In Web Developing</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-04 10:39:45" itemprop="dateCreated datePublished" datetime="2018-09-04T10:39:45+08:00">2018-09-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-09-17 19:15:53" itemprop="dateModified" datetime="2018-09-17T19:15:53+08:00">2018-09-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E6%80%9D%E7%B4%A2/" itemprop="url" rel="index"><span itemprop="name">编程思索</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><h2 id="0x02-前端"><a href="#0x02-前端" class="headerlink" title="0x02 前端"></a>0x02 前端</h2><h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><p>代理服务器分布式网络，它从靠近用户的位置提供内容</p>
<h4 id="更新方式"><a href="#更新方式" class="headerlink" title="更新方式"></a>更新方式</h4><p>推送 PUSH</p>
<p>当服务器内容发生变动，推送 CDN 接受新的内容。</p>
<ul>
<li>更新最快</li>
<li>流量最小化</li>
<li>存储最大化</li>
</ul>
<p>拉取 PULL</p>
<p>当用户请求该资源的时候，从服务器拉取资源。</p>
<ul>
<li>更新有延迟</li>
<li>存储最小化</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ol>
<li>CDN 成本可能会很高</li>
<li>TTL 过期之前更新内容，CDN 缓存内容可能会过时</li>
</ol>
<h2 id="0x02-后端组件"><a href="#0x02-后端组件" class="headerlink" title="0x02 后端组件"></a>0x02 后端组件</h2><h3 id="负载均衡器"><a href="#负载均衡器" class="headerlink" title="负载均衡器"></a>负载均衡器</h3><p>负载均衡起到了一个均衡负载的作用</p>
<ol>
<li>防止请求进入运行情况糟糕的服务器。</li>
<li>防止资源过载。</li>
<li>帮助消除单一故障点。</li>
</ol>
<p>额外的功能：</p>
<ol>
<li>SSL 终结：解密传入的请求，并加密服务器响应。</li>
</ol>
<p>工作-备用 / 双工作</p>
<h4 id="选-Worker"><a href="#选-Worker" class="headerlink" title="选 Worker"></a>选 Worker</h4><ul>
<li>Random</li>
<li>Round Robin</li>
<li>Least Busy</li>
<li>Sticky session / Cookie</li>
<li>By request paramters</li>
</ul>
<h4 id="路由流量"><a href="#路由流量" class="headerlink" title="路由流量"></a>路由流量</h4><ul>
<li>随机</li>
<li>最少负载</li>
<li>Session/Cookie</li>
<li>轮询调度或加权轮询调度</li>
<li>四层负载均衡</li>
<li>七层负载均衡</li>
</ul>
<h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><ul>
<li>安全性：隐藏后端服务器信息</li>
<li>可扩展性和灵活性：客户端只能看到服务器，服务端</li>
<li>本地终结 SSL 会话：</li>
<li>压缩：</li>
<li>缓存：</li>
<li>静态内容：</li>
</ul>
<h2 id="0x08-Http-Server-Model"><a href="#0x08-Http-Server-Model" class="headerlink" title="0x08 Http Server Model"></a>0x08 Http Server Model</h2><h3 id="Master"><a href="#Master" class="headerlink" title="Master"></a>Master</h3><p>主进程监听不同的进程信号，并且作出反馈。</p>
<ul>
<li>TTIN TTOU 告诉 master 升高或者降低运行的 worker</li>
<li>CHLD 子进程已结束</li>
</ul>
<h3 id="四种-Worker"><a href="#四种-Worker" class="headerlink" title="四种 Worker"></a>四种 Worker</h3><h4 id="同步-Workers"><a href="#同步-Workers" class="headerlink" title="同步 Workers"></a>同步 Workers</h4><p>单请求单 worker, 并且不支持 persistent connections</p>
<p>在 CPU 和网络贷款上资源有限。（啥意思，,,,)</p>
<p>即请求时间不定的情况应该是要避免的。</p>
<h4 id="异步-Workers"><a href="#异步-Workers" class="headerlink" title="异步 Workers"></a>异步 Workers</h4><p>异步场景</p>
<ul>
<li>Applications making long blocking calls (Ie, external web services)</li>
<li>Serving requests directly to the internet</li>
<li>Streaming requests and responses</li>
<li>Long polling</li>
<li>Web sockets</li>
<li>Comet （其实就是推送）</li>
</ul>
<p>通过 eventlet / gevent 使用 Greenlets</p>
<h4 id="Tornado-Workers"><a href="#Tornado-Workers" class="headerlink" title="Tornado Workers"></a>Tornado Workers</h4><p>tornado</p>
<h4 id="AsyncIO-Workers"><a href="#AsyncIO-Workers" class="headerlink" title="AsyncIO Workers"></a>AsyncIO Workers</h4><ul>
<li>gthread</li>
<li>gaiohttp</li>
</ul>
<h3 id="Pre-fork-Web-Server"><a href="#Pre-fork-Web-Server" class="headerlink" title="Pre-fork Web Server"></a>Pre-fork Web Server</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/25834333/what-exactly-is-a-pre-fork-web-server-model">https://stackoverflow.com/questions/25834333/what-exactly-is-a-pre-fork-web-server-model</a></p>
<p>pre-forking 意味着 一个 master 创建了多个 fork 来处理请求。每一个分叉意味着一个独立的 *nix 进程（不一定吧，异步 worker 怎么算？)。</p>
<p>The pre in pre-fork means that these processes are forked before a request comes in. They can however usually be increased or decreased as the load goes up and down.</p>
<p>libev / libuv</p>
<p>epoll or kqueue, it is always indispensable to the asynchronous topic.</p>
<p>asyncio</p>
<p>sanic<br>libuv<br>uvloop</p>
<h2 id="0xEE-结论"><a href="#0xEE-结论" class="headerlink" title="0xEE 结论"></a>0xEE 结论</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Micheal Gardner</p>
  <div class="site-description" itemprop="description">Two roads diverged in a wood, and I took the one less traveled by, And that has made all the difference.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">93</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">96</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Micheal Gardner</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




  















  

  

</body>
</html>
