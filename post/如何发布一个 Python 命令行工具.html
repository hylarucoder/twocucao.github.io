<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>如何发布一个 Python 命令行工具 | 海拉鲁编程客</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/49455a07b6dd33600cdf.css" as="style"/><link rel="stylesheet" href="/_next/static/css/49455a07b6dd33600cdf.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-20d43e08bea62467b090.js" defer=""></script><script src="/_next/static/chunks/framework-0441fae7fd130f37dee1.js" defer=""></script><script src="/_next/static/chunks/main-4777350f2a9ff73ea2b0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-3050679c6e5142ffcaf5.js" defer=""></script><script src="/_next/static/chunks/ea88be26-9bcf6ead520f4ac26973.js" defer=""></script><script src="/_next/static/chunks/421-f2f33a86b546237f0325.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-173fe2de48c90365db9d.js" defer=""></script><script src="/_next/static/uCwe9m-iio9bnoWMgWDqE/_buildManifest.js" defer=""></script><script src="/_next/static/uCwe9m-iio9bnoWMgWDqE/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="v-page"><nav class="shadow"><div class="flex flex-col container mx-auto h-12 px-40 md:flex-row md:items-center md:justify-between"><div class="flex justify-between items-center"><div><a class="text-gray-800 text-xl md:text-xl leading-5" href="/">海拉鲁编程客</a></div><div><button type="button" class="block text-gray-800 hover:text-gray-600 focus:text-gray-600 focus:outline-none md:hidden"><svg viewBox="0 0 24 24" class="h-6 w-6 fill-current"><path d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z"></path></svg></button></div></div><div class="md:flex flex-col md:flex-row md:-mx-4 hidden"><a class="my-1 text-gray-800 hover:text-blue-500 md:mx-4 md:my-0" href="/">首页</a><a class="my-1 text-gray-800 hover:text-blue-500 md:mx-4 md:my-0" href="/archive">归档</a><a class="my-1 text-gray-800 hover:text-blue-500 md:mx-4 md:my-0" href="/about">关于我</a><button style="cursor:pointer;overflow:hidden;width:50px;height:23.5px;appearance:none;-moz-appearance:none;-webkit-appearance:none;border:none;background-color:transparent;padding:0" aria-hidden="true"><div style="display:flex;align-items:center;justify-content:center;margin-top:-28.749999999999996px;margin-left:-16px;width:82.5px;height:82.5px"><div></div></div></button></div></div></nav><div class="v-article"><div class="v-article-main" style="margin:auto;width:786px"><div><h1 id="如何发布一个-python-命令行工具"><a class="v-toc-item" href="#如何发布一个-python-命令行工具">#</a> 如何发布一个 Python 命令行工具</h1>
<h2 id="0x01-本文简介"><a class="v-toc-item" href="#0x01-本文简介">#</a> 0x01 本文简介</h2>
<p>上次写的一个终端里面斗鱼 TV 弹幕 Python 版本和 Ruby 版本，并且发布到 PIP 和 RubyGems 上面。在发布 PIP 包的时候，居然 Google 不到一篇可以非常好的讲解这个流程的文章。于是整理这篇文章，并且方便后来自己检索，并且方便他人找资料。</p>
<p>自推荐下依照本文定制的命令行工具 <a href="http://danmu.fm">danmu.fm</a> 的 github 地址：</p>
<p><a href="https://github.com/twocucao/danmu.fm">https://github.com/twocucao/danmu.fm</a></p>
<p>本文的目的也是非常简单：</p>
<blockquote>
<p>**写一个 Python 命令行工具，并且发布到 PIP 上面.**并且在这个过程中给出我自己的一些思考。</p>
</blockquote>
<!-- more -->
<h2 id="0x02-如何分解这个发布任务"><a class="v-toc-item" href="#0x02-如何分解这个发布任务">#</a> 0x02 如何分解这个发布任务？</h2>
<p>只需要进行如下的两个步骤便可以：</p>
<ul>
<li>
<ol>
<li>写好一个 Python 命令行工具。</li>
</ol>
</li>
<li>
<ol start="2">
<li>发布它。</li>
</ol>
</li>
</ul>
<p>当然，这样不够细致。再细分一下。</p>
<ul>
<li>
<ol>
<li>写好一个 Python 命令行工具</li>
</ol>
<ul>
<li>1.1. 命令行的特点，以及 Python 的如何编写命令行</li>
<li>1.2. 如何组织代码结构。</li>
</ul>
</li>
<li>
<ol start="2">
<li>发布</li>
</ol>
</li>
<li>2.1. 注册 pypi 账户
<ul>
<li>2.2. 注册在账户下面注册 Python 包</li>
<li>2.3. 上传<strong>打包</strong>好的 Python 命令行工具。</li>
</ul>
</li>
<li>
<ol start="3">
<li>完善代码</li>
</ol>
</li>
</ul>
<h2 id="0x03-写好一个-python-命令行工具"><a class="v-toc-item" href="#0x03-写好一个-python-命令行工具">#</a> 0x03 写好一个 Python 命令行工具</h2>
<p>写好一个命令行工具首先要知道命令行工具是什么？</p>
<blockquote>
<p>在我看来，命令行工具就是一种完成某种类型的任务的终端程序。</p>
</blockquote>
<p>也就是基本上没有什么用户界面的程序。</p>
<p>由于基本上没有什么用户界面，所以导致单个命令行的交互能力及其低下。但这种低下的交互性对于一些固定工作而言，简直就是最灵活的工具。只需要输入一些命令便可以完成某种类型的工作。实在是方便的很。</p>
<p>所以，某种程度上，终端程序低交互的缺点反而成了优点。</p>
<h3 id="11python-的如何编写一个简单的命令行"><a class="v-toc-item" href="#11python-的如何编写一个简单的命令行">#</a> 1.1.Python 的如何编写一个简单的命令行</h3>
<p>对于 Python 和命令行交互，我们很容易想出一个比较方便的方案。</p>
<p>sys.argv 就是这样的嘛！</p>
<p>我们很容易这样写代码。</p>
<pre><code class="language-bash"> python testargv<span class="token punctuation">.</span>py thisisaargv1
</code></pre>
<p>甚至我们也可以这样写命令行，</p>
<pre><code class="language-bash"> python testargv<span class="token punctuation">.</span>py thisisaargv1 <span class="token operator">-</span>d <span class="token operator">-</span>f <span class="token number">0</span>
</code></pre>
<p>那么，这样写的后果就是，不方便解析出（不是不能，是不方便） -d -f 0 以及 thisisaargv1.</p>
<p>不信的话，你解析一个下面场景的命令行试试，</p>
<pre><code class="language-bash"># 用户可能这样输入
danmu<span class="token punctuation">.</span>fm http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>douyutv<span class="token punctuation">.</span>com<span class="token operator">/</span>xiaocang <span class="token operator">-</span>q <span class="token number">1</span> <span class="token operator">-</span>v <span class="token number">2</span>
danmu<span class="token punctuation">.</span>fm <span class="token operator">-</span>q <span class="token number">1</span> <span class="token operator">-</span>v <span class="token number">2</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>douyutv<span class="token punctuation">.</span>com<span class="token operator">/</span>xiaocang
# 当然，肯定还有漏写啦，等等，你得需要转类型，增加各种 blablabla 的描述吧，添加默认的参数值吧。
</code></pre>
<p>于是 Python 就提供了一个非常好用的模块可以使用。叫做 argparse.</p>
<p>上面的描述就变成了这个样子</p>
<pre><code class="language-python"><span class="token keyword">import</span> argparse

<span class="token constant">APP_DESC</span><span class="token operator">=</span><span class="token string">""</span>"
这就是描述
<span class="token string">""</span>"
<span class="token function">print</span><span class="token punctuation">(</span><span class="token constant">APP_DESC</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token operator">:</span>
    sys<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'--help'</span><span class="token punctuation">)</span>
parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span><span class="token function">ArgumentParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token string">'-q'</span><span class="token punctuation">,</span><span class="token string">'--quality'</span><span class="token punctuation">,</span>type<span class="token operator">=</span>int<span class="token punctuation">,</span><span class="token keyword">default</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>help<span class="token operator">=</span><span class="token string">"download video quality : 1 for the standard-definition; 3 for the super-definition"</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token string">'-v'</span><span class="token punctuation">,</span><span class="token string">'--verbose'</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>help<span class="token operator">=</span><span class="token string">"print more debuging information"</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token string">'-s'</span><span class="token punctuation">,</span><span class="token string">'--store'</span><span class="token punctuation">,</span>help<span class="token operator">=</span><span class="token string">"保存流媒体文件到指定位置"</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token string">'-c'</span><span class="token punctuation">,</span><span class="token string">'--config'</span><span class="token punctuation">,</span><span class="token keyword">default</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>help<span class="token operator">=</span><span class="token string">"读取~/.danmu.fm 配置，请~/.danmu.fm 指定数据库"</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">,</span>metavar<span class="token operator">=</span><span class="token string">'URL'</span><span class="token punctuation">,</span>nargs<span class="token operator">=</span><span class="token string">'+'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">"zhubo page URL (http://www.douyutv.com/*/)"</span><span class="token punctuation">)</span>
args <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse_args</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
# 获取对应参数只需要 args<span class="token punctuation">.</span>quality<span class="token punctuation">,</span>args<span class="token punctuation">.</span>url 之类。
url <span class="token operator">=</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token function">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
#其他执行逻辑
</code></pre>
<p>保存为 <a href="http://danmu.py">danmu.py</a></p>
<p>这样就可以执行命令</p>
<pre><code class="language-bash">python danmu<span class="token punctuation">.</span>py http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>douyutv<span class="token punctuation">.</span>com<span class="token operator">/</span>xiaocang <span class="token operator">-</span>q <span class="token number">1</span> <span class="token operator">-</span>v <span class="token number">2</span>
</code></pre>
<p>通过 args 就可以获取参数，然后进行终端程序的参数初始化。</p>
<p>可是这和我们的要求还是不同嘛，我们不想多写 Python XXX, 我们想直接 XXX. 就像这样。</p>
<pre><code class="language-bash">danmu<span class="token punctuation">.</span>fm <span class="token operator">-</span>q <span class="token number">1</span> <span class="token operator">-</span>v <span class="token number">2</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>douyutv<span class="token punctuation">.</span>com<span class="token operator">/</span>xiaocang
</code></pre>
<p>不急，下面就是了。</p>
<h3 id="12-如何组织代码结构"><a class="v-toc-item" href="#12-如何组织代码结构">#</a> 1.2. 如何组织代码结构。</h3>
<p>于是，现在就要开始组织代码结构了。</p>
<p>我们在最终的代码目录大概是这样的。</p>
<pre><code class="language-bash">danmu<span class="token punctuation">.</span>fm
├── <span class="token constant">README</span><span class="token punctuation">.</span>md
├── danmufm
│   ├── __init__<span class="token punctuation">.</span>py
│   ├── client
│   │   ├── __init__<span class="token punctuation">.</span>py
│   │   ├── __init__<span class="token punctuation">.</span>pyc
│   │   ├── douyu_client<span class="token punctuation">.</span>py
│   │   └── douyu_danmu_client<span class="token punctuation">.</span>py
│   ├── danmu<span class="token punctuation">.</span>py
│   ├── misc
│   │   ├── __init__<span class="token punctuation">.</span>py
│   │   ├── color_printer<span class="token punctuation">.</span>py
│   │   ├── downloaders<span class="token punctuation">.</span>py
│   │   └── player<span class="token punctuation">.</span>py
│   └── model
│       ├── __init__<span class="token punctuation">.</span>py
│       └── douyu_msg<span class="token punctuation">.</span>py
├── docs
├── setup<span class="token punctuation">.</span>cfg
├── setup<span class="token punctuation">.</span>py
├── sh<span class="token punctuation">.</span>py
└── tests
</code></pre>
<p>这就是我上次写的 <a href="http://danmu.fm">danmu.fm</a> 的代码目录。</p>
<p>聪明的你这时候你注意到了：</p>
<ol>
<li>主要的程序不是放在根目录下面，而是放在第二目录 danmufm 下面。</li>
<li>setup.cfg 是什么鬼东西</li>
<li><a href="http://setup.py">setup.py</a> 是什么鬼东西</li>
</ol>
<p>对于上面几点，我们分别进行解释</p>
<h3 id="121-为什么主要程序在第二目录下"><a class="v-toc-item" href="#121-为什么主要程序在第二目录下">#</a> 1.2.1 为什么主要程序在第二目录下</h3>
<p>为了把主要的程序分离出来，放在第二目录下面，这样的待会打包以后多出很多文件夹就不会对源码造成干扰。</p>
<p>当然，由于把程序放在了第二目录下面，所以，脚本里面的 from import 语句应该使用相对路径导入。</p>
<p>相对路径导入的的时候需要注意运行的时候使用如下命令</p>
<pre><code class="language-bash">python3 <span class="token operator">-</span>m danmufm<span class="token punctuation">.</span>danmu <span class="token punctuation">[</span>xxxx<span class="token punctuation">]</span>
</code></pre>
<h3 id="122-setupcfg"><a class="v-toc-item" href="#122-setupcfg">#</a> 1.2.2 setup.cfg</h3>
<p>填写如下内容即可。</p>
<pre><code>[metadata]
description-file = README.md
</code></pre>
<p>然后去写 Markdown 的 Readme 就好了。</p>
<h3 id="123-setuppy"><a class="v-toc-item" href="#123-setuppy">#</a> 1.2.3 <a href="http://setup.py">setup.py</a></h3>
<p>这个是重头戏了。</p>
<p>setup 这个 py 文件就是打包配置文件。对这个程序是谁的，有什么依赖，入口是什么，等等等等的配置。</p>
<pre><code class="language-python">#<span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span> encoding<span class="token operator">:</span> <span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span>
from setuptools <span class="token keyword">import</span> setup<span class="token punctuation">,</span> find_packages
<span class="token string">""</span>"
打包的用的 setup 必须引入，
<span class="token string">""</span>"

<span class="token constant">VERSION</span> <span class="token operator">=</span> <span class="token string">'0.1.1'</span>

<span class="token function">setup</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'danmu.fm'</span><span class="token punctuation">,</span>
      version<span class="token operator">=</span><span class="token constant">VERSION</span><span class="token punctuation">,</span>
      description<span class="token operator">=</span><span class="token string">"a tiny and smart cli player of douyutv,ximalayad,anmu based on Python"</span><span class="token punctuation">,</span>
      long_description<span class="token operator">=</span><span class="token string">'just enjoy'</span><span class="token punctuation">,</span>
      classifiers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> # Get strings from http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>pypi<span class="token punctuation">.</span>python<span class="token punctuation">.</span>org<span class="token operator">/</span>pypi<span class="token operator">?</span><span class="token operator">%</span><span class="token number">3</span>Aaction<span class="token operator">=</span>list_classifiers
      keywords<span class="token operator">=</span><span class="token string">'python douyu danmu danmu.fm terminal'</span><span class="token punctuation">,</span>
      author<span class="token operator">=</span><span class="token string">'twocucao'</span><span class="token punctuation">,</span>
      author_email<span class="token operator">=</span><span class="token string">'twocucao@gmail.com'</span><span class="token punctuation">,</span>
      url<span class="token operator">=</span><span class="token string">'https://github.com/twocucao/doumu.fm'</span><span class="token punctuation">,</span>
      license<span class="token operator">=</span><span class="token string">'MIT'</span><span class="token punctuation">,</span>
      packages<span class="token operator">=</span><span class="token function">find_packages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      include_package_data<span class="token operator">=</span>True<span class="token punctuation">,</span>
      zip_safe<span class="token operator">=</span>True<span class="token punctuation">,</span>
      install_requires<span class="token operator">=</span><span class="token punctuation">[</span>
        <span class="token string">'requests'</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      entry_points<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">'console_scripts'</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token string">'danmu.fm = danmufm.danmu:main'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

</code></pre>
<p>官方有 distutils 这个包管理器工具，设置也非常的简单，只是，它不支持 entry_points 属性，由于无法使用 entry_point, 也就无法通过命令来跳转到指定模块运行程序，这也就意味着，官方工具不方便写成命令行。还是 setuptools 好。</p>
<p>上面需要注意的就是 install_requires 可以添加依赖。其他的你猜都可以猜出来是做什么的。自己去看代码，我就不多说了。</p>
<h2 id="2-发布"><a class="v-toc-item" href="#2-发布">#</a> 2. 发布</h2>
<p>所谓的发布，就是将打包好的程序的某个版本发布到某个仓库中。</p>
<h3 id="21-注册-pypi-账户"><a class="v-toc-item" href="#21-注册-pypi-账户">#</a> 2.1. 注册 pypi 账户</h3>
<p>到这个上面注册账号：<br>
<a href="https://pypi.python.org/pypi">https://pypi.python.org/pypi</a></p>
<h3 id="22-注册在账户下面注册-python-包"><a class="v-toc-item" href="#22-注册在账户下面注册-python-包">#</a> 2.2. 注册在账户下面注册 Python 包</h3>
<p>进入对应项目根文件，然后执行</p>
<pre><code class="language-bash">python3 setup<span class="token punctuation">.</span>py register
</code></pre>
<p>这一步程序会让你输入刚刚注册的账号和密码，然后注册该包。注册该包以后，你就有了一个小仓库。可以存放不同版本的 <a href="http://danmu.fm">danmu.fm</a>.</p>
<p>注册的仓库是可以在这个地址看到的，<br>
<a href="https://pypi.python.org/pypi?%3Aaction=pkg_edit&amp;name=danmu.fm">https://pypi.python.org/pypi?%3Aaction=pkg_edit&amp;name=danmu.fm</a></p>
<h3 id="23-上传打包好的-python-命令行工具"><a class="v-toc-item" href="#23-上传打包好的-python-命令行工具">#</a> 2.3. 上传<strong>打包</strong>好的 Python 命令行工具。</h3>
<p>这里需要借助一个小工具，twine.twine 是一个更加安全方便上传打包好的代码的工具。</p>
<pre><code class="language-bash">pip3 install twine
</code></pre>
<p>接着开始打包，打包成两个版本，一个是不需要 build 的版本，另一个是需要 build 的版本（顺带吐槽下，这两个诡异的命名）.</p>
<pre><code class="language-bash">python setup<span class="token punctuation">.</span>py sdist bdist_wheel
</code></pre>
<p>于是剩下来的就显而易见了，上传 build 完毕的程序到仓库中。</p>
<pre><code class="language-bash">twine upload dist<span class="token operator">/</span>danmu<span class="token punctuation">.</span>fm<span class="token operator">-</span><span class="token number">0.1</span><span class="token number">.2</span><span class="token operator">*</span>
</code></pre>
<p>于是，安装一下，测试是否成功</p>
<pre><code class="language-bash">pip3 install danmu<span class="token punctuation">.</span>fm <span class="token operator">--</span>upgrade
</code></pre>
<p>命令行的工具是这样使用的。</p>
<pre><code class="language-bash">danmu<span class="token punctuation">.</span>fm <span class="token operator">-</span>q <span class="token number">2</span> <span class="token operator">-</span>v <span class="token number">1</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>douyutv<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token number">16789</span>
</code></pre>
<h2 id="3-完善"><a class="v-toc-item" href="#3-完善">#</a> 3. 完善</h2>
<p>不断的完善代码，然后打包终端程序发布到仓库给别人用，这就是整个的 PIP 打包发布流程。</p>
<ul>
<li>这个时候，你可能需要使用版本控制软件。</li>
<li>你可能需要增多的代码的测试。</li>
</ul>
</div></div><div><ul class="v-article-toc">
<li><a href="#%E5%A6%82%E4%BD%95%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AA-python-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7">如何发布一个 Python 命令行工具</a>
<ul>
<li><a href="#0x01-%E6%9C%AC%E6%96%87%E7%AE%80%E4%BB%8B">0x01 本文简介</a></li>
<li><a href="#0x02-%E5%A6%82%E4%BD%95%E5%88%86%E8%A7%A3%E8%BF%99%E4%B8%AA%E5%8F%91%E5%B8%83%E4%BB%BB%E5%8A%A1">0x02 如何分解这个发布任务？</a></li>
<li><a href="#0x03-%E5%86%99%E5%A5%BD%E4%B8%80%E4%B8%AA-python-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7">0x03 写好一个 Python 命令行工具</a>
<ul>
<li><a href="#11python-%E7%9A%84%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C">1.1.Python 的如何编写一个简单的命令行</a></li>
<li><a href="#12-%E5%A6%82%E4%BD%95%E7%BB%84%E7%BB%87%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84">1.2. 如何组织代码结构。</a></li>
<li><a href="#121-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%BB%E8%A6%81%E7%A8%8B%E5%BA%8F%E5%9C%A8%E7%AC%AC%E4%BA%8C%E7%9B%AE%E5%BD%95%E4%B8%8B">1.2.1 为什么主要程序在第二目录下</a></li>
<li><a href="#122-setupcfg">1.2.2 setup.cfg</a></li>
<li><a href="#123-setuppy">1.2.3 setup.py</a></li>
</ul>
</li>
<li><a href="#2-%E5%8F%91%E5%B8%83">2. 发布</a>
<ul>
<li><a href="#21-%E6%B3%A8%E5%86%8C-pypi-%E8%B4%A6%E6%88%B7">2.1. 注册 pypi 账户</a></li>
<li><a href="#22-%E6%B3%A8%E5%86%8C%E5%9C%A8%E8%B4%A6%E6%88%B7%E4%B8%8B%E9%9D%A2%E6%B3%A8%E5%86%8C-python-%E5%8C%85">2.2. 注册在账户下面注册 Python 包</a></li>
<li><a href="#23-%E4%B8%8A%E4%BC%A0%E6%89%93%E5%8C%85%E5%A5%BD%E7%9A%84-python-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7">2.3. 上传<strong>打包</strong>好的 Python 命令行工具。</a></li>
</ul>
</li>
<li><a href="#3-%E5%AE%8C%E5%96%84">3. 完善</a></li>
</ul>
</li>
</ul>
</div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"tags":["Python"],"path":"20160315_如何发布一个Py命令行工具.md","title":"如何发布一个 Python 命令行工具","slug":"如何发布一个 Python 命令行工具","date":"2016-03-15","category":"Python","lastMod":"2020-01-01","description":"这篇文章展示了基本的 Markdown 语法和格式.","thumbnail":"","content":"\u003ch1 id=\"如何发布一个-python-命令行工具\"\u003e\u003ca class=\"v-toc-item\" href=\"#如何发布一个-python-命令行工具\"\u003e#\u003c/a\u003e 如何发布一个 Python 命令行工具\u003c/h1\u003e\n\u003ch2 id=\"0x01-本文简介\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x01-本文简介\"\u003e#\u003c/a\u003e 0x01 本文简介\u003c/h2\u003e\n\u003cp\u003e上次写的一个终端里面斗鱼 TV 弹幕 Python 版本和 Ruby 版本，并且发布到 PIP 和 RubyGems 上面。在发布 PIP 包的时候，居然 Google 不到一篇可以非常好的讲解这个流程的文章。于是整理这篇文章，并且方便后来自己检索，并且方便他人找资料。\u003c/p\u003e\n\u003cp\u003e自推荐下依照本文定制的命令行工具 \u003ca href=\"http://danmu.fm\"\u003edanmu.fm\u003c/a\u003e 的 github 地址：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/twocucao/danmu.fm\"\u003ehttps://github.com/twocucao/danmu.fm\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e本文的目的也是非常简单：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e**写一个 Python 命令行工具，并且发布到 PIP 上面.**并且在这个过程中给出我自己的一些思考。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"0x02-如何分解这个发布任务\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x02-如何分解这个发布任务\"\u003e#\u003c/a\u003e 0x02 如何分解这个发布任务？\u003c/h2\u003e\n\u003cp\u003e只需要进行如下的两个步骤便可以：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003col\u003e\n\u003cli\u003e写好一个 Python 命令行工具。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003e发布它。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e当然，这样不够细致。再细分一下。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003col\u003e\n\u003cli\u003e写好一个 Python 命令行工具\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003e1.1. 命令行的特点，以及 Python 的如何编写命令行\u003c/li\u003e\n\u003cli\u003e1.2. 如何组织代码结构。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003e发布\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e2.1. 注册 pypi 账户\n\u003cul\u003e\n\u003cli\u003e2.2. 注册在账户下面注册 Python 包\u003c/li\u003e\n\u003cli\u003e2.3. 上传\u003cstrong\u003e打包\u003c/strong\u003e好的 Python 命令行工具。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e完善代码\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"0x03-写好一个-python-命令行工具\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x03-写好一个-python-命令行工具\"\u003e#\u003c/a\u003e 0x03 写好一个 Python 命令行工具\u003c/h2\u003e\n\u003cp\u003e写好一个命令行工具首先要知道命令行工具是什么？\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在我看来，命令行工具就是一种完成某种类型的任务的终端程序。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e也就是基本上没有什么用户界面的程序。\u003c/p\u003e\n\u003cp\u003e由于基本上没有什么用户界面，所以导致单个命令行的交互能力及其低下。但这种低下的交互性对于一些固定工作而言，简直就是最灵活的工具。只需要输入一些命令便可以完成某种类型的工作。实在是方便的很。\u003c/p\u003e\n\u003cp\u003e所以，某种程度上，终端程序低交互的缺点反而成了优点。\u003c/p\u003e\n\u003ch3 id=\"11python-的如何编写一个简单的命令行\"\u003e\u003ca class=\"v-toc-item\" href=\"#11python-的如何编写一个简单的命令行\"\u003e#\u003c/a\u003e 1.1.Python 的如何编写一个简单的命令行\u003c/h3\u003e\n\u003cp\u003e对于 Python 和命令行交互，我们很容易想出一个比较方便的方案。\u003c/p\u003e\n\u003cp\u003esys.argv 就是这样的嘛！\u003c/p\u003e\n\u003cp\u003e我们很容易这样写代码。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e python testargv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy thisisaargv1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e甚至我们也可以这样写命令行，\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e python testargv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy thisisaargv1 \u003cspan class=\"token operator\"\u003e-\u003c/span\u003ed \u003cspan class=\"token operator\"\u003e-\u003c/span\u003ef \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e那么，这样写的后果就是，不方便解析出（不是不能，是不方便） -d -f 0 以及 thisisaargv1.\u003c/p\u003e\n\u003cp\u003e不信的话，你解析一个下面场景的命令行试试，\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# 用户可能这样输入\ndanmu\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efm http\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ewww\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edouyutv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecom\u003cspan class=\"token operator\"\u003e/\u003c/span\u003exiaocang \u003cspan class=\"token operator\"\u003e-\u003c/span\u003eq \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003ev \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\ndanmu\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efm \u003cspan class=\"token operator\"\u003e-\u003c/span\u003eq \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003ev \u003cspan class=\"token number\"\u003e2\u003c/span\u003e http\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ewww\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edouyutv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecom\u003cspan class=\"token operator\"\u003e/\u003c/span\u003exiaocang\n# 当然，肯定还有漏写啦，等等，你得需要转类型，增加各种 blablabla 的描述吧，添加默认的参数值吧。\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e于是 Python 就提供了一个非常好用的模块可以使用。叫做 argparse.\u003c/p\u003e\n\u003cp\u003e上面的描述就变成了这个样子\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e argparse\n\n\u003cspan class=\"token constant\"\u003eAPP_DESC\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n这就是描述\n\u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n\u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token constant\"\u003eAPP_DESC\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token function\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esys\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eargv\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    sys\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eargv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eappend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'--help'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nparser \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e argparse\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eArgumentParser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nparser\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eadd_argument\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'-q'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string\"\u003e'--quality'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003etype\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eint\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token keyword\"\u003edefault\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ehelp\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"download video quality : 1 for the standard-definition; 3 for the super-definition\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nparser\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eadd_argument\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'-v'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string\"\u003e'--verbose'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edefault\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ehelp\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"print more debuging information\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nparser\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eadd_argument\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'-s'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string\"\u003e'--store'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ehelp\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"保存流媒体文件到指定位置\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nparser\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eadd_argument\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'-c'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string\"\u003e'--config'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token keyword\"\u003edefault\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ehelp\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"读取~/.danmu.fm 配置，请~/.danmu.fm 指定数据库\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nparser\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eadd_argument\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'url'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003emetavar\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'URL'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003enargs\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'+'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e help\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"zhubo page URL (http://www.douyutv.com/*/)\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nargs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e parser\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eparse_args\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n# 获取对应参数只需要 args\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003equality\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eurl 之类。\nurl \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eurl\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eurl\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n#其他执行逻辑\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e保存为 \u003ca href=\"http://danmu.py\"\u003edanmu.py\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e这样就可以执行命令\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003epython danmu\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy http\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ewww\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edouyutv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecom\u003cspan class=\"token operator\"\u003e/\u003c/span\u003exiaocang \u003cspan class=\"token operator\"\u003e-\u003c/span\u003eq \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003ev \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e通过 args 就可以获取参数，然后进行终端程序的参数初始化。\u003c/p\u003e\n\u003cp\u003e可是这和我们的要求还是不同嘛，我们不想多写 Python XXX, 我们想直接 XXX. 就像这样。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003edanmu\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efm \u003cspan class=\"token operator\"\u003e-\u003c/span\u003eq \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003ev \u003cspan class=\"token number\"\u003e2\u003c/span\u003e http\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ewww\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edouyutv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecom\u003cspan class=\"token operator\"\u003e/\u003c/span\u003exiaocang\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e不急，下面就是了。\u003c/p\u003e\n\u003ch3 id=\"12-如何组织代码结构\"\u003e\u003ca class=\"v-toc-item\" href=\"#12-如何组织代码结构\"\u003e#\u003c/a\u003e 1.2. 如何组织代码结构。\u003c/h3\u003e\n\u003cp\u003e于是，现在就要开始组织代码结构了。\u003c/p\u003e\n\u003cp\u003e我们在最终的代码目录大概是这样的。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003edanmu\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efm\n├── \u003cspan class=\"token constant\"\u003eREADME\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emd\n├── danmufm\n│   ├── __init__\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n│   ├── client\n│   │   ├── __init__\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n│   │   ├── __init__\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epyc\n│   │   ├── douyu_client\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n│   │   └── douyu_danmu_client\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n│   ├── danmu\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n│   ├── misc\n│   │   ├── __init__\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n│   │   ├── color_printer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n│   │   ├── downloaders\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n│   │   └── player\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n│   └── model\n│       ├── __init__\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n│       └── douyu_msg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n├── docs\n├── setup\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecfg\n├── setup\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n├── sh\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n└── tests\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这就是我上次写的 \u003ca href=\"http://danmu.fm\"\u003edanmu.fm\u003c/a\u003e 的代码目录。\u003c/p\u003e\n\u003cp\u003e聪明的你这时候你注意到了：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e主要的程序不是放在根目录下面，而是放在第二目录 danmufm 下面。\u003c/li\u003e\n\u003cli\u003esetup.cfg 是什么鬼东西\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://setup.py\"\u003esetup.py\u003c/a\u003e 是什么鬼东西\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e对于上面几点，我们分别进行解释\u003c/p\u003e\n\u003ch3 id=\"121-为什么主要程序在第二目录下\"\u003e\u003ca class=\"v-toc-item\" href=\"#121-为什么主要程序在第二目录下\"\u003e#\u003c/a\u003e 1.2.1 为什么主要程序在第二目录下\u003c/h3\u003e\n\u003cp\u003e为了把主要的程序分离出来，放在第二目录下面，这样的待会打包以后多出很多文件夹就不会对源码造成干扰。\u003c/p\u003e\n\u003cp\u003e当然，由于把程序放在了第二目录下面，所以，脚本里面的 from import 语句应该使用相对路径导入。\u003c/p\u003e\n\u003cp\u003e相对路径导入的的时候需要注意运行的时候使用如下命令\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003epython3 \u003cspan class=\"token operator\"\u003e-\u003c/span\u003em danmufm\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edanmu \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003exxxx\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"122-setupcfg\"\u003e\u003ca class=\"v-toc-item\" href=\"#122-setupcfg\"\u003e#\u003c/a\u003e 1.2.2 setup.cfg\u003c/h3\u003e\n\u003cp\u003e填写如下内容即可。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[metadata]\ndescription-file = README.md\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后去写 Markdown 的 Readme 就好了。\u003c/p\u003e\n\u003ch3 id=\"123-setuppy\"\u003e\u003ca class=\"v-toc-item\" href=\"#123-setuppy\"\u003e#\u003c/a\u003e 1.2.3 \u003ca href=\"http://setup.py\"\u003esetup.py\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e这个是重头戏了。\u003c/p\u003e\n\u003cp\u003esetup 这个 py 文件就是打包配置文件。对这个程序是谁的，有什么依赖，入口是什么，等等等等的配置。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e#\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e encoding\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eUTF\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e8\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\nfrom setuptools \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e setup\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e find_packages\n\u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n打包的用的 setup 必须引入，\n\u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n\n\u003cspan class=\"token constant\"\u003eVERSION\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'0.1.1'\u003c/span\u003e\n\n\u003cspan class=\"token function\"\u003esetup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ename\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'danmu.fm'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      version\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token constant\"\u003eVERSION\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      description\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"a tiny and smart cli player of douyutv,ximalayad,anmu based on Python\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      long_description\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'just enjoy'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      classifiers\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e # Get strings from http\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003epypi\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epython\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eorg\u003cspan class=\"token operator\"\u003e/\u003c/span\u003epypi\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e%\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003eAaction\u003cspan class=\"token operator\"\u003e=\u003c/span\u003elist_classifiers\n      keywords\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'python douyu danmu danmu.fm terminal'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      author\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'twocucao'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      author_email\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'twocucao@gmail.com'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      url\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'https://github.com/twocucao/doumu.fm'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      license\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'MIT'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      packages\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token function\"\u003efind_packages\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      include_package_data\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTrue\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      zip_safe\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTrue\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      install_requires\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'requests'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      entry_points\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e'console_scripts'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'danmu.fm = danmufm.danmu:main'\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e官方有 distutils 这个包管理器工具，设置也非常的简单，只是，它不支持 entry_points 属性，由于无法使用 entry_point, 也就无法通过命令来跳转到指定模块运行程序，这也就意味着，官方工具不方便写成命令行。还是 setuptools 好。\u003c/p\u003e\n\u003cp\u003e上面需要注意的就是 install_requires 可以添加依赖。其他的你猜都可以猜出来是做什么的。自己去看代码，我就不多说了。\u003c/p\u003e\n\u003ch2 id=\"2-发布\"\u003e\u003ca class=\"v-toc-item\" href=\"#2-发布\"\u003e#\u003c/a\u003e 2. 发布\u003c/h2\u003e\n\u003cp\u003e所谓的发布，就是将打包好的程序的某个版本发布到某个仓库中。\u003c/p\u003e\n\u003ch3 id=\"21-注册-pypi-账户\"\u003e\u003ca class=\"v-toc-item\" href=\"#21-注册-pypi-账户\"\u003e#\u003c/a\u003e 2.1. 注册 pypi 账户\u003c/h3\u003e\n\u003cp\u003e到这个上面注册账号：\u003cbr\u003e\n\u003ca href=\"https://pypi.python.org/pypi\"\u003ehttps://pypi.python.org/pypi\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"22-注册在账户下面注册-python-包\"\u003e\u003ca class=\"v-toc-item\" href=\"#22-注册在账户下面注册-python-包\"\u003e#\u003c/a\u003e 2.2. 注册在账户下面注册 Python 包\u003c/h3\u003e\n\u003cp\u003e进入对应项目根文件，然后执行\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003epython3 setup\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy register\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这一步程序会让你输入刚刚注册的账号和密码，然后注册该包。注册该包以后，你就有了一个小仓库。可以存放不同版本的 \u003ca href=\"http://danmu.fm\"\u003edanmu.fm\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003e注册的仓库是可以在这个地址看到的，\u003cbr\u003e\n\u003ca href=\"https://pypi.python.org/pypi?%3Aaction=pkg_edit\u0026amp;name=danmu.fm\"\u003ehttps://pypi.python.org/pypi?%3Aaction=pkg_edit\u0026amp;name=danmu.fm\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"23-上传打包好的-python-命令行工具\"\u003e\u003ca class=\"v-toc-item\" href=\"#23-上传打包好的-python-命令行工具\"\u003e#\u003c/a\u003e 2.3. 上传\u003cstrong\u003e打包\u003c/strong\u003e好的 Python 命令行工具。\u003c/h3\u003e\n\u003cp\u003e这里需要借助一个小工具，twine.twine 是一个更加安全方便上传打包好的代码的工具。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003epip3 install twine\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e接着开始打包，打包成两个版本，一个是不需要 build 的版本，另一个是需要 build 的版本（顺带吐槽下，这两个诡异的命名）.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003epython setup\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy sdist bdist_wheel\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e于是剩下来的就显而易见了，上传 build 完毕的程序到仓库中。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003etwine upload dist\u003cspan class=\"token operator\"\u003e/\u003c/span\u003edanmu\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efm\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.1\u003c/span\u003e\u003cspan class=\"token number\"\u003e.2\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e于是，安装一下，测试是否成功\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003epip3 install danmu\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efm \u003cspan class=\"token operator\"\u003e--\u003c/span\u003eupgrade\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e命令行的工具是这样使用的。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003edanmu\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efm \u003cspan class=\"token operator\"\u003e-\u003c/span\u003eq \u003cspan class=\"token number\"\u003e2\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003ev \u003cspan class=\"token number\"\u003e1\u003c/span\u003e http\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ewww\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edouyutv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecom\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e16789\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"3-完善\"\u003e\u003ca class=\"v-toc-item\" href=\"#3-完善\"\u003e#\u003c/a\u003e 3. 完善\u003c/h2\u003e\n\u003cp\u003e不断的完善代码，然后打包终端程序发布到仓库给别人用，这就是整个的 PIP 打包发布流程。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e这个时候，你可能需要使用版本控制软件。\u003c/li\u003e\n\u003cli\u003e你可能需要增多的代码的测试。\u003c/li\u003e\n\u003c/ul\u003e\n","toc":"\u003cul class=\"v-article-toc\"\u003e\n\u003cli\u003e\u003ca href=\"#%E5%A6%82%E4%BD%95%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AA-python-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7\"\u003e如何发布一个 Python 命令行工具\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#0x01-%E6%9C%AC%E6%96%87%E7%AE%80%E4%BB%8B\"\u003e0x01 本文简介\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x02-%E5%A6%82%E4%BD%95%E5%88%86%E8%A7%A3%E8%BF%99%E4%B8%AA%E5%8F%91%E5%B8%83%E4%BB%BB%E5%8A%A1\"\u003e0x02 如何分解这个发布任务？\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x03-%E5%86%99%E5%A5%BD%E4%B8%80%E4%B8%AA-python-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7\"\u003e0x03 写好一个 Python 命令行工具\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#11python-%E7%9A%84%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C\"\u003e1.1.Python 的如何编写一个简单的命令行\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#12-%E5%A6%82%E4%BD%95%E7%BB%84%E7%BB%87%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84\"\u003e1.2. 如何组织代码结构。\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#121-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%BB%E8%A6%81%E7%A8%8B%E5%BA%8F%E5%9C%A8%E7%AC%AC%E4%BA%8C%E7%9B%AE%E5%BD%95%E4%B8%8B\"\u003e1.2.1 为什么主要程序在第二目录下\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#122-setupcfg\"\u003e1.2.2 setup.cfg\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#123-setuppy\"\u003e1.2.3 setup.py\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#2-%E5%8F%91%E5%B8%83\"\u003e2. 发布\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#21-%E6%B3%A8%E5%86%8C-pypi-%E8%B4%A6%E6%88%B7\"\u003e2.1. 注册 pypi 账户\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#22-%E6%B3%A8%E5%86%8C%E5%9C%A8%E8%B4%A6%E6%88%B7%E4%B8%8B%E9%9D%A2%E6%B3%A8%E5%86%8C-python-%E5%8C%85\"\u003e2.2. 注册在账户下面注册 Python 包\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#23-%E4%B8%8A%E4%BC%A0%E6%89%93%E5%8C%85%E5%A5%BD%E7%9A%84-python-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7\"\u003e2.3. 上传\u003cstrong\u003e打包\u003c/strong\u003e好的 Python 命令行工具。\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#3-%E5%AE%8C%E5%96%84\"\u003e3. 完善\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n"}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"如何发布一个 Python 命令行工具"},"buildId":"uCwe9m-iio9bnoWMgWDqE","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>