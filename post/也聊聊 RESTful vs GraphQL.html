<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>也聊聊 RESTful vs GraphQL | 海拉鲁编程客</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/49455a07b6dd33600cdf.css" as="style"/><link rel="stylesheet" href="/_next/static/css/49455a07b6dd33600cdf.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-20d43e08bea62467b090.js" defer=""></script><script src="/_next/static/chunks/framework-0441fae7fd130f37dee1.js" defer=""></script><script src="/_next/static/chunks/main-4777350f2a9ff73ea2b0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-3050679c6e5142ffcaf5.js" defer=""></script><script src="/_next/static/chunks/ea88be26-9bcf6ead520f4ac26973.js" defer=""></script><script src="/_next/static/chunks/421-f2f33a86b546237f0325.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-173fe2de48c90365db9d.js" defer=""></script><script src="/_next/static/oDi_oBCBuu3qj6v7hDnrL/_buildManifest.js" defer=""></script><script src="/_next/static/oDi_oBCBuu3qj6v7hDnrL/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="v-page"><nav class="shadow"><div class="flex flex-col container mx-auto h-12 px-40 md:flex-row md:items-center md:justify-between"><div class="flex justify-between items-center"><div><a class="text-gray-800 text-xl md:text-xl leading-5" href="/">海拉鲁编程客</a></div><div><button type="button" class="block text-gray-800 hover:text-gray-600 focus:text-gray-600 focus:outline-none md:hidden"><svg viewBox="0 0 24 24" class="h-6 w-6 fill-current"><path d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z"></path></svg></button></div></div><div class="md:flex flex-col md:flex-row md:-mx-4 hidden"><a class="my-1 text-gray-800 hover:text-blue-500 md:mx-4 md:my-0" href="/">首页</a><a class="my-1 text-gray-800 hover:text-blue-500 md:mx-4 md:my-0" href="/archive">归档</a><a class="my-1 text-gray-800 hover:text-blue-500 md:mx-4 md:my-0" href="/about">关于我</a><button style="cursor:pointer;overflow:hidden;width:50px;height:23.5px;appearance:none;-moz-appearance:none;-webkit-appearance:none;border:none;background-color:transparent;padding:0" aria-hidden="true"><div style="display:flex;align-items:center;justify-content:center;margin-top:-28.749999999999996px;margin-left:-16px;width:82.5px;height:82.5px"><div></div></div></button></div></div></nav><div class="v-article"><div class="v-article-main" style="margin:auto;width:786px"><div><h1 id="也聊聊-restful-vs-graphql"><a class="v-toc-item" href="#也聊聊-restful-vs-graphql">#</a> 也聊聊 RESTful vs GraphQL</h1>
<h2 id="0x00-前言"><a class="v-toc-item" href="#0x00-前言">#</a> 0x00 前言</h2>
<p>本文最早行文于 2018 年中，那时 GraphQL 的生态尚未成熟，也缺乏社区总结的一些经验。</p>
<blockquote>
<p>较早入了坑，回首百年身</p>
</blockquote>
<p>2021 年中，复盘一下 GraphQL 的一些使用经验。</p>
<p>名词约定</p>
<ul>
<li><strong>接口生产端 / 服务端 下面统一称「生产端」</strong></li>
<li><strong>接口消费端 / 客户端 下面统一称「消费端」</strong></li>
</ul>
<h2 id="0x01-流水的技术方案铁打的需求"><a class="v-toc-item" href="#0x01-流水的技术方案铁打的需求">#</a> 0x01 流水的技术方案，铁打的需求。</h2>
<p>年幼时看笑傲江湖，华山派两派居然为了剑宗和气宗争个你死我活。</p>
<p>觉得甚是幼稚。</p>
<p>年纪渐大之后发现社会处处充满着这种「谁好」的争论。</p>
<ul>
<li>剑宗 or 气宗</li>
<li>自然美 or 人造美</li>
<li>Java or Python or Golang</li>
<li>Editor or IDE</li>
<li>Rest or GraphQL</li>
<li>单体应用 or 微服务</li>
</ul>
<p>剑招是死的，人是活的。</p>
<p>当讨论问题的时候，下面两个问题意义可能并不是很大。</p>
<ul>
<li>用剑宗初学者和气宗高手比，或者相反，这个完全没有多大意义？</li>
<li>用剑宗初学者和气宗初学者比孰强孰弱，这个有一点意义，但意义也不是很大。菜鸡互啄。</li>
</ul>
<p>GraphQL 作为挑战者，下面几个问题是很有意义的。</p>
<ul>
<li>现有方案存在哪些问题？</li>
<li>GraphQL 相比于原先成熟稳定的方案</li>
<li>新方案解决了哪些原先没有解决的问题。</li>
<li>新方案更低成本解决了哪些问题。</li>
<li>现有的痛点是否存在一些新老方案都无法解决的问题。</li>
<li>有无前车之鉴，有无社区最佳实践。</li>
<li>迁移成本和学习成本是多少。</li>
<li>回滚成本多少。</li>
</ul>
<h2 id="0x02-restful-的缺点"><a class="v-toc-item" href="#0x02-restful-的缺点">#</a> 0x02 RESTful 的缺点</h2>
<p>RESTful 有很多接口上最佳实践，但生搬硬套就会使得接口比较诡异。</p>
<p>这里只说生搬硬套 RESTFul 的带来的缺点，对于大部分公司来说，这些缺点远远抵不上带来的优点。</p>
<h3 id="语义不明确"><a class="v-toc-item" href="#语义不明确">#</a> 语义不明确</h3>
<p>比如，业务具备一定复杂性的时候，语义容易不明确。</p>
<p>预览订单和下单两个接口，如果遵循如下的标准</p>
<ul>
<li>接口路径使用名词而非动词</li>
<li>GET 不修改，POST/PUT/DELETE 修改状态</li>
<li>使用子字段来表述关系，查询订单 GET /shop/711/orders/</li>
</ul>
<p>严格遵循 RESTful 的话，接口就会成这个样子</p>
<pre><code class="language-bash"><span class="token constant">GET</span> <span class="token operator">/</span>shops<span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span>order  <span class="token punctuation">{</span>   <span class="token string">"products"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token constant">PUT</span> <span class="token operator">/</span>shops<span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span>order  <span class="token punctuation">{</span>   <span class="token string">"products"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
</code></pre>
<p>反正我是看不出来这是一坨啥玩意的，至于如果你硬性规范 PUT order 就是创建订单，就会出现接下来两个接口完全不知道该怎么写</p>
<pre><code>    支付订单 （用 patch /shop/1/order)
    取消订单 （用 delete 方法，也没有 delete 呀）
    退款订单
    部分退款订单
</code></pre>
<ul>
<li>产品上，用户删除了一台机器，那就是删除了一台机器？这里是软删。</li>
<li>产品上，管理员删除了一台机器，那就是删除了一台机器？机器记录还在的。</li>
</ul>
<p>所以，采用的是 DELETE /machine/1</p>
<blockquote>
<p>剑招是死的，人是活的。</p>
</blockquote>
<p>不严格遵循 RESTful 的时候可以这么写。</p>
<pre><code class="language-bash"><span class="token constant">POST</span> <span class="token operator">/</span>preview_order
<span class="token punctuation">{</span>
  <span class="token string">"shop_id"</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
  <span class="token string">"products"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token constant">POST</span> <span class="token operator">/</span>make_order
<span class="token punctuation">{</span>
  <span class="token string">"shop_id"</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
  <span class="token string">"products"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token constant">POST</span> <span class="token operator">/</span>pay_order
<span class="token punctuation">{</span>
  <span class="token string">"order_id"</span><span class="token operator">:</span> <span class="token string">"202012001231237"</span><span class="token punctuation">,</span>
  <span class="token string">"balance"</span><span class="token operator">:</span> <span class="token string">"20.20"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token constant">POST</span> <span class="token operator">/</span>cancel_order
<span class="token punctuation">{</span>
  <span class="token string">"order_id"</span><span class="token operator">:</span> <span class="token string">"202012001231237"</span>
<span class="token punctuation">}</span>
</code></pre>
<p>至于第三点的子字段表述关系，是一个典型的反面教材</p>
<p>引用 Python 之禅来表达</p>
<pre><code>Flat is better than nested. 扁平优于嵌套
</code></pre>
<h3 id="得到即是失去-gets-loss"><a class="v-toc-item" href="#得到即是失去-gets-loss">#</a> 得到即是失去 - Get’s loss</h3>
<p>GET 让问题变得复杂</p>
<p>Rest 时代一个有代表性的问题就是如何在 GET 方法里处理以下四个问题</p>
<ul>
<li>过滤 filter</li>
<li>排序 sort</li>
<li>字段裁剪 field selections</li>
<li>分页 pagination</li>
</ul>
<p>为了解决这个问题，一个稍微复杂的查询接口就成了如下的样子</p>
<pre><code class="language-bash"><span class="token constant">GET</span> <span class="token operator">/</span>cars<span class="token operator">?</span>seats<span class="token operator">&lt;=</span><span class="token number">2</span><span class="token operator">&amp;</span>sort<span class="token operator">=</span><span class="token operator">-</span>manufactorer<span class="token punctuation">,</span><span class="token operator">+</span>model<span class="token operator">&amp;</span>fields<span class="token operator">=</span>manufacturer<span class="token punctuation">,</span>model<span class="token punctuation">,</span>id<span class="token punctuation">,</span>color<span class="token operator">&amp;</span>page<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>per_page<span class="token operator">=</span><span class="token number">10</span>
</code></pre>
<blockquote>
<p><strong>可阅读性较差</strong></p>
</blockquote>
<p>而如果这么写，则前端无需把原先的 queryparams 转化成逗号结尾的字符串，后端也需要跟着解析并且转成自己想要的格式</p>
<p>如果按照如下的写法，后端则可以直接使用 json 标准库里的数据类型。</p>
<pre><code class="language-bash"><span class="token constant">POST</span> <span class="token operator">/</span>cars
<span class="token punctuation">{</span>
  <span class="token string">"filters"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">"seat__lt"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
  <span class="token string">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"-manufactorer"</span><span class="token punctuation">,</span>
    <span class="token string">"+model"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"fields"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"manufacturer"</span><span class="token punctuation">,</span>
    <span class="token string">"model"</span><span class="token punctuation">,</span>
    <span class="token string">"id"</span><span class="token punctuation">,</span>
    <span class="token string">"color"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"pagination"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">"page"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">"per_page"</span><span class="token operator">:</span> <span class="token number">10</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>

</code></pre>
<h3 id="未很好解决的问题"><a class="v-toc-item" href="#未很好解决的问题">#</a> 未很好解决的问题</h3>
<p>RESTFul 接口提倡的是细粒度、正交性。</p>
<p>这样的接口是为了更加方便的复用多个接口来组成页面，但是并非没有问题。</p>
<p>细粒度和正交性意味着接口是 building block, 而 building block 组合起来是交给前端来做的。 这意味着前端为了组合多个资源，则需要发起多次请求。</p>
<p>这首先是带来了的网络开销成本 (HTTP 2 解决了首部开销、多路复用等 HTTP 1.1 面临的问题，还做到了完全向后兼容。) 和响应内容拼装成本</p>
<p>其次，前端往往会抱怨</p>
<ol>
<li>服务端这个接口字段少了，后端往往会复用序列器，直接把太多前端用不到的数据一并返回。</li>
<li>服务端这个接口字段太多，需要慢慢找 diff, 于是会开始抱怨文档问题。</li>
</ol>
<p>于是大家采用了 swagger/openapi 的配套解决方案。同时带来了，文档的缺失和滞后</p>
<h2 id="0x03-graphql-是新的颠覆者么"><a class="v-toc-item" href="#0x03-graphql-是新的颠覆者么">#</a> 0x03 GraphQL 是新的颠覆者么？</h2>
<p>GraphQL 也不是什么革命性的产品，不过是一种新的开 Web 接口的方式罢了。</p>
<p>而请求接口提交的参数也变成了包含参数的一种查询语言。</p>
<p>官方宣传的 GraphQL 搞好了，只需如此：</p>
<pre><code class="language-graphql"># Step1\<span class="token punctuation">.</span> 描述你的数据
type Project <span class="token punctuation">{</span>
  name<span class="token operator">:</span> String
  tagline<span class="token operator">:</span> String
  contributors<span class="token operator">:</span> <span class="token punctuation">[</span>User<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
# Step2\<span class="token punctuation">.</span> 请求所需数据。
<span class="token punctuation">{</span>
  <span class="token function">project</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token string">"GraphQL"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tagline
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
# Step3\<span class="token punctuation">.</span> 拿到所需数据。
<span class="token punctuation">{</span>
  <span class="token string">"project"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">"tagline"</span><span class="token operator">:</span> <span class="token string">"A query language for APIs"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>嗯，是不是和 SQL 看起来有点像？当然咯，都是查询语言 (QL) 嘛。</p>
<h2 id="0x04-graphql-给消费端带来的好处"><a class="v-toc-item" href="#0x04-graphql-给消费端带来的好处">#</a> 0x04 GraphQL 给消费端带来的好处</h2>
<p>GraphQL 的好处，自然是接口消费端写起来就是一个字，爽。</p>
<p>比如我们使用 Github 的 API 做一个简单的查询<br>
地址如下 <a href="https://link.zhihu.com/?target=https%3A//developer.github.com/v4/explorer/">https://link.zhihu.com/?target=https%3A//developer.github.com/v4/explorer/</a><br>
查询如下</p>
<pre><code class="language-graphql">query <span class="token punctuation">{</span>
  viewer <span class="token punctuation">{</span>
    login
    bio
    <span class="token function">repositories</span><span class="token punctuation">(</span><span class="token parameter">first<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> orderBy<span class="token operator">:</span> <span class="token punctuation">{</span> field<span class="token operator">:</span> <span class="token constant">STARGAZERS</span><span class="token punctuation">,</span> direction<span class="token operator">:</span> <span class="token constant">DESC</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nodes <span class="token punctuation">{</span>
        nameWithOwner
        viewerHasStarred
        watchers <span class="token punctuation">{</span>
          totalCount
        <span class="token punctuation">}</span>
        stargazers <span class="token punctuation">{</span>
          totalCount
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      totalCount
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>结果如下</p>
<pre><code class="language-json"><span class="token punctuation">{</span>
  <span class="token string">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">"viewer"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">"login"</span><span class="token operator">:</span> <span class="token string">"twocucao"</span><span class="token punctuation">,</span>
      <span class="token string">"bio"</span><span class="token operator">:</span> <span class="token string">"FullStack Pythonist In Shanghai"</span><span class="token punctuation">,</span>
      <span class="token string">"repositories"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">"nodes"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string">"nameWithOwner"</span><span class="token operator">:</span> <span class="token string">"twocucao/YaDjangoBlog"</span><span class="token punctuation">,</span>
            <span class="token string">"viewerHasStarred"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token string">"watchers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">"totalCount"</span><span class="token operator">:</span> <span class="token number">12</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"stargazers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">"totalCount"</span><span class="token operator">:</span> <span class="token number">326</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token string">"nameWithOwner"</span><span class="token operator">:</span> <span class="token string">"twocucao/danmu.fm"</span><span class="token punctuation">,</span>
            <span class="token string">"viewerHasStarred"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token string">"watchers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">"totalCount"</span><span class="token operator">:</span> <span class="token number">23</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"stargazers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">"totalCount"</span><span class="token operator">:</span> <span class="token number">316</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token string">"nameWithOwner"</span><span class="token operator">:</span> <span class="token string">"twocucao/YaVueBlog"</span><span class="token punctuation">,</span>
            <span class="token string">"viewerHasStarred"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token string">"watchers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">"totalCount"</span><span class="token operator">:</span> <span class="token number">8</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"stargazers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">"totalCount"</span><span class="token operator">:</span> <span class="token number">141</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token string">"nameWithOwner"</span><span class="token operator">:</span> <span class="token string">"twocucao/danmu"</span><span class="token punctuation">,</span>
            <span class="token string">"viewerHasStarred"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token string">"watchers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">"totalCount"</span><span class="token operator">:</span> <span class="token number">5</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"stargazers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">"totalCount"</span><span class="token operator">:</span> <span class="token number">69</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token string">"nameWithOwner"</span><span class="token operator">:</span> <span class="token string">"twocucao/silverhand"</span><span class="token punctuation">,</span>
            <span class="token string">"viewerHasStarred"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token string">"watchers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">"totalCount"</span><span class="token operator">:</span> <span class="token number">7</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"stargazers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">"totalCount"</span><span class="token operator">:</span> <span class="token number">60</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token string">"nameWithOwner"</span><span class="token operator">:</span> <span class="token string">"twocucao/ChortHotKey"</span><span class="token punctuation">,</span>
            <span class="token string">"viewerHasStarred"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token string">"watchers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">"totalCount"</span><span class="token operator">:</span> <span class="token number">7</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"stargazers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">"totalCount"</span><span class="token operator">:</span> <span class="token number">32</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// ......</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">"totalCount"</span><span class="token operator">:</span> <span class="token number">155</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>如果你说，我还要看看这个 repo 的主要语言，那么增加一行查询即可。如图。</p>
<p><img src="https://pic2.zhimg.com/v2-997f49fd55e972c37d458a2aef6fb4dd_b.jpg" alt=""></p>
<p><img src="https://pic2.zhimg.com/80/v2-997f49fd55e972c37d458a2aef6fb4dd_1440w.jpg" alt=""></p>
<p>是不是很方便？前端基本对着 Schemas 里面的 query 查询完毕就完毕了。</p>
<p>查询这么搞可以，增删改查之类的操作呢？</p>
<p>GraphQL 里面还有 Mutation 可以帮你解决这个问题，在后端定义完 Mutation , 前端在 Mutation 里面可以直接传参。</p>
<p>甚至，<strong>后端开出接口时，可以依据请求和响应生成对应的 typescript 代码，然后享受代码补全的快感。</strong></p>
<blockquote>
<p><strong>极大利好前端</strong></p>
</blockquote>
<p>有人说, graphql 不就最后生成了 schema 嘛</p>
<p>可不要小瞧了生成全接口的 schema, 用它可以做很多东西</p>
<ol>
<li><strong>便捷的文档功能,</strong> 接口列表以及入参的初步生成。便于快速调接口，比如我写了一个接口，发布到测试环境，接着点击一个按扭直接同步到 insomnia 里。点击运行即可调试。<strong>「甚至可以做简单的接口自动化测试」</strong></li>
<li><strong>可以生成 typescript/javascript 代码,</strong> 让前端享受到直接在代码里补全的快感。</li>
<li>比对两个版本之间的 schema 可以直接得出接口 schema 上，后端有没有做好兼容。如果不行, 则 CI 无法跑过</li>
</ol>
<p><img src="https://pic1.zhimg.com/v2-c7a593ada4bc7fc78b20c3d18b5e1850_b.jpg" alt=""></p>
<h2 id="0x05-graphql-给生产端带来的挑战"><a class="v-toc-item" href="#0x05-graphql-给生产端带来的挑战">#</a> 0x05 GraphQL 给生产端带来的挑战</h2>
<p>消费端（前端）爽了，是否意味着生产端（服务端）会爽呢？</p>
<blockquote>
<p><strong>并不是</strong></p>
</blockquote>
<ul>
<li>对于前端来说，如果要消费 graphql api, 相对容易一些。 只需将原先的 api 层改为 graphqlfetch 即可</li>
<li>对于后端来说，如果要生产 graphql api, 则麻烦了不少。</li>
</ul>
<p>下文我会以 graphene 这个 graphql python 库来说明带来的一些挑战</p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/graphql-python/graphene">https://link.zhihu.com/?target=https%3A//github.com/graphql-python/graphene</a></p>
<p>有的挑战是和 graphql 相关的，有的挑战则是来自 graphene 库，或许其他库有更好的解决方案。</p>
<blockquote>
<p>注意！痛点背后的原因，大多是 graphql 以及配套库玩的不熟。<strong>而不一定是 RESTFUL 不存在这些问题</strong></p>
</blockquote>
<p>大致有如下挑战</p>
<ul>
<li>View 层代码组织剧变</li>
<li>权限问题</li>
<li>版本更迭</li>
<li>required vs nullable vs blank</li>
<li>服务端缓存</li>
<li>嵌套式 API</li>
<li>N+1 问题</li>
<li>为名所困</li>
</ul>
<h3 id="view-层代码组织剧变"><a class="v-toc-item" href="#view-层代码组织剧变">#</a> View 层代码组织剧变</h3>
<p>以简单的查询和创建两个接口为例。</p>
<pre><code class="language-python">
<span class="token keyword">import</span> graphene

<span class="token keyword">class</span> <span class="token class-name">PersonInput</span><span class="token punctuation">(</span>graphene<span class="token punctuation">.</span>InputObjectType<span class="token punctuation">)</span><span class="token operator">:</span>
  name <span class="token operator">=</span> graphene<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>required<span class="token operator">=</span>True<span class="token punctuation">)</span>
  age <span class="token operator">=</span> graphene<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span>required<span class="token operator">=</span>True<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">CreatePerson</span><span class="token punctuation">(</span>graphene<span class="token punctuation">.</span>Mutation<span class="token punctuation">)</span><span class="token operator">:</span>

  <span class="token keyword">class</span> <span class="token class-name">Arguments</span><span class="token operator">:</span>
    person_data <span class="token operator">=</span> <span class="token function">PersonInput</span><span class="token punctuation">(</span>required<span class="token operator">=</span>True<span class="token punctuation">)</span>
    person <span class="token operator">=</span> graphene<span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span>

  def <span class="token function">mutate</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> info<span class="token punctuation">,</span> person_data<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token operator">:</span>
    person <span class="token operator">=</span> <span class="token function">Person</span><span class="token punctuation">(</span>name<span class="token operator">=</span>person_data<span class="token punctuation">.</span>name<span class="token punctuation">,</span>age<span class="token operator">=</span>person_data<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">CreatePerson</span><span class="token punctuation">(</span>person<span class="token operator">=</span>person<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>graphene<span class="token punctuation">.</span>ObjectType<span class="token punctuation">)</span><span class="token operator">:</span>
  name <span class="token operator">=</span> graphene<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  age <span class="token operator">=</span> graphene<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">MyMutations</span><span class="token punctuation">(</span>graphene<span class="token punctuation">.</span>ObjectType<span class="token punctuation">)</span><span class="token operator">:</span>
  create_person <span class="token operator">=</span> CreatePerson<span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

# We must define a query <span class="token keyword">for</span> our schema
<span class="token keyword">class</span> <span class="token class-name">Query</span><span class="token punctuation">(</span>graphene<span class="token punctuation">.</span>ObjectType<span class="token punctuation">)</span><span class="token operator">:</span>
  person <span class="token operator">=</span> graphene<span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span>
  schema <span class="token operator">=</span> graphene<span class="token punctuation">.</span><span class="token function">Schema</span><span class="token punctuation">(</span>query<span class="token operator">=</span>Query<span class="token punctuation">,</span> mutation<span class="token operator">=</span>MyMutations<span class="token punctuation">)</span>

</code></pre>
<p>同样的逻辑用原先的方法只需如此即可。</p>
<pre><code class="language-python">@bp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/person"</span><span class="token punctuation">)</span>
def <span class="token function">get_person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
  # <span class="token keyword">do</span> <span class="token keyword">get</span> person
  <span class="token keyword">return</span> data

<span class="token keyword">class</span> <span class="token class-name">DataValidator</span><span class="token punctuation">(</span>validator<span class="token punctuation">)</span><span class="token operator">:</span>
  name<span class="token operator">:</span> <span class="token function">constr</span><span class="token punctuation">(</span>min_length<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
  age<span class="token operator">:</span> <span class="token function">conint</span><span class="token punctuation">(</span>gte<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> lte<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>

@bp<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/person_create"</span><span class="token punctuation">)</span>
def <span class="token function">person_create</span><span class="token punctuation">(</span>data<span class="token operator">:</span> DataValidator<span class="token punctuation">)</span><span class="token operator">:</span>
  # <span class="token keyword">do</span> create person
  <span class="token keyword">return</span> data
</code></pre>
<ul>
<li>第一个痛点<strong>原先简单清晰的代码变成了非常冗长的代码。</strong></li>
</ul>
<p>为了提升输入速度，分别尝试了 code generator / snippet 。大量的输入的代价是代码阅读带来较多无效阅读，反而造成了更多的调试困难。</p>
<ul>
<li>第二个痛点<strong>校验层没了。而增加校验层变得比较麻烦。</strong></li>
</ul>
<p>随着代码量上升，相同业务逻辑的物理距离变得比较长，query 和 mutation 需要拆分到两个文件或者一个文件的上部分和下部分。</p>
<ul>
<li>假设你写的是一个商城，从上到下阅读代码会发现一会儿是商品基本信息，一会儿是分类，一会儿是订单，一会儿又是分类，order 的逻辑查看在一个文件的犄角旮旯，修改在另一个文件的犄角旮旯。代码复杂度 +1</li>
<li>假设查询订单和修改订单两个接口查询，查看与修改所查询的业务逻辑是一样的。由于物理距离过于远，则大概率会写两遍这个代码。Same Logic, Write Everywhere</li>
</ul>
<p>我在 tifa 这个 fastapi 项目里尝试了使用这种组织 view 层代码的姿势</p>
<p>这种组织代码的方式可以用 restful 的开发体验，获得 graphql 的效果</p>
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/twocucao/tifa/blob/master/tifa/apps/admin/graphql.py">https://link.zhihu.com/?target=https%3A//github.com/twocucao/tifa/blob/master/tifa/apps/admin/graphql.py</a></p>
<pre><code class="language-python">router <span class="token operator">=</span> <span class="token function">GQLRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">TPost</span><span class="token punctuation">(</span>gr<span class="token punctuation">.</span>ObjectType<span class="token punctuation">)</span><span class="token operator">:</span>
    id <span class="token operator">=</span> gr<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"博客 ID"</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> gr<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>required<span class="token operator">=</span>True<span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">"博客标题"</span><span class="token punctuation">)</span>

@router<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">,</span> output<span class="token operator">=</span>gr<span class="token punctuation">.</span>Boolean<span class="token punctuation">)</span>
def <span class="token function">test_ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token string">""</span>"
    做一个简单的 healthcheck
    <span class="token string">""</span>"
    <span class="token keyword">return</span> True

@router<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token string">"test_exception"</span><span class="token punctuation">,</span> output<span class="token operator">=</span>gr<span class="token punctuation">.</span>Boolean<span class="token punctuation">)</span>
def <span class="token function">test_exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    raise <span class="token function">ApiException</span><span class="token punctuation">(</span><span class="token string">"raise an api exception"</span><span class="token punctuation">)</span>

@router<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token string">"post"</span><span class="token punctuation">,</span> output<span class="token operator">=</span>TPost<span class="token punctuation">)</span>
<span class="token keyword">async</span> def <span class="token function">post_by_id</span><span class="token punctuation">(</span>id<span class="token operator">:</span> gr<span class="token punctuation">.</span>Int<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token string">""</span>"
    文章详情
    <span class="token string">""</span>"
    <span class="token keyword">return</span> <span class="token keyword">await</span> Post<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>

@router<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token string">"posts"</span><span class="token punctuation">,</span> output<span class="token operator">=</span>TPost<span class="token punctuation">)</span>
<span class="token keyword">async</span> def <span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token string">""</span>"
    文章列表
    <span class="token string">""</span>"
    <span class="token keyword">return</span> <span class="token keyword">await</span> Post<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">PPostPagination</span><span class="token punctuation">(</span>gr<span class="token punctuation">.</span>InputObjectType<span class="token punctuation">)</span><span class="token operator">:</span>
    q <span class="token operator">=</span> gr<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"标题，等等"</span><span class="token punctuation">)</span>

@router<span class="token punctuation">.</span><span class="token function">pagination</span><span class="token punctuation">(</span><span class="token string">"posts2"</span><span class="token punctuation">,</span> output<span class="token operator">=</span>TPost<span class="token punctuation">)</span>
def <span class="token function">posts_pagination</span><span class="token punctuation">(</span>params<span class="token operator">:</span> PPostPagination<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string">"items"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token operator">:</span> i<span class="token punctuation">,</span>
                <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"testName"</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">"per_page"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token string">"page"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ParamsCreatePost</span><span class="token punctuation">(</span>gr<span class="token punctuation">.</span>InputObjectType<span class="token punctuation">)</span><span class="token operator">:</span>
    name <span class="token operator">=</span> gr<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>required<span class="token operator">=</span>True<span class="token punctuation">)</span>

@router<span class="token punctuation">.</span><span class="token function">mutation</span><span class="token punctuation">(</span><span class="token string">"create_post"</span><span class="token punctuation">,</span> output<span class="token operator">=</span>TPost<span class="token punctuation">)</span>
<span class="token keyword">async</span> def <span class="token function">create_post</span><span class="token punctuation">(</span>params<span class="token operator">:</span> ParamsCreatePost<span class="token punctuation">)</span><span class="token operator">:</span>
    post <span class="token operator">=</span> <span class="token keyword">await</span> Post<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
        name<span class="token operator">=</span>params<span class="token punctuation">.</span>name
    <span class="token punctuation">)</span>
    <span class="token keyword">await</span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> post
</code></pre>
<p>可以看出，这种组织方式有如下的优点</p>
<ol>
<li>depth 为 1 的 query / mutation 字段为一个 route</li>
<li>简单粗暴的权限可以做在 route 上</li>
<li>与 restful 完全一致的代码组织方式。RESTFul 代码几乎无缝迁移。</li>
</ol>
<h3 id="权限问题"><a class="v-toc-item" href="#权限问题">#</a> 权限问题</h3>
<p>接口的正交性带来的是细粒度的控制，而聚合起来之后，权限则不是很好管控。</p>
<p>一个请求打过来包含了越权和非越权的请求。服务端需要如何判断？</p>
<blockquote>
<p><strong>保大保小？</strong></p>
</blockquote>
<p>在 Restful 里依据路由可以做简单粗暴的首次鉴权。并且程序设计之初就会考虑到权限问题。</p>
<p>在我 18 年研究 graphql 的时候，几乎就没有关于权限的最佳实践…</p>
<p>当然，graphql 已经流行了好久了，现在也有一些成熟的解决方案了。</p>
<h3 id="版本更迭"><a class="v-toc-item" href="#版本更迭">#</a> 版本更迭</h3>
<p>随着业务的变更，往往需要新增 / 废弃一些接口。</p>
<p>在原先 RESTFul 的实践下</p>
<ol>
<li>接口新增只需要考虑 v2 版本</li>
<li>接口移除通过监控接口的请求次数来解决这个问题。</li>
</ol>
<p>graphql 社区推荐的是不废弃接口，只做兼容。尝试遵循了 graphql 社区的意见。最后还是改回和 restful 类似的方案了。</p>
<p>还有另外一些痛点，以往想把一些性能敏感的接口拆出来的时候，一般可以</p>
<ol>
<li>运维手段：直接起另一个服务，然后在网关那边直接转发请求即可。</li>
<li>非运维手段：请求依旧由现在的服务接收，然后由再次发起请求到新服务上。</li>
</ol>
<p>如果采用 graphql 之后，就只能用第二种方案了。</p>
<h3 id="required-vs-nullable-vs-blank"><a class="v-toc-item" href="#required-vs-nullable-vs-blank">#</a> required vs nullable vs blank</h3>
<pre><code>  not required 表示这个字段不是必须的，可传可不传。
  required 表示这个字段是必须的，但可为 null/none, 也可不为。
  not nullable 表示这个字段是必须的，但是不能为 null/none
  nullable 表示这个字段是必须的，但可为 null/none, 也可不为。
  not blank 表示这个字段是可为空的
  对于字符串，则必须要不为 &quot;&quot;
  对于列表，则必须要存在至少一个 item
</code></pre>
<p>举个例子来说明，如果要表示如下的响应内容</p>
<p>订单没有支付状态，就没有支付方式，即不应该有支付方式这个字段。</p>
<pre><code>
# 未支付订单
{
  &quot;status&quot;: &quot;NOT_PAID&quot;
}
# 已支付订单
{
  &quot;status&quot;: &quot;PAID&quot;,
  &quot;pay_method&quot;: &quot;WECHAT&quot;
}
</code></pre>
<blockquote>
<p>这样的接口是<strong>无法表示</strong>, 如果有这个字段，就展示在界面上，没有这个字段就不展示在界面上的</p>
</blockquote>
<p>graphql 没法做到未支付订单无 pay_method 这种情况，在响应体里 pay_method 总是为 null</p>
<pre><code># 未支付订单
{
  &quot;status&quot;: &quot;NOT_PAID&quot;
  &quot;pay_method&quot;: null
}
</code></pre>
<p>当然，如果硬是要做的话，只能借助 UNION[PaidOrder,NotPaidOrder] 来实现。使用 Union 本身就造成了序列化的成本急剧上升。</p>
<h3 id="服务端缓存"><a class="v-toc-item" href="#服务端缓存">#</a> 服务端缓存</h3>
<p>要查什么，往往不可知（无法预知查询语句），随前端来定。不知道该怎么缓存响应内容。</p>
<p>以往通过 URI 定位资源，Http 协议无状态，非常容易实现对应用层透明的缓存。</p>
<p>而 GraphQL 重新定义了资源的定位方式，设计缓存的时候往往不知道该怎么设计。</p>
<h3 id="嵌套式-api"><a class="v-toc-item" href="#嵌套式-api">#</a> 嵌套式 API</h3>
<p>在 graphql 的场景下，重写 resolver 是一个非常的影响是未知的。</p>
<p>因为，你不知道有多少个 query 用了这个 field, 为了知道这个问题，你还得打点知道有多少个场景的 query 用到了这个字段。</p>
<p>现实生活中情况可能复杂一些。</p>
<p>这个例子旨在说明，存在一些改动的心智负担比较严重。</p>
<p>比如，前端变动，接口层次，所有商家级别的数据落到店铺级别。</p>
<p>这个例子正确的解法是联合前端一起升级到 V2</p>
<h3 id="n1-问题"><a class="v-toc-item" href="#n1-问题">#</a> N+1 问题</h3>
<p>有的时候需要看情况来解决不同的 N+1 问题，也是比较迷惑的…</p>
<p>客户端不见得会按照你的预期来查询。</p>
<p>这就意味着，同一个结构，有的时候要依据情况 A 来重写查询，有的时候要依据情况 B 来重写查询。</p>
<h3 id="为名所困"><a class="v-toc-item" href="#为名所困">#</a> 为名所困</h3>
<p>项目写了半年，由于 graphene 玩的不熟，我（后端）一直在各种起名困难症中度过。</p>
<p>明明业务流程都差不多，但最后结果全是在改各种各样 ObjectType 的前缀。</p>
<h2 id="0x06-结论"><a class="v-toc-item" href="#0x06-结论">#</a> 0x06 结论</h2>
<p><strong>GraphQL 这一套玩的熟悉的话，效率确实非常高。(前提是团队里面的人能玩的熟悉)</strong></p>
<p>如果团队里面缺少全栈人才的话，在很多地方的比较难推进的动。graphql 用起来确实爽，特别是前端。</p>
<p>由于是较新的技术，<strong>引入进来算上折腾出最佳实践的成本和折腾过程中诞生的技术债，收益可能并没有想象的那么大。</strong></p>
<p>restful 其实也并不是做不到不少 graphql 能做到的东西。schema 生成工具其实蛮多的.</p>
<blockquote>
<p>不过，搞技术嘛，<strong>折腾不止 生命不息</strong>, 说不一定这次折腾收益就很高了呢？</p>
</blockquote>
<h2 id="0xee-参考链接"><a class="v-toc-item" href="#0xee-参考链接">#</a> 0xEE 参考链接</h2>
<ul>
<li>Photo by <a href="https://link.zhihu.com/?target=https%3A//unsplash.com/%40sigmund%3Futm_source%3Dunsplash%26utm_medium%3Dreferral%26utm_content%3DcreditCopyText">Sigmund</a> on <a href="https://link.zhihu.com/?target=https%3A//unsplash.com/s/photos/compute%3Futm_source%3Dunsplash%26utm_medium%3Dreferral%26utm_content%3DcreditCopyText">Unsplash</a></li>
<li><a href="https://link.zhihu.com/?target=https%3A//github.com/twocucao/tifa">「FastAPI 脚手架」</a></li>
<li><a href="https://link.zhihu.com/?target=https%3A//graphene-python.org/">https://link.zhihu.com/?target=https%3A//graphene-python.org/</a></li>
<li><a href="https://link.zhihu.com/?target=https%3A//graphql.org/">https://link.zhihu.com/?target=https%3A//graphql.org/</a></li>
<li><a href="https://link.zhihu.com/?target=https%3A//www.apollographql.com/docs/react/data/operation-best-practices/">https://link.zhihu.com/?target=https%3A//www.apollographql.com/docs/react/data/operation-best-practices/</a></li>
<li><a href="https://link.zhihu.com/?target=https%3A//graphql-code-generator.com/docs/plugins/typescript">https://link.zhihu.com/?target=https%3A//graphql-code-generator.com/docs/plugins/typescript</a></li>
</ul>
</div></div><div><ul class="v-article-toc">
<li><a href="#%E4%B9%9F%E8%81%8A%E8%81%8A-restful-vs-graphql">也聊聊 RESTful vs GraphQL</a>
<ul>
<li><a href="#0x00-%E5%89%8D%E8%A8%80">0x00 前言</a></li>
<li><a href="#0x01-%E6%B5%81%E6%B0%B4%E7%9A%84%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88%E9%93%81%E6%89%93%E7%9A%84%E9%9C%80%E6%B1%82">0x01 流水的技术方案，铁打的需求。</a></li>
<li><a href="#0x02-restful-%E7%9A%84%E7%BC%BA%E7%82%B9">0x02 RESTful 的缺点</a>
<ul>
<li><a href="#%E8%AF%AD%E4%B9%89%E4%B8%8D%E6%98%8E%E7%A1%AE">语义不明确</a></li>
<li><a href="#%E5%BE%97%E5%88%B0%E5%8D%B3%E6%98%AF%E5%A4%B1%E5%8E%BB-gets-loss">得到即是失去 - Get’s loss</a></li>
<li><a href="#%E6%9C%AA%E5%BE%88%E5%A5%BD%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98">未很好解决的问题</a></li>
</ul>
</li>
<li><a href="#0x03-graphql-%E6%98%AF%E6%96%B0%E7%9A%84%E9%A2%A0%E8%A6%86%E8%80%85%E4%B9%88">0x03 GraphQL 是新的颠覆者么？</a></li>
<li><a href="#0x04-graphql-%E7%BB%99%E6%B6%88%E8%B4%B9%E7%AB%AF%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%A5%BD%E5%A4%84">0x04 GraphQL 给消费端带来的好处</a></li>
<li><a href="#0x05-graphql-%E7%BB%99%E7%94%9F%E4%BA%A7%E7%AB%AF%E5%B8%A6%E6%9D%A5%E7%9A%84%E6%8C%91%E6%88%98">0x05 GraphQL 给生产端带来的挑战</a>
<ul>
<li><a href="#view-%E5%B1%82%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87%E5%89%A7%E5%8F%98">View 层代码组织剧变</a></li>
<li><a href="#%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98">权限问题</a></li>
<li><a href="#%E7%89%88%E6%9C%AC%E6%9B%B4%E8%BF%AD">版本更迭</a></li>
<li><a href="#required-vs-nullable-vs-blank">required vs nullable vs blank</a></li>
<li><a href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%BC%93%E5%AD%98">服务端缓存</a></li>
<li><a href="#%E5%B5%8C%E5%A5%97%E5%BC%8F-api">嵌套式 API</a></li>
<li><a href="#n1-%E9%97%AE%E9%A2%98">N+1 问题</a></li>
<li><a href="#%E4%B8%BA%E5%90%8D%E6%89%80%E5%9B%B0">为名所困</a></li>
</ul>
</li>
<li><a href="#0x06-%E7%BB%93%E8%AE%BA">0x06 结论</a></li>
<li><a href="#0xee-%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5">0xEE 参考链接</a></li>
</ul>
</li>
</ul>
</div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"tags":["业务系统"],"path":"20210627_RESTful_vs_GraphQL.md","title":"也聊聊 RESTful vs GraphQL","slug":"也聊聊 RESTful vs GraphQL","date":"2021-06-20","category":"系统设计","lastMod":"2021-06-20","description":"系统设计","thumbnail":"","content":"\u003ch1 id=\"也聊聊-restful-vs-graphql\"\u003e\u003ca class=\"v-toc-item\" href=\"#也聊聊-restful-vs-graphql\"\u003e#\u003c/a\u003e 也聊聊 RESTful vs GraphQL\u003c/h1\u003e\n\u003ch2 id=\"0x00-前言\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x00-前言\"\u003e#\u003c/a\u003e 0x00 前言\u003c/h2\u003e\n\u003cp\u003e本文最早行文于 2018 年中，那时 GraphQL 的生态尚未成熟，也缺乏社区总结的一些经验。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e较早入了坑，回首百年身\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e2021 年中，复盘一下 GraphQL 的一些使用经验。\u003c/p\u003e\n\u003cp\u003e名词约定\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e接口生产端 / 服务端 下面统一称「生产端」\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e接口消费端 / 客户端 下面统一称「消费端」\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"0x01-流水的技术方案铁打的需求\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x01-流水的技术方案铁打的需求\"\u003e#\u003c/a\u003e 0x01 流水的技术方案，铁打的需求。\u003c/h2\u003e\n\u003cp\u003e年幼时看笑傲江湖，华山派两派居然为了剑宗和气宗争个你死我活。\u003c/p\u003e\n\u003cp\u003e觉得甚是幼稚。\u003c/p\u003e\n\u003cp\u003e年纪渐大之后发现社会处处充满着这种「谁好」的争论。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e剑宗 or 气宗\u003c/li\u003e\n\u003cli\u003e自然美 or 人造美\u003c/li\u003e\n\u003cli\u003eJava or Python or Golang\u003c/li\u003e\n\u003cli\u003eEditor or IDE\u003c/li\u003e\n\u003cli\u003eRest or GraphQL\u003c/li\u003e\n\u003cli\u003e单体应用 or 微服务\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e剑招是死的，人是活的。\u003c/p\u003e\n\u003cp\u003e当讨论问题的时候，下面两个问题意义可能并不是很大。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e用剑宗初学者和气宗高手比，或者相反，这个完全没有多大意义？\u003c/li\u003e\n\u003cli\u003e用剑宗初学者和气宗初学者比孰强孰弱，这个有一点意义，但意义也不是很大。菜鸡互啄。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eGraphQL 作为挑战者，下面几个问题是很有意义的。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e现有方案存在哪些问题？\u003c/li\u003e\n\u003cli\u003eGraphQL 相比于原先成熟稳定的方案\u003c/li\u003e\n\u003cli\u003e新方案解决了哪些原先没有解决的问题。\u003c/li\u003e\n\u003cli\u003e新方案更低成本解决了哪些问题。\u003c/li\u003e\n\u003cli\u003e现有的痛点是否存在一些新老方案都无法解决的问题。\u003c/li\u003e\n\u003cli\u003e有无前车之鉴，有无社区最佳实践。\u003c/li\u003e\n\u003cli\u003e迁移成本和学习成本是多少。\u003c/li\u003e\n\u003cli\u003e回滚成本多少。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"0x02-restful-的缺点\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x02-restful-的缺点\"\u003e#\u003c/a\u003e 0x02 RESTful 的缺点\u003c/h2\u003e\n\u003cp\u003eRESTful 有很多接口上最佳实践，但生搬硬套就会使得接口比较诡异。\u003c/p\u003e\n\u003cp\u003e这里只说生搬硬套 RESTFul 的带来的缺点，对于大部分公司来说，这些缺点远远抵不上带来的优点。\u003c/p\u003e\n\u003ch3 id=\"语义不明确\"\u003e\u003ca class=\"v-toc-item\" href=\"#语义不明确\"\u003e#\u003c/a\u003e 语义不明确\u003c/h3\u003e\n\u003cp\u003e比如，业务具备一定复杂性的时候，语义容易不明确。\u003c/p\u003e\n\u003cp\u003e预览订单和下单两个接口，如果遵循如下的标准\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e接口路径使用名词而非动词\u003c/li\u003e\n\u003cli\u003eGET 不修改，POST/PUT/DELETE 修改状态\u003c/li\u003e\n\u003cli\u003e使用子字段来表述关系，查询订单 GET /shop/711/orders/\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e严格遵循 RESTful 的话，接口就会成这个样子\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token constant\"\u003eGET\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003eshops\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eorder  \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e   \u003cspan class=\"token string\"\u003e\"products\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token constant\"\u003ePUT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003eshops\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eorder  \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e   \u003cspan class=\"token string\"\u003e\"products\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e反正我是看不出来这是一坨啥玩意的，至于如果你硬性规范 PUT order 就是创建订单，就会出现接下来两个接口完全不知道该怎么写\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    支付订单 （用 patch /shop/1/order)\n    取消订单 （用 delete 方法，也没有 delete 呀）\n    退款订单\n    部分退款订单\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e产品上，用户删除了一台机器，那就是删除了一台机器？这里是软删。\u003c/li\u003e\n\u003cli\u003e产品上，管理员删除了一台机器，那就是删除了一台机器？机器记录还在的。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e所以，采用的是 DELETE /machine/1\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e剑招是死的，人是活的。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e不严格遵循 RESTful 的时候可以这么写。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token constant\"\u003ePOST\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003epreview_order\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token string\"\u003e\"shop_id\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e123\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token string\"\u003e\"products\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token constant\"\u003ePOST\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003emake_order\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token string\"\u003e\"shop_id\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e123\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token string\"\u003e\"products\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token constant\"\u003ePOST\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003epay_order\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token string\"\u003e\"order_id\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"202012001231237\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token string\"\u003e\"balance\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"20.20\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token constant\"\u003ePOST\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003ecancel_order\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token string\"\u003e\"order_id\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"202012001231237\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e至于第三点的子字段表述关系，是一个典型的反面教材\u003c/p\u003e\n\u003cp\u003e引用 Python 之禅来表达\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eFlat is better than nested. 扁平优于嵌套\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"得到即是失去-gets-loss\"\u003e\u003ca class=\"v-toc-item\" href=\"#得到即是失去-gets-loss\"\u003e#\u003c/a\u003e 得到即是失去 - Get’s loss\u003c/h3\u003e\n\u003cp\u003eGET 让问题变得复杂\u003c/p\u003e\n\u003cp\u003eRest 时代一个有代表性的问题就是如何在 GET 方法里处理以下四个问题\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e过滤 filter\u003c/li\u003e\n\u003cli\u003e排序 sort\u003c/li\u003e\n\u003cli\u003e字段裁剪 field selections\u003c/li\u003e\n\u003cli\u003e分页 pagination\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e为了解决这个问题，一个稍微复杂的查询接口就成了如下的样子\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token constant\"\u003eGET\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003ecars\u003cspan class=\"token operator\"\u003e?\u003c/span\u003eseats\u003cspan class=\"token operator\"\u003e\u0026lt;=\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003esort\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003emanufactorer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003emodel\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003efields\u003cspan class=\"token operator\"\u003e=\u003c/span\u003emanufacturer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003eid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ecolor\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003epage\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003eper_page\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e10\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e可阅读性较差\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e而如果这么写，则前端无需把原先的 queryparams 转化成逗号结尾的字符串，后端也需要跟着解析并且转成自己想要的格式\u003c/p\u003e\n\u003cp\u003e如果按照如下的写法，后端则可以直接使用 json 标准库里的数据类型。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token constant\"\u003ePOST\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003ecars\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token string\"\u003e\"filters\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"seat__lt\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"token string\"\u003e\"sort\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"-manufactorer\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"+model\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token string\"\u003e\"fields\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"manufacturer\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"model\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"color\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token string\"\u003e\"pagination\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"page\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"per_page\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e10\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"未很好解决的问题\"\u003e\u003ca class=\"v-toc-item\" href=\"#未很好解决的问题\"\u003e#\u003c/a\u003e 未很好解决的问题\u003c/h3\u003e\n\u003cp\u003eRESTFul 接口提倡的是细粒度、正交性。\u003c/p\u003e\n\u003cp\u003e这样的接口是为了更加方便的复用多个接口来组成页面，但是并非没有问题。\u003c/p\u003e\n\u003cp\u003e细粒度和正交性意味着接口是 building block, 而 building block 组合起来是交给前端来做的。 这意味着前端为了组合多个资源，则需要发起多次请求。\u003c/p\u003e\n\u003cp\u003e这首先是带来了的网络开销成本 (HTTP 2 解决了首部开销、多路复用等 HTTP 1.1 面临的问题，还做到了完全向后兼容。) 和响应内容拼装成本\u003c/p\u003e\n\u003cp\u003e其次，前端往往会抱怨\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e服务端这个接口字段少了，后端往往会复用序列器，直接把太多前端用不到的数据一并返回。\u003c/li\u003e\n\u003cli\u003e服务端这个接口字段太多，需要慢慢找 diff, 于是会开始抱怨文档问题。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e于是大家采用了 swagger/openapi 的配套解决方案。同时带来了，文档的缺失和滞后\u003c/p\u003e\n\u003ch2 id=\"0x03-graphql-是新的颠覆者么\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x03-graphql-是新的颠覆者么\"\u003e#\u003c/a\u003e 0x03 GraphQL 是新的颠覆者么？\u003c/h2\u003e\n\u003cp\u003eGraphQL 也不是什么革命性的产品，不过是一种新的开 Web 接口的方式罢了。\u003c/p\u003e\n\u003cp\u003e而请求接口提交的参数也变成了包含参数的一种查询语言。\u003c/p\u003e\n\u003cp\u003e官方宣传的 GraphQL 搞好了，只需如此：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-graphql\"\u003e# Step1\\\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e 描述你的数据\ntype Project \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e String\n  tagline\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e String\n  contributors\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eUser\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n# Step2\\\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e 请求所需数据。\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eproject\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ename\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"GraphQL\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    tagline\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n# Step3\\\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e 拿到所需数据。\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token string\"\u003e\"project\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token string\"\u003e\"tagline\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"A query language for APIs\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e嗯，是不是和 SQL 看起来有点像？当然咯，都是查询语言 (QL) 嘛。\u003c/p\u003e\n\u003ch2 id=\"0x04-graphql-给消费端带来的好处\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x04-graphql-给消费端带来的好处\"\u003e#\u003c/a\u003e 0x04 GraphQL 给消费端带来的好处\u003c/h2\u003e\n\u003cp\u003eGraphQL 的好处，自然是接口消费端写起来就是一个字，爽。\u003c/p\u003e\n\u003cp\u003e比如我们使用 Github 的 API 做一个简单的查询\u003cbr\u003e\n地址如下 \u003ca href=\"https://link.zhihu.com/?target=https%3A//developer.github.com/v4/explorer/\"\u003ehttps://link.zhihu.com/?target=https%3A//developer.github.com/v4/explorer/\u003c/a\u003e\u003cbr\u003e\n查询如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-graphql\"\u003equery \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  viewer \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    login\n    bio\n    \u003cspan class=\"token function\"\u003erepositories\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003efirst\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e orderBy\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e field\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eSTARGAZERS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e direction\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eDESC\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      nodes \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        nameWithOwner\n        viewerHasStarred\n        watchers \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n          totalCount\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        stargazers \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n          totalCount\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      totalCount\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e结果如下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token string\"\u003e\"data\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"viewer\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token string\"\u003e\"login\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"twocucao\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token string\"\u003e\"bio\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"FullStack Pythonist In Shanghai\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token string\"\u003e\"repositories\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"nodes\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"nameWithOwner\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"twocucao/YaDjangoBlog\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"viewerHasStarred\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"watchers\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"token string\"\u003e\"totalCount\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e12\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"stargazers\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"token string\"\u003e\"totalCount\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e326\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"nameWithOwner\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"twocucao/danmu.fm\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"viewerHasStarred\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"watchers\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"token string\"\u003e\"totalCount\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e23\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"stargazers\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"token string\"\u003e\"totalCount\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e316\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"nameWithOwner\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"twocucao/YaVueBlog\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"viewerHasStarred\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"watchers\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"token string\"\u003e\"totalCount\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e8\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"stargazers\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"token string\"\u003e\"totalCount\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e141\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"nameWithOwner\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"twocucao/danmu\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"viewerHasStarred\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"watchers\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"token string\"\u003e\"totalCount\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"stargazers\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"token string\"\u003e\"totalCount\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e69\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"nameWithOwner\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"twocucao/silverhand\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"viewerHasStarred\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"watchers\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"token string\"\u003e\"totalCount\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e7\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"stargazers\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"token string\"\u003e\"totalCount\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e60\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"nameWithOwner\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"twocucao/ChortHotKey\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"viewerHasStarred\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"watchers\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"token string\"\u003e\"totalCount\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e7\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e\"stargazers\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"token string\"\u003e\"totalCount\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e32\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n          \u003cspan class=\"token comment\"\u003e// ......\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"totalCount\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e155\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如果你说，我还要看看这个 repo 的主要语言，那么增加一行查询即可。如图。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://pic2.zhimg.com/v2-997f49fd55e972c37d458a2aef6fb4dd_b.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://pic2.zhimg.com/80/v2-997f49fd55e972c37d458a2aef6fb4dd_1440w.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e是不是很方便？前端基本对着 Schemas 里面的 query 查询完毕就完毕了。\u003c/p\u003e\n\u003cp\u003e查询这么搞可以，增删改查之类的操作呢？\u003c/p\u003e\n\u003cp\u003eGraphQL 里面还有 Mutation 可以帮你解决这个问题，在后端定义完 Mutation , 前端在 Mutation 里面可以直接传参。\u003c/p\u003e\n\u003cp\u003e甚至，\u003cstrong\u003e后端开出接口时，可以依据请求和响应生成对应的 typescript 代码，然后享受代码补全的快感。\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e极大利好前端\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e有人说, graphql 不就最后生成了 schema 嘛\u003c/p\u003e\n\u003cp\u003e可不要小瞧了生成全接口的 schema, 用它可以做很多东西\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e便捷的文档功能,\u003c/strong\u003e 接口列表以及入参的初步生成。便于快速调接口，比如我写了一个接口，发布到测试环境，接着点击一个按扭直接同步到 insomnia 里。点击运行即可调试。\u003cstrong\u003e「甚至可以做简单的接口自动化测试」\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e可以生成 typescript/javascript 代码,\u003c/strong\u003e 让前端享受到直接在代码里补全的快感。\u003c/li\u003e\n\u003cli\u003e比对两个版本之间的 schema 可以直接得出接口 schema 上，后端有没有做好兼容。如果不行, 则 CI 无法跑过\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"https://pic1.zhimg.com/v2-c7a593ada4bc7fc78b20c3d18b5e1850_b.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"0x05-graphql-给生产端带来的挑战\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x05-graphql-给生产端带来的挑战\"\u003e#\u003c/a\u003e 0x05 GraphQL 给生产端带来的挑战\u003c/h2\u003e\n\u003cp\u003e消费端（前端）爽了，是否意味着生产端（服务端）会爽呢？\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e并不是\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e对于前端来说，如果要消费 graphql api, 相对容易一些。 只需将原先的 api 层改为 graphqlfetch 即可\u003c/li\u003e\n\u003cli\u003e对于后端来说，如果要生产 graphql api, 则麻烦了不少。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e下文我会以 graphene 这个 graphql python 库来说明带来的一些挑战\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://link.zhihu.com/?target=https%3A//github.com/graphql-python/graphene\"\u003ehttps://link.zhihu.com/?target=https%3A//github.com/graphql-python/graphene\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e有的挑战是和 graphql 相关的，有的挑战则是来自 graphene 库，或许其他库有更好的解决方案。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意！痛点背后的原因，大多是 graphql 以及配套库玩的不熟。\u003cstrong\u003e而不一定是 RESTFUL 不存在这些问题\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e大致有如下挑战\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eView 层代码组织剧变\u003c/li\u003e\n\u003cli\u003e权限问题\u003c/li\u003e\n\u003cli\u003e版本更迭\u003c/li\u003e\n\u003cli\u003erequired vs nullable vs blank\u003c/li\u003e\n\u003cli\u003e服务端缓存\u003c/li\u003e\n\u003cli\u003e嵌套式 API\u003c/li\u003e\n\u003cli\u003eN+1 问题\u003c/li\u003e\n\u003cli\u003e为名所困\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"view-层代码组织剧变\"\u003e\u003ca class=\"v-toc-item\" href=\"#view-层代码组织剧变\"\u003e#\u003c/a\u003e View 层代码组织剧变\u003c/h3\u003e\n\u003cp\u003e以简单的查询和创建两个接口为例。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e graphene\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ePersonInput\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egraphene\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eInputObjectType\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n  name \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e graphene\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequired\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTrue\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  age \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e graphene\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eInt\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequired\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTrue\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCreatePerson\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egraphene\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eMutation\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eArguments\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    person_data \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ePersonInput\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequired\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTrue\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    person \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e graphene\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ePerson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n  def \u003cspan class=\"token function\"\u003emutate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eroot\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e info\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e person_data\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eNone\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    person \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ePerson\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ename\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eperson_data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ename\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003eage\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eperson_data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eage\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003eCreatePerson\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eperson\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eperson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ePerson\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egraphene\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eObjectType\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n  name \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e graphene\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  age \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e graphene\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eInt\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMyMutations\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egraphene\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eObjectType\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n  create_person \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e CreatePerson\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n# We must define a query \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e our schema\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eQuery\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egraphene\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eObjectType\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n  person \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e graphene\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ePerson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  schema \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e graphene\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eSchema\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003equery\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eQuery\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e mutation\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eMyMutations\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e同样的逻辑用原先的方法只需如此即可。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e@bp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/person\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\ndef \u003cspan class=\"token function\"\u003eget_person\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n  # \u003cspan class=\"token keyword\"\u003edo\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eget\u003c/span\u003e person\n  \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e data\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDataValidator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003evalidator\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n  name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token function\"\u003econstr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emin_length\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e max_length\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  age\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token function\"\u003econint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egte\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e lte\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e200\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n@bp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epost\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/person_create\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\ndef \u003cspan class=\"token function\"\u003eperson_create\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e DataValidator\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n  # \u003cspan class=\"token keyword\"\u003edo\u003c/span\u003e create person\n  \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e data\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e第一个痛点\u003cstrong\u003e原先简单清晰的代码变成了非常冗长的代码。\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e为了提升输入速度，分别尝试了 code generator / snippet 。大量的输入的代价是代码阅读带来较多无效阅读，反而造成了更多的调试困难。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e第二个痛点\u003cstrong\u003e校验层没了。而增加校验层变得比较麻烦。\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e随着代码量上升，相同业务逻辑的物理距离变得比较长，query 和 mutation 需要拆分到两个文件或者一个文件的上部分和下部分。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e假设你写的是一个商城，从上到下阅读代码会发现一会儿是商品基本信息，一会儿是分类，一会儿是订单，一会儿又是分类，order 的逻辑查看在一个文件的犄角旮旯，修改在另一个文件的犄角旮旯。代码复杂度 +1\u003c/li\u003e\n\u003cli\u003e假设查询订单和修改订单两个接口查询，查看与修改所查询的业务逻辑是一样的。由于物理距离过于远，则大概率会写两遍这个代码。Same Logic, Write Everywhere\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e我在 tifa 这个 fastapi 项目里尝试了使用这种组织 view 层代码的姿势\u003c/p\u003e\n\u003cp\u003e这种组织代码的方式可以用 restful 的开发体验，获得 graphql 的效果\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://link.zhihu.com/?target=https%3A//github.com/twocucao/tifa/blob/master/tifa/apps/admin/graphql.py\"\u003ehttps://link.zhihu.com/?target=https%3A//github.com/twocucao/tifa/blob/master/tifa/apps/admin/graphql.py\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003erouter \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eGQLRouter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eTPost\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eObjectType\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e gr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eInt\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edescription\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"博客 ID\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    name \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e gr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequired\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTrue\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e description\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"博客标题\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n@router\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eitem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"ok\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e output\u003cspan class=\"token operator\"\u003e=\u003c/span\u003egr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eBoolean\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\ndef \u003cspan class=\"token function\"\u003etest_ok\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n    做一个简单的 healthcheck\n    \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e True\n\n@router\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eitem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"test_exception\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e output\u003cspan class=\"token operator\"\u003e=\u003c/span\u003egr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eBoolean\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\ndef \u003cspan class=\"token function\"\u003etest_exception\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    raise \u003cspan class=\"token function\"\u003eApiException\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"raise an api exception\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n@router\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eitem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"post\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e output\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTPost\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e def \u003cspan class=\"token function\"\u003epost_by_id\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eid\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e gr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eInt\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n    文章详情\n    \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e Post\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eid\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n@router\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elist\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"posts\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e output\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTPost\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e def \u003cspan class=\"token function\"\u003eposts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n    文章列表\n    \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e Post\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eall\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ePPostPagination\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eInputObjectType\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    q \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e gr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edescription\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"标题，等等\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n@router\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epagination\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"posts2\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e output\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTPost\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\ndef \u003cspan class=\"token function\"\u003eposts_pagination\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eparams\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e PPostPagination\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"items\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"token string\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e i\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"token string\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"testName\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token function\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"per_page\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"page\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eParamsCreatePost\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eInputObjectType\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    name \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e gr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequired\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTrue\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n@router\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emutation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"create_post\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e output\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTPost\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e def \u003cspan class=\"token function\"\u003ecreate_post\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eparams\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e ParamsCreatePost\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    post \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e Post\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eadd\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n        name\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eparams\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ename\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e db\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esession\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecommit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e post\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e可以看出，这种组织方式有如下的优点\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003edepth 为 1 的 query / mutation 字段为一个 route\u003c/li\u003e\n\u003cli\u003e简单粗暴的权限可以做在 route 上\u003c/li\u003e\n\u003cli\u003e与 restful 完全一致的代码组织方式。RESTFul 代码几乎无缝迁移。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"权限问题\"\u003e\u003ca class=\"v-toc-item\" href=\"#权限问题\"\u003e#\u003c/a\u003e 权限问题\u003c/h3\u003e\n\u003cp\u003e接口的正交性带来的是细粒度的控制，而聚合起来之后，权限则不是很好管控。\u003c/p\u003e\n\u003cp\u003e一个请求打过来包含了越权和非越权的请求。服务端需要如何判断？\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e保大保小？\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e在 Restful 里依据路由可以做简单粗暴的首次鉴权。并且程序设计之初就会考虑到权限问题。\u003c/p\u003e\n\u003cp\u003e在我 18 年研究 graphql 的时候，几乎就没有关于权限的最佳实践…\u003c/p\u003e\n\u003cp\u003e当然，graphql 已经流行了好久了，现在也有一些成熟的解决方案了。\u003c/p\u003e\n\u003ch3 id=\"版本更迭\"\u003e\u003ca class=\"v-toc-item\" href=\"#版本更迭\"\u003e#\u003c/a\u003e 版本更迭\u003c/h3\u003e\n\u003cp\u003e随着业务的变更，往往需要新增 / 废弃一些接口。\u003c/p\u003e\n\u003cp\u003e在原先 RESTFul 的实践下\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e接口新增只需要考虑 v2 版本\u003c/li\u003e\n\u003cli\u003e接口移除通过监控接口的请求次数来解决这个问题。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003egraphql 社区推荐的是不废弃接口，只做兼容。尝试遵循了 graphql 社区的意见。最后还是改回和 restful 类似的方案了。\u003c/p\u003e\n\u003cp\u003e还有另外一些痛点，以往想把一些性能敏感的接口拆出来的时候，一般可以\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e运维手段：直接起另一个服务，然后在网关那边直接转发请求即可。\u003c/li\u003e\n\u003cli\u003e非运维手段：请求依旧由现在的服务接收，然后由再次发起请求到新服务上。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e如果采用 graphql 之后，就只能用第二种方案了。\u003c/p\u003e\n\u003ch3 id=\"required-vs-nullable-vs-blank\"\u003e\u003ca class=\"v-toc-item\" href=\"#required-vs-nullable-vs-blank\"\u003e#\u003c/a\u003e required vs nullable vs blank\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003e  not required 表示这个字段不是必须的，可传可不传。\n  required 表示这个字段是必须的，但可为 null/none, 也可不为。\n  not nullable 表示这个字段是必须的，但是不能为 null/none\n  nullable 表示这个字段是必须的，但可为 null/none, 也可不为。\n  not blank 表示这个字段是可为空的\n  对于字符串，则必须要不为 \u0026quot;\u0026quot;\n  对于列表，则必须要存在至少一个 item\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e举个例子来说明，如果要表示如下的响应内容\u003c/p\u003e\n\u003cp\u003e订单没有支付状态，就没有支付方式，即不应该有支付方式这个字段。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\n# 未支付订单\n{\n  \u0026quot;status\u0026quot;: \u0026quot;NOT_PAID\u0026quot;\n}\n# 已支付订单\n{\n  \u0026quot;status\u0026quot;: \u0026quot;PAID\u0026quot;,\n  \u0026quot;pay_method\u0026quot;: \u0026quot;WECHAT\u0026quot;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e这样的接口是\u003cstrong\u003e无法表示\u003c/strong\u003e, 如果有这个字段，就展示在界面上，没有这个字段就不展示在界面上的\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003egraphql 没法做到未支付订单无 pay_method 这种情况，在响应体里 pay_method 总是为 null\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# 未支付订单\n{\n  \u0026quot;status\u0026quot;: \u0026quot;NOT_PAID\u0026quot;\n  \u0026quot;pay_method\u0026quot;: null\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e当然，如果硬是要做的话，只能借助 UNION[PaidOrder,NotPaidOrder] 来实现。使用 Union 本身就造成了序列化的成本急剧上升。\u003c/p\u003e\n\u003ch3 id=\"服务端缓存\"\u003e\u003ca class=\"v-toc-item\" href=\"#服务端缓存\"\u003e#\u003c/a\u003e 服务端缓存\u003c/h3\u003e\n\u003cp\u003e要查什么，往往不可知（无法预知查询语句），随前端来定。不知道该怎么缓存响应内容。\u003c/p\u003e\n\u003cp\u003e以往通过 URI 定位资源，Http 协议无状态，非常容易实现对应用层透明的缓存。\u003c/p\u003e\n\u003cp\u003e而 GraphQL 重新定义了资源的定位方式，设计缓存的时候往往不知道该怎么设计。\u003c/p\u003e\n\u003ch3 id=\"嵌套式-api\"\u003e\u003ca class=\"v-toc-item\" href=\"#嵌套式-api\"\u003e#\u003c/a\u003e 嵌套式 API\u003c/h3\u003e\n\u003cp\u003e在 graphql 的场景下，重写 resolver 是一个非常的影响是未知的。\u003c/p\u003e\n\u003cp\u003e因为，你不知道有多少个 query 用了这个 field, 为了知道这个问题，你还得打点知道有多少个场景的 query 用到了这个字段。\u003c/p\u003e\n\u003cp\u003e现实生活中情况可能复杂一些。\u003c/p\u003e\n\u003cp\u003e这个例子旨在说明，存在一些改动的心智负担比较严重。\u003c/p\u003e\n\u003cp\u003e比如，前端变动，接口层次，所有商家级别的数据落到店铺级别。\u003c/p\u003e\n\u003cp\u003e这个例子正确的解法是联合前端一起升级到 V2\u003c/p\u003e\n\u003ch3 id=\"n1-问题\"\u003e\u003ca class=\"v-toc-item\" href=\"#n1-问题\"\u003e#\u003c/a\u003e N+1 问题\u003c/h3\u003e\n\u003cp\u003e有的时候需要看情况来解决不同的 N+1 问题，也是比较迷惑的…\u003c/p\u003e\n\u003cp\u003e客户端不见得会按照你的预期来查询。\u003c/p\u003e\n\u003cp\u003e这就意味着，同一个结构，有的时候要依据情况 A 来重写查询，有的时候要依据情况 B 来重写查询。\u003c/p\u003e\n\u003ch3 id=\"为名所困\"\u003e\u003ca class=\"v-toc-item\" href=\"#为名所困\"\u003e#\u003c/a\u003e 为名所困\u003c/h3\u003e\n\u003cp\u003e项目写了半年，由于 graphene 玩的不熟，我（后端）一直在各种起名困难症中度过。\u003c/p\u003e\n\u003cp\u003e明明业务流程都差不多，但最后结果全是在改各种各样 ObjectType 的前缀。\u003c/p\u003e\n\u003ch2 id=\"0x06-结论\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x06-结论\"\u003e#\u003c/a\u003e 0x06 结论\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eGraphQL 这一套玩的熟悉的话，效率确实非常高。(前提是团队里面的人能玩的熟悉)\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e如果团队里面缺少全栈人才的话，在很多地方的比较难推进的动。graphql 用起来确实爽，特别是前端。\u003c/p\u003e\n\u003cp\u003e由于是较新的技术，\u003cstrong\u003e引入进来算上折腾出最佳实践的成本和折腾过程中诞生的技术债，收益可能并没有想象的那么大。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003erestful 其实也并不是做不到不少 graphql 能做到的东西。schema 生成工具其实蛮多的.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e不过，搞技术嘛，\u003cstrong\u003e折腾不止 生命不息\u003c/strong\u003e, 说不一定这次折腾收益就很高了呢？\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"0xee-参考链接\"\u003e\u003ca class=\"v-toc-item\" href=\"#0xee-参考链接\"\u003e#\u003c/a\u003e 0xEE 参考链接\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePhoto by \u003ca href=\"https://link.zhihu.com/?target=https%3A//unsplash.com/%40sigmund%3Futm_source%3Dunsplash%26utm_medium%3Dreferral%26utm_content%3DcreditCopyText\"\u003eSigmund\u003c/a\u003e on \u003ca href=\"https://link.zhihu.com/?target=https%3A//unsplash.com/s/photos/compute%3Futm_source%3Dunsplash%26utm_medium%3Dreferral%26utm_content%3DcreditCopyText\"\u003eUnsplash\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://link.zhihu.com/?target=https%3A//github.com/twocucao/tifa\"\u003e「FastAPI 脚手架」\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://link.zhihu.com/?target=https%3A//graphene-python.org/\"\u003ehttps://link.zhihu.com/?target=https%3A//graphene-python.org/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://link.zhihu.com/?target=https%3A//graphql.org/\"\u003ehttps://link.zhihu.com/?target=https%3A//graphql.org/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://link.zhihu.com/?target=https%3A//www.apollographql.com/docs/react/data/operation-best-practices/\"\u003ehttps://link.zhihu.com/?target=https%3A//www.apollographql.com/docs/react/data/operation-best-practices/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://link.zhihu.com/?target=https%3A//graphql-code-generator.com/docs/plugins/typescript\"\u003ehttps://link.zhihu.com/?target=https%3A//graphql-code-generator.com/docs/plugins/typescript\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","toc":"\u003cul class=\"v-article-toc\"\u003e\n\u003cli\u003e\u003ca href=\"#%E4%B9%9F%E8%81%8A%E8%81%8A-restful-vs-graphql\"\u003e也聊聊 RESTful vs GraphQL\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#0x00-%E5%89%8D%E8%A8%80\"\u003e0x00 前言\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x01-%E6%B5%81%E6%B0%B4%E7%9A%84%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88%E9%93%81%E6%89%93%E7%9A%84%E9%9C%80%E6%B1%82\"\u003e0x01 流水的技术方案，铁打的需求。\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x02-restful-%E7%9A%84%E7%BC%BA%E7%82%B9\"\u003e0x02 RESTful 的缺点\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E8%AF%AD%E4%B9%89%E4%B8%8D%E6%98%8E%E7%A1%AE\"\u003e语义不明确\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E5%BE%97%E5%88%B0%E5%8D%B3%E6%98%AF%E5%A4%B1%E5%8E%BB-gets-loss\"\u003e得到即是失去 - Get’s loss\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E6%9C%AA%E5%BE%88%E5%A5%BD%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98\"\u003e未很好解决的问题\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x03-graphql-%E6%98%AF%E6%96%B0%E7%9A%84%E9%A2%A0%E8%A6%86%E8%80%85%E4%B9%88\"\u003e0x03 GraphQL 是新的颠覆者么？\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x04-graphql-%E7%BB%99%E6%B6%88%E8%B4%B9%E7%AB%AF%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%A5%BD%E5%A4%84\"\u003e0x04 GraphQL 给消费端带来的好处\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x05-graphql-%E7%BB%99%E7%94%9F%E4%BA%A7%E7%AB%AF%E5%B8%A6%E6%9D%A5%E7%9A%84%E6%8C%91%E6%88%98\"\u003e0x05 GraphQL 给生产端带来的挑战\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#view-%E5%B1%82%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87%E5%89%A7%E5%8F%98\"\u003eView 层代码组织剧变\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98\"\u003e权限问题\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E7%89%88%E6%9C%AC%E6%9B%B4%E8%BF%AD\"\u003e版本更迭\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#required-vs-nullable-vs-blank\"\u003erequired vs nullable vs blank\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%BC%93%E5%AD%98\"\u003e服务端缓存\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E5%B5%8C%E5%A5%97%E5%BC%8F-api\"\u003e嵌套式 API\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#n1-%E9%97%AE%E9%A2%98\"\u003eN+1 问题\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E4%B8%BA%E5%90%8D%E6%89%80%E5%9B%B0\"\u003e为名所困\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x06-%E7%BB%93%E8%AE%BA\"\u003e0x06 结论\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0xee-%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5\"\u003e0xEE 参考链接\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n"}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"也聊聊 RESTful vs GraphQL"},"buildId":"oDi_oBCBuu3qj6v7hDnrL","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>