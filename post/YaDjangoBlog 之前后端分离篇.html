<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>YaDjangoBlog 之前后端分离篇 | 海拉鲁编程客</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/49455a07b6dd33600cdf.css" as="style"/><link rel="stylesheet" href="/_next/static/css/49455a07b6dd33600cdf.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-20d43e08bea62467b090.js" defer=""></script><script src="/_next/static/chunks/framework-0441fae7fd130f37dee1.js" defer=""></script><script src="/_next/static/chunks/main-4777350f2a9ff73ea2b0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-3050679c6e5142ffcaf5.js" defer=""></script><script src="/_next/static/chunks/ea88be26-9bcf6ead520f4ac26973.js" defer=""></script><script src="/_next/static/chunks/421-f2f33a86b546237f0325.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-173fe2de48c90365db9d.js" defer=""></script><script src="/_next/static/uCwe9m-iio9bnoWMgWDqE/_buildManifest.js" defer=""></script><script src="/_next/static/uCwe9m-iio9bnoWMgWDqE/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="v-page"><nav class="shadow"><div class="flex flex-col container mx-auto h-12 px-40 md:flex-row md:items-center md:justify-between"><div class="flex justify-between items-center"><div><a class="text-gray-800 text-xl md:text-xl leading-5" href="/">海拉鲁编程客</a></div><div><button type="button" class="block text-gray-800 hover:text-gray-600 focus:text-gray-600 focus:outline-none md:hidden"><svg viewBox="0 0 24 24" class="h-6 w-6 fill-current"><path d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z"></path></svg></button></div></div><div class="md:flex flex-col md:flex-row md:-mx-4 hidden"><a class="my-1 text-gray-800 hover:text-blue-500 md:mx-4 md:my-0" href="/">首页</a><a class="my-1 text-gray-800 hover:text-blue-500 md:mx-4 md:my-0" href="/archive">归档</a><a class="my-1 text-gray-800 hover:text-blue-500 md:mx-4 md:my-0" href="/about">关于我</a><button style="cursor:pointer;overflow:hidden;width:50px;height:23.5px;appearance:none;-moz-appearance:none;-webkit-appearance:none;border:none;background-color:transparent;padding:0" aria-hidden="true"><div style="display:flex;align-items:center;justify-content:center;margin-top:-28.749999999999996px;margin-left:-16px;width:82.5px;height:82.5px"><div></div></div></button></div></div></nav><div class="v-article"><div class="v-article-main" style="margin:auto;width:786px"><div><h2 id="0x00-前言"><a class="v-toc-item" href="#0x00-前言">#</a> 0x00 前言</h2>
<p>本文是 Django 全栈开发教程的第三篇 YaDjangoBlog 之前后端分离</p>
<p>目录在这里，已经更新的文章如下</p>
<ul>
<li>Django 全栈开发教程 - 2018 年不容错过的 Django 全栈项目 – 目录篇</li>
<li>Django 全栈开发教程 - YaDjangoBlog 的开发环境配置</li>
<li>Django 全栈开发教程 - YaDjangoBlog 的前后端设计</li>
</ul>
<p><strong>本文需要成四件事情：</strong></p>
<ul>
<li>第一件事情，解读 DjangoRestFramework, 通过简单的例子来引入用 DRF 的必要性，并且简单介绍 DRF 的 CBV 实现。</li>
<li>第二件事情，简单介绍 DRF 在本项目 YaDjangoBlog 中的使用</li>
<li>第三件事情，简单聊聊 RESTFULAPI 规范，并给出最佳实践参考。</li>
<li>第四件事情，简单解读一下 Django 处理请求流程代码。</li>
</ul>
<p>PS: 为了打字方便，下面的：</p>
<ul>
<li>DRF 指的是 DjangoRestFramework</li>
<li>CBV 指的是 Class Based View</li>
<li>FBV 指的是 Function Based View</li>
</ul>
<blockquote>
<p>坐稳了，开车了。</p>
</blockquote>
<h2 id="0x01-djangorestframework-解读"><a class="v-toc-item" href="#0x01-djangorestframework-解读">#</a> 0x01 DjangorestFramework 解读</h2>
<h3 id="为什么要用-drf-呢"><a class="v-toc-item" href="#为什么要用-drf-呢">#</a> 为什么要用 DRF 呢？</h3>
<p>使用一个库的原因，无非就是为了：</p>
<ol>
<li>节省开发者自己造轮子的时间。</li>
<li>有利于代码的可维护性 / 或者程序的健壮性。</li>
</ol>
<p>具体落实到 DRF, 有哪些具体的优点呢？</p>
<ol>
<li>可直接浏览调试的界面。让前端调试起来欲罢不能的功能。</li>
<li>用 DRF 的方式快速批量开接口</li>
<li>分页、序列化、校验、登录、权限、Web 附加文档、限流，高度的可扩展性。哪里不爽扩展哪里，so easy</li>
<li>算的上是 Django 社区最好的 RESTFUL 框架的轮子了。</li>
<li>完善的社区支持，比如 guardian/django-filter 等等结合。</li>
</ol>
<h3 id="不使用-drf-应该如何写-webapi-做呢"><a class="v-toc-item" href="#不使用-drf-应该如何写-webapi-做呢">#</a> 不使用 DRF 应该如何写 WebAPI 做呢？</h3>
<p>我们先看看，不使用 DRF 的时代，API 是如何编写的。</p>
<p>这里我们用 function based view 来简单说明。</p>
<pre><code class="language-python"># 最简单版本
def <span class="token function">simple_hello</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token function">JsonResponse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">"这就是 key"</span><span class="token operator">:</span> <span class="token string">"这就是 value"</span><span class="token punctuation">,</span>
        <span class="token string">"时间"</span><span class="token operator">:</span> time<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>刚开始学 DRF 的时候，我也有这种疑惑，这有必要需要一个 RESTFULAPI 的框架嘛？捋起袖子，JSON API 甩起来开咯。</p>
<p>之所以得出这个结论，是因为这个例子实在是过于简单。</p>
<p>当涉及到一定复杂程度的 API 的时候，问题就来了：</p>
<ol>
<li>权限是否需要区分？</li>
<li>分页需不需要做？</li>
<li>前端人员提交 Form 表单时，只能通过命令行或者是 POSTMAN 之类的工具提交参数，这会不会带来不便？后端人员写这些表单的各个字段，也是很手酸的事情。</li>
<li>拼接字典或者是字符串倒也还好，能不能有个序列器帮我直接序列化这模型，并且如果模型和模型之间有联系，最好也可以帮我完成模型和模型之间的关联。</li>
<li>Profile API 应该如何做？</li>
</ol>
<p>这都是我们需要考虑的。</p>
<p>如果不用 DRF, 而是由后端程序员直接写这些代码的话，也不是不行。</p>
<ol>
<li>对于第一点，可以直接在 fbv 上面加装饰器。</li>
<li>对于第二点，分页的时候可以直接将逻辑写在 fbv 里面。</li>
<li>前端 er 直接使用 PostMan 之类的工具就好了。</li>
<li>序列化，可以借助内置的序列化方法。</li>
<li>Profile 可以在提交参数的时候，附加一个参数比如 debug, 渲染的时候，将使用 HTML 里面内置一个 JSON 字符串的方式渲染出来。这样的话，就可以使用 Django Debug Tools 进行 Profile 了。</li>
</ol>
<p>很显然，这是个系统性的活。 假如接下来还要考虑限流、RESTFULAPI 的设计，这就相当蛋疼了。</p>
<p>显然，我们的 FBV 就会是这样：</p>
<pre><code class="language-python">@a_authority
def <span class="token function">complex_hello</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token operator">:</span>
    params <span class="token operator">=</span> <span class="token function">getParams</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
    <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    query_results <span class="token operator">=</span> SomeModels<span class="token punctuation">.</span><span class="token function">some_query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    results <span class="token operator">=</span> <span class="token function">SomeModelsSerial</span><span class="token punctuation">(</span>query_results<span class="token punctuation">)</span>
    <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> <span class="token function">JsonResponse</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
</code></pre>
<p>看起来似乎是有规律可循的，既然有规律可循，就能封装一下，减轻负担。FBV 已经这样了，显然只能每次都要硬编码这些取参数，查询，序列化。当然，如果用生成器也能简化一部分函数代码。yield 实现方法太丑还是弃用吧。</p>
<p>我们试试 CBV 看看如何。</p>
<pre><code class="language-python"># 继承并重写方法
from django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>generic <span class="token keyword">import</span> View
<span class="token keyword">class</span> <span class="token class-name">APIView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token operator">:</span>

    def <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token operator">:</span>
        query_results <span class="token operator">=</span> SomeModels<span class="token punctuation">.</span><span class="token function">some_query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        results <span class="token operator">=</span> <span class="token function">SomeModelsSerial</span><span class="token punctuation">(</span>query_results<span class="token punctuation">)</span>
        <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> results

    def <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token operator">:</span>
        query_results <span class="token operator">=</span> SomeModels<span class="token punctuation">.</span><span class="token function">some_query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        results <span class="token operator">=</span> <span class="token function">SomeModelsSerial</span><span class="token punctuation">(</span>query_results<span class="token punctuation">)</span>
        <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> results

    <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    # 这里相当于 view 函数
    def <span class="token function">dispatch</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token operator">:</span>
        # 这里处理正式处理之前的逻辑，比如权限判断。
        # 如果是 <span class="token constant">GET</span> 方法，则调用
        results <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token operator">:</span>
        # 这里处理正式处理之后的逻辑，比如统计 list 的 total 值，加上时间戳
        <span class="token keyword">return</span> <span class="token function">JsonResponse</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
</code></pre>
<p>于是，除了使用 FBV 进行硬编码之外，还可以使用 CBV 的基类 进行扩展定制。</p>
<p>我们思考一下：</p>
<ol>
<li>假如我想渲染某个模型的 JSON 列表，就可以定制一个 ListViewAPI 出来。如果需要一个 DetailViewAPI, 就定制一个 DetailViewAPI 出来。</li>
<li>我们再声明一些 Permission 类，序列化类，模型，然后在 dispatch 中直接使用这些东西的话，就只需要在 get 和 post 里面编写一些最核心的逻辑了。</li>
<li>甚至，指定了分页器和查询，都完全不需要再 get 和 post 里面写代码。</li>
</ol>
<p>恭喜你，读到这里，你已经可以写一个极简的 DRF 出来了。</p>
<p>但写成 DRF 这种量级的程序，还需要做很多很多事情。</p>
<h3 id="drf-处理请求的流程"><a class="v-toc-item" href="#drf-处理请求的流程">#</a> DRF 处理请求的流程</h3>
<p>要知道 DRF 的处理请求的流程，就要先知道 Django 的处理请求流程。</p>
<p>宏观来看</p>
<ol>
<li>请求先经过 MiddleWare , 接着判断 urlconf （默认为 ROOT_URLCONF),</li>
<li>匹配 URL, 将请求上下文 dispatch 到具体的 view.</li>
<li>处理完毕，经过 MiddleWare</li>
</ol>
<p><a href="https://docs.djangoproject.com/en/2.0/topics/http/urls/">https://docs.djangoproject.com/en/2.0/topics/http/urls/</a></p>
<p>在本文的结尾的时候，我也将带大家从源码角度过一下，涉及到这个流程的相关的源码。这里先跳过。</p>
<p>那么，DRF 是如何处理一个请求的呢？我们忽略路由之类的东西，直接看对应的 CBV 的源码</p>
<pre><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">APIView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token operator">:</span>

    renderer_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span><span class="token constant">DEFAULT_RENDERER_CLASSES</span>
    parser_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span><span class="token constant">DEFAULT_PARSER_CLASSES</span>
    authentication_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span><span class="token constant">DEFAULT_AUTHENTICATION_CLASSES</span>
    throttle_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span><span class="token constant">DEFAULT_THROTTLE_CLASSES</span>
    permission_classes <span class="token operator">=</span> api_settings<span class="token punctuation">.</span><span class="token constant">DEFAULT_PERMISSION_CLASSES</span>
    content_negotiation_class <span class="token operator">=</span> api_settings<span class="token punctuation">.</span><span class="token constant">DEFAULT_CONTENT_NEGOTIATION_CLASS</span>
    metadata_class <span class="token operator">=</span> api_settings<span class="token punctuation">.</span><span class="token constant">DEFAULT_METADATA_CLASS</span>
    versioning_class <span class="token operator">=</span> api_settings<span class="token punctuation">.</span><span class="token constant">DEFAULT_VERSIONING_CLASS</span>

    # <span class="token operator">...</span><span class="token operator">...</span> 其他方法

    # Dispatch methods

    def <span class="token function">initialize_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token string">""</span>"
        Returns the initial request object<span class="token punctuation">.</span>
        <span class="token string">""</span>"
        parser_context <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">get_parser_context</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token function">Request</span><span class="token punctuation">(</span>
            request<span class="token punctuation">,</span>
            parsers<span class="token operator">=</span>self<span class="token punctuation">.</span><span class="token function">get_parsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            authenticators<span class="token operator">=</span>self<span class="token punctuation">.</span><span class="token function">get_authenticators</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            negotiator<span class="token operator">=</span>self<span class="token punctuation">.</span><span class="token function">get_content_negotiator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            parser_context<span class="token operator">=</span>parser_context
        <span class="token punctuation">)</span>

    def <span class="token function">initial</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token string">""</span>"
        Runs anything that needs to occur prior to calling the method handler<span class="token punctuation">.</span>
        <span class="token string">""</span>"
        self<span class="token punctuation">.</span>format_kwarg <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">get_format_suffix</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

        # Perform content negotiation and store the accepted info on the request
        neg <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">perform_content_negotiation</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        request<span class="token punctuation">.</span>accepted_renderer<span class="token punctuation">,</span> request<span class="token punctuation">.</span>accepted_media_type <span class="token operator">=</span> neg

        # Determine the <span class="token constant">API</span> version<span class="token punctuation">,</span> <span class="token keyword">if</span> versioning is <span class="token keyword">in</span> use<span class="token punctuation">.</span>
        version<span class="token punctuation">,</span> scheme <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">determine_version</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        request<span class="token punctuation">.</span>version<span class="token punctuation">,</span> request<span class="token punctuation">.</span>versioning_scheme <span class="token operator">=</span> version<span class="token punctuation">,</span> scheme

        # Ensure that the incoming request is permitted
        self<span class="token punctuation">.</span><span class="token function">perform_authentication</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span><span class="token function">check_permissions</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span><span class="token function">check_throttles</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>

    # Note<span class="token operator">:</span> Views are made <span class="token constant">CSRF</span> exempt from within <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">as_view</span><span class="token template-punctuation string">`</span></span> <span class="token keyword">as</span> to prevent
    # accidental removal <span class="token keyword">of</span> <span class="token keyword">this</span> exemption <span class="token keyword">in</span> cases where <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dispatch</span><span class="token template-punctuation string">`</span></span> needs to
    # be overridden<span class="token punctuation">.</span>
    def <span class="token function">dispatch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token string">""</span>"
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">.dispatch()</span><span class="token template-punctuation string">`</span></span> is pretty much the same <span class="token keyword">as</span> Django's regular dispatch<span class="token punctuation">,</span>
        but <span class="token keyword">with</span> extra hooks <span class="token keyword">for</span> startup<span class="token punctuation">,</span> finalize<span class="token punctuation">,</span> and exception handling<span class="token punctuation">.</span>
        <span class="token string">""</span>"
        self<span class="token punctuation">.</span>args <span class="token operator">=</span> args
        self<span class="token punctuation">.</span>kwargs <span class="token operator">=</span> kwargs
        # 这里需要注意
        request <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">initialize_request</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>request <span class="token operator">=</span> request
        self<span class="token punctuation">.</span>headers <span class="token operator">=</span> self<span class="token punctuation">.</span>default_response_headers  # deprecate<span class="token operator">?</span>

        <span class="token keyword">try</span><span class="token operator">:</span>
            # 这里需要注意
            self<span class="token punctuation">.</span><span class="token function">initial</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

            # Get the appropriate handler method
            <span class="token keyword">if</span> request<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">lower</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>http_method_names<span class="token operator">:</span>
                handler <span class="token operator">=</span> <span class="token function">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">lower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  self<span class="token punctuation">.</span>http_method_not_allowed<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token operator">:</span>
                handler <span class="token operator">=</span> self<span class="token punctuation">.</span>http_method_not_allowed

            response <span class="token operator">=</span> <span class="token function">handler</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

        except Exception <span class="token keyword">as</span> exc<span class="token operator">:</span>
            response <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">handle_exception</span><span class="token punctuation">(</span>exc<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>response <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">finalize_response</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>response
</code></pre>
<p>可以看出，当请求到达 dispatch 的时候，DRF 添加了一些钩子函数，用于开始 / 结束 / 错误控制。</p>
<ol>
<li>在 initialize_request 的时候，对 request 进行封装，添加上 parser / auth / negoriator / parser context</li>
<li>接着在 initial 方法里面校验了版本，进行了认证和鉴权，检查了限流</li>
</ol>
<p>一看，其实与我们之前想封装 APIView 的想法不谋而合，而我们只是想想，DRF 是详细实现。</p>
<h2 id="0x02-djangorestframework-的使用案例"><a class="v-toc-item" href="#0x02-djangorestframework-的使用案例">#</a> 0x02 DjangorestFramework 的使用案例</h2>
<h3 id="如何开-webapi-接口"><a class="v-toc-item" href="#如何开-webapi-接口">#</a> 如何开 WebAPI 接口</h3>
<p>回到我们的 yadjangoblog 上面来。这个时候我们想开一个博文列表 API:</p>
<pre><code class="language-python"># <span class="token number">1.</span> 定义序列器，用于序列化查询的每一条。
<span class="token keyword">class</span> <span class="token class-name">BlogPostListSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token operator">:</span>
    category <span class="token operator">=</span> <span class="token function">BlogCategorySerializer</span><span class="token punctuation">(</span>read_only<span class="token operator">=</span>True<span class="token punctuation">)</span>
    tags <span class="token operator">=</span> <span class="token function">BlogTagSerializer</span><span class="token punctuation">(</span>many<span class="token operator">=</span>True<span class="token punctuation">,</span> read_only<span class="token operator">=</span>True<span class="token punctuation">)</span>
    title <span class="token operator">=</span> serializers<span class="token punctuation">.</span><span class="token function">CharField</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    id <span class="token operator">=</span> serializers<span class="token punctuation">.</span><span class="token function">IntegerField</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token operator">:</span>
        model <span class="token operator">=</span> BlogPost
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'char_num'</span><span class="token punctuation">,</span> <span class="token string">'vote_num'</span><span class="token punctuation">,</span> <span class="token string">'category'</span><span class="token punctuation">,</span> <span class="token string">'tags'</span><span class="token punctuation">,</span> <span class="token string">'publish_date'</span><span class="token punctuation">)</span>

# <span class="token number">2.</span> 定义过滤器，可以通过过滤器进行查询
<span class="token keyword">class</span> <span class="token class-name">BlogPostFilter</span><span class="token punctuation">(</span>filters<span class="token punctuation">.</span>FilterSet<span class="token punctuation">)</span><span class="token operator">:</span>
    title <span class="token operator">=</span> filters<span class="token punctuation">.</span><span class="token function">CharFilter</span><span class="token punctuation">(</span>lookup_expr<span class="token operator">=</span><span class="token string">'contains'</span><span class="token punctuation">)</span>
    having_tags <span class="token operator">=</span> filters<span class="token punctuation">.</span><span class="token function">Filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"tags"</span><span class="token punctuation">,</span> lookup_expr<span class="token operator">=</span><span class="token string">'in'</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token operator">:</span>
        model <span class="token operator">=</span> BlogPost
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'char_num'</span><span class="token punctuation">,</span> <span class="token string">'category'</span><span class="token punctuation">,</span> <span class="token string">'tags'</span><span class="token punctuation">)</span>

# <span class="token number">3.</span> 指定其他设置，具体大家看源码就好了。
<span class="token keyword">class</span> <span class="token class-name">BlogPostListAPIView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token string">""</span>"
    依照 category <span class="token punctuation">,</span> tags <span class="token punctuation">,</span> 时间 （年 <span class="token operator">/</span> 月 <span class="token operator">/</span> 日  年 <span class="token operator">/</span> 月 年）
    <span class="token string">""</span>"
    queryset <span class="token operator">=</span> BlogPost<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> BlogPostListSerializer
    filter_backends <span class="token operator">=</span> <span class="token punctuation">(</span>filters<span class="token punctuation">.</span>DjangoFilterBackend<span class="token punctuation">,</span> OrderingFilter<span class="token punctuation">,</span><span class="token punctuation">)</span>
    filter_class <span class="token operator">=</span> BlogPostFilter
    ordering_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'publish_date'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    ordering <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'publish_date'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>AllowAny<span class="token punctuation">,</span><span class="token punctuation">)</span>
    pagination_class <span class="token operator">=</span> SmallResultsSetPagination
</code></pre>
<p>在指定上面的操作之后，一个接口就快速的开出来了。</p>
<p>: TODO 插入一张图</p>
<p>当然，DRF 认认真真通读一遍的话，还是可以给自己节省不少时间的。</p>
<p>这是开接口，似乎，还少了什么，比如 Restful API.</p>
<h3 id="前端如何使用-webapi-接口"><a class="v-toc-item" href="#前端如何使用-webapi-接口">#</a> 前端如何使用 WebAPI 接口</h3>
<p>什么是 CORS 可以参考阮一峰的文章 <a href="http://www.ruanyifeng.com/blog/2016/04/cors.html">http://www.ruanyifeng.com/blog/2016/04/cors.html</a></p>
<p>在调试的时候，我们肯定是使用 ajax / fetch 方式请求。这就会遇到一个问题：</p>
<ul>
<li>跨域</li>
</ul>
<p>解决方式也很简单，服务端只要服务器实现了 CORS 接口，就可以跨源通信。</p>
<p>安装 django-cors-headers, 并在 settings 中开启 CORS_ORIGIN_ALLOW_ALL = True 即可。</p>
<p>这里参考了临书的解决方案，要感谢 @临书 , 附上参考地址 <a href="https://zhuanlan.zhihu.com/p/24893786">https://zhuanlan.zhihu.com/p/24893786</a></p>
<p>对于本项目而言，使用了 axios 请求库，直接 get 即可。详细看前端代码即可。</p>
<h2 id="0x03-restful-api-设计"><a class="v-toc-item" href="#0x03-restful-api-设计">#</a> 0x03 RESTFUL API 设计</h2>
<p>开发过程中，尽量靠近 RESTFUL API 的设计，而不是照搬。</p>
<p>举个其他领域的例子，有的人表述美就只有：</p>
<ul>
<li>已撸</li>
</ul>
<p>但是不同的美各有各的模样：</p>
<ul>
<li>手如柔荑，肤如凝脂，领如蝤蛴，齿如瓠犀，螓首蛾眉，巧笑倩兮，美目盼兮。</li>
</ul>
<p>同样，放在 RESFUL 的时候确实也出现了这种情况：</p>
<p>几乎所有的业务逻辑最后会落实到数据表的 CURDE, 但是所有业务逻辑并不能完全使用 CRUDE 描述。</p>
<p>我们看下面的例子</p>
<h3 id="关于请求"><a class="v-toc-item" href="#关于请求">#</a> 关于请求</h3>
<p>举个例子，RESTFUL 适合纯粹 CURDE 的设计风格。</p>
<p>比如，新增博客，更新博客，查询博客，删除博客，查看是否含有博客</p>
<p>但语义在某些场景下表述不足， 比如，设计订单的时候，</p>
<pre><code class="language-bash"><span class="token constant">URL</span><span class="token operator">:</span> <span class="token operator">/</span>api<span class="token operator">/</span>v1<span class="token operator">/</span>user<span class="token operator">/</span>some_user<span class="token operator">/</span>orders
你查看订单集合，这个好理解。<span class="token keyword">get</span> 方法
你新增订单，这个好理解。put 方法
<span class="token constant">URL</span><span class="token operator">:</span> <span class="token operator">/</span>api<span class="token operator">/</span>v1<span class="token operator">/</span>user<span class="token operator">/</span>some_user<span class="token operator">/</span>order<span class="token operator">/</span>xxxxxxx
你删除订单，这个好理解。<span class="token keyword">delete</span> 方法
你获取订单，这个好理解。<span class="token keyword">get</span> 方法
你修改订单，这个好理解。post 方法

但修改订单，有的时候可能会比较复杂，有可能是取消订单，有可能是评价订单，有可能是其他。而 <span class="token constant">RESTFUL</span> 表达这种情况就有些语义不足了。
</code></pre>
<p>当然，个人经验是，字段越多，越难靠近 RESTFUL 规范</p>
<p>这个时候，就需要设计者做好 RESTFULAPI 的设计与语义化的平衡了。</p>
<h3 id="关于响应"><a class="v-toc-item" href="#关于响应">#</a> 关于响应</h3>
<p>关于响应设计，主要有两点需要注意：</p>
<ul>
<li>状态码 (HTTP 状态码，也业务逻辑通用状态码）</li>
<li>响应内容 包含 业务逻辑通用状态码，剩下的视具体情况而定。</li>
</ul>
<p>HTTP 状态码用于标记资源情况，比如：</p>
<pre><code>200 表示获取资源
404 表示 NOT FOUND
</code></pre>
<p>但有时候也存在语义表达不足问题，一般前后端也会约定一个通用的状态码</p>
<pre><code>通用状态码 错误信息 含义 HTTP 状态码
999	    unknow_v2_error	未知错误	400
1000	need_permission	需要权限	403
1001	uri_not_found	资源不存在	404
1002	missing_args	参数不全	400
1003	image_too_large	上传的图片太大	400
....
</code></pre>
<p>至于响应内容，一般都是见招拆招的。建议查看文章末尾的 Douban 的相关 API 规范来提升姿势。</p>
<h2 id="0x04-django-的处理请求流程代码解读"><a class="v-toc-item" href="#0x04-django-的处理请求流程代码解读">#</a> 0x04 Django 的处理请求流程代码解读</h2>
<p>这小节属于一时兴起写的番外篇。和本文主体内容没啥必要的关联。不感兴趣的可以直接跳转到文章末尾点赞哈。</p>
<p>WSGI 全称叫做 web 服务器网关接口，通常情况下，gunicorn 或者 uwsgi 接收来自 nginx 转发来的请求之后，向 web app 提供了环境信息（叫请求上下文会不会好些）以及一个 callback. 这样的话，web app 就可以接收这个环境信息，处理完毕，通过回调函数处理请求，并返回响应。一个极简的 webapp 如下：</p>
<pre><code class="language-python">def <span class="token function">app</span><span class="token punctuation">(</span>environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token string">""</span><span class="token string">"Simplest possible application object"</span><span class="token string">""</span>
    data <span class="token operator">=</span> <span class="token string">'Hello, World!\n'</span>
    status <span class="token operator">=</span> <span class="token string">'200 OK'</span>
    response_headers <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span><span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">'Content-Length'</span><span class="token punctuation">,</span> <span class="token function">str</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    <span class="token function">start_response</span><span class="token punctuation">(</span>status<span class="token punctuation">,</span> response_headers<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>现在我们看看 django 中是如何处理请求的。首先查看相关的 <a href="http://wsgi.py">wsgi.py</a></p>
<pre><code class="language-python"># wsgi<span class="token punctuation">.</span>py
<span class="token keyword">import</span> os
from django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>wsgi <span class="token keyword">import</span> get_wsgi_application
os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span><span class="token function">setdefault</span><span class="token punctuation">(</span><span class="token string">"DJANGO_SETTINGS_MODULE"</span><span class="token punctuation">,</span> <span class="token string">"config.settings"</span><span class="token punctuation">)</span>
application <span class="token operator">=</span> <span class="token function">get_wsgi_application</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

# 接着查看 get_wsgi_application
<span class="token keyword">import</span> django
from django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handlers<span class="token punctuation">.</span>wsgi <span class="token keyword">import</span> WSGIHandler

def <span class="token function">get_wsgi_application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token string">""</span>"
    The <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">to</span> Django's <span class="token constant">WSGI</span> support<span class="token punctuation">.</span> Return a <span class="token constant">WSGI</span> callable<span class="token punctuation">.</span>

    Avoids making django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handlers<span class="token punctuation">.</span>WSGIHandler a <span class="token keyword">public</span> <span class="token constant">API</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token keyword">case</span> the
    internal <span class="token constant">WSGI</span> implementation changes or moves <span class="token keyword">in</span> the future<span class="token punctuation">.</span>
    <span class="token string">""</span>"
    django<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>set_prefix<span class="token operator">=</span>False<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">WSGIHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

# 于是自然而言的看到了 WSGIHandler
<span class="token keyword">class</span> <span class="token class-name">WSGIHandler</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>BaseHandler<span class="token punctuation">)</span><span class="token operator">:</span>
    request_class <span class="token operator">=</span> WSGIRequest

    def <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">__init__</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span><span class="token function">load_middleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    def <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token operator">:</span>
        # 有木有看到 environ 和 start_response <span class="token operator">??</span> 这就是极简 web app 中的 webapp 核心方法。
        <span class="token function">set_script_prefix</span><span class="token punctuation">(</span><span class="token function">get_script_name</span><span class="token punctuation">(</span>environ<span class="token punctuation">)</span><span class="token punctuation">)</span>
        signals<span class="token punctuation">.</span>request_started<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>sender<span class="token operator">=</span>self<span class="token punctuation">.</span>__class__<span class="token punctuation">,</span> environ<span class="token operator">=</span>environ<span class="token punctuation">)</span>
        request <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">request_class</span><span class="token punctuation">(</span>environ<span class="token punctuation">)</span>
        # 注意这一行，有请求处理逻辑 具体要见下面代码
        response <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">get_response</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        # <span class="token operator">...</span><span class="token operator">...</span>
        <span class="token keyword">return</span> response
</code></pre>
<p>嗯，看到了子类，就要看看基类</p>
<pre><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">BaseHandler</span><span class="token operator">:</span>
    _request_middleware <span class="token operator">=</span> None
    _view_middleware <span class="token operator">=</span> None
    _template_response_middleware <span class="token operator">=</span> None
    _response_middleware <span class="token operator">=</span> None
    _exception_middleware <span class="token operator">=</span> None
    _middleware_chain <span class="token operator">=</span> None

    def <span class="token function">load_middleware</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token string">""</span>"
        注册 MiddleWare<span class="token punctuation">,</span> 并赋值 _middleware_chain 方法，使之调用的时候可以先按照顺序从 setting 的 middleware 里面处理 requests
        并在处理 request 的最后调用 私有方法 _get_response
        <span class="token string">""</span>"
        self<span class="token punctuation">.</span>_request_middleware <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_view_middleware <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_template_response_middleware <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_response_middleware <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_exception_middleware <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        handler <span class="token operator">=</span> <span class="token function">convert_exception_to_response</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_get_response<span class="token punctuation">)</span>
        # 注意，这里面是倒着来的 代码中越在前面，实际运行的时候处理就越在后面
        <span class="token keyword">for</span> middleware_path <span class="token keyword">in</span> <span class="token function">reversed</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span><span class="token constant">MIDDLEWARE</span><span class="token punctuation">)</span><span class="token operator">:</span>
            # 依次添加 view middleware <span class="token operator">/</span> template middleware <span class="token operator">/</span> exception middleware
            middleware <span class="token operator">=</span> <span class="token function">import_string</span><span class="token punctuation">(</span>middleware_path<span class="token punctuation">)</span>
            mw_instance <span class="token operator">=</span> <span class="token function">middleware</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
            handler <span class="token operator">=</span> <span class="token function">convert_exception_to_response</span><span class="token punctuation">(</span>mw_instance<span class="token punctuation">)</span>

        # We only assign to <span class="token keyword">this</span> when initialization is complete <span class="token keyword">as</span> it is used
        # <span class="token keyword">as</span> a flag <span class="token keyword">for</span> initialization being complete<span class="token punctuation">.</span>
        self<span class="token punctuation">.</span>_middleware_chain <span class="token operator">=</span> handler

    <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    def <span class="token function">get_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token string">""</span><span class="token string">"Return an HttpResponse object for the given HttpRequest."</span><span class="token string">""</span>
        # Setup <span class="token keyword">default</span> url resolver <span class="token keyword">for</span> <span class="token keyword">this</span> thread
        <span class="token function">set_urlconf</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span><span class="token constant">ROOT_URLCONF</span><span class="token punctuation">)</span>

        response <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">_middleware_chain</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        # <span class="token operator">...</span><span class="token operator">...</span>
        <span class="token keyword">return</span> response

    def <span class="token function">_get_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token string">""</span>"
        Resolve and call the view<span class="token punctuation">,</span> then apply view<span class="token punctuation">,</span> exception<span class="token punctuation">,</span> and
        template_response middleware<span class="token punctuation">.</span> This method is everything that happens
        inside the request<span class="token operator">/</span>response middleware<span class="token punctuation">.</span>
        <span class="token string">""</span>"
        response <span class="token operator">=</span> None

        # <span class="token number">1.</span> 接着判断 urlconf （默认为 <span class="token constant">ROOT_URLCONF</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 可以通过 middleware 进行设置
        <span class="token keyword">if</span> <span class="token function">hasattr</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'urlconf'</span><span class="token punctuation">)</span><span class="token operator">:</span>
            urlconf <span class="token operator">=</span> request<span class="token punctuation">.</span>urlconf
            <span class="token function">set_urlconf</span><span class="token punctuation">(</span>urlconf<span class="token punctuation">)</span>
            resolver <span class="token operator">=</span> <span class="token function">get_resolver</span><span class="token punctuation">(</span>urlconf<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token operator">:</span>
            resolver <span class="token operator">=</span> <span class="token function">get_resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        resolver_match <span class="token operator">=</span> resolver<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>path_info<span class="token punctuation">)</span>
        callback<span class="token punctuation">,</span> callback_args<span class="token punctuation">,</span> callback_kwargs <span class="token operator">=</span> resolver_match
        request<span class="token punctuation">.</span>resolver_match <span class="token operator">=</span> resolver_match

        # Apply view middleware<span class="token operator">...</span><span class="token punctuation">.</span>
        # 注意，这个就是 view 函数
        wrapped_callback <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">make_view_atomic</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
        response <span class="token operator">=</span> <span class="token function">wrapped_callback</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>callback_args<span class="token punctuation">,</span> <span class="token operator">**</span>callback_kwargs<span class="token punctuation">)</span>
        # Complain <span class="token keyword">if</span> the view returned <span class="token function">None</span> <span class="token punctuation">(</span>a common error<span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> response

    def <span class="token function">process_exception_by_middleware</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exception<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token operator">:</span>
        # <span class="token operator">...</span><span class="token operator">...</span>
</code></pre>
<p>上面代码比较表达的意思比较简单，值得注意的地方我都加了注释。</p>
<p>需要特别注意的就是 middleware_chain 这个属性（实际上是一个方法）, 正是这个方法使得注册的 middleware （在 load_middleware 方法里）可以在 fbv 或者 cbv 处理 request 之前，通过对 request 进行处理。</p>
<h2 id="0xee-参考链接"><a class="v-toc-item" href="#0xee-参考链接">#</a> 0xEE. 参考链接</h2>
<p>还犹豫啥，Django 前后端分离最佳实践，点赞后，快上车吧</p>
<ul>
<li>前端代码 <a href="https://github.com/twocucao/YaVueBlog">https://github.com/twocucao/YaVueBlog</a></li>
<li>后端代码 <a href="https://github.com/twocucao/YaDjangoBlog">https://github.com/twocucao/YaDjangoBlog</a></li>
<li>扩展阅读之 douban restful api 设计 <a href="https://developers.douban.com/wiki/?title=api_v2">https://developers.douban.com/wiki/?title=api_v2</a></li>
</ul>
<hr>
<p>ChangeLog:</p>
<ul>
<li><strong>2018-02-22</strong> 开启本文</li>
<li><strong>2018-03-04</strong> 重修文字</li>
</ul>
</div></div><div><ul class="v-article-toc">
<li>
<ul>
<li><a href="#0x00-%E5%89%8D%E8%A8%80">0x00 前言</a></li>
<li><a href="#0x01-djangorestframework-%E8%A7%A3%E8%AF%BB">0x01 DjangorestFramework 解读</a>
<ul>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8-drf-%E5%91%A2">为什么要用 DRF 呢？</a></li>
<li><a href="#%E4%B8%8D%E4%BD%BF%E7%94%A8-drf-%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E5%86%99-webapi-%E5%81%9A%E5%91%A2">不使用 DRF 应该如何写 WebAPI 做呢？</a></li>
<li><a href="#drf-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E7%9A%84%E6%B5%81%E7%A8%8B">DRF 处理请求的流程</a></li>
</ul>
</li>
<li><a href="#0x02-djangorestframework-%E7%9A%84%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B">0x02 DjangorestFramework 的使用案例</a>
<ul>
<li><a href="#%E5%A6%82%E4%BD%95%E5%BC%80-webapi-%E6%8E%A5%E5%8F%A3">如何开 WebAPI 接口</a></li>
<li><a href="#%E5%89%8D%E7%AB%AF%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-webapi-%E6%8E%A5%E5%8F%A3">前端如何使用 WebAPI 接口</a></li>
</ul>
</li>
<li><a href="#0x03-restful-api-%E8%AE%BE%E8%AE%A1">0x03 RESTFUL API 设计</a>
<ul>
<li><a href="#%E5%85%B3%E4%BA%8E%E8%AF%B7%E6%B1%82">关于请求</a></li>
<li><a href="#%E5%85%B3%E4%BA%8E%E5%93%8D%E5%BA%94">关于响应</a></li>
</ul>
</li>
<li><a href="#0x04-django-%E7%9A%84%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB">0x04 Django 的处理请求流程代码解读</a></li>
<li><a href="#0xee-%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5">0xEE. 参考链接</a></li>
</ul>
</li>
</ul>
</div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"tags":["Python","Django","YaDjangoBlog"],"path":"20180223_YaDjangoBlog前后端分离篇.md","title":"YaDjangoBlog 之前后端分离篇","slug":"YaDjangoBlog 之前后端分离篇","date":"2018-02-23","category":"Django","lastMod":"2020-01-01","description":"这篇文章展示了基本的 Markdown 语法和格式.","thumbnail":"","content":"\u003ch2 id=\"0x00-前言\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x00-前言\"\u003e#\u003c/a\u003e 0x00 前言\u003c/h2\u003e\n\u003cp\u003e本文是 Django 全栈开发教程的第三篇 YaDjangoBlog 之前后端分离\u003c/p\u003e\n\u003cp\u003e目录在这里，已经更新的文章如下\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDjango 全栈开发教程 - 2018 年不容错过的 Django 全栈项目 – 目录篇\u003c/li\u003e\n\u003cli\u003eDjango 全栈开发教程 - YaDjangoBlog 的开发环境配置\u003c/li\u003e\n\u003cli\u003eDjango 全栈开发教程 - YaDjangoBlog 的前后端设计\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e本文需要成四件事情：\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e第一件事情，解读 DjangoRestFramework, 通过简单的例子来引入用 DRF 的必要性，并且简单介绍 DRF 的 CBV 实现。\u003c/li\u003e\n\u003cli\u003e第二件事情，简单介绍 DRF 在本项目 YaDjangoBlog 中的使用\u003c/li\u003e\n\u003cli\u003e第三件事情，简单聊聊 RESTFULAPI 规范，并给出最佳实践参考。\u003c/li\u003e\n\u003cli\u003e第四件事情，简单解读一下 Django 处理请求流程代码。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ePS: 为了打字方便，下面的：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDRF 指的是 DjangoRestFramework\u003c/li\u003e\n\u003cli\u003eCBV 指的是 Class Based View\u003c/li\u003e\n\u003cli\u003eFBV 指的是 Function Based View\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e坐稳了，开车了。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"0x01-djangorestframework-解读\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x01-djangorestframework-解读\"\u003e#\u003c/a\u003e 0x01 DjangorestFramework 解读\u003c/h2\u003e\n\u003ch3 id=\"为什么要用-drf-呢\"\u003e\u003ca class=\"v-toc-item\" href=\"#为什么要用-drf-呢\"\u003e#\u003c/a\u003e 为什么要用 DRF 呢？\u003c/h3\u003e\n\u003cp\u003e使用一个库的原因，无非就是为了：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e节省开发者自己造轮子的时间。\u003c/li\u003e\n\u003cli\u003e有利于代码的可维护性 / 或者程序的健壮性。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e具体落实到 DRF, 有哪些具体的优点呢？\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e可直接浏览调试的界面。让前端调试起来欲罢不能的功能。\u003c/li\u003e\n\u003cli\u003e用 DRF 的方式快速批量开接口\u003c/li\u003e\n\u003cli\u003e分页、序列化、校验、登录、权限、Web 附加文档、限流，高度的可扩展性。哪里不爽扩展哪里，so easy\u003c/li\u003e\n\u003cli\u003e算的上是 Django 社区最好的 RESTFUL 框架的轮子了。\u003c/li\u003e\n\u003cli\u003e完善的社区支持，比如 guardian/django-filter 等等结合。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"不使用-drf-应该如何写-webapi-做呢\"\u003e\u003ca class=\"v-toc-item\" href=\"#不使用-drf-应该如何写-webapi-做呢\"\u003e#\u003c/a\u003e 不使用 DRF 应该如何写 WebAPI 做呢？\u003c/h3\u003e\n\u003cp\u003e我们先看看，不使用 DRF 的时代，API 是如何编写的。\u003c/p\u003e\n\u003cp\u003e这里我们用 function based view 来简单说明。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# 最简单版本\ndef \u003cspan class=\"token function\"\u003esimple_hello\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003eJsonResponse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"这就是 key\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"这就是 value\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"时间\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e time\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003etime\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e刚开始学 DRF 的时候，我也有这种疑惑，这有必要需要一个 RESTFULAPI 的框架嘛？捋起袖子，JSON API 甩起来开咯。\u003c/p\u003e\n\u003cp\u003e之所以得出这个结论，是因为这个例子实在是过于简单。\u003c/p\u003e\n\u003cp\u003e当涉及到一定复杂程度的 API 的时候，问题就来了：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e权限是否需要区分？\u003c/li\u003e\n\u003cli\u003e分页需不需要做？\u003c/li\u003e\n\u003cli\u003e前端人员提交 Form 表单时，只能通过命令行或者是 POSTMAN 之类的工具提交参数，这会不会带来不便？后端人员写这些表单的各个字段，也是很手酸的事情。\u003c/li\u003e\n\u003cli\u003e拼接字典或者是字符串倒也还好，能不能有个序列器帮我直接序列化这模型，并且如果模型和模型之间有联系，最好也可以帮我完成模型和模型之间的关联。\u003c/li\u003e\n\u003cli\u003eProfile API 应该如何做？\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e这都是我们需要考虑的。\u003c/p\u003e\n\u003cp\u003e如果不用 DRF, 而是由后端程序员直接写这些代码的话，也不是不行。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e对于第一点，可以直接在 fbv 上面加装饰器。\u003c/li\u003e\n\u003cli\u003e对于第二点，分页的时候可以直接将逻辑写在 fbv 里面。\u003c/li\u003e\n\u003cli\u003e前端 er 直接使用 PostMan 之类的工具就好了。\u003c/li\u003e\n\u003cli\u003e序列化，可以借助内置的序列化方法。\u003c/li\u003e\n\u003cli\u003eProfile 可以在提交参数的时候，附加一个参数比如 debug, 渲染的时候，将使用 HTML 里面内置一个 JSON 字符串的方式渲染出来。这样的话，就可以使用 Django Debug Tools 进行 Profile 了。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e很显然，这是个系统性的活。 假如接下来还要考虑限流、RESTFULAPI 的设计，这就相当蛋疼了。\u003c/p\u003e\n\u003cp\u003e显然，我们的 FBV 就会是这样：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e@a_authority\ndef \u003cspan class=\"token function\"\u003ecomplex_hello\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    params \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003egetParams\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n    query_results \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e SomeModels\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esome_query\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n    results \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eSomeModelsSerial\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003equery_results\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003eJsonResponse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresults\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e看起来似乎是有规律可循的，既然有规律可循，就能封装一下，减轻负担。FBV 已经这样了，显然只能每次都要硬编码这些取参数，查询，序列化。当然，如果用生成器也能简化一部分函数代码。yield 实现方法太丑还是弃用吧。\u003c/p\u003e\n\u003cp\u003e我们试试 CBV 看看如何。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# 继承并重写方法\nfrom django\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eviews\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egeneric \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e View\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eAPIView\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eView\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n\n    def \u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        query_results \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e SomeModels\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esome_query\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n        results \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eSomeModelsSerial\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003equery_results\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e results\n\n    def \u003cspan class=\"token function\"\u003epost\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        query_results \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e SomeModels\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esome_query\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n        results \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eSomeModelsSerial\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003equery_results\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e results\n\n    \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n\n    # 这里相当于 view 函数\n    def \u003cspan class=\"token function\"\u003edispatch\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003ekwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        # 这里处理正式处理之前的逻辑，比如权限判断。\n        # 如果是 \u003cspan class=\"token constant\"\u003eGET\u003c/span\u003e 方法，则调用\n        results \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003ekwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        # 这里处理正式处理之后的逻辑，比如统计 list 的 total 值，加上时间戳\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003eJsonResponse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresults\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e于是，除了使用 FBV 进行硬编码之外，还可以使用 CBV 的基类 进行扩展定制。\u003c/p\u003e\n\u003cp\u003e我们思考一下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e假如我想渲染某个模型的 JSON 列表，就可以定制一个 ListViewAPI 出来。如果需要一个 DetailViewAPI, 就定制一个 DetailViewAPI 出来。\u003c/li\u003e\n\u003cli\u003e我们再声明一些 Permission 类，序列化类，模型，然后在 dispatch 中直接使用这些东西的话，就只需要在 get 和 post 里面编写一些最核心的逻辑了。\u003c/li\u003e\n\u003cli\u003e甚至，指定了分页器和查询，都完全不需要再 get 和 post 里面写代码。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e恭喜你，读到这里，你已经可以写一个极简的 DRF 出来了。\u003c/p\u003e\n\u003cp\u003e但写成 DRF 这种量级的程序，还需要做很多很多事情。\u003c/p\u003e\n\u003ch3 id=\"drf-处理请求的流程\"\u003e\u003ca class=\"v-toc-item\" href=\"#drf-处理请求的流程\"\u003e#\u003c/a\u003e DRF 处理请求的流程\u003c/h3\u003e\n\u003cp\u003e要知道 DRF 的处理请求的流程，就要先知道 Django 的处理请求流程。\u003c/p\u003e\n\u003cp\u003e宏观来看\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e请求先经过 MiddleWare , 接着判断 urlconf （默认为 ROOT_URLCONF),\u003c/li\u003e\n\u003cli\u003e匹配 URL, 将请求上下文 dispatch 到具体的 view.\u003c/li\u003e\n\u003cli\u003e处理完毕，经过 MiddleWare\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003ca href=\"https://docs.djangoproject.com/en/2.0/topics/http/urls/\"\u003ehttps://docs.djangoproject.com/en/2.0/topics/http/urls/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e在本文的结尾的时候，我也将带大家从源码角度过一下，涉及到这个流程的相关的源码。这里先跳过。\u003c/p\u003e\n\u003cp\u003e那么，DRF 是如何处理一个请求的呢？我们忽略路由之类的东西，直接看对应的 CBV 的源码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eAPIView\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eView\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n\n    renderer_classes \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e api_settings\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eDEFAULT_RENDERER_CLASSES\u003c/span\u003e\n    parser_classes \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e api_settings\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eDEFAULT_PARSER_CLASSES\u003c/span\u003e\n    authentication_classes \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e api_settings\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eDEFAULT_AUTHENTICATION_CLASSES\u003c/span\u003e\n    throttle_classes \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e api_settings\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eDEFAULT_THROTTLE_CLASSES\u003c/span\u003e\n    permission_classes \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e api_settings\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eDEFAULT_PERMISSION_CLASSES\u003c/span\u003e\n    content_negotiation_class \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e api_settings\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eDEFAULT_CONTENT_NEGOTIATION_CLASS\u003c/span\u003e\n    metadata_class \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e api_settings\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eDEFAULT_METADATA_CLASS\u003c/span\u003e\n    versioning_class \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e api_settings\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eDEFAULT_VERSIONING_CLASS\u003c/span\u003e\n\n    # \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token operator\"\u003e...\u003c/span\u003e 其他方法\n\n    # Dispatch methods\n\n    def \u003cspan class=\"token function\"\u003einitialize_request\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003ekwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n        Returns the initial request object\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n        parser_context \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget_parser_context\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003eRequest\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n            request\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            parsers\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget_parsers\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            authenticators\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget_authenticators\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            negotiator\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget_content_negotiator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            parser_context\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eparser_context\n        \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    def \u003cspan class=\"token function\"\u003einitial\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003ekwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n        Runs anything that needs to occur prior to calling the method handler\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eformat_kwarg \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget_format_suffix\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e**\u003c/span\u003ekwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n        # Perform content negotiation and store the accepted info on the request\n        neg \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eperform_content_negotiation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        request\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eaccepted_renderer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eaccepted_media_type \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e neg\n\n        # Determine the \u003cspan class=\"token constant\"\u003eAPI\u003c/span\u003e version\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e versioning is \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e use\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n        version\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e scheme \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003edetermine_version\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003ekwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        request\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eversion\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eversioning_scheme \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e version\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e scheme\n\n        # Ensure that the incoming request is permitted\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eperform_authentication\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003echeck_permissions\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003echeck_throttles\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    # Note\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e Views are made \u003cspan class=\"token constant\"\u003eCSRF\u003c/span\u003e exempt from within \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003eas_view\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e to prevent\n    # accidental removal \u003cspan class=\"token keyword\"\u003eof\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e exemption \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e cases where \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003edispatch\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e needs to\n    # be overridden\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n    def \u003cspan class=\"token function\"\u003edispatch\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003ekwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n        \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003e.dispatch()\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e is pretty much the same \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e Django's regular dispatch\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        but \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e extra hooks \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e startup\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e finalize\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e and exception handling\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eargs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e args\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ekwargs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e kwargs\n        # 这里需要注意\n        request \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003einitialize_request\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003ekwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erequest \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e request\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eheaders \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edefault_response_headers  # deprecate\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            # 这里需要注意\n            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003einitial\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003ekwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n            # Get the appropriate handler method\n            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emethod\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elower\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehttp_method_names\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n                handler \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003egetattr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emethod\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elower\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                  self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehttp_method_not_allowed\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n                handler \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehttp_method_not_allowed\n\n            response \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ehandler\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003ekwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n        except Exception \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e exc\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            response \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ehandle_exception\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexc\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eresponse \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efinalize_response\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e response\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003ekwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eresponse\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e可以看出，当请求到达 dispatch 的时候，DRF 添加了一些钩子函数，用于开始 / 结束 / 错误控制。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e在 initialize_request 的时候，对 request 进行封装，添加上 parser / auth / negoriator / parser context\u003c/li\u003e\n\u003cli\u003e接着在 initial 方法里面校验了版本，进行了认证和鉴权，检查了限流\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e一看，其实与我们之前想封装 APIView 的想法不谋而合，而我们只是想想，DRF 是详细实现。\u003c/p\u003e\n\u003ch2 id=\"0x02-djangorestframework-的使用案例\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x02-djangorestframework-的使用案例\"\u003e#\u003c/a\u003e 0x02 DjangorestFramework 的使用案例\u003c/h2\u003e\n\u003ch3 id=\"如何开-webapi-接口\"\u003e\u003ca class=\"v-toc-item\" href=\"#如何开-webapi-接口\"\u003e#\u003c/a\u003e 如何开 WebAPI 接口\u003c/h3\u003e\n\u003cp\u003e回到我们的 yadjangoblog 上面来。这个时候我们想开一个博文列表 API:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# \u003cspan class=\"token number\"\u003e1.\u003c/span\u003e 定义序列器，用于序列化查询的每一条。\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBlogPostListSerializer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eserializers\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eModelSerializer\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    category \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eBlogCategorySerializer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eread_only\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTrue\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    tags \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eBlogTagSerializer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emany\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTrue\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e read_only\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTrue\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    title \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e serializers\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eCharField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e serializers\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eIntegerField\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMeta\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        model \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e BlogPost\n        fields \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'title'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'char_num'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'vote_num'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'category'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'tags'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'publish_date'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n# \u003cspan class=\"token number\"\u003e2.\u003c/span\u003e 定义过滤器，可以通过过滤器进行查询\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBlogPostFilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efilters\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eFilterSet\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    title \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e filters\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eCharFilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elookup_expr\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'contains'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    having_tags \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e filters\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eFilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ename\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"tags\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e lookup_expr\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'in'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMeta\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        model \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e BlogPost\n        fields \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'title'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'char_num'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'category'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'tags'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n# \u003cspan class=\"token number\"\u003e3.\u003c/span\u003e 指定其他设置，具体大家看源码就好了。\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBlogPostListAPIView\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egenerics\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eListAPIView\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n    依照 category \u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e tags \u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e 时间 （年 \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e 月 \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e 日  年 \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e 月 年）\n    \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n    queryset \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e BlogPost\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eobjects\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eall\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    serializer_class \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e BlogPostListSerializer\n    filter_backends \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efilters\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDjangoFilterBackend\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e OrderingFilter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    filter_class \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e BlogPostFilter\n    ordering_fields \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'publish_date'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    ordering \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'publish_date'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    permission_classes \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epermissions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eAllowAny\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    pagination_class \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e SmallResultsSetPagination\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在指定上面的操作之后，一个接口就快速的开出来了。\u003c/p\u003e\n\u003cp\u003e: TODO 插入一张图\u003c/p\u003e\n\u003cp\u003e当然，DRF 认认真真通读一遍的话，还是可以给自己节省不少时间的。\u003c/p\u003e\n\u003cp\u003e这是开接口，似乎，还少了什么，比如 Restful API.\u003c/p\u003e\n\u003ch3 id=\"前端如何使用-webapi-接口\"\u003e\u003ca class=\"v-toc-item\" href=\"#前端如何使用-webapi-接口\"\u003e#\u003c/a\u003e 前端如何使用 WebAPI 接口\u003c/h3\u003e\n\u003cp\u003e什么是 CORS 可以参考阮一峰的文章 \u003ca href=\"http://www.ruanyifeng.com/blog/2016/04/cors.html\"\u003ehttp://www.ruanyifeng.com/blog/2016/04/cors.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e在调试的时候，我们肯定是使用 ajax / fetch 方式请求。这就会遇到一个问题：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e跨域\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e解决方式也很简单，服务端只要服务器实现了 CORS 接口，就可以跨源通信。\u003c/p\u003e\n\u003cp\u003e安装 django-cors-headers, 并在 settings 中开启 CORS_ORIGIN_ALLOW_ALL = True 即可。\u003c/p\u003e\n\u003cp\u003e这里参考了临书的解决方案，要感谢 @临书 , 附上参考地址 \u003ca href=\"https://zhuanlan.zhihu.com/p/24893786\"\u003ehttps://zhuanlan.zhihu.com/p/24893786\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e对于本项目而言，使用了 axios 请求库，直接 get 即可。详细看前端代码即可。\u003c/p\u003e\n\u003ch2 id=\"0x03-restful-api-设计\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x03-restful-api-设计\"\u003e#\u003c/a\u003e 0x03 RESTFUL API 设计\u003c/h2\u003e\n\u003cp\u003e开发过程中，尽量靠近 RESTFUL API 的设计，而不是照搬。\u003c/p\u003e\n\u003cp\u003e举个其他领域的例子，有的人表述美就只有：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e已撸\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e但是不同的美各有各的模样：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e手如柔荑，肤如凝脂，领如蝤蛴，齿如瓠犀，螓首蛾眉，巧笑倩兮，美目盼兮。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e同样，放在 RESFUL 的时候确实也出现了这种情况：\u003c/p\u003e\n\u003cp\u003e几乎所有的业务逻辑最后会落实到数据表的 CURDE, 但是所有业务逻辑并不能完全使用 CRUDE 描述。\u003c/p\u003e\n\u003cp\u003e我们看下面的例子\u003c/p\u003e\n\u003ch3 id=\"关于请求\"\u003e\u003ca class=\"v-toc-item\" href=\"#关于请求\"\u003e#\u003c/a\u003e 关于请求\u003c/h3\u003e\n\u003cp\u003e举个例子，RESTFUL 适合纯粹 CURDE 的设计风格。\u003c/p\u003e\n\u003cp\u003e比如，新增博客，更新博客，查询博客，删除博客，查看是否含有博客\u003c/p\u003e\n\u003cp\u003e但语义在某些场景下表述不足， 比如，设计订单的时候，\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token constant\"\u003eURL\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003eapi\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ev1\u003cspan class=\"token operator\"\u003e/\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e/\u003c/span\u003esome_user\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eorders\n你查看订单集合，这个好理解。\u003cspan class=\"token keyword\"\u003eget\u003c/span\u003e 方法\n你新增订单，这个好理解。put 方法\n\u003cspan class=\"token constant\"\u003eURL\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003eapi\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ev1\u003cspan class=\"token operator\"\u003e/\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e/\u003c/span\u003esome_user\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eorder\u003cspan class=\"token operator\"\u003e/\u003c/span\u003exxxxxxx\n你删除订单，这个好理解。\u003cspan class=\"token keyword\"\u003edelete\u003c/span\u003e 方法\n你获取订单，这个好理解。\u003cspan class=\"token keyword\"\u003eget\u003c/span\u003e 方法\n你修改订单，这个好理解。post 方法\n\n但修改订单，有的时候可能会比较复杂，有可能是取消订单，有可能是评价订单，有可能是其他。而 \u003cspan class=\"token constant\"\u003eRESTFUL\u003c/span\u003e 表达这种情况就有些语义不足了。\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e当然，个人经验是，字段越多，越难靠近 RESTFUL 规范\u003c/p\u003e\n\u003cp\u003e这个时候，就需要设计者做好 RESTFULAPI 的设计与语义化的平衡了。\u003c/p\u003e\n\u003ch3 id=\"关于响应\"\u003e\u003ca class=\"v-toc-item\" href=\"#关于响应\"\u003e#\u003c/a\u003e 关于响应\u003c/h3\u003e\n\u003cp\u003e关于响应设计，主要有两点需要注意：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e状态码 (HTTP 状态码，也业务逻辑通用状态码）\u003c/li\u003e\n\u003cli\u003e响应内容 包含 业务逻辑通用状态码，剩下的视具体情况而定。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHTTP 状态码用于标记资源情况，比如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e200 表示获取资源\n404 表示 NOT FOUND\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但有时候也存在语义表达不足问题，一般前后端也会约定一个通用的状态码\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e通用状态码 错误信息 含义 HTTP 状态码\n999\t    unknow_v2_error\t未知错误\t400\n1000\tneed_permission\t需要权限\t403\n1001\turi_not_found\t资源不存在\t404\n1002\tmissing_args\t参数不全\t400\n1003\timage_too_large\t上传的图片太大\t400\n....\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e至于响应内容，一般都是见招拆招的。建议查看文章末尾的 Douban 的相关 API 规范来提升姿势。\u003c/p\u003e\n\u003ch2 id=\"0x04-django-的处理请求流程代码解读\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x04-django-的处理请求流程代码解读\"\u003e#\u003c/a\u003e 0x04 Django 的处理请求流程代码解读\u003c/h2\u003e\n\u003cp\u003e这小节属于一时兴起写的番外篇。和本文主体内容没啥必要的关联。不感兴趣的可以直接跳转到文章末尾点赞哈。\u003c/p\u003e\n\u003cp\u003eWSGI 全称叫做 web 服务器网关接口，通常情况下，gunicorn 或者 uwsgi 接收来自 nginx 转发来的请求之后，向 web app 提供了环境信息（叫请求上下文会不会好些）以及一个 callback. 这样的话，web app 就可以接收这个环境信息，处理完毕，通过回调函数处理请求，并返回响应。一个极简的 webapp 如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003edef \u003cspan class=\"token function\"\u003eapp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eenviron\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e start_response\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Simplest possible application object\"\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\n    data \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Hello, World!\\n'\u003c/span\u003e\n    status \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'200 OK'\u003c/span\u003e\n    response_headers \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'Content-type'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string\"\u003e'text/plain'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'Content-Length'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token function\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003estart_response\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estatus\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e response_headers\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003eiter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e现在我们看看 django 中是如何处理请求的。首先查看相关的 \u003ca href=\"http://wsgi.py\"\u003ewsgi.py\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# wsgi\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epy\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e os\nfrom django\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecore\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewsgi \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e get_wsgi_application\nos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eenviron\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetdefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"DJANGO_SETTINGS_MODULE\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"config.settings\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\napplication \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eget_wsgi_application\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n# 接着查看 get_wsgi_application\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e django\nfrom django\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecore\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehandlers\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewsgi \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e WSGIHandler\n\ndef \u003cspan class=\"token function\"\u003eget_wsgi_application\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n    The \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eto\u003c/span\u003e Django's \u003cspan class=\"token constant\"\u003eWSGI\u003c/span\u003e support\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e Return a \u003cspan class=\"token constant\"\u003eWSGI\u003c/span\u003e callable\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n\n    Avoids making django\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecore\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehandlers\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eWSGIHandler a \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token constant\"\u003eAPI\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e the\n    internal \u003cspan class=\"token constant\"\u003eWSGI\u003c/span\u003e implementation changes or moves \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e the future\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n    django\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eset_prefix\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eFalse\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003eWSGIHandler\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n# 于是自然而言的看到了 WSGIHandler\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWSGIHandler\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebase\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eBaseHandler\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    request_class \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e WSGIRequest\n\n    def \u003cspan class=\"token function\"\u003e__init__\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003ekwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003esuper\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003e__init__\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003ekwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eload_middleware\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    def \u003cspan class=\"token function\"\u003e__call__\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e environ\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e start_response\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        # 有木有看到 environ 和 start_response \u003cspan class=\"token operator\"\u003e??\u003c/span\u003e 这就是极简 web app 中的 webapp 核心方法。\n        \u003cspan class=\"token function\"\u003eset_script_prefix\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eget_script_name\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eenviron\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        signals\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erequest_started\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esender\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e__class__\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e environ\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eenviron\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        request \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003erequest_class\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eenviron\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        # 注意这一行，有请求处理逻辑 具体要见下面代码\n        response \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget_response\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        # \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e response\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e嗯，看到了子类，就要看看基类\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBaseHandler\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    _request_middleware \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e None\n    _view_middleware \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e None\n    _template_response_middleware \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e None\n    _response_middleware \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e None\n    _exception_middleware \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e None\n    _middleware_chain \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e None\n\n    def \u003cspan class=\"token function\"\u003eload_middleware\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n        注册 MiddleWare\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e 并赋值 _middleware_chain 方法，使之调用的时候可以先按照顺序从 setting 的 middleware 里面处理 requests\n        并在处理 request 的最后调用 私有方法 _get_response\n        \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e_request_middleware \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e_view_middleware \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e_template_response_middleware \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e_response_middleware \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e_exception_middleware \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\n        handler \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003econvert_exception_to_response\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e_get_response\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        # 注意，这里面是倒着来的 代码中越在前面，实际运行的时候处理就越在后面\n        \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e middleware_path \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token function\"\u003ereversed\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esettings\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eMIDDLEWARE\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            # 依次添加 view middleware \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e template middleware \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e exception middleware\n            middleware \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eimport_string\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emiddleware_path\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            mw_instance \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003emiddleware\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ehandler\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            handler \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003econvert_exception_to_response\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emw_instance\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n        # We only assign to \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e when initialization is complete \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e it is used\n        # \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e a flag \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e initialization being complete\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e_middleware_chain \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e handler\n\n    \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n\n    def \u003cspan class=\"token function\"\u003eget_response\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Return an HttpResponse object for the given HttpRequest.\"\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\n        # Setup \u003cspan class=\"token keyword\"\u003edefault\u003c/span\u003e url resolver \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e thread\n        \u003cspan class=\"token function\"\u003eset_urlconf\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esettings\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eROOT_URLCONF\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n        response \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003e_middleware_chain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        # \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e response\n\n    def \u003cspan class=\"token function\"\u003e_get_response\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n        Resolve and call the view\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e then apply view\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e exception\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e and\n        template_response middleware\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e This method is everything that happens\n        inside the request\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eresponse middleware\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\"\n        response \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e None\n\n        # \u003cspan class=\"token number\"\u003e1.\u003c/span\u003e 接着判断 urlconf （默认为 \u003cspan class=\"token constant\"\u003eROOT_URLCONF\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e 可以通过 middleware 进行设置\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token function\"\u003ehasattr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'urlconf'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            urlconf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eurlconf\n            \u003cspan class=\"token function\"\u003eset_urlconf\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eurlconf\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            resolver \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eget_resolver\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eurlconf\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            resolver \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eget_resolver\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n        resolver_match \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e resolver\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eresolve\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epath_info\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        callback\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e callback_args\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e callback_kwargs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e resolver_match\n        request\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eresolver_match \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e resolver_match\n\n        # Apply view middleware\u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n        # 注意，这个就是 view 函数\n        wrapped_callback \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emake_view_atomic\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecallback\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        response \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ewrapped_callback\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003ecallback_args\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003ecallback_kwargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        # Complain \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e the view returned \u003cspan class=\"token function\"\u003eNone\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea common error\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e response\n\n    def \u003cspan class=\"token function\"\u003eprocess_exception_by_middleware\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e exception\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        # \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e上面代码比较表达的意思比较简单，值得注意的地方我都加了注释。\u003c/p\u003e\n\u003cp\u003e需要特别注意的就是 middleware_chain 这个属性（实际上是一个方法）, 正是这个方法使得注册的 middleware （在 load_middleware 方法里）可以在 fbv 或者 cbv 处理 request 之前，通过对 request 进行处理。\u003c/p\u003e\n\u003ch2 id=\"0xee-参考链接\"\u003e\u003ca class=\"v-toc-item\" href=\"#0xee-参考链接\"\u003e#\u003c/a\u003e 0xEE. 参考链接\u003c/h2\u003e\n\u003cp\u003e还犹豫啥，Django 前后端分离最佳实践，点赞后，快上车吧\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e前端代码 \u003ca href=\"https://github.com/twocucao/YaVueBlog\"\u003ehttps://github.com/twocucao/YaVueBlog\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e后端代码 \u003ca href=\"https://github.com/twocucao/YaDjangoBlog\"\u003ehttps://github.com/twocucao/YaDjangoBlog\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e扩展阅读之 douban restful api 设计 \u003ca href=\"https://developers.douban.com/wiki/?title=api_v2\"\u003ehttps://developers.douban.com/wiki/?title=api_v2\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eChangeLog:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e2018-02-22\u003c/strong\u003e 开启本文\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e2018-03-04\u003c/strong\u003e 重修文字\u003c/li\u003e\n\u003c/ul\u003e\n","toc":"\u003cul class=\"v-article-toc\"\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#0x00-%E5%89%8D%E8%A8%80\"\u003e0x00 前言\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x01-djangorestframework-%E8%A7%A3%E8%AF%BB\"\u003e0x01 DjangorestFramework 解读\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8-drf-%E5%91%A2\"\u003e为什么要用 DRF 呢？\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E4%B8%8D%E4%BD%BF%E7%94%A8-drf-%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E5%86%99-webapi-%E5%81%9A%E5%91%A2\"\u003e不使用 DRF 应该如何写 WebAPI 做呢？\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#drf-%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E7%9A%84%E6%B5%81%E7%A8%8B\"\u003eDRF 处理请求的流程\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x02-djangorestframework-%E7%9A%84%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B\"\u003e0x02 DjangorestFramework 的使用案例\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E5%A6%82%E4%BD%95%E5%BC%80-webapi-%E6%8E%A5%E5%8F%A3\"\u003e如何开 WebAPI 接口\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E5%89%8D%E7%AB%AF%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-webapi-%E6%8E%A5%E5%8F%A3\"\u003e前端如何使用 WebAPI 接口\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x03-restful-api-%E8%AE%BE%E8%AE%A1\"\u003e0x03 RESTFUL API 设计\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E5%85%B3%E4%BA%8E%E8%AF%B7%E6%B1%82\"\u003e关于请求\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E5%85%B3%E4%BA%8E%E5%93%8D%E5%BA%94\"\u003e关于响应\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x04-django-%E7%9A%84%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB\"\u003e0x04 Django 的处理请求流程代码解读\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0xee-%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5\"\u003e0xEE. 参考链接\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n"}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"YaDjangoBlog 之前后端分离篇"},"buildId":"uCwe9m-iio9bnoWMgWDqE","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>