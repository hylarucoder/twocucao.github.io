<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Python 图片爬虫 | 海拉鲁编程客</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/49455a07b6dd33600cdf.css" as="style"/><link rel="stylesheet" href="/_next/static/css/49455a07b6dd33600cdf.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-20d43e08bea62467b090.js" defer=""></script><script src="/_next/static/chunks/framework-0441fae7fd130f37dee1.js" defer=""></script><script src="/_next/static/chunks/main-4777350f2a9ff73ea2b0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-3050679c6e5142ffcaf5.js" defer=""></script><script src="/_next/static/chunks/ea88be26-9bcf6ead520f4ac26973.js" defer=""></script><script src="/_next/static/chunks/421-f2f33a86b546237f0325.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-173fe2de48c90365db9d.js" defer=""></script><script src="/_next/static/uCwe9m-iio9bnoWMgWDqE/_buildManifest.js" defer=""></script><script src="/_next/static/uCwe9m-iio9bnoWMgWDqE/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="v-page"><nav class="shadow"><div class="flex flex-col container mx-auto h-12 px-40 md:flex-row md:items-center md:justify-between"><div class="flex justify-between items-center"><div><a class="text-gray-800 text-xl md:text-xl leading-5" href="/">海拉鲁编程客</a></div><div><button type="button" class="block text-gray-800 hover:text-gray-600 focus:text-gray-600 focus:outline-none md:hidden"><svg viewBox="0 0 24 24" class="h-6 w-6 fill-current"><path d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z"></path></svg></button></div></div><div class="md:flex flex-col md:flex-row md:-mx-4 hidden"><a class="my-1 text-gray-800 hover:text-blue-500 md:mx-4 md:my-0" href="/">首页</a><a class="my-1 text-gray-800 hover:text-blue-500 md:mx-4 md:my-0" href="/archive">归档</a><a class="my-1 text-gray-800 hover:text-blue-500 md:mx-4 md:my-0" href="/about">关于我</a><button style="cursor:pointer;overflow:hidden;width:50px;height:23.5px;appearance:none;-moz-appearance:none;-webkit-appearance:none;border:none;background-color:transparent;padding:0" aria-hidden="true"><div style="display:flex;align-items:center;justify-content:center;margin-top:-28.749999999999996px;margin-left:-16px;width:82.5px;height:82.5px"><div></div></div></button></div></div></nav><div class="v-article"><div class="v-article-main" style="margin:auto;width:786px"><div><h1 id="python-图片爬虫"><a class="v-toc-item" href="#python-图片爬虫">#</a> Python 图片爬虫</h1>
<h2 id="0x00-前言"><a class="v-toc-item" href="#0x00-前言">#</a> 0x00 前言</h2>
<p>在平时抓取部分自己喜欢的资源的时候，我们常常会去下载一些比较有用的资源，比如，我比较喜欢 GEM 的照片，但是，这个东西，总不能总是去找别人要吧，那么，怎么办？</p>
<p>很简单，我们只需要通过 Python 写一个小小的爬虫就可以解决这些问题。</p>
<p>什么是爬虫？自己可以百度去。</p>
<p>我这里指的爬虫是那些可以模拟浏览器的行为的小程序。</p>
<p>比如，我要抓取 G.E.M 的相片，那么，我就想个办法。把图片的地址解析出来。然后写一个小功能下载不就好了么。</p>
<!--more-->
<p>虽然，话是这么说，</p>
<p>但，怎么下手？</p>
<p>这在写这篇文章，并且写到这里的时候，刚刚决定了抓取几个站点</p>
<p>（刚刚百度了 邓紫棋壁纸 得到这个网站 <a href="http://www.6188.com/show/12788_1.html">http://www.6188.com/show/12788_1.html</a>)</p>
<h2 id="0x01-准备工作以及爬取思路"><a class="v-toc-item" href="#0x01-准备工作以及爬取思路">#</a> 0x01 准备工作以及爬取思路</h2>
<p>Python3,Chrome 浏览器或者 Firefox,<br>
Python3 基本依赖库 beautifulsoup4 lxml</p>
<p>任务如下：</p>
<ol>
<li>
<p>第一个简单案例 <a href="http://www.6188.com/show/12788_1.html">http://www.6188.com/show/12788_1.html</a></p>
</li>
<li>
<p>百度 API 解析</p>
</li>
<li>
<p>虾米照片爬取</p>
</li>
</ol>
<p>4.instagram 墙外下载 Gem 照片</p>
<ol start="5">
<li>发烧级别的 GEM 粉丝 - 虾米网 down! down! down!</li>
</ol>
<p>涉及到的知识点：</p>
<ol>
<li>爬虫的最最基本思路</li>
<li>几个解析方法 正则解析，bs4 解析，lxml 解析</li>
<li>多线程使用</li>
</ol>
<h2 id="0x02-6188com-壁纸抓取-关键词爬虫"><a class="v-toc-item" href="#0x02-6188com-壁纸抓取-关键词爬虫">#</a> 0x02 <a href="http://6188.com">6188.com</a> 壁纸抓取 – 关键词爬虫</h2>
<p>先说一下思路，首先，你要会点击下载按钮.(#-#)</p>
<ol>
<li>
<p>访问 <a href="http://www.6188.com/show/12788_1.html">http://www.6188.com/show/12788_1.html</a></p>
</li>
<li>
<p>点击下载大图</p>
</li>
<li>
<p>看大图，手动另存为</p>
</li>
</ol>
<p>这是普通人下载图片的方式。</p>
<p>让我们用程序员的眼光来看。</p>
<p>浏览器呈现的具体的过程可以看我的 PyDjango 中关于计算机 Http 协议的部分。</p>
<p>经过抓包 (http 包）分析 (chrome 的 F12), 知道，要想获取图片原始链接，有这么一个流程</p>
<p>从 <a href="http://www.6188.com/show/12788_1.html">http://www.6188.com/show/12788_1.html</a> 解析出下面链接</p>
<p>从 <a href="http://www.6188.com/show.php?pic=/flashAll/20140211/1392111065nvjKS7.jpg">http://www.6188.com/show.php?pic=/flashAll/20140211/1392111065nvjKS7.jpg</a> 解析下面链接</p>
<p>从 <a href="http://pic.6188.com/upload_6188s/flashAll/20140211/1392111065nvjKS7.jpg">http://pic.6188.com/upload_6188s/flashAll/20140211/1392111065nvjKS7.jpg</a> 下载图片。</p>
<p>这样一看，非常简单明了。这就是下载一张图片的链接。</p>
<p>同样道理，把下面的程序写成一个 for 循环，就可以直接下载 35 张图片。</p>
<pre><code class="language-html">http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span><span class="token number">6188.</span>com<span class="token operator">/</span>show<span class="token operator">/</span><span class="token number">12788_1.</span>html http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span><span class="token number">6188.</span>com<span class="token operator">/</span>show<span class="token operator">/</span><span class="token number">12788_2.</span>html
http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span><span class="token number">6188.</span>com<span class="token operator">/</span>show<span class="token operator">/</span><span class="token number">12788_3.</span>html <span class="token operator">...</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span><span class="token number">6188.</span>com<span class="token operator">/</span>show<span class="token operator">/</span><span class="token number">12788_35.</span>html
</code></pre>
<p>写的应该比较容易认出</p>
<pre><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> re
<span class="token keyword">import</span> requests

__author__ <span class="token operator">=</span> <span class="token string">'micheal'</span>

r <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"http://www.6188.com/show/12788_1.html"</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token string">"(/show\.php.+jpg)\""</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

pic_url <span class="token operator">=</span> <span class="token string">"http://www.6188.com"</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pic_url<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

m <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token string">"src='(http://.+\.jpg)"</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
real_url <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">try</span><span class="token operator">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"real_url-- 正在下载 --"</span><span class="token operator">+</span>real_url<span class="token punctuation">)</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>real_url<span class="token punctuation">,</span>stream<span class="token operator">=</span>True<span class="token punctuation">)</span>
    fileName <span class="token operator">=</span> <span class="token string">"GEM.jpg"</span>
    fileFullPath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/home/micheal/Pictures/'</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"正在下载"</span> <span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token function">open</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token operator">:</span>
        <span class="token keyword">for</span> chunk <span class="token keyword">in</span> r<span class="token punctuation">.</span><span class="token function">iter_content</span><span class="token punctuation">(</span>chunk_size<span class="token operator">=</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">:</span>
            <span class="token keyword">if</span> chunk<span class="token operator">:</span> # filter out keep<span class="token operator">-</span>alive <span class="token keyword">new</span> <span class="token class-name">chunks</span>
                f<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
                f<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    pass
except Exception<span class="token operator">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"出错"</span><span class="token punctuation">)</span>
    raise

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"任务完成"</span><span class="token punctuation">)</span>

</code></pre>
<p>添加 For 循环，优化一下</p>
<pre><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> re
<span class="token keyword">import</span> requests

__author__ <span class="token operator">=</span> <span class="token string">'micheal'</span>

s <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span> # 仿真 browser 使用一个会话

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token operator">:</span>
    html_url <span class="token operator">=</span> <span class="token string">"http://www.6188.com/show/12788_"</span><span class="token operator">+</span><span class="token function">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">".html"</span>
    r <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>html_url<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"downloading"</span> <span class="token operator">+</span> html_url<span class="token punctuation">)</span>
    m <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token string">"(/show\.php.+jpg)\""</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

    pic_url <span class="token operator">=</span> <span class="token string">"http://www.6188.com"</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pic_url<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

    m <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token string">"src='(http://.+\.jpg)"</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    real_url <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">try</span><span class="token operator">:</span>
        img_store_dir <span class="token operator">=</span> <span class="token string">"/home/micheal/Pictures/GEM/6188"</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"real_url-- 正在下载 --"</span><span class="token operator">+</span>real_url<span class="token punctuation">)</span>
        r <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>real_url<span class="token punctuation">,</span>stream<span class="token operator">=</span>True<span class="token punctuation">)</span>
        fileName <span class="token operator">=</span> <span class="token string">"GEM"</span><span class="token operator">+</span><span class="token function">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">".jpg"</span>
        <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>img_store_dir<span class="token punctuation">)</span><span class="token operator">:</span>
            os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>img_store_dir<span class="token punctuation">)</span>
        fileFullPath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>img_store_dir<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"正在下载"</span> <span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token function">open</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token operator">:</span>
            <span class="token keyword">for</span> chunk <span class="token keyword">in</span> r<span class="token punctuation">.</span><span class="token function">iter_content</span><span class="token punctuation">(</span>chunk_size<span class="token operator">=</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">:</span>
                <span class="token keyword">if</span> chunk<span class="token operator">:</span> # filter out keep<span class="token operator">-</span>alive <span class="token keyword">new</span> <span class="token class-name">chunks</span>
                    f<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
                    f<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        pass
    except Exception<span class="token operator">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"出错"</span><span class="token punctuation">)</span>
        <span class="token keyword">continue</span>
    finally<span class="token operator">:</span>
        pass

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"任务完成"</span><span class="token punctuation">)</span>

</code></pre>
<p>###评价</p>
<p>第一个小程序应该是非常容易看懂的。</p>
<p>那么，这个程序有什么缺点呢？</p>
<ul>
<li>下载速度太慢，需要使用多线程，</li>
<li>解析方法不具有通用性，这张网页中只有一个地址需要解析，所以正则表达式还是可以胜任。但是，复杂的网页肯定不行</li>
<li>下载的图片太少了。</li>
</ul>
<h2 id="0x03-百度-api-的解析-关键词多线程"><a class="v-toc-item" href="#0x03-百度-api-的解析-关键词多线程">#</a> 0x03 百度 API 的解析 – 关键词多线程</h2>
<p>主要就是增加了一个多线程的任务，原理什么的基本上和上面那个的相似</p>
<pre><code class="language-python"><span class="token keyword">import</span> json
<span class="token keyword">import</span> os
from queue <span class="token keyword">import</span> Queue
<span class="token keyword">import</span> re
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> requests

__author__ <span class="token operator">=</span> <span class="token string">'micheal'</span>

q <span class="token operator">=</span> <span class="token function">Queue</span><span class="token punctuation">(</span>maxsize<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
# http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>image<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token operator">/</span>i<span class="token operator">?</span>tn<span class="token operator">=</span>resultjsonavatarnew<span class="token operator">&amp;</span>ie<span class="token operator">=</span>utf<span class="token operator">-</span><span class="token number">8</span><span class="token operator">&amp;</span>word<span class="token operator">=</span><span class="token operator">%</span><span class="token constant">E9</span><span class="token operator">%</span><span class="token number">82</span><span class="token operator">%</span><span class="token number">93</span><span class="token operator">%</span><span class="token constant">E7</span><span class="token operator">%</span><span class="token constant">B4</span><span class="token operator">%</span><span class="token constant">AB</span><span class="token operator">%</span><span class="token constant">E6</span><span class="token operator">%</span><span class="token constant">A3</span><span class="token operator">%</span><span class="token number">8</span>B<span class="token operator">&amp;</span>cg<span class="token operator">=</span>star<span class="token operator">&amp;</span>pn<span class="token operator">=</span><span class="token number">0</span><span class="token operator">&amp;</span>rn<span class="token operator">=</span><span class="token number">60</span>

s <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

def <span class="token function">worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">while</span> True<span class="token operator">:</span>
        <span class="token keyword">try</span><span class="token operator">:</span>
            real_url <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"正在下载"</span> <span class="token operator">+</span> real_url<span class="token punctuation">)</span>

            img_store_dir <span class="token operator">=</span> <span class="token string">"/home/micheal/Pictures/GEM/baidu"</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"real_url-- 正在下载 --"</span><span class="token operator">+</span>real_url<span class="token punctuation">)</span>
            r <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>real_url<span class="token punctuation">,</span>stream<span class="token operator">=</span>True<span class="token punctuation">)</span>
            fileName <span class="token operator">=</span> real_url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>img_store_dir<span class="token punctuation">)</span><span class="token operator">:</span>
                os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>img_store_dir<span class="token punctuation">)</span>
            fileFullPath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>img_store_dir<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"正在下载"</span> <span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> <span class="token function">open</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token operator">:</span>
                <span class="token keyword">for</span> chunk <span class="token keyword">in</span> r<span class="token punctuation">.</span><span class="token function">iter_content</span><span class="token punctuation">(</span>chunk_size<span class="token operator">=</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">:</span>
                    <span class="token keyword">if</span> chunk<span class="token operator">:</span> # filter out keep<span class="token operator">-</span>alive <span class="token keyword">new</span> <span class="token class-name">chunks</span>
                        f<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
                        f<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            pass
        except Exception <span class="token keyword">as</span> e<span class="token operator">:</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"出错"</span><span class="token punctuation">)</span>
            raise e
            <span class="token keyword">continue</span>

        finally<span class="token operator">:</span>
            pass

        q<span class="token punctuation">.</span><span class="token function">task_done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    pass

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token operator">:</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">:</span>
        fr <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token number">60</span>
        to <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">+</span> <span class="token number">60</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"http://image.baidu.com/i?tn=resultjsonavatarnew&amp;ie=utf-8&amp;word=%E9%82%93%E7%B4%AB%E6%A3%8B&amp;cg=star&amp;pn="</span><span class="token operator">+</span><span class="token function">str</span><span class="token punctuation">(</span>fr<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"&amp;rn="</span><span class="token operator">+</span><span class="token function">str</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"&amp;itg=1&amp;z=3&amp;fr=&amp;width=0&amp;height=0&amp;lm=-1&amp;ic=0&amp;s=0&amp;st=-1"</span><span class="token punctuation">)</span>
        data <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">loads</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token operator">:</span>
            real_url <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'imgs'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'objURL'</span><span class="token punctuation">]</span>
            <span class="token function">print</span><span class="token punctuation">(</span>real_url<span class="token punctuation">)</span>
            q<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>real_url<span class="token punctuation">)</span>

        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token operator">:</span>
            t <span class="token operator">=</span> threading<span class="token punctuation">.</span><span class="token function">Thread</span><span class="token punctuation">(</span>target<span class="token operator">=</span>worker<span class="token punctuation">)</span>
            t<span class="token punctuation">.</span>daemon <span class="token operator">=</span> True
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

q<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"任务完成"</span><span class="token punctuation">)</span>

</code></pre>
<p>引入了多线程，但是抓取效果并不好，大概有 10% 左右的照片可能是有点问题的，把线程数目从 20 条调整小一些。</p>
<p>先写到这里，明天接着写剩下来的代码。</p>
<h2 id="0x04-抓取虾米的相册-反反爬虫"><a class="v-toc-item" href="#0x04-抓取虾米的相册-反反爬虫">#</a> 0x04 抓取虾米的相册 – 反反爬虫</h2>
<p>好吧，我们将魔手伸向了虾米音乐的图片板块</p>
<p><a href="http://www.xiami.com/artist/pic-55712">http://www.xiami.com/artist/pic-55712</a></p>
<p>我们尝试使用昨天的方法获取页面。</p>
<pre><code class="language-python">ss <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>“http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>xiami<span class="token punctuation">.</span>com<span class="token operator">/</span>artist<span class="token operator">/</span>pic<span class="token operator">-</span><span class="token number">55712</span><span class="token operator">?</span>spm<span class="token operator">=</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">.</span>IaKt5o<span class="token operator">&amp;</span>page<span class="token operator">=</span><span class="token number">3</span>”<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

</code></pre>
<p>但是出现问题了，</p>
<pre><code class="language-html"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> <span class="token constant">HTML</span> <span class="token constant">PUBLIC</span> “<span class="token operator">-</span><span class="token comment">//IETF//DTD HTML 2.0//EN”></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
<span class="token operator">&lt;</span>head<span class="token operator">></span><span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token number">400</span> Bad Request<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
<span class="token operator">&lt;</span>body bgcolor<span class="token operator">=</span>”white”<span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">with</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token keyword">with</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>“script”<span class="token punctuation">)</span><span class="token punctuation">,</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>“exparams”<span class="token punctuation">,</span>”category<span class="token operator">=</span><span class="token operator">&amp;</span>userid<span class="token operator">=</span><span class="token operator">&amp;</span>aplus<span class="token operator">&amp;</span>yunid<span class="token operator">=</span><span class="token operator">&amp;&amp;</span>asid<span class="token operator">=</span>AABI4v5USkJh1pUp01o<span class="token operator">=</span>”<span class="token punctuation">,</span>id<span class="token operator">=</span>”tb<span class="token operator">-</span>beacon<span class="token operator">-</span>aplus”<span class="token punctuation">,</span>src<span class="token operator">=</span><span class="token punctuation">(</span>location<span class="token operator">></span>”https”<span class="token operator">?</span>”<span class="token comment">//s”:”//a”)+”.tbcdn.cn/s/aplus_v2.js”)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>

<span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token number">400</span> Bad Request<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token operator">&lt;</span>p<span class="token operator">></span>Your browser sent a request that <span class="token keyword">this</span> server could not understand<span class="token punctuation">.</span> Sorry <span class="token keyword">for</span> the inconvenience<span class="token punctuation">.</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">></span>
Please report <span class="token keyword">this</span> message and include the following information to us<span class="token punctuation">.</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">></span>
Thank you very much<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
<span class="token operator">&lt;</span>table<span class="token operator">></span>
<span class="token operator">&lt;</span>tr<span class="token operator">></span>
<span class="token operator">&lt;</span>td<span class="token operator">></span><span class="token constant">URL</span><span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">></span>
<span class="token operator">&lt;</span>td<span class="token operator">></span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>xiami<span class="token punctuation">.</span>com<span class="token operator">/</span>artist<span class="token operator">/</span>pic<span class="token operator">-</span><span class="token number">55712</span><span class="token operator">?</span>spm<span class="token operator">=</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">.</span>IaKt5o<span class="token operator">&amp;</span>amp<span class="token punctuation">;</span>page<span class="token operator">=</span><span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">></span>
<span class="token operator">&lt;</span>tr<span class="token operator">></span>
<span class="token operator">&lt;</span>td<span class="token operator">></span>Server<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">></span>
<span class="token operator">&lt;</span>td<span class="token operator">></span>web<span class="token operator">-</span>xiami<span class="token operator">-</span>main<span class="token operator">-</span><span class="token number">030.</span>cm10<span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">></span>
<span class="token operator">&lt;</span>tr<span class="token operator">></span>
<span class="token operator">&lt;</span>td<span class="token operator">></span>Date<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">></span>
<span class="token operator">&lt;</span>td<span class="token operator">></span><span class="token number">2015</span><span class="token operator">/</span><span class="token number">03</span><span class="token operator">/</span><span class="token number">10</span> <span class="token number">20</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">36</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">></span>
<span class="token operator">&lt;</span>hr<span class="token operator">/</span><span class="token operator">></span>Powered by Tengine<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span>

Process finished <span class="token keyword">with</span> exit code <span class="token number">0</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>h<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span>
</code></pre>
<p>我们前面使用的代码都是爬取一些没有做太多防止爬虫的网站，但是，我们今天准备爬取的是一个有防护措施的网站。</p>
<p>没办法，修改一下 headers, 然后继续访问即可。</p>
<h2 id="0xee-更新"><a class="v-toc-item" href="#0xee-更新">#</a> 0xEE 更新</h2>
<hr>
<p>ChangeLog:</p>
<ul>
<li><strong>2017-12-19</strong> 重修文字</li>
</ul>
</div></div><div><ul class="v-article-toc">
<li><a href="#python-%E5%9B%BE%E7%89%87%E7%88%AC%E8%99%AB">Python 图片爬虫</a>
<ul>
<li><a href="#0x00-%E5%89%8D%E8%A8%80">0x00 前言</a></li>
<li><a href="#0x01-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%E4%BB%A5%E5%8F%8A%E7%88%AC%E5%8F%96%E6%80%9D%E8%B7%AF">0x01 准备工作以及爬取思路</a></li>
<li><a href="#0x02-6188com-%E5%A3%81%E7%BA%B8%E6%8A%93%E5%8F%96-%E5%85%B3%E9%94%AE%E8%AF%8D%E7%88%AC%E8%99%AB">0x02 6188.com 壁纸抓取 – 关键词爬虫</a></li>
<li><a href="#0x03-%E7%99%BE%E5%BA%A6-api-%E7%9A%84%E8%A7%A3%E6%9E%90-%E5%85%B3%E9%94%AE%E8%AF%8D%E5%A4%9A%E7%BA%BF%E7%A8%8B">0x03 百度 API 的解析 – 关键词多线程</a></li>
<li><a href="#0x04-%E6%8A%93%E5%8F%96%E8%99%BE%E7%B1%B3%E7%9A%84%E7%9B%B8%E5%86%8C-%E5%8F%8D%E5%8F%8D%E7%88%AC%E8%99%AB">0x04 抓取虾米的相册 – 反反爬虫</a></li>
<li><a href="#0xee-%E6%9B%B4%E6%96%B0">0xEE 更新</a></li>
</ul>
</li>
</ul>
</div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"tags":["Python"],"path":"20150309_图片爬虫.md","title":"Python 图片爬虫","slug":"Python 图片爬虫","date":"2017-12-01","category":"Python","lastMod":"2020-01-01","description":"这篇文章展示了基本的 Markdown 语法和格式.","thumbnail":"","content":"\u003ch1 id=\"python-图片爬虫\"\u003e\u003ca class=\"v-toc-item\" href=\"#python-图片爬虫\"\u003e#\u003c/a\u003e Python 图片爬虫\u003c/h1\u003e\n\u003ch2 id=\"0x00-前言\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x00-前言\"\u003e#\u003c/a\u003e 0x00 前言\u003c/h2\u003e\n\u003cp\u003e在平时抓取部分自己喜欢的资源的时候，我们常常会去下载一些比较有用的资源，比如，我比较喜欢 GEM 的照片，但是，这个东西，总不能总是去找别人要吧，那么，怎么办？\u003c/p\u003e\n\u003cp\u003e很简单，我们只需要通过 Python 写一个小小的爬虫就可以解决这些问题。\u003c/p\u003e\n\u003cp\u003e什么是爬虫？自己可以百度去。\u003c/p\u003e\n\u003cp\u003e我这里指的爬虫是那些可以模拟浏览器的行为的小程序。\u003c/p\u003e\n\u003cp\u003e比如，我要抓取 G.E.M 的相片，那么，我就想个办法。把图片的地址解析出来。然后写一个小功能下载不就好了么。\u003c/p\u003e\n\u003c!--more--\u003e\n\u003cp\u003e虽然，话是这么说，\u003c/p\u003e\n\u003cp\u003e但，怎么下手？\u003c/p\u003e\n\u003cp\u003e这在写这篇文章，并且写到这里的时候，刚刚决定了抓取几个站点\u003c/p\u003e\n\u003cp\u003e（刚刚百度了 邓紫棋壁纸 得到这个网站 \u003ca href=\"http://www.6188.com/show/12788_1.html\"\u003ehttp://www.6188.com/show/12788_1.html\u003c/a\u003e)\u003c/p\u003e\n\u003ch2 id=\"0x01-准备工作以及爬取思路\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x01-准备工作以及爬取思路\"\u003e#\u003c/a\u003e 0x01 准备工作以及爬取思路\u003c/h2\u003e\n\u003cp\u003ePython3,Chrome 浏览器或者 Firefox,\u003cbr\u003e\nPython3 基本依赖库 beautifulsoup4 lxml\u003c/p\u003e\n\u003cp\u003e任务如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e第一个简单案例 \u003ca href=\"http://www.6188.com/show/12788_1.html\"\u003ehttp://www.6188.com/show/12788_1.html\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e百度 API 解析\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e虾米照片爬取\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e4.instagram 墙外下载 Gem 照片\u003c/p\u003e\n\u003col start=\"5\"\u003e\n\u003cli\u003e发烧级别的 GEM 粉丝 - 虾米网 down! down! down!\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e涉及到的知识点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e爬虫的最最基本思路\u003c/li\u003e\n\u003cli\u003e几个解析方法 正则解析，bs4 解析，lxml 解析\u003c/li\u003e\n\u003cli\u003e多线程使用\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"0x02-6188com-壁纸抓取-关键词爬虫\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x02-6188com-壁纸抓取-关键词爬虫\"\u003e#\u003c/a\u003e 0x02 \u003ca href=\"http://6188.com\"\u003e6188.com\u003c/a\u003e 壁纸抓取 – 关键词爬虫\u003c/h2\u003e\n\u003cp\u003e先说一下思路，首先，你要会点击下载按钮.(#-#)\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e访问 \u003ca href=\"http://www.6188.com/show/12788_1.html\"\u003ehttp://www.6188.com/show/12788_1.html\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e点击下载大图\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e看大图，手动另存为\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e这是普通人下载图片的方式。\u003c/p\u003e\n\u003cp\u003e让我们用程序员的眼光来看。\u003c/p\u003e\n\u003cp\u003e浏览器呈现的具体的过程可以看我的 PyDjango 中关于计算机 Http 协议的部分。\u003c/p\u003e\n\u003cp\u003e经过抓包 (http 包）分析 (chrome 的 F12), 知道，要想获取图片原始链接，有这么一个流程\u003c/p\u003e\n\u003cp\u003e从 \u003ca href=\"http://www.6188.com/show/12788_1.html\"\u003ehttp://www.6188.com/show/12788_1.html\u003c/a\u003e 解析出下面链接\u003c/p\u003e\n\u003cp\u003e从 \u003ca href=\"http://www.6188.com/show.php?pic=/flashAll/20140211/1392111065nvjKS7.jpg\"\u003ehttp://www.6188.com/show.php?pic=/flashAll/20140211/1392111065nvjKS7.jpg\u003c/a\u003e 解析下面链接\u003c/p\u003e\n\u003cp\u003e从 \u003ca href=\"http://pic.6188.com/upload_6188s/flashAll/20140211/1392111065nvjKS7.jpg\"\u003ehttp://pic.6188.com/upload_6188s/flashAll/20140211/1392111065nvjKS7.jpg\u003c/a\u003e 下载图片。\u003c/p\u003e\n\u003cp\u003e这样一看，非常简单明了。这就是下载一张图片的链接。\u003c/p\u003e\n\u003cp\u003e同样道理，把下面的程序写成一个 for 循环，就可以直接下载 35 张图片。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003ehttp\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ewww\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token number\"\u003e6188.\u003c/span\u003ecom\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eshow\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e12788_1.\u003c/span\u003ehtml http\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ewww\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token number\"\u003e6188.\u003c/span\u003ecom\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eshow\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e12788_2.\u003c/span\u003ehtml\nhttp\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ewww\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token number\"\u003e6188.\u003c/span\u003ecom\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eshow\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e12788_3.\u003c/span\u003ehtml \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e http\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ewww\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token number\"\u003e6188.\u003c/span\u003ecom\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eshow\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e12788_35.\u003c/span\u003ehtml\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e写的应该比较容易认出\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e os\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e re\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e requests\n\n__author__ \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'micheal'\u003c/span\u003e\n\nr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e requests\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"http://www.6188.com/show/12788_1.html\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nm \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e re\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esearch\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"(/show\\.php.+jpg)\\\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e r\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\npic_url \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"http://www.6188.com\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e m\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egroup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003em\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egroup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\ndata \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e requests\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epic_url\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\nm \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e re\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esearch\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"src='(http://.+\\.jpg)\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nreal_url \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e m\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egroup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"real_url-- 正在下载 --\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003ereal_url\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    r \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e requests\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ereal_url\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003estream\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTrue\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    fileName \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"GEM.jpg\"\u003c/span\u003e\n    fileFullPath \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e os\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ejoin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'/home/micheal/Pictures/'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fileName\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"正在下载\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token function\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estatus_code\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"token function\"\u003eopen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efileFullPath\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'wb'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e f\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e chunk \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e r\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eiter_content\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003echunk_size\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1024\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e chunk\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e # filter out keep\u003cspan class=\"token operator\"\u003e-\u003c/span\u003ealive \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003echunks\u003c/span\u003e\n                f\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003echunk\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                f\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eflush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    pass\nexcept Exception\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"出错\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    raise\n\n\u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"任务完成\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e添加 For 循环，优化一下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e os\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e re\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e requests\n\n__author__ \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'micheal'\u003c/span\u003e\n\ns \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e requests\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esession\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e # 仿真 browser 使用一个会话\n\n\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token function\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token number\"\u003e30\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    html_url \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"http://www.6188.com/show/12788_\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token function\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token string\"\u003e\".html\"\u003c/span\u003e\n    r \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ehtml_url\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"downloading\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e html_url\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    m \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e re\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esearch\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"(/show\\.php.+jpg)\\\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e r\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    pic_url \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"http://www.6188.com\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e m\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egroup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003em\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egroup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    data \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epic_url\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    m \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e re\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esearch\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"src='(http://.+\\.jpg)\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    real_url \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e m\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egroup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        img_store_dir \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"/home/micheal/Pictures/GEM/6188\"\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"real_url-- 正在下载 --\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003ereal_url\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        r \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ereal_url\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003estream\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTrue\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        fileName \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"GEM\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token function\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token string\"\u003e\".jpg\"\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e not os\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eexists\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eimg_store_dir\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            os\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emakedirs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eimg_store_dir\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        fileFullPath \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e os\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ejoin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eimg_store_dir\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fileName\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"正在下载\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token function\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estatus_code\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"token function\"\u003eopen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efileFullPath\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'wb'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e f\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e chunk \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e r\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eiter_content\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003echunk_size\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1024\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e chunk\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e # filter out keep\u003cspan class=\"token operator\"\u003e-\u003c/span\u003ealive \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003echunks\u003c/span\u003e\n                    f\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003echunk\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                    f\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eflush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        pass\n    except Exception\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"出错\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econtinue\u003c/span\u003e\n    finally\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        pass\n\n\u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"任务完成\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e###评价\u003c/p\u003e\n\u003cp\u003e第一个小程序应该是非常容易看懂的。\u003c/p\u003e\n\u003cp\u003e那么，这个程序有什么缺点呢？\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e下载速度太慢，需要使用多线程，\u003c/li\u003e\n\u003cli\u003e解析方法不具有通用性，这张网页中只有一个地址需要解析，所以正则表达式还是可以胜任。但是，复杂的网页肯定不行\u003c/li\u003e\n\u003cli\u003e下载的图片太少了。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"0x03-百度-api-的解析-关键词多线程\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x03-百度-api-的解析-关键词多线程\"\u003e#\u003c/a\u003e 0x03 百度 API 的解析 – 关键词多线程\u003c/h2\u003e\n\u003cp\u003e主要就是增加了一个多线程的任务，原理什么的基本上和上面那个的相似\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e json\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e os\nfrom queue \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e Queue\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e re\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e threading\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e requests\n\n__author__ \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'micheal'\u003c/span\u003e\n\nq \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eQueue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emaxsize\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n# http\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eimage\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebaidu\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecom\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ei\u003cspan class=\"token operator\"\u003e?\u003c/span\u003etn\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eresultjsonavatarnew\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003eie\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eutf\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e8\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003eword\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token operator\"\u003e%\u003c/span\u003e\u003cspan class=\"token constant\"\u003eE9\u003c/span\u003e\u003cspan class=\"token operator\"\u003e%\u003c/span\u003e\u003cspan class=\"token number\"\u003e82\u003c/span\u003e\u003cspan class=\"token operator\"\u003e%\u003c/span\u003e\u003cspan class=\"token number\"\u003e93\u003c/span\u003e\u003cspan class=\"token operator\"\u003e%\u003c/span\u003e\u003cspan class=\"token constant\"\u003eE7\u003c/span\u003e\u003cspan class=\"token operator\"\u003e%\u003c/span\u003e\u003cspan class=\"token constant\"\u003eB4\u003c/span\u003e\u003cspan class=\"token operator\"\u003e%\u003c/span\u003e\u003cspan class=\"token constant\"\u003eAB\u003c/span\u003e\u003cspan class=\"token operator\"\u003e%\u003c/span\u003e\u003cspan class=\"token constant\"\u003eE6\u003c/span\u003e\u003cspan class=\"token operator\"\u003e%\u003c/span\u003e\u003cspan class=\"token constant\"\u003eA3\u003c/span\u003e\u003cspan class=\"token operator\"\u003e%\u003c/span\u003e\u003cspan class=\"token number\"\u003e8\u003c/span\u003eB\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003ecg\u003cspan class=\"token operator\"\u003e=\u003c/span\u003estar\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003epn\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003ern\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e60\u003c/span\u003e\n\ns \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e requests\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esession\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\ndef \u003cspan class=\"token function\"\u003eworker\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e True\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            real_url \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e q\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"正在下载\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e real_url\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n            img_store_dir \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"/home/micheal/Pictures/GEM/baidu\"\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"real_url-- 正在下载 --\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003ereal_url\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            r \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ereal_url\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003estream\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTrue\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            fileName \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e real_url\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esplit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e not os\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eexists\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eimg_store_dir\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n                os\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emakedirs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eimg_store_dir\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            fileFullPath \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e os\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ejoin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eimg_store_dir\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fileName\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"正在下载\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token function\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003er\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estatus_code\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"token function\"\u003eopen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efileFullPath\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'wb'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e f\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e chunk \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e r\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eiter_content\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003echunk_size\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1024\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e chunk\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e # filter out keep\u003cspan class=\"token operator\"\u003e-\u003c/span\u003ealive \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003echunks\u003c/span\u003e\n                        f\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003echunk\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                        f\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eflush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            pass\n        except Exception \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"出错\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            raise e\n            \u003cspan class=\"token keyword\"\u003econtinue\u003c/span\u003e\n\n        finally\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            pass\n\n        q\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003etask_done\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    pass\n\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e __name__ \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"__main__\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token function\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e100\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n        fr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e60\u003c/span\u003e\n        to \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e60\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token number\"\u003e60\u003c/span\u003e\n        r \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e requests\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"http://image.baidu.com/i?tn=resultjsonavatarnew\u0026amp;ie=utf-8\u0026amp;word=%E9%82%93%E7%B4%AB%E6%A3%8B\u0026amp;cg=star\u0026amp;pn=\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token function\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\u0026amp;rn=\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token function\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eto\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\u0026amp;itg=1\u0026amp;z=3\u0026amp;fr=\u0026amp;width=0\u0026amp;height=0\u0026amp;lm=-1\u0026amp;ic=0\u0026amp;s=0\u0026amp;st=-1\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        data \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e json\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eloads\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003er\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e j \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token function\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e60\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            real_url \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'imgs'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ej\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'objURL'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ereal_url\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            q\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eput\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ereal_url\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e j \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token function\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e20\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            t \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e threading\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eThread\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etarget\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eworker\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            t\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edaemon \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e True\n            t\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003estart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\nq\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ejoin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"任务完成\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e引入了多线程，但是抓取效果并不好，大概有 10% 左右的照片可能是有点问题的，把线程数目从 20 条调整小一些。\u003c/p\u003e\n\u003cp\u003e先写到这里，明天接着写剩下来的代码。\u003c/p\u003e\n\u003ch2 id=\"0x04-抓取虾米的相册-反反爬虫\"\u003e\u003ca class=\"v-toc-item\" href=\"#0x04-抓取虾米的相册-反反爬虫\"\u003e#\u003c/a\u003e 0x04 抓取虾米的相册 – 反反爬虫\u003c/h2\u003e\n\u003cp\u003e好吧，我们将魔手伸向了虾米音乐的图片板块\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.xiami.com/artist/pic-55712\"\u003ehttp://www.xiami.com/artist/pic-55712\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e我们尝试使用昨天的方法获取页面。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003ess \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e requests\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esession\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e ss\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e“http\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ewww\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exiami\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecom\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eartist\u003cspan class=\"token operator\"\u003e/\u003c/span\u003epic\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e55712\u003c/span\u003e\u003cspan class=\"token operator\"\u003e?\u003c/span\u003espm\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token number\"\u003e.0\u003c/span\u003e\u003cspan class=\"token number\"\u003e.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eIaKt5o\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003epage\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e”\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003er\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是出现问题了，\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token constant\"\u003eDOCTYPE\u003c/span\u003e \u003cspan class=\"token constant\"\u003eHTML\u003c/span\u003e \u003cspan class=\"token constant\"\u003ePUBLIC\u003c/span\u003e “\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token comment\"\u003e//IETF//DTD HTML 2.0//EN”\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003ehtml\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003ehead\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003etitle\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token number\"\u003e400\u003c/span\u003e Bad Request\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etitle\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ehead\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003ebody bgcolor\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e”white”\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003escript\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edocument\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003einsertBefore\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003ecreateElement\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e“script”\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003efirstChild\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003esetAttribute\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e“exparams”\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e”category\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003euserid\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003eaplus\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003eyunid\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003easid\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eAABI4v5USkJh1pUp01o\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e”\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003eid\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e”tb\u003cspan class=\"token operator\"\u003e-\u003c/span\u003ebeacon\u003cspan class=\"token operator\"\u003e-\u003c/span\u003eaplus”\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003esrc\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elocation\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e”https”\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e”\u003cspan class=\"token comment\"\u003e//s”:”//a”)+”.tbcdn.cn/s/aplus_v2.js”)\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003escript\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003eh1\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token number\"\u003e400\u003c/span\u003e Bad Request\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eh1\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003ep\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003eYour browser sent a request that \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e server could not understand\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e Sorry \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e the inconvenience\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003ebr\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\nPlease report \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e message and include the following information to us\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003ebr\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\nThank you very much\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ep\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003etable\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003etr\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003etd\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token constant\"\u003eURL\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etd\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003etd\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003ehttp\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ewww\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exiami\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecom\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eartist\u003cspan class=\"token operator\"\u003e/\u003c/span\u003epic\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e55712\u003c/span\u003e\u003cspan class=\"token operator\"\u003e?\u003c/span\u003espm\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token number\"\u003e.0\u003c/span\u003e\u003cspan class=\"token number\"\u003e.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eIaKt5o\u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003eamp\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003epage\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etd\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etr\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003etr\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003etd\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003eServer\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etd\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003etd\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003eweb\u003cspan class=\"token operator\"\u003e-\u003c/span\u003exiami\u003cspan class=\"token operator\"\u003e-\u003c/span\u003emain\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e030.\u003c/span\u003ecm10\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etd\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etr\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003etr\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003etd\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003eDate\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etd\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003etd\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token number\"\u003e2015\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e03\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e10\u003c/span\u003e \u003cspan class=\"token number\"\u003e20\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token number\"\u003e23\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\u003cspan class=\"token number\"\u003e36\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etd\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etr\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etable\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003ehr\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003ePowered by Tengine\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ebody\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ehtml\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\nProcess finished \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e exit code \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etd\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etr\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etable\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ep\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003eh\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003escript\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003etitle\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ehead\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003ehtml\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们前面使用的代码都是爬取一些没有做太多防止爬虫的网站，但是，我们今天准备爬取的是一个有防护措施的网站。\u003c/p\u003e\n\u003cp\u003e没办法，修改一下 headers, 然后继续访问即可。\u003c/p\u003e\n\u003ch2 id=\"0xee-更新\"\u003e\u003ca class=\"v-toc-item\" href=\"#0xee-更新\"\u003e#\u003c/a\u003e 0xEE 更新\u003c/h2\u003e\n\u003chr\u003e\n\u003cp\u003eChangeLog:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e2017-12-19\u003c/strong\u003e 重修文字\u003c/li\u003e\n\u003c/ul\u003e\n","toc":"\u003cul class=\"v-article-toc\"\u003e\n\u003cli\u003e\u003ca href=\"#python-%E5%9B%BE%E7%89%87%E7%88%AC%E8%99%AB\"\u003ePython 图片爬虫\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#0x00-%E5%89%8D%E8%A8%80\"\u003e0x00 前言\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x01-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%E4%BB%A5%E5%8F%8A%E7%88%AC%E5%8F%96%E6%80%9D%E8%B7%AF\"\u003e0x01 准备工作以及爬取思路\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x02-6188com-%E5%A3%81%E7%BA%B8%E6%8A%93%E5%8F%96-%E5%85%B3%E9%94%AE%E8%AF%8D%E7%88%AC%E8%99%AB\"\u003e0x02 6188.com 壁纸抓取 – 关键词爬虫\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x03-%E7%99%BE%E5%BA%A6-api-%E7%9A%84%E8%A7%A3%E6%9E%90-%E5%85%B3%E9%94%AE%E8%AF%8D%E5%A4%9A%E7%BA%BF%E7%A8%8B\"\u003e0x03 百度 API 的解析 – 关键词多线程\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0x04-%E6%8A%93%E5%8F%96%E8%99%BE%E7%B1%B3%E7%9A%84%E7%9B%B8%E5%86%8C-%E5%8F%8D%E5%8F%8D%E7%88%AC%E8%99%AB\"\u003e0x04 抓取虾米的相册 – 反反爬虫\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#0xee-%E6%9B%B4%E6%96%B0\"\u003e0xEE 更新\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n"}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"Python 图片爬虫"},"buildId":"uCwe9m-iio9bnoWMgWDqE","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>