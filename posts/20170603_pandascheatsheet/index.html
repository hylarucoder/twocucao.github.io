<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Pandas CheatSheet - 海拉鲁编程客</title><meta name="Description" content="这篇文章展示了基本的 Markdown 语法和格式."><meta property="og:title" content="Pandas CheatSheet" />
<meta property="og:description" content="这篇文章展示了基本的 Markdown 语法和格式." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://twocucao.xyz/posts/20170603_pandascheatsheet/" />
<meta property="article:published_time" content="2017-06-03T21:57:40+08:00" />
<meta property="article:modified_time" content="2020-01-01T16:45:40+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Pandas CheatSheet"/>
<meta name="twitter:description" content="这篇文章展示了基本的 Markdown 语法和格式."/>
<meta name="application-name" content="海拉鲁编程客">
<meta name="apple-mobile-web-app-title" content="海拉鲁编程客"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://twocucao.xyz/posts/20170603_pandascheatsheet/" /><link rel="prev" href="http://twocucao.xyz/posts/20170529_%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8Etensorflow%E7%9A%84%E5%88%86%E7%B1%BB%E5%99%A8/" /><link rel="next" href="http://twocucao.xyz/posts/20170623_vimcheatsheet/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Pandas CheatSheet",
        "inLanguage": "zh-cn",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/twocucao.xyz\/posts\/20170603_pandascheatsheet\/"
        },"genre": "posts","keywords": "数据分析","wordcount":  885 ,
        "url": "http:\/\/twocucao.xyz\/posts\/20170603_pandascheatsheet\/","datePublished": "2017-06-03T21:57:40+08:00","dateModified": "2020-01-01T16:45:40+08:00","publisher": {
            "@type": "Organization",
            "name": "twocucao"},"author": {
                "@type": "Person",
                "name": "twocucao"
            },"description": "这篇文章展示了基本的 Markdown 语法和格式."
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="海拉鲁编程客">海拉鲁编程客</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/posts/"> 存档 </a><a class="menu-item" href="/tags/"> 标签 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="海拉鲁编程客">海拉鲁编程客</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/posts/" title="">存档</a><a class="menu-item" href="/tags/" title="">标签</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Pandas CheatSheet</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="http://twocucao.xyz" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas"></i>twocucao</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/python/"><i class="far fa-folder fa-fw"></i>Python</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2017-06-03">2017-06-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 885 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 5 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#0x00-前言">0x00 前言</a></li>
    <li><a href="#0x01-series-相关">0x01 Series 相关</a></li>
    <li><a href="#0x02-dataframe-相关">0x02 DataFrame 相关</a>
      <ul>
        <li><a href="#21-对象创建">2.1 对象创建</a></li>
        <li><a href="#22-浏览数据">2.2 浏览数据</a></li>
        <li><a href="#23-修改表内容">2.3 修改表内容</a></li>
        <li><a href="#24-查看表内容">2.4 查看表内容</a></li>
        <li><a href="#25-表变换">2.5 表变换</a></li>
        <li><a href="#26-表遍历">2.6 表遍历</a></li>
      </ul>
    </li>
    <li><a href="#数据导入导出">数据导入导出</a>
      <ul>
        <li><a href="#sql">SQL</a></li>
        <li><a href="#csv">CSV</a></li>
        <li><a href="#excel">Excel</a></li>
      </ul>
    </li>
    <li><a href="#0x02-可视化技术">0x02 可视化技术</a></li>
    <li><a href="#0x03-asd1">0x03 asd1</a></li>
    <li><a href="#0x07-performance-tips">0x07 Performance Tips</a>
      <ul>
        <li><a href="#71-精简行列">7.1 精简行列</a></li>
        <li><a href="#72-大文件的处理">7.2 大文件的处理</a></li>
      </ul>
    </li>
    <li><a href="#0x-踩坑集合">0x 踩坑集合</a></li>
    <li><a href="#0x08-踩坑集合">0x08 踩坑集合</a>
      <ul>
        <li><a href="#81-io-类">8.1 IO 类</a></li>
        <li><a href="#82-io-类">8.2 IO 类</a></li>
      </ul>
    </li>
    <li><a href="#0xee-参考链接">0xEE 参考链接</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="0x00-前言">0x00 前言</h2>
<p>本文为 Cheatsheet 类型文章，用于记录我在日常编程中经常使用的 Pandas 相关语句。</p>
<p>主要包含：</p>
<ul>
<li>Pandas 中 Series 的一些常见操作和技巧</li>
<li>Pandas 中 Dateframe 的一些常见操作和技巧</li>
<li>Python 里的可视化技巧</li>
<li>Pandas 使用过程中的一些细节</li>
</ul>
<p>不定期更新。</p>
<!-- raw HTML omitted -->
<blockquote>
<p>SQL 是一种面向集合的处理工具 / 语言
Pandas 是一种面向数组的处理工具</p>
</blockquote>
<blockquote>
<p><strong>而一般处理 pandas 的数据往往以二维表的形式存在。所以，可以类比为更加强大的 SQL 语言。</strong></p>
</blockquote>
<p>而依据 Pandas 的作者之言，牛逼的 Pandas 使用者必须要精通 numpy; 当然，关于 Numpy, 留待之后开一篇文章做笔记好了。</p>
<h2 id="0x01-series-相关">0x01 Series 相关</h2>
<p>Series 接近于 ndarray 的用法，区别仅仅在于会带上 label 而已</p>
<blockquote>
<p>关于 ndarray, 请参考 我的另一篇文章 Numpy Cheatsheet</p>
</blockquote>
<h2 id="0x02-dataframe-相关">0x02 DataFrame 相关</h2>
<h3 id="21-对象创建">2.1 对象创建</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python">
<span class="c1"># 1. 内存变量转 Dataframe</span>
<span class="c1">## 1.1. 通过二位矩阵 , index , columns</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">pd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;ABCD&#39;</span><span class="p">))</span>
<span class="c1">## 1.2. 通过字典 Key 为 Column , Value 为 list,timestamp,np.array,value</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span> <span class="s1">&#39;A&#39;</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span>
                     <span class="s1">&#39;B&#39;</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20130102&#39;</span><span class="p">),</span>
                     <span class="s1">&#39;C&#39;</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">),</span>
                     <span class="s1">&#39;D&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">),</span>
                     <span class="s1">&#39;E&#39;</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">([</span><span class="s2">&#34;test&#34;</span><span class="p">,</span><span class="s2">&#34;train&#34;</span><span class="p">,</span><span class="s2">&#34;test&#34;</span><span class="p">,</span><span class="s2">&#34;train&#34;</span><span class="p">]),</span>
                     <span class="s1">&#39;F&#39;</span> <span class="p">:</span> <span class="s1">&#39;foo&#39;</span> <span class="p">})</span>
<span class="c1"># 长度无需统一，会自动填充</span>

<span class="c1"># 2. 从文件中读取</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&#34;./data_set.xlsx&#34;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="c1"># 关掉 Index</span>

<span class="c1"># 3. 合并多个同样的 DataFrame</span>
<span class="n">df_items</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_item1</span><span class="p">,</span><span class="n">df_item2</span><span class="p">,</span><span class="o">...</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_items</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data_set_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&#34;lno&#34;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&#34;rno&#34;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&#34;outer&#34;</span><span class="p">)</span>

<span class="c1"># 4.series to dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>

</code></pre></div><p>选择数据
Getting
Selection by Label
Selection by Position
Boolean Indexing
Setting
缺失数据
数据操作
Operations
Stats
Apply
Histogramming
String Methods
数据合并
Concat
Join
Append
Grouping
Reshaping
Stack
Pivot Tables
Time Series
Categoricals
Plotting</p>
<h3 id="22-浏览数据">2.2 浏览数据</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 1. 查看表结构</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span>
<span class="c1"># df.index = [&#39;日期&#39;,&#39;小时&#39;]</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">values</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">convert_objects</span><span class="p">(</span><span class="n">convert_numeric</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># 2. 删除 col_name</span>

<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;col_name_1&#39;</span><span class="p">,</span><span class="s1">&#39;col_name_2&#39;</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="s1">&#39;col_name_N&#39;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cola&#39;</span><span class="p">]</span>

<span class="c1"># 3. 修改元数据</span>
<span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;oldName1&#39;</span><span class="p">:</span> <span class="s1">&#39;newName1&#39;</span><span class="p">,</span> <span class="s1">&#39;oldName2&#39;</span><span class="p">:</span> <span class="s1">&#39;newName2&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;cola&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;colb&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;colc&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># 2.</span>
<span class="c1">## 2. 遍历</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">row</span><span class="p">[</span><span class="s2">&#34;c1&#34;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&#34;c2&#34;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Pandas&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="s2">&#34;c1&#34;</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="s2">&#34;c2&#34;</span><span class="p">)</span>
<span class="o">=</span> <span class="n">IF</span><span class="p">([</span><span class="nd">@price</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;未知&#34;</span><span class="p">,</span><span class="n">IF</span><span class="p">([</span><span class="nd">@price</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">30000</span><span class="p">,</span> <span class="s2">&#34;三万以下&#34;</span><span class="p">,</span> <span class="n">IF</span><span class="p">([</span><span class="nd">@price</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&#34;三万到五万&#34;</span><span class="p">,</span> <span class="n">IF</span><span class="p">([</span><span class="nd">@price</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&#34;五万到十万&#34;</span><span class="p">,</span> <span class="n">IF</span><span class="p">([</span><span class="nd">@price</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">10000000</span><span class="p">,</span> <span class="s2">&#34;十万以上&#34;</span><span class="p">,</span> <span class="s2">&#34;其他&#34;</span><span class="p">)))))</span>
</code></pre></div><h3 id="23-修改表内容">2.3 修改表内容</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s1">&#39;col_a&#39;</span><span class="p">,</span><span class="s1">&#39;col_b&#39;</span><span class="p">])</span>
</code></pre></div><h3 id="24-查看表内容">2.4 查看表内容</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 选择</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="c1"># 列选</span>
<span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span> <span class="c1"># 行选</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;20130102&#39;</span><span class="p">:</span><span class="s1">&#39;20130104&#39;</span><span class="p">]</span> <span class="c1"># 行选</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;20130102&#39;</span><span class="p">:</span><span class="s1">&#39;20130104&#39;</span><span class="p">,[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">]]</span> <span class="c1"># by label</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">condition</span><span class="p">,[</span><span class="s1">&#39;cola&#39;</span><span class="p">,</span><span class="s1">&#39;colb&#39;</span><span class="p">]]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;ri01&#39;</span><span class="p">,</span><span class="s1">&#39;ri02&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="p">[</span><span class="s2">&#34;cola&#34;</span><span class="p">,</span><span class="s2">&#34;colb&#34;</span><span class="p">,</span><span class="s2">&#34;colc&#34;</span><span class="p">]]</span>

<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="c1"># by position</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="c1"># 全部列，0-7 索引</span>

<span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[[</span><span class="s1">&#39;ri02&#39;</span><span class="p">,</span> <span class="s1">&#39;ri09&#39;</span><span class="p">]]</span> <span class="c1"># 选取行</span>

<span class="n">total_rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">total_cols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3000</span><span class="p">)</span> <span class="c1"># 随机抽取 3000 行，可以用于快速验证算法</span>

<span class="n">criterion</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">))</span>
<span class="n">df2</span><span class="p">[</span><span class="n">criterion</span><span class="p">]</span>

<span class="n">df2</span><span class="p">[[</span><span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]]]</span>
<span class="c1"># select * from df limit 5</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1"># select a,b,c from df</span>
<span class="n">df</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1"># select a,b,c from df where a = 11 and b = &#39;xx&#39;</span>
<span class="n">df</span><span class="p">[</span> <span class="p">(</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;xx&#39;</span><span class="p">)</span> <span class="p">][[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">]]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>

<span class="c1"># SELECT * FROM df ORDER BY a DESC LIMIT 10 OFFSET 5;</span>
<span class="n">df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">column_name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
<span class="n">two_groups</span> <span class="o">=</span> <span class="s1">&#39;(?P&lt;letter&gt;[a-z])(?P&lt;digit&gt;[0-9])&#39;</span>
<span class="n">s</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">two_groups</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># 排序</span>

<span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s1">&#39;col1&#39;</span><span class="p">,</span><span class="s1">&#39;col2&#39;</span><span class="p">,</span><span class="s1">&#39;col3&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="c1">#</span>

<span class="c1"># window function</span>
<span class="c1"># SELECT a, b, c, rank() OVER (PARTITION BY a ORDER BY b DESC) as rn FROM df;</span>
<span class="c1"># 如果没有这个 window function 的话，可以 groupby 一下，然后生成表和原有表进行 JOIN</span>
<span class="n">tips</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rn</span><span class="o">=</span><span class="n">tips</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumcount</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Top N rows per group</span>
<span class="c1"># rank 代表等级 如果两人并列第一名，则不存在第二名，直接是第三名 , row_number 代表排名，即即便两个人分数一样，也无法并列第一名</span>

<span class="c1"># PostGRESQL&#39;s ROW_NUMBER() analytic function</span>
<span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="p">(</span>
  <span class="n">SELECT</span>
    <span class="n">t</span><span class="o">.*</span><span class="p">,</span>
    <span class="n">ROW_NUMBER</span><span class="p">()</span> <span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">day</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">total_bill</span> <span class="n">DESC</span><span class="p">)</span> <span class="n">AS</span> <span class="n">rn</span>
  <span class="n">FROM</span> <span class="n">tips</span> <span class="n">t</span>
<span class="p">)</span> <span class="n">tt</span>
<span class="n">WHERE</span> <span class="n">rn</span> <span class="o">&lt;</span> <span class="mi">3</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="n">day</span><span class="p">,</span> <span class="n">rn</span><span class="p">;</span>

<span class="p">(</span><span class="n">tips</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rn</span><span class="o">=</span><span class="n">tips</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;total_bill&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;day&#39;</span><span class="p">])</span>
                    <span class="o">.</span><span class="n">cumcount</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
     <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;rn &lt; 3&#39;</span><span class="p">)</span>
     <span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="s1">&#39;rn&#39;</span><span class="p">])</span>
<span class="p">)</span>

<span class="p">(</span><span class="n">tips</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rnk</span><span class="o">=</span><span class="n">tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;day&#39;</span><span class="p">])[</span><span class="s1">&#39;total_bill&#39;</span><span class="p">]</span>
                     <span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
     <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;rnk &lt; 3&#39;</span><span class="p">)</span>
     <span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="s1">&#39;rnk&#39;</span><span class="p">])</span>
<span class="p">)</span>

<span class="c1"># PostGRESQL&#39;s RANK() analytic function</span>
<span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="p">(</span>
  <span class="n">SELECT</span>
    <span class="n">t</span><span class="o">.*</span><span class="p">,</span>
    <span class="n">RANK</span><span class="p">()</span> <span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">sex</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">tip</span><span class="p">)</span> <span class="n">AS</span> <span class="n">rnk</span>
  <span class="n">FROM</span> <span class="n">tips</span> <span class="n">t</span>
  <span class="n">WHERE</span> <span class="n">tip</span> <span class="o">&lt;</span> <span class="mi">2</span>
<span class="p">)</span>
<span class="n">WHERE</span> <span class="n">rnk</span> <span class="o">&lt;</span> <span class="mi">3</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="n">sex</span><span class="p">,</span> <span class="n">rnk</span><span class="p">;</span>

<span class="p">(</span><span class="n">tips</span><span class="p">[</span><span class="n">tips</span><span class="p">[</span><span class="s1">&#39;tip&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">]</span>
     <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rnk_min</span><span class="o">=</span><span class="n">tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;sex&#39;</span><span class="p">])[</span><span class="s1">&#39;tip&#39;</span><span class="p">]</span>
                         <span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">))</span>
     <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;rnk_min &lt; 3&#39;</span><span class="p">)</span>
     <span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span><span class="s1">&#39;rnk_min&#39;</span><span class="p">])</span>
<span class="p">)</span>

<span class="c1"># where 语句</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

<span class="c1"># groupby</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="c1"># 计算 a</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="c1"># 同上计算 a</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="c1"># 计算所有 cols</span>
<span class="n">agg_fun_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tip&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">}</span>
<span class="n">agg_fun_dict_new</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tip&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">]}</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)[[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_fun_dict</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">multiply_10_for_every_int</span><span class="p">)</span> <span class="c1">#</span>

<span class="n">calc_groups</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">date</span><span class="p">])</span>
<span class="n">calc_groups</span><span class="p">[</span><span class="s1">&#39;id_aa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">&#34;123.xlsx&#34;</span><span class="p">)</span>

<span class="c1"># pivot</span>
<span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="s1">&#39;value_col&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;A_FROM&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;B_TO&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span><span class="n">margins</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># CONCAT</span>
<span class="n">append</span>
<span class="c1"># JOIN</span>
<span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>

<span class="c1"># UPDATE tips SET tip = tip*2 WHERE tip &lt; 2;</span>
<span class="n">tips</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tips</span><span class="p">[</span><span class="s1">&#39;tip&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;tip&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span>

<span class="c1"># TODO:</span>
</code></pre></div><h3 id="25-表变换">2.5 表变换</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># apply , apply map</span>
<span class="n">DataFrame</span><span class="o">.</span><span class="n">apply</span> <span class="n">operates</span> <span class="n">on</span> <span class="n">entire</span> <span class="n">rows</span> <span class="ow">or</span> <span class="n">columns</span> <span class="n">at</span> <span class="n">a</span> <span class="n">time</span><span class="o">.</span>
<span class="n">DataFrame</span><span class="o">.</span><span class="n">applymap</span><span class="p">,</span> <span class="n">Series</span><span class="o">.</span><span class="n">apply</span><span class="p">,</span> <span class="ow">and</span> <span class="n">Series</span><span class="o">.</span><span class="n">map</span> <span class="n">operate</span> <span class="n">on</span> <span class="n">one</span> <span class="n">element</span> <span class="n">at</span> <span class="n">time</span><span class="o">.</span>
</code></pre></div><h3 id="26-表遍历">2.6 表遍历</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">()</span>
</code></pre></div><h2 id="数据导入导出">数据导入导出</h2>
<h3 id="sql">SQL</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.engine.url</span> <span class="kn">import</span> <span class="n">URL</span>
<span class="n">DATABASE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;drivername&#39;</span><span class="p">:</span> <span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
    <span class="s1">&#39;host&#39;</span><span class="p">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="s1">&#39;5432&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;yourusername&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;yourpass&#39;</span><span class="p">,</span>
    <span class="s1">&#39;database&#39;</span><span class="p">:</span> <span class="s1">&#39;yourdb&#39;</span>
<span class="p">}</span>
<span class="c1"># 这里并不建议直接写数据库连接字符串，而是使用 URL 函数，这样可以避免转义字符带来的坑，比如 @ 在数据库连接字符串是 %40</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">URL</span><span class="p">(</span><span class="o">**</span><span class="n">DATABASE</span><span class="p">))</span>

<span class="c1"># 读一整张表</span>
<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">,</span> <span class="n">conn</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s1">&#39;yourtablehere&#39;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
    <span class="n">processyourdata</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># 按照 SQL 语句来读</span>
<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">,</span> <span class="n">conn</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span><span class="s2">    yoursqlquery
</span><span class="s2">    &#34;&#34;&#34;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
    <span class="n">processyourdata</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div><h3 id="csv">CSV</h3>
<p>日常数据处理用 CSV 的比较多，因为这种格式语法简洁，类二维表，读写速度快，而且配合 gzip 压缩解压。</p>
<p>pandas 在 windows 上好像不能读取中文路径？</p>
<p>而且，pandas 读取的时候要注意指定编码。因为在日常导出 CSV 的时往往使用的是 utf-8, 而 windows 默认打开文本文件时候使用的是 gbk</p>
<p>read_csv 有几十个参数，挑几个说一下：</p>
<ul>
<li>sep 可以指定分隔符，默认为',', 但有的人导出的数据以 tab 为空格。</li>
<li>dtype 可以指定某些列的值类型为 int,float 的类型从而减少 object 的创建 , 但是对 str/object 没有什么暖用</li>
<li>parse_dates 可以指定 date 列</li>
<li>header 如果 CSV 没有 Header, 可以指定为 None</li>
<li>usecols 可以指定几列，相当于数据库中的 SELECT a_col,b_col</li>
</ul>
<p>其中还有一些比较有趣的东西，比如说，iterator=True
值得注意的是，通过</p>
<h3 id="excel">Excel</h3>
<p>Gotchas</p>
<h2 id="0x02-可视化技术">0x02 可视化技术</h2>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 绘制</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;xlable&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ylable&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;title name&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;数量&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>

<span class="c1"># 批量创建图</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">customers</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&#34;cola&#34;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="s2">&#34;数量&#34;</span><span class="p">,</span> <span class="s2">&#34;单位&#34;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_legend</span><span class="p">();</span>

<span class="n">ttbill</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">tips</span><span class="p">[</span><span class="s2">&#34;总价格&#34;</span><span class="p">]);</span>
<span class="n">ttbill</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;价值&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;频率&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s2">&#34;标题名&#34;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span><span class="s2">&#34;total_bill&#34;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span><span class="s2">&#34;tip&#34;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">tips</span><span class="p">)</span>
<span class="c1"># https://github.com/guipsamora/pandas_exercises/blob/master/07_Visualization/Tips/Exercises_with_code_and_solutions.ipynb</span>

<span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span>
    <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">300</span><span class="p">],</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;男&#39;</span><span class="p">,</span> <span class="s1">&#39;女&#39;</span><span class="p">],</span>
    <span class="n">shadow</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">],</span>
    <span class="n">explode</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.15</span> <span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">startangle</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>
    <span class="n">autopct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%1.1f%%</span><span class="s1">&#39;</span>
    <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;男女比例&#34;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div><h2 id="0x03-asd1">0x03 asd1</h2>
<h2 id="0x07-performance-tips">0x07 Performance Tips</h2>
<p>最近遇到了数据量比较大的数据处理，数据条数差不多在 3 千万条。加载到内存中大约 1GB.</p>
<h3 id="71-精简行列">7.1 精简行列</h3>
<ol>
<li>读入 dataframe 的时候就排除多余的行列。</li>
<li>Merge 时候需要精简行列。</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">df1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;xab&#39;</span><span class="p">)])</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataframe1</span><span class="p">,</span> <span class="n">dataframe2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
</code></pre></div><h3 id="72-大文件的处理">7.2 大文件的处理</h3>
<blockquote>
<p>参考我的文章 记一次小机器的 Python 大数据分析</p>
</blockquote>
<h2 id="0x-踩坑集合">0x 踩坑集合</h2>
<h2 id="0x08-踩坑集合">0x08 踩坑集合</h2>
<h3 id="81-io-类">8.1 IO 类</h3>
<h4 id="heading"></h4>
<h3 id="82-io-类">8.2 IO 类</h3>
<h2 id="0xee-参考链接">0xEE 参考链接</h2>
<hr>
<p>ChangeLog:</p>
<ul>
<li><strong>2017-06-03</strong> 初始化本文</li>
<li><strong>2018-02-03</strong> 重修文字</li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2020-01-01</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/20170529_%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8Etensorflow%E7%9A%84%E5%88%86%E7%B1%BB%E5%99%A8/" class="prev" rel="prev" title="一个基于 TensorFlow 的图片分类器"><i class="fas fa-angle-left fa-fw"></i>一个基于 TensorFlow 的图片分类器</a>
            <a href="/posts/20170623_vimcheatsheet/" class="next" rel="next" title="CVim">CVim<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.79.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="http://twocucao.xyz" target="_blank">twocucao</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
