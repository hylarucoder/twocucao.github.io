<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>开源认证基础服务 - 海拉鲁编程客</title><meta name="Description" content="Get Busy is My New Hugo Site"><meta property="og:title" content="开源认证基础服务" />
<meta property="og:description" content="0x00 前言 随着业务的增长，往往需要统一体系内的服务的账户。
经过一番调研，决定尝试一下 ory 的开源认证基础服务
0x01 ORY 尝试解决问题？ ORY 提供了四个主要项目，每个项目着力于解决一个边界清晰的认证 / 鉴权问题
 ORY Kratos 提供了用户认证服务 ORY Hydra 提供了 OAuth 2.0 &amp; OpenID Connect provider. ORY Keto 提供了 访问控制 ORY Oathkeeper 提供了认证访问代理  0x02 用户认证服务 Kratos 常见方案  方案 1, 选择全栈式解决方案 - 比如 Java 社区的 JGroups 方案 2, 选择 IDaas - 比如 Login With Apple, Google 方案 3, 选择自己来 - 比如 Java 社区的 JGroups  三种方案各有利弊
 全栈式解决方案上手极快，但  扩展性不强 绑定 Java 技术栈 数据模型固定 登陆流程固定     更新迭代慢  Login With Google 虽然方便，但是并没有解决如下的问题   更新 Profile  添加第二个恢复邮箱 2FA 存储管理 Sessions   全局登出  自己来，需要处理事情也挺多   方案二遇到的问题，一个不会少 加密算法  流程可能较为复杂，比如先用邮箱注册，然后用 Sign Up Using Google, 或者先用 Sign Up Google, 然后使用邮箱登陆。(PS: 我国的登陆姿势就更多了）    是不是某种方案是最好的呢？其实未必" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://twocucao.xyz/posts/20201130_ory/" />
<meta property="article:published_time" content="2020-11-30T18:03:01+08:00" />
<meta property="article:modified_time" content="2020-11-30T18:03:01+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="开源认证基础服务"/>
<meta name="twitter:description" content="0x00 前言 随着业务的增长，往往需要统一体系内的服务的账户。
经过一番调研，决定尝试一下 ory 的开源认证基础服务
0x01 ORY 尝试解决问题？ ORY 提供了四个主要项目，每个项目着力于解决一个边界清晰的认证 / 鉴权问题
 ORY Kratos 提供了用户认证服务 ORY Hydra 提供了 OAuth 2.0 &amp; OpenID Connect provider. ORY Keto 提供了 访问控制 ORY Oathkeeper 提供了认证访问代理  0x02 用户认证服务 Kratos 常见方案  方案 1, 选择全栈式解决方案 - 比如 Java 社区的 JGroups 方案 2, 选择 IDaas - 比如 Login With Apple, Google 方案 3, 选择自己来 - 比如 Java 社区的 JGroups  三种方案各有利弊
 全栈式解决方案上手极快，但  扩展性不强 绑定 Java 技术栈 数据模型固定 登陆流程固定     更新迭代慢  Login With Google 虽然方便，但是并没有解决如下的问题   更新 Profile  添加第二个恢复邮箱 2FA 存储管理 Sessions   全局登出  自己来，需要处理事情也挺多   方案二遇到的问题，一个不会少 加密算法  流程可能较为复杂，比如先用邮箱注册，然后用 Sign Up Using Google, 或者先用 Sign Up Google, 然后使用邮箱登陆。(PS: 我国的登陆姿势就更多了）    是不是某种方案是最好的呢？其实未必"/>
<meta name="application-name" content="海拉鲁编程客">
<meta name="apple-mobile-web-app-title" content="海拉鲁编程客"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://twocucao.xyz/posts/20201130_ory/" /><link rel="prev" href="http://twocucao.xyz/posts/20190924_pycode_08/" /><link rel="next" href="http://twocucao.xyz/posts/20201201_modern_shell/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "开源认证基础服务",
        "inLanguage": "zh-cn",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/twocucao.xyz\/posts\/20201130_ory\/"
        },"genre": "posts","keywords": "Golang","wordcount":  164 ,
        "url": "http:\/\/twocucao.xyz\/posts\/20201130_ory\/","datePublished": "2020-11-30T18:03:01+08:00","dateModified": "2020-11-30T18:03:01+08:00","publisher": {
            "@type": "Organization",
            "name": "twocucao"},"author": {
                "@type": "Person",
                "name": "twocucao"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="海拉鲁编程客">海拉鲁编程客</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/posts/"> 存档 </a><a class="menu-item" href="/tags/"> 标签 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="海拉鲁编程客">海拉鲁编程客</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/posts/" title="">存档</a><a class="menu-item" href="/tags/" title="">标签</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">开源认证基础服务</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="http://twocucao.xyz" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas"></i>twocucao</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/"><i class="far fa-folder fa-fw"></i>开源项目</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-11-30">2020-11-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 164 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 1 分钟&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/5625783/100601457-8efe8a80-333d-11eb-803e-861352bd1715.jpg"
        data-srcset="https://user-images.githubusercontent.com/5625783/100601457-8efe8a80-333d-11eb-803e-861352bd1715.jpg, https://user-images.githubusercontent.com/5625783/100601457-8efe8a80-333d-11eb-803e-861352bd1715.jpg 1.5x, https://user-images.githubusercontent.com/5625783/100601457-8efe8a80-333d-11eb-803e-861352bd1715.jpg 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/5625783/100601457-8efe8a80-333d-11eb-803e-861352bd1715.jpg"
        title="https://user-images.githubusercontent.com/5625783/100601457-8efe8a80-333d-11eb-803e-861352bd1715.jpg" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#0x00-前言">0x00 前言</a></li>
    <li><a href="#0x01-ory-尝试解决问题">0x01 ORY 尝试解决问题？</a></li>
    <li><a href="#0x02-用户认证服务-kratos">0x02 用户认证服务 Kratos</a>
      <ul>
        <li><a href="#常见方案">常见方案</a></li>
        <li><a href="#kratos-的方案">Kratos 的方案</a></li>
      </ul>
    </li>
    <li><a href="#0x03-ory-hydra">0x03 Ory Hydra</a></li>
    <li><a href="#0x03-ory-keto">0x03 Ory Keto</a></li>
    <li><a href="#0x04-ory-oathkeeper">0x04 Ory Oathkeeper</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="0x00-前言">0x00 前言</h2>
<p>随着业务的增长，往往需要统一体系内的服务的账户。</p>
<p>经过一番调研，决定尝试一下 ory 的开源认证基础服务</p>
<h2 id="0x01-ory-尝试解决问题">0x01 ORY 尝试解决问题？</h2>
<p>ORY 提供了四个主要项目，每个项目着力于解决一个边界清晰的认证 / 鉴权问题</p>
<ul>
<li>ORY Kratos 提供了用户认证服务</li>
<li>ORY Hydra 提供了 OAuth 2.0 &amp; OpenID Connect provider.</li>
<li>ORY Keto 提供了 访问控制</li>
<li>ORY Oathkeeper 提供了认证访问代理</li>
</ul>
<h2 id="0x02-用户认证服务-kratos">0x02 用户认证服务 Kratos</h2>
<h3 id="常见方案">常见方案</h3>
<ol>
<li>方案 1, 选择全栈式解决方案 - 比如 Java 社区的 JGroups</li>
<li>方案 2, 选择 IDaas - 比如 Login With Apple, Google</li>
<li>方案 3, 选择自己来 - 比如 Java 社区的 JGroups</li>
</ol>
<p>三种方案各有利弊</p>
<ol>
<li>全栈式解决方案上手极快，但
<ul>
<li>扩展性不强</li>
<li>绑定 Java 技术栈</li>
<li>数据模型固定</li>
<li>登陆流程固定</li>
</ul>
</li>
</ol>
<ul>
<li>更新迭代慢</li>
</ul>
<ol start="2">
<li>Login With Google 虽然方便，但是并没有解决如下的问题</li>
</ol>
<ul>
<li>更新 Profile
<ul>
<li>添加第二个恢复邮箱</li>
<li>2FA</li>
<li>存储管理 Sessions</li>
</ul>
</li>
<li>全局登出</li>
</ul>
<ol start="3">
<li>自己来，需要处理事情也挺多</li>
</ol>
<ul>
<li>方案二遇到的问题，一个不会少</li>
<li>加密算法
<ul>
<li>流程可能较为复杂，比如先用邮箱注册，然后用 Sign Up Using Google, 或者先用 Sign Up Google, 然后使用邮箱登陆。(PS: 我国的登陆姿势就更多了）</li>
</ul>
</li>
</ul>
<p>是不是某种方案是最好的呢？其实未必</p>
<p>就我个人经验来说，</p>
<ul>
<li>第一种方案比较适合稳定的，技术栈相同的团队使用。如果对原先应用进行少量裁剪就可以使用，其实未尝不可。</li>
<li>第二种方案如果登陆入口仅是 Login With Google, 并且内网服务数量就几个，也不需要做全局登出，那么其实做起来比较省事。我工作过的一个公司就喜欢这么干。</li>
<li>第三种方案虽然处理的问题看起来比较多，但是社区现有的 Building Block 已经比较多了。如果流程没有特别复杂，一手打造的非常容易往自己的项目发展情况发展。</li>
</ul>
<h3 id="kratos-的方案">Kratos 的方案</h3>
<p>Kratos 提供了如下的解决方案</p>
<ul>
<li>登陆与注册</li>
<li>track sesison/devices</li>
<li>MFA/2FA</li>
<li>账户验证</li>
<li>账户恢复</li>
<li>Profile &amp; Account Management</li>
<li>管理后台接口 API</li>
<li>消费 OAuth2 and OpenID Connect</li>
</ul>
<h2 id="0x03-ory-hydra">0x03 Ory Hydra</h2>
<blockquote>
<p>You May Not Need It</p>
</blockquote>
<ul>
<li>Provider OAuth2 and OpenID Connect via <a href="https://github.com/ory/hydra">https://github.com/ory/hydra</a></li>
</ul>
<h2 id="0x03-ory-keto">0x03 Ory Keto</h2>
<p>权限系统一般放在按照产品需求，最好跟着产品走。而不是随随便便提取出来做一个权限系统。</p>
<blockquote>
<p>You May Not Need It</p>
</blockquote>
<h2 id="0x04-ory-oathkeeper">0x04 Ory Oathkeeper</h2>
<p>同样，如果你不是有做 zero trust</p>
<blockquote>
<p>You May Not Need It</p>
</blockquote>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2020-11-30</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/golang/">Golang</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/20190924_pycode_08/" class="prev" rel="prev" title="如何写出整洁的 Python 代码 下"><i class="fas fa-angle-left fa-fw"></i>如何写出整洁的 Python 代码 下</a>
            <a href="/posts/20201201_modern_shell/" class="next" rel="next" title="Modern Shell">Modern Shell<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.79.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="http://twocucao.xyz" target="_blank">twocucao</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
