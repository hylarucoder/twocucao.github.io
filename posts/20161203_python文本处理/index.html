<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Text Processing In Python - 海拉鲁编程客</title><meta name="Description" content="这篇文章展示了基本的 Markdown 语法和格式."><meta property="og:title" content="Text Processing In Python" />
<meta property="og:description" content="这篇文章展示了基本的 Markdown 语法和格式." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://twocucao.xyz/posts/20161203_python%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/" />
<meta property="article:published_time" content="2016-12-03T21:57:40+08:00" />
<meta property="article:modified_time" content="2020-01-01T16:45:40+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Text Processing In Python"/>
<meta name="twitter:description" content="这篇文章展示了基本的 Markdown 语法和格式."/>
<meta name="application-name" content="海拉鲁编程客">
<meta name="apple-mobile-web-app-title" content="海拉鲁编程客"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://twocucao.xyz/posts/20161203_python%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/" /><link rel="prev" href="http://twocucao.xyz/posts/20161126_pythonista_list/" /><link rel="next" href="http://twocucao.xyz/posts/20161209_mongocheatsheet/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Text Processing In Python",
        "inLanguage": "zh-cn",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/twocucao.xyz\/posts\/20161203_python%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86\/"
        },"genre": "posts","keywords": "Python","wordcount":  521 ,
        "url": "http:\/\/twocucao.xyz\/posts\/20161203_python%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86\/","datePublished": "2016-12-03T21:57:40+08:00","dateModified": "2020-01-01T16:45:40+08:00","publisher": {
            "@type": "Organization",
            "name": "twocucao"},"author": {
                "@type": "Person",
                "name": "twocucao"
            },"description": "这篇文章展示了基本的 Markdown 语法和格式."
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="海拉鲁编程客">海拉鲁编程客</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/posts/"> 存档 </a><a class="menu-item" href="/tags/"> 标签 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="海拉鲁编程客">海拉鲁编程客</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/posts/" title="">存档</a><a class="menu-item" href="/tags/" title="">标签</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Text Processing In Python</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="http://twocucao.xyz" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas"></i>twocucao</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/python/"><i class="far fa-folder fa-fw"></i>Python</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2016-12-03">2016-12-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 521 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 3 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#0x00-前言">0x00 前言</a></li>
    <li><a href="#0x01-正则处理相关">0x01 正则处理相关</a>
      <ul>
        <li><a href="#11-正则表达式">1.1. 正则表达式</a></li>
        <li><a href="#12-python-中正则表达式语法">1.2. Python 中正则表达式语法</a></li>
        <li><a href="#13-python-中使用正则的方法">1.3. Python 中使用正则的方法</a></li>
      </ul>
    </li>
    <li><a href="#14-正则表达式性能">1.4. 正则表达式性能</a></li>
    <li><a href="#0x02-htmlxml-处理相关">0x02 HTML/XML 处理相关</a>
      <ul>
        <li><a href="#21-beautifulsoup-处理-html">2.1. Beautifulsoup 处理 HTML</a></li>
        <li><a href="#22-xpath-处理-html">2.2. XPath 处理 HTML</a></li>
        <li><a href="#23-标准库处理-html">2.3. 标准库处理 HTML</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="0x00-前言">0x00 前言</h2>
<p>本文为 Cheatsheet 类型文章，用于记录我在日常编程中的文本处理相关思路。</p>
<p>本文的目录为：</p>
<ul>
<li>正则处理相关</li>
<li>HTML/XML 处理相关</li>
<li>Python 中的文本处理</li>
</ul>
<h2 id="0x01-正则处理相关">0x01 正则处理相关</h2>
<h3 id="11-正则表达式">1.1. 正则表达式</h3>
<p>正则是个很奇葩的名字，为什么叫做正则表达式呢，首先是个表达式，其次，这是一种叫做正则 (regular expression, rational expression) 的表达式。
名称为什么叫做 regular 呢，因为它基于 regular language. 而 regular language 是一种 formal language. 得，现在又开始是编译原理相关概念了。为了逃避概念，通过用途来简单定义正则表达式。</p>
<p>简而言之，就是一种用于字符串搜索的模式。或者就是一种领域专用编程语言。</p>
<p><a href="https://en.wikipedia.org/wiki/Regular_expression">https://en.wikipedia.org/wiki/Regular_expression</a></p>
<h3 id="12-python-中正则表达式语法">1.2. Python 中正则表达式语法</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 元字符</span>
<span class="o">.</span> <span class="o">^</span> <span class="err">$</span> <span class="o">*</span> <span class="o">+</span> <span class="err">?</span> <span class="p">{</span> <span class="p">}</span> <span class="p">[</span> <span class="p">]</span> \ <span class="o">|</span> <span class="p">(</span> <span class="p">)</span>

<span class="o">*</span> <span class="c1"># 速记，天上一个星星都没有，0 到多个。</span>
<span class="o">+</span> <span class="c1"># 一加手机..... 1 到多个。</span>
<span class="err">?</span> <span class="c1"># 有还是没有 即 0 or 1</span>
<span class="o">*</span><span class="err">?</span> <span class="c1"># 没有疑问就是贪婪，有疑问就是非贪婪</span>
<span class="o">+</span><span class="err">?</span>
<span class="err">??</span>

<span class="p">{</span><span class="n">m</span><span class="p">}</span> <span class="c1"># m 份</span>
<span class="p">{</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">}</span> <span class="c1"># 优先匹配 a{2,}b 优先匹配 aaaab 中 aaaab</span>
<span class="p">{</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">}</span><span class="err">?</span> <span class="c1"># 优先匹配 a{2,}b 优先匹配 aaaab 中 aab</span>

<span class="p">[]</span> <span class="c1"># [a\-z] == [az-]</span>
<span class="c1"># 1. [\w] [\S]</span>
<span class="c1"># 2. [^5]</span>
<span class="c1"># 3. [akm$]  在 [] 中 $ 并不具备元字符特点</span>

<span class="n">PattenA</span> <span class="o">|</span> <span class="n">PattenB</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="c1"># 捕获 , 引用可以使用、1 , 但是还有一种扩展语法</span>

<span class="p">(</span><span class="err">?</span><span class="o">...</span><span class="p">)</span> <span class="c1"># 扩展</span>
<span class="c1"># - (?aiLmsux)</span>
<span class="c1"># - (?:...) 不捕获</span>
<span class="c1"># - (?P&lt;quote&gt;...) 正则内引用 (?P=quote);python 内获取 m.group(&#39;quote&#39;) ,m.end(&#39;quote&#39;);re.sub 内 repl 参数为、g&lt;quote&gt; \g&lt;1&gt; \1</span>

</code></pre></div><h3 id="13-python-中使用正则的方法">1.3. Python 中使用正则的方法</h3>
<h4 id="131-re-模块的用法">1.3.1. re 模块的用法</h4>
<ul>
<li>sub 替换</li>
<li>match / fullmatch 匹配</li>
<li>search 搜索</li>
<li>split 分片</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(\W+)&#39;</span><span class="p">,</span> <span class="s1">&#39;...words, words...&#39;</span><span class="p">)</span>
<span class="c1"># [&#39;&#39;, &#39;...&#39;, &#39;words&#39;, &#39;, &#39;, &#39;words&#39;, &#39;...&#39;, &#39;&#39;]</span>
</code></pre></div><blockquote>
<p>match 为匹配起始字符 / fullmatch 为全部字符 / search 为搜索</p>
</blockquote>
<h4 id="132-match-object-的用法">1.3.2. match object 的用法</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;(?P&lt;first_name&gt;\w+) (?P&lt;last_name&gt;\w+)&#34;</span><span class="p">,</span> <span class="s2">&#34;Malcolm Reynolds&#34;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">)</span>
<span class="s1">&#39;Malcolm&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;last_name&#39;</span><span class="p">)</span>
<span class="s1">&#39;Reynolds&#39;</span>
<span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="c1"># 起始</span>
<span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>   <span class="c1"># 结尾</span>
</code></pre></div><h2 id="14-正则表达式性能">1.4. 正则表达式性能</h2>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 编译优于不编译</span>
<span class="n">prog</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">string</span><span class="p">)</span>
</code></pre></div><h2 id="0x02-htmlxml-处理相关">0x02 HTML/XML 处理相关</h2>
<h3 id="21-beautifulsoup-处理-html">2.1. Beautifulsoup 处理 HTML</h3>
<p>解析往往伴随着各种各样奇葩的不奇葩的，诡异的不诡异的网页数据抽取，这个过程中，我们常使用两个库来解决问题，一个库叫做 lxml, 另一个库叫做 BeautifulSoup.</p>
<p>beautifulsoup 可是让我们通过直接手动编写遍历 dom 树的方法来快速遍历 dom 树从而获得数据。相比自己写解析器而言，可以算得上非常的节省时间了。</p>
<p>只要能手动遍历 dom 树，基本上所有的数据都是可以获取的。痛点就是手动编写遍历 Dom 树并且完成测试的时间可能长一些。</p>
<p>但是开发效率就比较低了。</p>
<p>举个例子：</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;lal&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span> <span class="na">itemprop</span><span class="o">=</span><span class="s">&#34;street-address&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;浦东南路八佰伴西面&#34;</span><span class="p">&gt;</span>
       地址：浦东南路八佰伴西面
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span> <span class="na">itemprop</span><span class="o">=</span><span class="s">&#34;street-address&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;浦东南路&#34;</span><span class="p">&gt;</span>
       名称：xxxx
    <span class="p">&lt;/</span><span class="nt">div</span> <span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div><p>我想要地址属性，如果是 beautifulsoup, 则我们需要先定位到 id 为 lal 的 div 元素。然后获取每个元素的 text 部分，然后使用 if 判断地址属性，然后提取 text.</p>
<p><strong>但是如果用 xpath, 则可以把对元素的简单定位简单判断直接写在 xpath 表达式。</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">sel</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@id=&#34;lal&#34;]/*[contains(text(),&#34;地址&#34;)]/text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract_first</span><span class="p">()</span>
<span class="c1"># 如果还需要添加筛选名称，则可是使用</span>
<span class="n">sel</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@id=&#34;lal&#34;]/*[contains(text(),&#34;名称&#34;)]/text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract_first</span><span class="p">()</span>
</code></pre></div><p>这样可以极大的提升开发效率。</p>
<p>页面的结构越复杂，则 xpath 带来的开发效率越高。</p>
<h3 id="22-xpath-处理-html">2.2. XPath 处理 HTML</h3>
<h4 id="221-概念">2.2.1. 概念</h4>
<p>XPath 是一种通过路径表达式定位 XML 文档内容的语法。
由于内置了大量的表达式函数，可以通过极少的代码完成定位。
有七种<strong>节点类型</strong>:</p>
<ul>
<li>element</li>
<li>attribute</li>
<li>text</li>
<li>namespace</li>
<li>processing-instruction</li>
<li>comment</li>
<li>document nodes</li>
</ul>
<p>有五种<strong>节点间关系</strong>:</p>
<ul>
<li>父节点 Parent</li>
<li>子节点 Children</li>
<li>兄弟节点 Siblings</li>
<li>先祖节点，即父与父父节点。Ancestors</li>
<li>后代节点，即子与子子节点。Descendants</li>
</ul>
<table>
<thead>
<tr>
<th>语法</th>
<th>描述</th>
<th>例子</th>
</tr>
</thead>
<tbody>
<tr>
<td>nodename</td>
<td>节点名称</td>
<td>a</td>
</tr>
<tr>
<td>/</td>
<td>根节点</td>
<td>/</td>
</tr>
<tr>
<td>//</td>
<td>匹配所有</td>
<td>bookstore//book</td>
</tr>
<tr>
<td>.</td>
<td>当前节点</td>
<td></td>
</tr>
<tr>
<td>..</td>
<td>父节点</td>
<td>a/../a/..</td>
</tr>
<tr>
<td>@</td>
<td>属性</td>
<td>a/@href</td>
</tr>
<tr>
<td>[]</td>
<td>谓语</td>
<td>book[1] , book[last()-1]</td>
</tr>
<tr>
<td>func()</td>
<td>表达式函数</td>
<td>postion()</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//*[@id=</span><span class="se">\&#34;</span><span class="s2">landlb_B04_04</span><span class="se">\&#34;</span><span class="s2">]/span[2]/a[contains(@href,&#39;market&#39;)]&#34;</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//*[@id=</span><span class="se">\&#34;</span><span class="s2">landlb_B04_04</span><span class="se">\&#34;</span><span class="s2">]/span[2]/a[not(@class)]&#34;</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//ul/li/b[contains(text(),&#39;什么玩意&#39;)]/following-sibling::span/text()&#34;</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//div[@class=&#39;address&#39;]/text()[preceding::span[@class=&#39;item&#39; and contains(text(),&#39;地址：&#39;)]]&#34;</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&#34;//ul/li/b[contains(text(),&#39;什么玩意：&#39;)]/following-sibling::a/text()&#34;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">//*<span class="o">[</span>contains<span class="o">(</span>text<span class="o">()</span>,<span class="s1">&#39;ABC&#39;</span><span class="o">)]</span>
<span class="c1"># http://stackoverflow.com/questions/3655549/xpath-containstext-some-string-doesnt-work-when-used-with-node-with-more/3655588#3655588</span>

&lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">&#34;atag btag&#34;</span> /&gt;
//div<span class="o">[</span>contains<span class="o">(</span>@class, <span class="s1">&#39;atag&#39;</span><span class="o">)</span> and contains<span class="o">(</span>@class ,<span class="s1">&#39;btag&#39;</span><span class="o">)]</span>
</code></pre></div><h4 id="222-lxml-parsel">2.2.2. lxml parsel</h4>
<p>这两个库是 Python 中常用的解析表达式， parsel 依赖于 lxml , 安装完 lxml 后直接安装即可。</p>
<h4 id="223-lxml-的番外">2.2.3. lxml 的番外</h4>
<p>众所周知，Mac 的 Homebrew 很方便，每一次遇到需要下载编译的组件的时候，只需要执行 brew install xxx, 很快就可以使用了。</p>
<p>但 homebrew 安装的软件都是最新的，这很容易导致部分软件由于版本更新带来的兼容性问题。</p>
<p>这不，最近在 Mac 上进行开发的时候每次调用初始化 lxml 的时候总是无法进行解析，最后经过排查发现问题是 lxml 在编译的时候使用的 libxml 2.9.4 但是 使用的版本为 2.9.2 , 于是每当我使用 lxml 的时候，就会报错。</p>
<p>不得已，找到 lxml 的 F&amp;Q 部分发现提 issue 之前需要先查看依赖版本。</p>
<p>于是进入 IPython 排查。</p>
<div class="highlight"><pre class="chroma"><code class="language-Python" data-lang="Python"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%-20s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;Python&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%-20s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;lxml.etree&#39;</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">LXML_VERSION</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%-20s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;libxml used&#39;</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">LIBXML_VERSION</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%-20s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;libxml compiled&#39;</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">LIBXML_COMPILED_VERSION</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%-20s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;libxslt used&#39;</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">LIBXSLT_VERSION</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%-20s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;libxslt compiled&#39;</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">LIBXSLT_COMPILED_VERSION</span><span class="p">))</span>

<span class="c1"># Python : sys.version_info(major=3, minor=5, micro=1, releaselevel=&#39;final&#39;, serial=0)</span>
<span class="c1"># lxml.etree : (3, 6, 2, 0)</span>
<span class="c1"># libxml used : (2, 9, 2)</span>
<span class="c1"># libxml compiled : (2, 9, 4) # 注意问题出在这里。</span>
<span class="c1"># libxslt used : (1, 1, 28)</span>
<span class="c1"># libxslt compiled : (1, 1, 28)</span>
</code></pre></div><p>于是使用 pip 强制进行安装升级。</p>
<pre><code>STATIC_DEPS=true pip install -i http://pypi.douban.com/simple/ –trusted-host pypi.douban.com lxml –ignore-installed –no-cache-dir –upgrade -vvv
</code></pre><p>安装完毕即可。</p>
<h3 id="23-标准库处理-html">2.3. 标准库处理 HTML</h3>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2020-01-01</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/python/">Python</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/20161126_pythonista_list/" class="prev" rel="prev" title="Python Awesome"><i class="fas fa-angle-left fa-fw"></i>Python Awesome</a>
            <a href="/posts/20161209_mongocheatsheet/" class="next" rel="next" title="MongoDB Cheatsheet">MongoDB Cheatsheet<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.79.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="http://twocucao.xyz" target="_blank">twocucao</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
