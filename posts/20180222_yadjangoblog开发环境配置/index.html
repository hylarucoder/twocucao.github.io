<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>YaDjangoBlog 开发环境配置 - 海拉鲁编程客</title><meta name="Description" content="这篇文章展示了基本的 Markdown 语法和格式."><meta property="og:title" content="YaDjangoBlog 开发环境配置" />
<meta property="og:description" content="这篇文章展示了基本的 Markdown 语法和格式." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://twocucao.xyz/posts/20180222_yadjangoblog%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" />
<meta property="article:published_time" content="2018-02-22T21:57:40+08:00" />
<meta property="article:modified_time" content="2020-01-01T16:45:40+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="YaDjangoBlog 开发环境配置"/>
<meta name="twitter:description" content="这篇文章展示了基本的 Markdown 语法和格式."/>
<meta name="application-name" content="海拉鲁编程客">
<meta name="apple-mobile-web-app-title" content="海拉鲁编程客"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://twocucao.xyz/posts/20180222_yadjangoblog%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" /><link rel="prev" href="http://twocucao.xyz/posts/20180221_fullstackdjangodevops/" /><link rel="next" href="http://twocucao.xyz/posts/20180223_yadjangoblog%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E7%AF%87/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "YaDjangoBlog 开发环境配置",
        "inLanguage": "zh-cn",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/twocucao.xyz\/posts\/20180222_yadjangoblog%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE\/"
        },"genre": "posts","keywords": "Python, Django, YaDjangoBlog","wordcount":  884 ,
        "url": "http:\/\/twocucao.xyz\/posts\/20180222_yadjangoblog%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE\/","datePublished": "2018-02-22T21:57:40+08:00","dateModified": "2020-01-01T16:45:40+08:00","publisher": {
            "@type": "Organization",
            "name": "twocucao"},"author": {
                "@type": "Person",
                "name": "twocucao"
            },"description": "这篇文章展示了基本的 Markdown 语法和格式."
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="海拉鲁编程客">海拉鲁编程客</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/posts/"> 存档 </a><a class="menu-item" href="/tags/"> 标签 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="海拉鲁编程客">海拉鲁编程客</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/posts/" title="">存档</a><a class="menu-item" href="/tags/" title="">标签</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">YaDjangoBlog 开发环境配置</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="http://twocucao.xyz" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas"></i>twocucao</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/django/"><i class="far fa-folder fa-fw"></i>Django</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2018-02-22">2018-02-22</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 884 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 5 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#0x00-前言">0x00 前言</a></li>
    <li><a href="#0x01-python-开发环境配置">0x01 Python 开发环境配置</a></li>
    <li><a href="#0x02-javascript-开发环境配置">0x02 JavaScript 开发环境配置</a></li>
    <li><a href="#0x03-docker-安装与配置">0x03 Docker 安装与配置</a></li>
    <li><a href="#0x04-项目试运行">0x04 项目试运行</a></li>
    <li><a href="#0x05-tmux-和-tmuxinator">0x05 Tmux 和 Tmuxinator</a></li>
    <li><a href="#0x06-pycharm-基本设置">0x06 PyCharm 基本设置</a></li>
    <li><a href="#0x07-开发流程">0x07 开发流程</a></li>
    <li><a href="#0xee-参考链接">0xEE. 参考链接</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="0x00-前言">0x00 前言</h2>
<p>本文是 Django 全栈开发教程的第一篇，上一篇是第零篇，目录会随时更新，地址在这里 2018 年不容错过的 Django 全栈项目 <a href="https://zhuanlan.zhihu.com/p/33903527">https://zhuanlan.zhihu.com/p/33903527</a></p>
<blockquote>
<p>为什么是第零篇，因为程序员从零计数呀。笑~~</p>
</blockquote>
<p>本文需要完成两件事情：</p>
<ul>
<li>配置基本的开发环境</li>
<li>让代码先运行一下</li>
</ul>
<p>如果你使用的 macOS, 那么可以跟着下文一步一步走。如果是 linux/window 用户，可能稍微需要在配置环境上多花点时间。</p>
<blockquote>
<p>本文默认你至少会在 iTerm2 下面使用基本的 bash 命令与 git , 如果使用的 ohmyzsh 就更好了。 建议先参考请查看我之前的文章里面的配置环境 如何优雅地使用 macOS <a href="https://zhuanlan.zhihu.com/p/29892969">https://zhuanlan.zhihu.com/p/29892969</a></p>
</blockquote>
<h2 id="0x01-python-开发环境配置">0x01 Python 开发环境配置</h2>
<p>本小节的目的就是配置好基本的 python 开发环境</p>
<p>使用了神器 pyenv</p>
<blockquote>
<p>BTW: 为什么不直接用 pipenv ? 因为网络不通畅，如若不然，pipenv 比 pyenv 更适合用来做 python 依赖包管理。</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 新开终端</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">yyuu</span><span class="o">/</span><span class="n">pyenv</span><span class="o">.</span><span class="n">git</span> <span class="o">~/.</span><span class="n">pyenv</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">yyuu</span><span class="o">/</span><span class="n">pyenv</span><span class="o">-</span><span class="n">virtualenv</span><span class="o">.</span><span class="n">git</span> <span class="o">~/.</span><span class="n">pyenv</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">pyenv</span><span class="o">-</span><span class="n">virtualenv</span>
<span class="n">echo</span> <span class="s1">&#39;export PYENV_ROOT=&#34;$HOME/.pyenv&#34;&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">~/.</span><span class="n">zshrc</span>
<span class="n">echo</span> <span class="s1">&#39;export PATH=&#34;$PYENV_ROOT/bin:$PATH&#34;&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">~/.</span><span class="n">zshrc</span>
<span class="n">echo</span> <span class="s1">&#39;eval &#34;$(pyenv init -)&#34;&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">~/.</span><span class="n">zshrc</span>
<span class="n">echo</span> <span class="s1">&#39;eval &#34;$(pyenv virtualenv-init -)&#34;&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">~/.</span><span class="n">zshrc</span>

<span class="c1"># 接着另开终端</span>
<span class="c1"># 不喜写兼容代码，所有代码均向 3.5+ 靠拢</span>
<span class="n">v</span><span class="o">=</span><span class="mf">3.5</span><span class="o">.</span><span class="mi">2</span><span class="o">|</span><span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">sohu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="err">$</span><span class="n">v</span><span class="o">/</span><span class="n">Python</span><span class="o">-</span><span class="err">$</span><span class="n">v</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">xz</span> <span class="o">-</span><span class="n">P</span> <span class="o">~/.</span><span class="n">pyenv</span><span class="o">/</span><span class="n">cache</span><span class="o">/</span><span class="p">;</span><span class="n">pyenv</span> <span class="n">install</span> <span class="err">$</span><span class="n">v</span>
<span class="n">v</span><span class="o">=</span><span class="mf">3.6</span><span class="o">.</span><span class="mi">0</span><span class="o">|</span><span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">sohu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="err">$</span><span class="n">v</span><span class="o">/</span><span class="n">Python</span><span class="o">-</span><span class="err">$</span><span class="n">v</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">xz</span> <span class="o">-</span><span class="n">P</span> <span class="o">~/.</span><span class="n">pyenv</span><span class="o">/</span><span class="n">cache</span><span class="o">/</span><span class="p">;</span><span class="n">pyenv</span> <span class="n">install</span> <span class="err">$</span><span class="n">v</span>
<span class="n">v</span><span class="o">=</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">11</span><span class="o">|</span><span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">sohu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="err">$</span><span class="n">v</span><span class="o">/</span><span class="n">Python</span><span class="o">-</span><span class="err">$</span><span class="n">v</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">xz</span> <span class="o">-</span><span class="n">P</span> <span class="o">~/.</span><span class="n">pyenv</span><span class="o">/</span><span class="n">cache</span><span class="o">/</span><span class="p">;</span><span class="n">pyenv</span> <span class="n">install</span> <span class="err">$</span><span class="n">v</span>

<span class="c1"># 设置 Global Python 为 2.7.11, 备注：尽量不要把 Py3 设置为全局，否则由于 Homebrew 本身有一些依赖是依赖于 Py2 的，这样容易出现一些奇怪的问题。</span>
<span class="n">pyenv</span> <span class="k">global</span> <span class="mf">2.7</span><span class="o">.</span><span class="mi">11</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">i</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">doubanio</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">simple</span> <span class="n">requests</span>
<span class="c1"># 下面这个是用于安装基本的代码补全功能</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">i</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">doubanio</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">simple</span> <span class="o">--</span><span class="n">upgrade</span> <span class="s2">&#34;jedi&gt;=0.9.0&#34;</span> <span class="s2">&#34;json-rpc&gt;=1.8.1&#34;</span> <span class="s2">&#34;service_factory&gt;=0.1.5&#34;</span> <span class="n">flake8</span> <span class="n">pytest</span> <span class="n">autoflake</span> <span class="n">hy</span>

<span class="c1"># 创建最常用 Py3 虚拟环境</span>
<span class="n">pyenv</span> <span class="n">virtualenv</span> <span class="mf">3.5</span><span class="o">.</span><span class="mi">2</span> <span class="n">py3</span><span class="o">-</span><span class="n">daily</span>
<span class="n">pyenv</span> <span class="n">activate</span> <span class="n">py3</span><span class="o">-</span><span class="n">daily</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">i</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">doubanio</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">simple</span> <span class="n">requests</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">i</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">doubanio</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">simple</span> <span class="n">beatutifulsoup4</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">i</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">doubanio</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">simple</span> <span class="n">ipython</span><span class="p">[</span><span class="n">notebook</span><span class="p">]</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">i</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">doubanio</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">simple</span> <span class="n">jupyter</span>
<span class="c1"># 下面这个是用于安装基本的代码补全功能</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">i</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">doubanio</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">simple</span> <span class="o">--</span><span class="n">upgrade</span> <span class="s2">&#34;jedi&gt;=0.9.0&#34;</span> <span class="s2">&#34;json-rpc&gt;=1.8.1&#34;</span> <span class="s2">&#34;service_factory&gt;=0.1.5&#34;</span> <span class="n">flake8</span> <span class="n">pytest</span> <span class="n">autoflake</span> <span class="n">hy</span>
</code></pre></div><p>好，Python 环境就安装完毕了。</p>
<h2 id="0x02-javascript-开发环境配置">0x02 JavaScript 开发环境配置</h2>
<blockquote>
<p>本小节的目的就是配置好基本的 JS 开发环境，但估计 JSer 看了本小节依旧可以在配置上少一些麻烦。</p>
</blockquote>
<p>JS 可以前后端通吃，社区生态很丰富。ES6 之后从 python 和 ruby 里面借鉴了不少语法糖。现在写起来还是比较愉悦的。</p>
<p>JavaScript 不管开发前端应用还是后端应用，都需要安装 node 环境。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 先安装 nvm</span>
curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh <span class="p">|</span> bash
<span class="c1"># 新开终端</span>
nvm install <span class="m">8</span>
nvm use <span class="m">8</span>
nvm <span class="nb">alias</span> default <span class="m">8</span>

npm install cnpm
cnpm install yarn -g
<span class="c1"># 设置镜像</span>
yarn config <span class="nb">set</span> registry https://registry.npm.taobao.org
</code></pre></div><p>编辑 ~/.npmrc 配置文件，输入下文再配置各种奇奇怪怪的镜像地址。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">registry</span><span class="o">=</span>https://registry.npm.taobao.org/
<span class="nv">chromedriver_cdnurl</span><span class="o">=</span>http://cdn.npm.taobao.org/dist/chromedriver
<span class="nv">disturl</span><span class="o">=</span>https://npm.taobao.org/dist
<span class="nv">operadriver_cdnurl</span><span class="o">=</span>http://cdn.npm.taobao.org/dist/operadriver
<span class="nv">phantomjs_cdnurl</span><span class="o">=</span>http://cdn.npm.taobao.org/dist/phantomjs
<span class="nv">fse_binary_host_mirror</span><span class="o">=</span>https://npm.taobao.org/mirrors/fsevents
<span class="nv">sass_binary_site</span><span class="o">=</span>http://cdn.npm.taobao.org/dist/node-sass
<span class="nv">electron_mirror</span><span class="o">=</span>http://cdn.npm.taobao.org/dist/electron/
</code></pre></div><p>配置完毕</p>
<h2 id="0x03-docker-安装与配置">0x03 Docker 安装与配置</h2>
<blockquote>
<p>本小节主要解决一个最蛋疼的问题，就是网络问题</p>
</blockquote>
<p>下载并安装 docker for mac 地址如下 <a href="https://docs.docker.com/docker-for-mac/install/">https://docs.docker.com/docker-for-mac/install/</a></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 安装成功后运行命令</span>
docker run hello-world
</code></pre></div><p>如果一切正常，则会显示如下</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ docker run hello-world
Unable to find image <span class="s1">&#39;hello-world:latest&#39;</span> locally
latest: Pulling from library/hello-world
ca4f61b1923c: Pull <span class="nb">complete</span>
Digest: sha256:083de497cff944f969d8499ab94f07134c50bcf5e6b9559b27182d3fa80ce3f7
Status: Downloaded newer image <span class="k">for</span> hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the <span class="s2">&#34;hello-world&#34;</span> image from the Docker Hub.
    <span class="o">(</span>amd64<span class="o">)</span>
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://cloud.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/engine/userguide/
</code></pre></div><p>好，配置到这里。</p>
<p>你以为你已经配置好了，还先别激动，网络问题还没解决呢。小的镜像可以直接从 Docker 上直接拖下来，几百兆的镜像可就没这么容易了。</p>
<p>这里我们使用了阿里云的 Docker 容器镜像。</p>
<p>登录阿里云，到控制台，找到容器镜像服务，镜像加速器，</p>
<p>如下图：</p>
<p>右键点击桌面顶栏的 docker 图标，选择 Preferences ，在 Daemon 标签（Docker 17.03 之前版本为 Advanced 标签）下的 Registry mirrors 列表中将 <a href="https://your-url.mirror.aliyuncs.com">https://your-url.mirror.aliyuncs.com</a> 加到&quot;registry-mirrors&quot;的数组里，点击 Apply &amp; Restart 按钮，等待 Docker 重启并应用配置的镜像加速器。</p>
<p>Docker 配置完毕。</p>
<h2 id="0x04-项目试运行">0x04 项目试运行</h2>
<p>运行项目之前，保持你我的工作环境基本一致</p>
<ul>
<li>创建一些必须的目录</li>
<li>clone 项目</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">mkdir -p ~/Codes/YaBlog/DockerVolume/YaDjangoBlog/PostgreSQL/data
mkdir -p ~/Codes/YaBlog/DockerVolume/YaDjangoBlog/Redis/data
mkdir -p ~/Codes/YaBlog/DockerVolume/YaDjangoBlog/Backups
<span class="nb">cd</span> ~/Codes/YaBlog/
git clone git@github.com:twocucao/YaVueBlog.git
git clone git@github.com:twocucao/YaDjangoBlog.git
</code></pre></div><p>克隆下来项目之后还需要稍微折腾一下（没办法，CURD 开发 = 折腾折腾折腾 + 搬砖搬砖搬砖）</p>
<ul>
<li>运行 Vue 开发环境</li>
<li>运行 Docker 化的 django 环境</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 新开一个终端 用于运行 Vue 应用</span>
<span class="c1"># 前端环境不放在 Docker 环境中。（因为开发环境没必要，生产环境才需要）</span>
<span class="nb">cd</span> ~/Codes/YaBlog/YaVueBlog/ <span class="o">&amp;&amp;</span> yarn <span class="o">&amp;&amp;</span> <span class="nb">cd</span> -
<span class="nb">cd</span> ~/Codes/YaBlog/YaVueBlog/packages/theme-future/ <span class="o">&amp;&amp;</span> yarn <span class="o">&amp;&amp;</span> <span class="nb">cd</span> -
<span class="nb">cd</span> ~/Codes/YaBlog/YaVueBlog/
npm run build:theme
npm run dev
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 新开一个终端</span>
<span class="nb">cd</span> ~/Codes/YaBlog/YaDjangoBlog/
make
</code></pre></div><p>看到下图，包含所有的命令。</p>
<p>这是我用 Makefile 编写的一系列命令，方便我在开发过程将主要的精力花在业务逻辑上而不是花时间在强记大量的琐碎的命令。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> ~/Codes/YaBlog/YaDjangoBlog/
make build-all
<span class="c1"># 等待运行后端所有组件</span>
</code></pre></div><p>然后，读者可以先去泡杯咖啡点个外卖吃个饭之类的。等待构建完毕。</p>
<p>需要注意的是，务必配置好 docker 镜像加速地址，否则根据国内情况，你可能需要多去泡几杯咖啡，多吃几顿饭。</p>
<p>好，接下来我们运行后端程序，首次运行需要花费不少时间</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> ~/Codes/YaBlog/YaDjangoBlog/
make django-just-up
</code></pre></div><p>运行之后，终端结果如下：</p>
<p>可以发现，服务已经都开始启动了。</p>
<p>但不要冲动，先等等，因为一次开了如下的服务：</p>
<ul>
<li>postgres</li>
<li>redis</li>
<li>elasticsearch</li>
<li>mailhog</li>
<li>django</li>
<li>celerybeat</li>
<li>celeryworker</li>
<li>celeryflower</li>
</ul>
<p>需要多等会儿时间到各个服务运行正常。直到出现下图：</p>
<p>这意味着基本上所有的程序都运行正常了。如果有服务挂掉，欢迎到 github 的 issue 上提一下。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 接着再新开一个终端 用于导入基础数据</span>
<span class="nb">cd</span> ~/Codes/YaBlog/YaDjangoBlog/
make django-import-articles
</code></pre></div><p>好，那么，我们来验证一下如下几个地址：</p>
<ul>
<li>接口地址 http://localhost:8000/api/v1/archive</li>
<li>Vue 地址 http://localhost:8080/</li>
<li>在搜索框内输入 elasticsearch 查看接口是否正常返回数据</li>
<li>查看 celery 的 task 是否正确</li>
</ul>
<p>如果一切正常，则所有的截图应该如下</p>
<h2 id="0x05-tmux-和-tmuxinator">0x05 Tmux 和 Tmuxinator</h2>
<p>我们在上文中可以发现有个极其蛋疼菊紧的问题。</p>
<p>当我们运行 make django-just-up 这个命令的时候，所有服务运行的同时，所有的标准输入都打印到一个终端。</p>
<p>这个和我们日常开发不太相同</p>
<ol>
<li>在 django 开发的时候，我们运行 runserver, 肯定是只想在那个终端里看到 runserver 的运行情况。而不是 Redis,Elasticsearch,PGsql 之类的 log。</li>
<li>并且，django 的热加载会有些小问题，有些错误只能 ctrl+c 关掉 runserver, 然后重启。但当我们想 ctrl+c 关掉 runserver 的时候，却把所有的的服务都关掉了。</li>
</ol>
<p>解决方式也简单：</p>
<p>对于暂时不想在开发时看到日志的服务，干脆直接放后台运行，执行我封装的命令 make django-before-up 把部分服务直接放在后台里，然后再开四个终端，运行下面的命令。</p>
<ul>
<li>make django-runserver # 运行 runserver , 并只把该容器的 log 打印出来。下面三者同上。</li>
<li>make django-celerybeat</li>
<li>make django-celeryworker</li>
<li>make django-celeryflower</li>
</ul>
<p>显然还是很麻烦，我这种懒人可是能少写几行代码就少些几行代码的。</p>
<p>那么我们还可以更省事（懒一些）么？</p>
<p>我之前写了一篇简单的 tmux 与 Tmuxinator 教程 <a href="https://zhuanlan.zhihu.com/p/33369297">https://zhuanlan.zhihu.com/p/33369297</a> , 具体配置步骤参考文中即可。</p>
<p>配置好 Tmuxinator 之后</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 先软连接一下</span>
ln -svf ~/Codes/YaBlog/YaDjangoBlog/yadjangoblog.yml ~/.tmuxinator/yadjangoblog.yml
</code></pre></div><p>当我需要运行的所有服务的时候，我只需要</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">tmuxinator start yadjangoblog
</code></pre></div><p>就可以开启所有命令。</p>
<p>yadjangoblog.yml 的内容如下</p>
<pre><code>windows:
  - &quot;前端-页面开发&quot;:
      root: ~/Codes/YaBlog/YaVueBlog/
      layout: main-vertical
      panes:
        - &quot;前端页面 DEV&quot;:
          - &quot;npm run dev&quot;
  - &quot;前端-CSS 与字体文件&quot;:
      root: ~/Codes/YaBlog/YaVueBlog/
      layout: main-vertical
      panes:
        - &quot;npm run dev:theme&quot;
        - &quot;npm run dev:iconfont&quot;
  - &quot;后端-Django 及其服务&quot;:
      root: ~/Codes/YaBlog/YaDjangoBlog/
      layout: main-vertical
      panes:
        - &quot;make django-before-up &amp;&amp; make django-runserver&quot;
  - &quot;后端-数据库相关&quot;:
      layout: main-vertical
      root: ~/Codes/YaBlog/YaDjangoBlog/
      panes:
        - &quot;sleep 20 &amp;&amp; make dbshell&quot;
        - &quot;sleep 20 &amp;&amp; make shell&quot;
  - &quot;后端-Celery&quot;:
      layout: main-vertical
      root: ~/Codes/YaBlog/YaDjangoBlog/
      panes:
        - &quot;sleep 20 &amp;&amp; make django-celerybeat&quot;
        - &quot;sleep 20 &amp;&amp; make django-celeryworker&quot;
</code></pre><h2 id="0x06-pycharm-基本设置">0x06 PyCharm 基本设置</h2>
<blockquote>
<p>大家应该都用 PyCharm 进行开发了吧。 如果是的话，不看本小节可能会让你栽个跟头</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 这步是给 pycharm 打开代码做准备</span>
pyenv activate py3-daily
pip install -i https://pypi.doubanio.com/simple -r requirements/local.txt
</code></pre></div><p>务必完成下面两个步骤</p>
<ol>
<li>在 Preferences -&gt; project -&gt; interpreter 选择对应的 py3-daily 虚拟环境。</li>
<li>在侧边栏把 yadjangoblog , 注意小写的。右键标记为 sources root</li>
</ol>
<p>这样的标记相当于告诉 PyCharm , 这个项目的 PYTHONPATH 是 yadjangoblog/ , 否则使用 PyCharm 导入 AModel 会自动导入 from yadjangoblog.yaadmin.models from AModel 而不是 from yaadmin.models import AModel , 这会导致程序运行错误。</p>
<blockquote>
<p>PS: 包括后面跑单元测试的时候，均手动设置了 PYTHONPATH 变量。</p>
</blockquote>
<h2 id="0x07-开发流程">0x07 开发流程</h2>
<p>本小节，从笔者开机开始，回顾一下环境配置好之后，笔者是如何进入开发状态的：</p>
<ol>
<li>开机。输入密码进入桌面。</li>
<li>打开 Iterm, 运行 tmuxinator start yadjangoblog 开启项目。打开 PyCharm 和 WebStorm</li>
<li>开发</li>
</ol>
<ul>
<li>在 WebStorm 中写写前端代码，在 http://localhost:8080 和 tmux 里的第一个 window 查看状态</li>
<li>在 PyCharm 中写写后端代码，在第三个 window 查看 runserver 状态，在第四个 window 的两个 Panel 运行 python manage.py 相关命令。</li>
<li>在 Chrome Elasticsearch Head 扩展里调试 Elasticsearch 语法</li>
<li>在 http://localhost:8000/api/your-api-path 里调试前后端 API</li>
<li>在 http://localhost:5555 通过 flower 查看相关</li>
<li>&hellip;..</li>
<li>当然，你也可以新开一个终端里面，执行 make 查看相关还可以执行哪些命令。</li>
</ul>
<p>那么，具体执行这些命令背后究竟发生了什么？</p>
<ul>
<li>数十服务为何突然启动</li>
<li>数百个任务为何半夜消失</li>
<li>正常运行的服务为何屡屡崩溃</li>
<li>这一切的背后！是工程师的人性扭曲还是码畜的道德沦丧？是内存的爆发还是处理器的无奈？</li>
<li>敬请关注本专栏 『MG 的编程小屋』或者 Github 频道，让我们跟随教程走进全干工程师的代码世界。</li>
</ul>
<blockquote>
<p>不好意思，顺手打了个硬广，防止别人把我的文章砍头去尾直接扒过去。</p>
</blockquote>
<h2 id="0xee-参考链接">0xEE. 参考链接</h2>
<p>还犹豫啥，点赞后，快上车吧</p>
<ul>
<li>前端代码 <a href="https://github.com/twocucao/YaVueBlog">https://github.com/twocucao/YaVueBlog</a></li>
<li>后端代码 <a href="https://github.com/twocucao/YaDjangoBlog">https://github.com/twocucao/YaDjangoBlog</a></li>
</ul>
<hr>
<p>ChangeLog:</p>
<ul>
<li><strong>2018-02-22</strong> 重修文字</li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2020-01-01</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/python/">Python</a>,&nbsp;<a href="/tags/django/">Django</a>,&nbsp;<a href="/tags/yadjangoblog/">YaDjangoBlog</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/20180221_fullstackdjangodevops/" class="prev" rel="prev" title="2018 年不容错过的 Django 全栈项目"><i class="fas fa-angle-left fa-fw"></i>2018 年不容错过的 Django 全栈项目</a>
            <a href="/posts/20180223_yadjangoblog%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E7%AF%87/" class="next" rel="next" title="YaDjangoBlog 之前后端分离篇">YaDjangoBlog 之前后端分离篇<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.79.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="http://twocucao.xyz" target="_blank">twocucao</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
